##############################################################################
#                                                                            #
# IAR ARM ANSI C/C++ Compiler V4.42A/W32 EVALUATION    13/Jan/2011  22:52:21 #
# Copyright 1999-2005 IAR Systems. All rights reserved.                      #
#                                                                            #
#    Cpu mode        =  interwork                                            #
#    Endian          =  little                                               #
#    Stack alignment =  4                                                    #
#    Source file     =  C:\arm\mss3\sms_dat.c                                #
#    Command line    =  C:\arm\mss3\sms_dat.c -D NEWSGOLD -D ELKA -D         #
#                       LANG_EN -D NO_CS -lC C:\arm\mss3\Release_ELKA_EN\Lis #
#                       t\ -o C:\arm\mss3\Release_ELKA_EN\Obj\ -s9           #
#                       --no_unroll --cpu_mode arm --endian little --cpu     #
#                       ARM926EJ-S --stack_align 4 --interwork -e --fpu      #
#                       None --dlib_config "C:\arm2\Embedded Workbench 4.0   #
#                       Evaluation\ARM\LIB\dl5tpainl8n.h" -I                 #
#                       "C:\arm2\Embedded Workbench 4.0                      #
#                       Evaluation\ARM\INC\" --inline_threshold=2            #
#    List file       =  C:\arm\mss3\Release_ELKA_EN\List\sms_dat.lst         #
#    Object file     =  C:\arm\mss3\Release_ELKA_EN\Obj\sms_dat.r79          #
#                                                                            #
#                                                                            #
##############################################################################

C:\arm\mss3\sms_dat.c
      1          #include "..\inc\swilib.h"
      2          #include "sms_dat.h"
      3          #include "adrList.h"
      4          #include "language.h"
      5          #include "config_data.h"
      6          
      7          #include "MySMSYS_ipc.h"
      8          
      9          #include "main.h"
     10          #include "string_works.h"
     11          #include "NewDatReader.h"
     12          #include "Filter.h"

   \                                 In segment DATA_Z, align 4, align-sorted
     13          SMS_DATA *sdltop=0;
   \                     sdltop:
   \   00000000                      DS8 4
     14          

   \                                 In segment CODE, align 4, keep-with-next
     15          void delSDList(SMS_DATA *sdl)
     16          {
   \                     delSDList:
   \   00000000   10402DE9           PUSH     {R4,LR}
   \   00000004   0040B0E1           MOVS     R4,R0
     17          	SMS_DATA *sdn;
     18          	SMS_DATA *sdp;
     19          	if(sdl)
   \   00000008   1080BD08           POPEQ    {R4,PC}
     20          	{
     21          		LockSched();
   \   0000000C   460100EF           SWI      +326
     22          		sdn=sdl->next;
     23          		sdp=sdl->prev;
     24          		if(sdl==sdltop)
   \   00000010   ........           LDR      R2,??DataTable7  ;; sdltop
   \   00000014   000094E5           LDR      R0,[R4, #+0]
   \   00000018   041094E5           LDR      R1,[R4, #+4]
   \   0000001C   003092E5           LDR      R3,[R2, #+0]
   \   00000020   030054E1           CMP      R4,R3
     25          			sdltop=sdn;
   \   00000024   00008205           STREQ    R0,[R2, #+0]
     26          		if(sdn)
   \   00000028   000050E3           CMP      R0,#+0
     27          			sdn->prev=sdp;
   \   0000002C   04108015           STRNE    R1,[R0, #+4]
     28          		if(sdp)
   \   00000030   000051E3           CMP      R1,#+0
     29          			sdp->next=sdn;
   \   00000034   00008115           STRNE    R0,[R1, #+0]
     30          		UnlockSched();
   \   00000038   470100EF           SWI      +327
     31          		if((sdl->isfile==1)&&(sdl->fname!=0))
   \   0000003C   140094E5           LDR      R0,[R4, #+20]
   \   00000040   010050E3           CMP      R0,#+1
   \   00000044   0300001A           BNE      ??delSDList_0
   \   00000048   200094E5           LDR      R0,[R4, #+32]
   \   0000004C   000050E3           CMP      R0,#+0
   \   00000050   0000000A           BEQ      ??delSDList_0
     32          			mfree(sdl->fname);
   \   00000054   150000EF           SWI      +21
     33          		if(sdl->SMS_TEXT)
   \                     ??delSDList_0:
   \   00000058   640094E5           LDR      R0,[R4, #+100]
   \   0000005C   000050E3           CMP      R0,#+0
   \   00000060   0000000A           BEQ      ??delSDList_1
     34          			FreeWS(sdl->SMS_TEXT);
   \   00000064   290100EF           SWI      +297
     35          		mfree(sdl);
   \                     ??delSDList_1:
   \   00000068   0400A0E1           MOV      R0,R4
   \   0000006C   150000EF           SWI      +21
     36          	}
     37          }
   \   00000070   1080BDE8           POP      {R4,PC}          ;; return
     38          

   \                                 In segment CODE, align 4, keep-with-next
     39          void freeSDList(void)
     40          {
   \                     freeSDList:
   \   00000000   70402DE9           PUSH     {R4-R6,LR}
     41          	SMS_DATA *sdl;
     42          	LockSched();
   \   00000004   460100EF           SWI      +326
     43          	sdl=sdltop;
   \   00000008   ........           LDR      R0,??DataTable7  ;; sdltop
     44          	sdltop=0;
   \   0000000C   0010A0E3           MOV      R1,#+0
   \   00000010   004090E5           LDR      R4,[R0, #+0]
   \   00000014   001080E5           STR      R1,[R0, #+0]
     45          	UnlockSched();
   \   00000018   470100EF           SWI      +327
   \   0000001C   000054E3           CMP      R4,#+0
   \   00000020   7080BD08           POPEQ    {R4-R6,PC}
     46          	while(sdl)
     47          	{
     48          		SMS_DATA *sdlx;
     49          		sdlx=sdl;
   \                     ??freeSDList_0:
   \   00000024   0450A0E1           MOV      R5,R4
     50          		sdl=sdl->next;
   \   00000028   004094E5           LDR      R4,[R4, #+0]
     51          		if((sdlx->isfile==1)&&(sdlx->fname!=0))
   \   0000002C   146085E2           ADD      R6,R5,#+20
   \   00000030   000096E5           LDR      R0,[R6, #+0]
   \   00000034   010050E3           CMP      R0,#+1
   \   00000038   0300001A           BNE      ??freeSDList_1
   \   0000003C   0C0096E5           LDR      R0,[R6, #+12]
   \   00000040   000050E3           CMP      R0,#+0
   \   00000044   0000000A           BEQ      ??freeSDList_1
     52          			mfree(sdlx->fname);
   \   00000048   150000EF           SWI      +21
     53          		if(sdlx->SMS_TEXT)
   \                     ??freeSDList_1:
   \   0000004C   500096E5           LDR      R0,[R6, #+80]
   \   00000050   000050E3           CMP      R0,#+0
   \   00000054   0000000A           BEQ      ??freeSDList_2
     54          			FreeWS(sdlx->SMS_TEXT);
   \   00000058   290100EF           SWI      +297
     55          		mfree(sdlx);
   \                     ??freeSDList_2:
   \   0000005C   0500A0E1           MOV      R0,R5
   \   00000060   150000EF           SWI      +21
     56          	}
   \   00000064   000054E3           CMP      R4,#+0
   \   00000068   EDFFFF1A           BNE      ??freeSDList_0
     57          }
   \   0000006C   7080BDE8           POP      {R4-R6,PC}       ;; return
     58          

   \                                 In segment CODE, align 4, keep-with-next
     59          int getCountByType(int type) //0, all
     60          {
     61            int i=0;
     62            SMS_DATA *sdl=sdltop;
   \                     getCountByType:
   \   00000000   ........           LDR      R2,??DataTable7  ;; sdltop
   \   00000004   00402DE9           PUSH     {LR}
   \   00000008   002092E5           LDR      R2,[R2, #+0]
   \   0000000C   0010A0E3           MOV      R1,#+0
     63            if(type>0&&type<5)
   \   00000010   010050E3           CMP      R0,#+1
   \   00000014   080000BA           BLT      ??getCountByType_0
   \   00000018   050050E3           CMP      R0,#+5
   \   0000001C   060000AA           BGE      ??getCountByType_0
     64            {
     65              while(sdl)
   \                     ??getCountByType_1:
   \   00000020   000052E3           CMP      R2,#+0
   \   00000024   1700000A           BEQ      ??getCountByType_2
     66              {
     67                if(sdl->type==type)
   \   00000028   083092E5           LDR      R3,[R2, #+8]
     68          	i++;
     69                sdl=sdl->next;
   \   0000002C   002092E5           LDR      R2,[R2, #+0]
   \   00000030   000053E1           CMP      R3,R0
   \   00000034   01108102           ADDEQ    R1,R1,#+1
   \   00000038   F8FFFFEA           B        ??getCountByType_1
     70              }
     71            }
     72            else if(type==TYPE_IN_ALL)
   \                     ??getCountByType_0:
   \   0000003C   050050E3           CMP      R0,#+5
   \   00000040   0800001A           BNE      ??getCountByType_3
     73            {
     74              while(sdl)
   \                     ??getCountByType_4:
   \   00000044   000052E3           CMP      R2,#+0
   \   00000048   0E00000A           BEQ      ??getCountByType_2
     75              {
     76                if((sdl->type==TYPE_IN_R)||(sdl->type==TYPE_IN_N)||(sdl->type==TYPE_IN_ALL))
   \   0000004C   080092E5           LDR      R0,[R2, #+8]
     77          	i++;
     78                sdl=sdl->next;
   \   00000050   002092E5           LDR      R2,[R2, #+0]
   \   00000054   020050E3           CMP      R0,#+2
   \   00000058   03005013           CMPNE    R0,#+3
   \   0000005C   05005013           CMPNE    R0,#+5
   \   00000060   01108102           ADDEQ    R1,R1,#+1
   \   00000064   F6FFFFEA           B        ??getCountByType_4
     79              }
     80            }
     81            else if(type==TYPE_FILTER)
   \                     ??getCountByType_3:
   \   00000068   0F0050E3           CMP      R0,#+15
   \   0000006C   0300001A           BNE      ??getCountByType_5
     82            {
     83              return (FilterGetCountSDL());
   \   00000070   ........           _BLF     FilterGetCountSDL,??FilterGetCountSDL??rA
   \   00000074   0080BDE8           POP      {PC}
     84            }
     85            else
     86            {
     87              while(sdl)
     88              {
     89                i++;
     90                sdl=sdl->next;
   \                     ??getCountByType_6:
   \   00000078   002092E5           LDR      R2,[R2, #+0]
   \   0000007C   011081E2           ADD      R1,R1,#+1
     91              }
   \                     ??getCountByType_5:
   \   00000080   000052E3           CMP      R2,#+0
   \   00000084   FBFFFF1A           BNE      ??getCountByType_6
     92            }
     93            return i;
   \                     ??getCountByType_2:
   \   00000088   0100A0E1           MOV      R0,R1
   \   0000008C   0080BDE8           POP      {PC}             ;; return
     94          }
     95          
     96          

   \                                 In segment CODE, align 4, keep-with-next
     97          int GetCountByIsFileType(int isfile, int type) //0, all
     98          {
     99            int i=0;
    100            SMS_DATA *sdl=sdltop;
   \                     GetCountByIsFileType:
   \   00000000   ........           LDR      R3,??DataTable7  ;; sdltop
   \   00000004   0020A0E3           MOV      R2,#+0
   \   00000008   003093E5           LDR      R3,[R3, #+0]
    101            if(type>0&&type<5)
   \   0000000C   010051E3           CMP      R1,#+1
   \   00000010   0A0000BA           BLT      ??GetCountByIsFileType_0
   \   00000014   050051E3           CMP      R1,#+5
   \   00000018   080000AA           BGE      ??GetCountByIsFileType_0
    102            {
    103              while(sdl)
   \                     ??GetCountByIsFileType_1:
   \   0000001C   000053E3           CMP      R3,#+0
   \   00000020   1900000A           BEQ      ??GetCountByIsFileType_2
    104              {
    105                if((sdl->type==type) && sdl->isfile==isfile)
   \   00000024   08C093E5           LDR      R12,[R3, #+8]
   \   00000028   01005CE1           CMP      R12,R1
   \   0000002C   14C09305           LDREQ    R12,[R3, #+20]
    106          	i++;
    107                sdl=sdl->next;
   \   00000030   003093E5           LDR      R3,[R3, #+0]
   \   00000034   00005C01           CMPEQ    R12,R0
   \   00000038   01208202           ADDEQ    R2,R2,#+1
   \   0000003C   F6FFFFEA           B        ??GetCountByIsFileType_1
    108              }
    109            }
    110            else if(type==TYPE_IN_ALL)
   \                     ??GetCountByIsFileType_0:
   \   00000040   050051E3           CMP      R1,#+5
   \   00000044   0E00001A           BNE      ??GetCountByIsFileType_3
    111            {
    112              int t;
    113              while(sdl)
   \                     ??GetCountByIsFileType_4:
   \   00000048   000053E3           CMP      R3,#+0
   \   0000004C   0E00000A           BEQ      ??GetCountByIsFileType_2
    114              {
    115                t=sdl->type;
   \   00000050   081093E5           LDR      R1,[R3, #+8]
    116                if(((t==TYPE_IN_R)||(t==TYPE_IN_N)||(t==TYPE_IN_ALL)) && sdl->isfile==isfile)
   \   00000054   020051E3           CMP      R1,#+2
   \   00000058   03005113           CMPNE    R1,#+3
   \   0000005C   05005113           CMPNE    R1,#+5
   \   00000060   14109305           LDREQ    R1,[R3, #+20]
    117          	i++;
    118                sdl=sdl->next;
   \   00000064   003093E5           LDR      R3,[R3, #+0]
   \   00000068   00005101           CMPEQ    R1,R0
   \   0000006C   01208202           ADDEQ    R2,R2,#+1
   \   00000070   F4FFFFEA           B        ??GetCountByIsFileType_4
    119              }
    120            }
    121            else
    122            {
    123              while(sdl)
    124              {
    125                if(sdl->isfile==isfile)
   \                     ??GetCountByIsFileType_5:
   \   00000074   141093E5           LDR      R1,[R3, #+20]
    126          	i++;
    127                sdl=sdl->next;
   \   00000078   003093E5           LDR      R3,[R3, #+0]
   \   0000007C   000051E1           CMP      R1,R0
   \   00000080   01208202           ADDEQ    R2,R2,#+1
    128              }
   \                     ??GetCountByIsFileType_3:
   \   00000084   000053E3           CMP      R3,#+0
   \   00000088   F9FFFF1A           BNE      ??GetCountByIsFileType_5
    129            }
    130            return i;
   \                     ??GetCountByIsFileType_2:
   \   0000008C   0200A0E1           MOV      R0,R2
   \   00000090   1EFF2FE1           BX       LR               ;; return
    131          }
    132          

   \                                 In segment CODE, align 4, keep-with-next
    133          SMS_DATA *getSMSDataByType(int n, int type)//0, all
    134          {
    135          	int i=0;
    136          	SMS_DATA *sdl=sdltop;
   \                     getSMSDataByType:
   \   00000000   ........           LDR      R2,??DataTable7  ;; sdltop
   \   00000004   00402DE9           PUSH     {LR}
   \   00000008   002092E5           LDR      R2,[R2, #+0]
   \   0000000C   0030A0E3           MOV      R3,#+0
    137          	if(type>0&&type<5)
   \   00000010   010051E3           CMP      R1,#+1
   \   00000014   010000BA           BLT      ??getSMSDataByType_0
   \   00000018   050051E3           CMP      R1,#+5
   \   0000001C   080000BA           BLT      ??getSMSDataByType_1
    138          	{
    139          		while(sdl)
    140          		{
    141          			if((i==n)&&(sdl->type==type))
    142          				return sdl;
    143          			if(sdl->type==type)
    144          				i++;
    145          			sdl=sdl->next;
    146          		}
    147          	}
    148          	else if(type==TYPE_IN_ALL)
   \                     ??getSMSDataByType_0:
   \   00000020   050051E3           CMP      R1,#+5
   \   00000024   1500000A           BEQ      ??getSMSDataByType_2
    149          	{
    150          		while(sdl)
    151          		{
    152          			if((i==n)&&((sdl->type==TYPE_IN_R)||(sdl->type==TYPE_IN_N)||(sdl->type==TYPE_IN_ALL)))
    153          				return sdl;
    154          			if((sdl->type==TYPE_IN_R)||(sdl->type==TYPE_IN_N)||(sdl->type==TYPE_IN_ALL))
    155          				i++;
    156          			sdl=sdl->next;
    157          		}
    158          	}
    159          	else if(type==TYPE_FILTER)
   \   00000028   0F0051E3           CMP      R1,#+15
   \   0000002C   2300001A           BNE      ??getSMSDataByType_3
    160          	{
    161          	  return (FilterFindSDL(n));
   \   00000030   ........           _BLF     FilterFindSDL,??FilterFindSDL??rA
   \   00000034   0080BDE8           POP      {PC}
    162          	}
   \                     ??getSMSDataByType_4:
   \   00000038   002092E5           LDR      R2,[R2, #+0]
   \   0000003C   01005CE1           CMP      R12,R1
   \   00000040   01308302           ADDEQ    R3,R3,#+1
   \                     ??getSMSDataByType_1:
   \   00000044   000052E3           CMP      R2,#+0
   \   00000048   1E00000A           BEQ      ??getSMSDataByType_5
   \   0000004C   08C092E5           LDR      R12,[R2, #+8]
   \   00000050   000053E1           CMP      R3,R0
   \   00000054   01005C01           CMPEQ    R12,R1
   \   00000058   F6FFFF1A           BNE      ??getSMSDataByType_4
   \                     ??getSMSDataByType_6:
   \   0000005C   0200A0E1           MOV      R0,R2
   \   00000060   0080BDE8           POP      {PC}
   \                     ??getSMSDataByType_7:
   \   00000064   020051E3           CMP      R1,#+2
   \   00000068   03005113           CMPNE    R1,#+3
   \   0000006C   0100000A           BEQ      ??getSMSDataByType_8
   \                     ??getSMSDataByType_9:
   \   00000070   050051E3           CMP      R1,#+5
   \   00000074   0000001A           BNE      ??getSMSDataByType_10
   \                     ??getSMSDataByType_8:
   \   00000078   013083E2           ADD      R3,R3,#+1
   \                     ??getSMSDataByType_10:
   \   0000007C   002092E5           LDR      R2,[R2, #+0]
   \                     ??getSMSDataByType_2:
   \   00000080   000052E3           CMP      R2,#+0
   \   00000084   0F00000A           BEQ      ??getSMSDataByType_5
   \   00000088   081092E5           LDR      R1,[R2, #+8]
   \   0000008C   000053E1           CMP      R3,R0
   \   00000090   F3FFFF1A           BNE      ??getSMSDataByType_7
   \   00000094   020051E3           CMP      R1,#+2
   \   00000098   03005113           CMPNE    R1,#+3
   \   0000009C   EEFFFF0A           BEQ      ??getSMSDataByType_6
   \   000000A0   050051E3           CMP      R1,#+5
   \   000000A4   F1FFFF1A           BNE      ??getSMSDataByType_9
   \   000000A8   0200A0E1           MOV      R0,R2
   \   000000AC   0080BDE8           POP      {PC}
    163          	else
    164          	{
    165          		while(sdl)
    166          		{
    167          			if(i==n)
   \                     ??getSMSDataByType_11:
   \   000000B0   000053E1           CMP      R3,R0
   \   000000B4   E8FFFF0A           BEQ      ??getSMSDataByType_6
    168          				return sdl;
    169          			sdl=sdl->next;
   \   000000B8   002092E5           LDR      R2,[R2, #+0]
    170          			i++;
   \   000000BC   013083E2           ADD      R3,R3,#+1
    171          		}
   \                     ??getSMSDataByType_3:
   \   000000C0   000052E3           CMP      R2,#+0
   \   000000C4   F9FFFF1A           BNE      ??getSMSDataByType_11
    172          	}
    173          	return 0;
   \                     ??getSMSDataByType_5:
   \   000000C8   0000A0E3           MOV      R0,#+0
   \   000000CC   0080BDE8           POP      {PC}             ;; return
    174          }
    175          

   \                                 In segment CODE, align 4, keep-with-next
    176          int getSDPos(SMS_DATA *sd)
    177          {
    178          	SMS_DATA *sdl=sdltop;
   \                     getSDPos:
   \   00000000   ........           LDR      R1,??DataTable7  ;; sdltop
   \   00000004   002091E5           LDR      R2,[R1, #+0]
    179          	int i=0;
   \   00000008   0010A0E3           MOV      R1,#+0
    180          	if(!sdl)
   \   0000000C   000052E3           CMP      R2,#+0
   \   00000010   0200001A           BNE      ??getSDPos_0
    181          		return -1;
   \                     ??getSDPos_1:
   \   00000014   0000E0E3           MVN      R0,#+0
   \   00000018   1EFF2FE1           BX       LR               ;; return
    182          	while(sdl->next) //goto last
    183          		sdl=sdl->next;
   \                     ??getSDPos_2:
   \   0000001C   0320A0E1           MOV      R2,R3
   \                     ??getSDPos_0:
   \   00000020   003092E5           LDR      R3,[R2, #+0]
   \   00000024   000053E3           CMP      R3,#+0
   \   00000028   FBFFFF1A           BNE      ??getSDPos_2
    184          	while(sdl)
   \                     ??getSDPos_3:
   \   0000002C   000052E3           CMP      R2,#+0
   \   00000030   F7FFFF0A           BEQ      ??getSDPos_1
    185          	{
    186          		if(sdl==sd)
   \   00000034   000052E1           CMP      R2,R0
    187          			return i;
   \   00000038   0100A001           MOVEQ    R0,R1
   \   0000003C   1EFF2F01           BXEQ     LR
    188          		sdl=sdl->prev;
   \   00000040   042092E5           LDR      R2,[R2, #+4]
    189          		i++;
   \   00000044   011081E2           ADD      R1,R1,#+1
   \   00000048   F7FFFFEA           B        ??getSDPos_3
    190          	}
    191          	return -1;
    192          }
    193          

   \                                 In segment CODE, align 4, keep-with-next
    194          void Hex2Num(char *hex, char *num, int len)
    195          {
   \                     Hex2Num:
   \   00000000   30002DE9           PUSH     {R4,R5}
    196          	int c;
    197          	int i=0,j;
    198          	char *p=hex;
    199          	len--;
    200          	if(*p==0x91)
   \   00000004   0040D0E5           LDRB     R4,[R0, #+0]
   \   00000008   0030A0E3           MOV      R3,#+0
   \   0000000C   012042E2           SUB      R2,R2,#+1
   \   00000010   910054E3           CMP      R4,#+145
    201          	{
    202          		num[i++]='+';
   \   00000014   2B30A003           MOVEQ    R3,#+43
   \   00000018   0030C105           STRBEQ   R3,[R1, #+0]
   \   0000001C   0130A003           MOVEQ    R3,#+1
    203          	}
    204          	p++;
   \   00000020   010080E2           ADD      R0,R0,#+1
    205          	for(j=0;j<len;j++)
   \   00000024   00C0A0E3           MOV      R12,#+0
   \   00000028   030000EA           B        ??Hex2Num_0
    206          	{
    207          		c=p[j]%0x10;
    208          		if(c>=0&&c<=9)
    209          			num[i++]=c+'0';
    210          		else
    211          			break;
    212          		c=p[j]/0x10;
    213          		if(c>=0&&c<=9)
    214          			num[i++]=c+'0';
   \                     ??Hex2Num_1:
   \   0000002C   304084E2           ADD      R4,R4,#+48
   \   00000030   0140C3E7           STRB     R4,[R3, +R1]
   \   00000034   013083E2           ADD      R3,R3,#+1
   \   00000038   01C08CE2           ADD      R12,R12,#+1
   \                     ??Hex2Num_0:
   \   0000003C   02005CE1           CMP      R12,R2
   \   00000040   0E0000AA           BGE      ??Hex2Num_2
   \   00000044   0040DCE7           LDRB     R4,[R12, +R0]
   \   00000048   0450A0E1           MOV      R5,R4
   \   0000004C   2552A0E1           LSR      R5,R5,#+4
   \   00000050   054254E0           SUBS     R4,R4,R5, LSL #+4
   \   00000054   0900004A           BMI      ??Hex2Num_2
   \   00000058   0A0054E3           CMP      R4,#+10
   \   0000005C   070000AA           BGE      ??Hex2Num_2
   \   00000060   304084E2           ADD      R4,R4,#+48
   \   00000064   0140C3E7           STRB     R4,[R3, +R1]
   \   00000068   0040DCE7           LDRB     R4,[R12, +R0]
   \   0000006C   013083E2           ADD      R3,R3,#+1
   \   00000070   2442B0E1           LSRS     R4,R4,#+4
   \   00000074   0100004A           BMI      ??Hex2Num_2
   \   00000078   0A0054E3           CMP      R4,#+10
   \   0000007C   EAFFFFBA           BLT      ??Hex2Num_1
    215          		else
    216          			break;
    217          	}
    218          	num[i]=0;
   \                     ??Hex2Num_2:
   \   00000080   0000A0E3           MOV      R0,#+0
   \   00000084   0100C3E7           STRB     R0,[R3, +R1]
    219          }
   \   00000088   3000BDE8           POP      {R4,R5}
   \   0000008C   1EFF2FE1           BX       LR               ;; return
    220          

   \                                 In segment CODE, align 4, keep-with-next
    221          void Add2WS(char *data, char *wsbody, int len)
    222          {
   \                     Add2WS:
   \   00000000   10002DE9           PUSH     {R4}
    223          	int i;
    224          	for(i=0;i<len;i+=2)
   \   00000004   0030A0E3           MOV      R3,#+0
   \   00000008   010052E3           CMP      R2,#+1
   \   0000000C   080000AA           BGE      ??Add2WS_0
   \   00000010   090000EA           B        ??Add2WS_1
    225          	{
    226          		wsbody[i+2]=data[i+1];
   \                     ??Add2WS_2:
   \   00000014   004083E0           ADD      R4,R3,R0
   \   00000018   0140D4E5           LDRB     R4,[R4, #+1]
   \   0000001C   01C083E0           ADD      R12,R3,R1
   \   00000020   0240CCE5           STRB     R4,[R12, #+2]
    227          		wsbody[i+3]=data[i];
   \   00000024   00C0D3E7           LDRB     R12,[R3, +R0]
   \   00000028   014083E0           ADD      R4,R3,R1
    228          	}
   \   0000002C   023083E2           ADD      R3,R3,#+2
   \   00000030   03C0C4E5           STRB     R12,[R4, #+3]
   \                     ??Add2WS_0:
   \   00000034   020053E1           CMP      R3,R2
   \   00000038   F5FFFFBA           BLT      ??Add2WS_2
    229          	unsigned short *p=(unsigned short *)wsbody;
    230          	*p=len/2;
   \                     ??Add2WS_1:
   \   0000003C   A20F82E0           ADD      R0,R2,R2, LSR #+31
   \   00000040   C000A0E1           ASR      R0,R0,#+1
   \   00000044   B000C1E1           STRH     R0,[R1, #+0]
    231          }
   \   00000048   1000BDE8           POP      {R4}
   \   0000004C   1EFF2FE1           BX       LR               ;; return
    232          

   \                                 In segment CODE, align 4, keep-with-next
    233          int memcmp_wo1(void *d1, void *d2, int n)
    234          {
   \                     memcmp_wo1:
   \   00000000   30002DE9           PUSH     {R4,R5}
    235          	int i=0, j=0;
   \   00000004   00C0A0E3           MOV      R12,#+0
   \   00000008   0040A0E3           MOV      R4,#+0
    236          	int c;
    237          	char *s1=(char *)d1;
    238          	char *s2=(char *)d2;
   \   0000000C   010000EA           B        ??memcmp_wo1_0
    239          	for(;i<n;i++)
    240          	{
    241          		c=s1[i]-s2[i];
    242          		if((c)&&(j))
    243          			return c;
    244          		if(c)
    245          			j++;
   \                     ??memcmp_wo1_1:
   \   00000010   0140A0E3           MOV      R4,#+1
   \                     ??memcmp_wo1_2:
   \   00000014   01C08CE2           ADD      R12,R12,#+1
   \                     ??memcmp_wo1_0:
   \   00000018   02005CE1           CMP      R12,R2
   \   0000001C   080000AA           BGE      ??memcmp_wo1_3
   \   00000020   0030DCE7           LDRB     R3,[R12, +R0]
   \   00000024   0150DCE7           LDRB     R5,[R12, +R1]
   \   00000028   053053E0           SUBS     R3,R3,R5
   \   0000002C   F8FFFF0A           BEQ      ??memcmp_wo1_2
   \   00000030   000054E3           CMP      R4,#+0
   \   00000034   F5FFFF0A           BEQ      ??memcmp_wo1_1
   \   00000038   3000BDE8           POP      {R4,R5}
   \   0000003C   0300A0E1           MOV      R0,R3
   \   00000040   1EFF2FE1           BX       LR
    246          	}
    247          	return 0;
   \                     ??memcmp_wo1_3:
   \   00000044   3000BDE8           POP      {R4,R5}
   \   00000048   0000A0E3           MOV      R0,#+0
   \   0000004C   1EFF2FE1           BX       LR               ;; return
    248          }

   \                                 In segment CODE, align 4, keep-with-next
    249          char *FindNextPartOfEMS(char *data, int cnt_a, int cnt_n, int sig, char *buf_start, char *buf_end, int cmp_size, int type)
    250          {
   \                     FindNextPartOfEMS:
   \   00000000   F04F2DE9           PUSH     {R4-R11,LR}
   \   00000004   24409DE5           LDR      R4,[SP, #+36]
   \   00000008   2CA09DE5           LDR      R10,[SP, #+44]
   \   0000000C   28909DE5           LDR      R9,[SP, #+40]
   \   00000010   0050A0E1           MOV      R5,R0
   \   00000014   30009DE5           LDR      R0,[SP, #+48]
   \   00000018   0160A0E1           MOV      R6,R1
   \   0000001C   0270A0E1           MOV      R7,R2
   \   00000020   0380A0E1           MOV      R8,R3
    251          	char *d2=buf_start;
    252          	int size=cmp_size;
   \   00000024   0AB0A0E1           MOV      R11,R10
    253          	if((type==TYPE_IN_N)||(type==TYPE_IN_R))
   \   00000028   030050E3           CMP      R0,#+3
   \   0000002C   02005013           CMPNE    R0,#+2
   \   00000030   0200001A           BNE      ??FindNextPartOfEMS_0
    254          		size-=3;
   \   00000034   03B04BE2           SUB      R11,R11,#+3
   \   00000038   000000EA           B        ??FindNextPartOfEMS_0
    255          	while(d2<buf_end)
    256          	{
    257          		if(!memcmp_wo1(d2, data, size))
    258          		{
    259          			char *p=d2;
    260          			int skip;
    261          			p+=cmp_size+2;
    262          			//skip=*p;
    263          			skip=p[1];
    264          			if(skip==8)
    265          				skip=6;
    266          			else
    267          				skip=5;
    268          			if((p[skip-2]==sig)&&(p[skip-1]==cnt_a)&&(p[skip]==cnt_n+1))
    269          				return d2;
    270          		}
    271          		d2+=sizeof(PDU);
   \                     ??FindNextPartOfEMS_1:
   \   0000003C   B24084E2           ADD      R4,R4,#+178
   \                     ??FindNextPartOfEMS_0:
   \   00000040   090054E1           CMP      R4,R9
   \   00000044   1700002A           BCS      ??FindNextPartOfEMS_2
   \   00000048   0B20A0E1           MOV      R2,R11
   \   0000004C   0510A0E1           MOV      R1,R5
   \   00000050   0400A0E1           MOV      R0,R4
   \   00000054   ........           BL       memcmp_wo1
   \   00000058   000050E3           CMP      R0,#+0
   \   0000005C   F6FFFF1A           BNE      ??FindNextPartOfEMS_1
   \   00000060   04008AE0           ADD      R0,R10,R4
   \   00000064   020080E2           ADD      R0,R0,#+2
   \   00000068   0110D0E5           LDRB     R1,[R0, #+1]
   \   0000006C   080051E3           CMP      R1,#+8
   \   00000070   0610A003           MOVEQ    R1,#+6
   \   00000074   0510A013           MOVNE    R1,#+5
   \   00000078   002081E0           ADD      R2,R1,R0
   \   0000007C   023072E5           LDRB     R3,[R2, #-2]!
   \   00000080   080053E1           CMP      R3,R8
   \   00000084   0120D205           LDRBEQ   R2,[R2, #+1]
   \   00000088   06005201           CMPEQ    R2,R6
   \   0000008C   EAFFFF1A           BNE      ??FindNextPartOfEMS_1
   \   00000090   0000D1E7           LDRB     R0,[R1, +R0]
   \   00000094   011087E2           ADD      R1,R7,#+1
   \   00000098   010050E1           CMP      R0,R1
   \   0000009C   E6FFFF1A           BNE      ??FindNextPartOfEMS_1
   \   000000A0   0400A0E1           MOV      R0,R4
   \   000000A4   F08FBDE8           POP      {R4-R11,PC}
    272          	}
    273          	return 0;
   \                     ??FindNextPartOfEMS_2:
   \   000000A8   0000A0E3           MOV      R0,#+0
   \   000000AC   F08FBDE8           POP      {R4-R11,PC}      ;; return
    274          }
    275          

   \                                 In segment CODE, align 4, keep-with-next
    276          int IsPartOfEMS(char *data) //return 1: first, 0xFF: sms, 0xFE: last part of ems
    277          {
    278          	int c, isems, isplus, isin, skip=0;
    279          	char *p=data;
    280          	if(*p++!=0x11)
   \                     IsPartOfEMS:
   \   00000000   0010D0E5           LDRB     R1,[R0, #+0]
   \   00000004   110051E3           CMP      R1,#+17
   \   00000008   0100000A           BEQ      ??IsPartOfEMS_0
    281          		return 0;
   \                     ??IsPartOfEMS_1:
   \   0000000C   0000A0E3           MOV      R0,#+0
   \   00000010   1EFF2FE1           BX       LR
    282          	
    283          	if(*p++!=0x11)
   \                     ??IsPartOfEMS_0:
   \   00000014   011080E2           ADD      R1,R0,#+1
   \   00000018   010081E2           ADD      R0,R1,#+1
   \   0000001C   0010D1E5           LDRB     R1,[R1, #+0]
   \   00000020   110051E3           CMP      R1,#+17
   \   00000024   F8FFFF1A           BNE      ??IsPartOfEMS_1
    284          		return 0;
    285          
    286          	if((c=*p++)==0)
   \   00000028   ........           LDRB     R2,[R0], #+1
   \   0000002C   000052E3           CMP      R2,#+0
   \   00000030   F5FFFF0A           BEQ      ??IsPartOfEMS_1
    287          		return 0;
    288          		
    289          	if((c==0x01)||(c==0x03)) isin=1;
   \   00000034   010052E3           CMP      R2,#+1
   \   00000038   03005213           CMPNE    R2,#+3
    290          	else isin=0;
    291          		
    292          	c=*p++; //sms center
   \   0000003C   ........           LDRB     R2,[R0], #+1
   \   00000040   0110A003           MOVEQ    R1,#+1
   \   00000044   0010A013           MOVNE    R1,#+0
    293          	p+=c;
   \   00000048   000082E0           ADD      R0,R2,R0
    294          	c=*p++;
   \   0000004C   ........           LDRB     R2,[R0], #+1
    295          	if((c>>4)%2) isplus=1;
   \   00000050   4232A0E1           ASR      R3,R2,#+4
   \   00000054   A3CF83E0           ADD      R12,R3,R3, LSR #+31
   \   00000058   CCC0A0E1           ASR      R12,R12,#+1
   \   0000005C   8C3053E0           SUBS     R3,R3,R12, LSL #+1
   \   00000060   0130A013           MOVNE    R3,#+1
    296          	else isplus=0;
    297          	if((c>>6)%2) isems=1;
   \   00000064   4223A0E1           ASR      R2,R2,#+6
   \   00000068   A2CF82E0           ADD      R12,R2,R2, LSR #+31
   \   0000006C   CCC0A0E1           ASR      R12,R12,#+1
   \   00000070   8C2052E0           SUBS     R2,R2,R12, LSL #+1
   \   00000074   0800000A           BEQ      ??IsPartOfEMS_2
    298          	else return 0xFF;
    299          	if(!isin)
   \   00000078   000051E3           CMP      R1,#+0
    300          		p++;	
   \   0000007C   01008002           ADDEQ    R0,R0,#+1
    301          	c=*p++;
   \   00000080   ........           LDRB     R12,[R0], #+1
   \   00000084   AC2F8CE0           ADD      R2,R12,R12, LSR #+31
   \   00000088   C220A0E1           ASR      R2,R2,#+1
   \   0000008C   82C05CE0           SUBS     R12,R12,R2, LSL #+1
   \   00000090   0300000A           BEQ      ??IsPartOfEMS_3
    302          	if(c%2)
    303          		c=c/2+1;
   \   00000094   012082E2           ADD      R2,R2,#+1
   \   00000098   010000EA           B        ??IsPartOfEMS_3
   \                     ??IsPartOfEMS_2:
   \   0000009C   FF00A0E3           MOV      R0,#+255
   \   000000A0   1EFF2FE1           BX       LR
    304          	else
    305          		c=c/2;
    306          	p+=c+2; //num
    307          	p++; //ttype
   \                     ??IsPartOfEMS_3:
   \   000000A4   000082E0           ADD      R0,R2,R0
   \   000000A8   030080E2           ADD      R0,R0,#+3
    308          	if(isin)
   \   000000AC   000051E3           CMP      R1,#+0
    309          		p+=7; //time ????????????????
   \   000000B0   07008012           ADDNE    R0,R0,#+7
    310          	if((isplus)&&(!isin)) p++; //
   \   000000B4   000053E3           CMP      R3,#+0
   \   000000B8   0100000A           BEQ      ??IsPartOfEMS_4
   \   000000BC   000051E3           CMP      R1,#+0
   \   000000C0   01008002           ADDEQ    R0,R0,#+1
    311          	p++; //len
    312          	//...text,
    313          	if(isems)
    314          	{
    315          		//skip=*p;
    316          			skip=p[1];
    317          			if(skip==8)
   \                     ??IsPartOfEMS_4:
   \   000000C4   010080E2           ADD      R0,R0,#+1
   \   000000C8   0110D0E5           LDRB     R1,[R0, #+1]
   \   000000CC   080051E3           CMP      R1,#+8
    318          				skip=6;
   \   000000D0   0610A003           MOVEQ    R1,#+6
    319          			else
    320          				skip=5;
   \   000000D4   0510A013           MOVNE    R1,#+5
    321          		//if(p[skip]!=1) //非EMS 的开头部分
    322          		//	return 1;
    323          		if(p[skip]==p[skip-1])
   \   000000D8   0020D1E7           LDRB     R2,[R1, +R0]
   \   000000DC   003081E0           ADD      R3,R1,R0
   \   000000E0   013053E5           LDRB     R3,[R3, #-1]
   \   000000E4   030052E1           CMP      R2,R3
    324          			return 0xFE;
   \   000000E8   FE00A003           MOVEQ    R0,#+254
   \   000000EC   1EFF2F01           BXEQ     LR
    325          		return (p[skip]);
   \   000000F0   0200A0E1           MOV      R0,R2
   \   000000F4   1EFF2FE1           BX       LR               ;; return
    326          	}
    327          	return 0;
    328          }
    329          

   \                                 In segment CODE, align 4, keep-with-next
    330          void GetEMSText(char *data, WSHDR *text, int cnt_a, int cnt_n, int type, char *buf_start, char *buf_end)
    331          {
   \                     GetEMSText:
   \   00000000   F34F2DE9           PUSH     {R0,R1,R4-R11,LR}
   \   00000004   51DF4DE2           SUB      SP,SP,#+324
   \   00000008   70419DE5           LDR      R4,[SP, #+368]
    332          	int c;
    333          	int ttype;
    334          	int isems;
    335          	int isplus;
    336          	int skip=0, cmp_size=0;
    337          	char *p, *p2=0, *ems_next=0;
    338          	WSHDR wsloc, *wn;
    339          	unsigned short wsb[150];
    340          	wn=CreateLocalWS(&wsloc,wsb,150);
   \   0000000C   9620A0E3           MOV      R2,#+150
   \   00000010   04108DE2           ADD      R1,SP,#+4
   \   00000014   4C0F8DE2           ADD      R0,SP,#+304
   \   00000018   270100EF           SWI      +295
   \   0000001C   0080A0E1           MOV      R8,R0
    341          
    342          	p=data;
    343          	if(*p++!=0x11)
   \   00000020   44019DE5           LDR      R0,[SP, #+324]
   \   00000024   0050A0E3           MOV      R5,#+0
   \   00000028   0000D0E5           LDRB     R0,[R0, #+0]
   \   0000002C   0070A0E3           MOV      R7,#+0
   \   00000030   0560A0E1           MOV      R6,R5
   \   00000034   110050E3           CMP      R0,#+17
   \   00000038   8A00001A           BNE      ??GetEMSText_0
    344          		return;
    345          	
    346          	if(*p++!=0x11)
   \   0000003C   44019DE5           LDR      R0,[SP, #+324]
   \   00000040   010080E2           ADD      R0,R0,#+1
   \   00000044   019080E2           ADD      R9,R0,#+1
   \   00000048   0000D0E5           LDRB     R0,[R0, #+0]
   \   0000004C   110050E3           CMP      R0,#+17
   \   00000050   8400001A           BNE      ??GetEMSText_0
    347          		return;
    348          	if(*p++==0)
   \   00000054   ........           LDRB     R0,[R9], #+1
   \   00000058   000050E3           CMP      R0,#+0
   \   0000005C   8100000A           BEQ      ??GetEMSText_0
    349          		return;
    350          	c=*p++; //sms center
   \   00000060   ........           LDRB     R0,[R9], #+1
    351          	p+=c;
   \   00000064   090080E0           ADD      R0,R0,R9
    352          	c=*p++;
   \   00000068   ........           LDRB     R2,[R0], #+1
    353          	if((c>>4)%2) isplus=1;
   \   0000006C   4212A0E1           ASR      R1,R2,#+4
   \   00000070   A13F81E0           ADD      R3,R1,R1, LSR #+31
   \   00000074   C330A0E1           ASR      R3,R3,#+1
   \   00000078   831051E0           SUBS     R1,R1,R3, LSL #+1
   \   0000007C   0110A013           MOVNE    R1,#+1
    354          	else isplus=0;
    355          	if((c>>6)%2) isems=1;
   \   00000080   4223A0E1           ASR      R2,R2,#+6
   \   00000084   A23F82E0           ADD      R3,R2,R2, LSR #+31
   \   00000088   C330A0E1           ASR      R3,R3,#+1
   \   0000008C   832052E0           SUBS     R2,R2,R3, LSL #+1
   \   00000090   0130A013           MOVNE    R3,#+1
    356          	else isems=0;
   \   00000094   0030A003           MOVEQ    R3,#+0
   \   00000098   00308DE5           STR      R3,[SP, #+0]
    357          	if((type==TYPE_OUT)||(type==TYPE_DRAFT)) //out
   \   0000009C   010054E3           CMP      R4,#+1
   \   000000A0   04005413           CMPNE    R4,#+4
    358          		p++;
   \   000000A4   01008002           ADDEQ    R0,R0,#+1
    359          	c=*p++;
   \   000000A8   ........           LDRB     R2,[R0], #+1
   \   000000AC   A23F82E0           ADD      R3,R2,R2, LSR #+31
   \   000000B0   C330A0E1           ASR      R3,R3,#+1
   \   000000B4   832052E0           SUBS     R2,R2,R3, LSL #+1
    360          	if(c%2)
    361          		c=c/2+2;
   \   000000B8   02208312           ADDNE    R2,R3,#+2
    362          	else
    363          		c=c/2+1;
   \   000000BC   01208302           ADDEQ    R2,R3,#+1
    364          	p+=c+1; //num
   \   000000C0   000082E0           ADD      R0,R2,R0
   \   000000C4   019080E2           ADD      R9,R0,#+1
    365          	ttype=*p++;
   \   000000C8   ........           LDRB     R2,[R9], #+1
    366          	if((type==TYPE_IN_R)||(type==TYPE_IN_N))
   \   000000CC   020054E3           CMP      R4,#+2
   \   000000D0   03005413           CMPNE    R4,#+3
    367          		p+=7; //time
   \   000000D4   07908902           ADDEQ    R9,R9,#+7
    368          
    369          	if(isplus&&((type==TYPE_OUT)||(type==TYPE_DRAFT))) p++; //
   \   000000D8   000051E3           CMP      R1,#+0
   \   000000DC   0200000A           BEQ      ??GetEMSText_1
   \   000000E0   010054E3           CMP      R4,#+1
   \   000000E4   04005413           CMPNE    R4,#+4
   \   000000E8   01908902           ADDEQ    R9,R9,#+1
    370          
    371          	c=*p++;
    372          	//...text,
    373          	if(isems)
   \                     ??GetEMSText_1:
   \   000000EC   00009DE5           LDR      R0,[SP, #+0]
   \   000000F0   ........           LDRB     R10,[R9], #+1
   \   000000F4   000050E3           CMP      R0,#+0
   \   000000F8   0E00000A           BEQ      ??GetEMSText_2
    374          	{
    375          		int sk=p[1];
    376          		cmp_size=p-data-2;
   \   000000FC   44119DE5           LDR      R1,[SP, #+324]
   \   00000100   0100D9E5           LDRB     R0,[R9, #+1]
   \   00000104   011049E0           SUB      R1,R9,R1
   \   00000108   027041E2           SUB      R7,R1,#+2
    377          		skip=*p;
   \   0000010C   0010D9E5           LDRB     R1,[R9, #+0]
    378          		p2=p;
   \   00000110   0960A0E1           MOV      R6,R9
    379          		if(ttype==8)
   \   00000114   080052E3           CMP      R2,#+8
   \   00000118   0300001A           BNE      ??GetEMSText_3
    380          		{
    381          			p+=skip+1;
   \   0000011C   093081E0           ADD      R3,R1,R9
   \   00000120   019083E2           ADD      R9,R3,#+1
    382          			c-=skip+1;
   \   00000124   01104AE0           SUB      R1,R10,R1
   \   00000128   01A041E2           SUB      R10,R1,#+1
    383          		}
    384          		if(sk==8)
   \                     ??GetEMSText_3:
   \   0000012C   080050E3           CMP      R0,#+8
    385          			skip=6;
   \   00000130   0650A003           MOVEQ    R5,#+6
    386          		else
    387          			skip=5;
   \   00000134   0550A013           MOVNE    R5,#+5
    388          	}
    389          	if(ttype==0x8)
   \                     ??GetEMSText_2:
   \   00000138   080052E3           CMP      R2,#+8
   \   0000013C   0400001A           BNE      ??GetEMSText_4
    390          	{
    391          		Add2WS(p, (char *)wn->wsbody, c);
   \   00000140   001098E5           LDR      R1,[R8, #+0]
   \   00000144   0A20A0E1           MOV      R2,R10
   \   00000148   0900A0E1           MOV      R0,R9
   \   0000014C   ........           BL       Add2WS
    392          		wstrcat(text, wn);
   \   00000150   1B0000EA           B        ??GetEMSText_5
    393          	}
    394          	else if(ttype==0x0) //7bit
   \                     ??GetEMSText_4:
   \   00000154   000052E3           CMP      R2,#+0
   \   00000158   1600001A           BNE      ??GetEMSText_6
    395          	{
    396          		GSMTXT_Decode(wn,(void*)p,c*7/8+1, ttype, (void*(*)(int))malloc_adr(),(void(*)(void))mfree_adr());
   \   0000015C   158000EF           SWI      +32789
   \   00000160   00B0A0E1           MOV      R11,R0
   \   00000164   148000EF           SWI      +32788
   \   00000168   00082DE9           PUSH     {R11}
   \   0000016C   01002DE9           PUSH     {R0}
   \   00000170   8A116AE0           RSB      R1,R10,R10, LSL #+3
   \   00000174   0030A0E3           MOV      R3,#+0
   \   00000178   4101A0E1           ASR      R0,R1,#+2
   \   0000017C   A00E81E0           ADD      R0,R1,R0, LSR #+29
   \   00000180   0110A0E3           MOV      R1,#+1
   \   00000184   C02181E0           ADD      R2,R1,R0, ASR #+3
   \   00000188   0910A0E1           MOV      R1,R9
   \   0000018C   0800A0E1           MOV      R0,R8
   \   00000190   1D0200EF           SWI      +541
    397          		if(wslen(wn)>c)
   \   00000194   000098E5           LDR      R0,[R8, #+0]
   \   00000198   B000D0E1           LDRH     R0,[R0, #+0]
   \   0000019C   08D08DE2           ADD      SP,SP,#+8
   \   000001A0   00005AE1           CMP      R10,R0
   \   000001A4   060000AA           BGE      ??GetEMSText_5
    398          		{
    399          			CutWSTR(wn, c);
   \   000001A8   0A10A0E1           MOV      R1,R10
   \   000001AC   0800A0E1           MOV      R0,R8
   \   000001B0   260100EF           SWI      +294
    400          		}
    401          		wstrcat(text, wn);
   \   000001B4   020000EA           B        ??GetEMSText_5
    402          	}
    403          	else
    404          	{
    405          		wsprintf(wn, STR_UNK_TXTT, ttype);
   \                     ??GetEMSText_6:
   \   000001B8   ........           LDR      R1,??DataTable29  ;; STR_UNK_TXTT
   \   000001BC   0800A0E1           MOV      R0,R8
   \   000001C0   240100EF           SWI      +292
    406          		wstrcat(text, wn);
   \                     ??GetEMSText_5:
   \   000001C4   48019DE5           LDR      R0,[SP, #+328]
   \   000001C8   0810A0E1           MOV      R1,R8
   \   000001CC   210100EF           SWI      +289
    407          	}
    408          	if(isems&&(p2)&&(skip)&&(p2[skip]<p2[skip-1]))
   \   000001D0   00009DE5           LDR      R0,[SP, #+0]
   \   000001D4   000050E3           CMP      R0,#+0
   \   000001D8   00005613           CMPNE    R6,#+0
   \   000001DC   00005513           CMPNE    R5,#+0
   \   000001E0   2000000A           BEQ      ??GetEMSText_0
   \   000001E4   060085E0           ADD      R0,R5,R6
   \   000001E8   028040E2           SUB      R8,R0,#+2
   \   000001EC   0600D5E7           LDRB     R0,[R5, +R6]
   \   000001F0   0110D8E5           LDRB     R1,[R8, #+1]
   \   000001F4   010050E1           CMP      R0,R1
   \   000001F8   1A00002A           BCS      ??GetEMSText_0
    409          	{
    410          		if(cmp_size) ems_next=FindNextPartOfEMS(data, p2[skip-1], p2[skip], p2[skip-2], buf_start, buf_end, cmp_size, type);
   \   000001FC   000057E3           CMP      R7,#+0
   \   00000200   1800000A           BEQ      ??GetEMSText_0
   \   00000204   0400A0E1           MOV      R0,R4
   \   00000208   01002DE9           PUSH     {R0}
   \   0000020C   80002DE9           PUSH     {R7}
   \   00000210   80019DE5           LDR      R0,[SP, #+384]
   \   00000214   01002DE9           PUSH     {R0}
   \   00000218   80019DE5           LDR      R0,[SP, #+384]
   \   0000021C   01002DE9           PUSH     {R0}
   \   00000220   0030D8E5           LDRB     R3,[R8, #+0]
   \   00000224   0620D5E7           LDRB     R2,[R5, +R6]
   \   00000228   0110D8E5           LDRB     R1,[R8, #+1]
   \   0000022C   54019DE5           LDR      R0,[SP, #+340]
   \   00000230   ........           BL       FindNextPartOfEMS
    411          		if(ems_next) GetEMSText(ems_next, text, p2[skip-1], p2[skip], type, buf_start, buf_end);
   \   00000234   000050E3           CMP      R0,#+0
   \   00000238   10D08DE2           ADD      SP,SP,#+16
   \   0000023C   0900000A           BEQ      ??GetEMSText_0
   \   00000240   78119DE5           LDR      R1,[SP, #+376]
   \   00000244   02002DE9           PUSH     {R1}
   \   00000248   78119DE5           LDR      R1,[SP, #+376]
   \   0000024C   02002DE9           PUSH     {R1}
   \   00000250   10002DE9           PUSH     {R4}
   \   00000254   0630D5E7           LDRB     R3,[R5, +R6]
   \   00000258   0120D8E5           LDRB     R2,[R8, #+1]
   \   0000025C   54119DE5           LDR      R1,[SP, #+340]
   \   00000260   66FFFFEB           BL       GetEMSText
   \   00000264   0CD08DE2           ADD      SP,SP,#+12
   \                     ??GetEMSText_0:
   \   00000268   53DF8DE2           ADD      SP,SP,#+332      ;; stack cleaning
   \   0000026C   F08FBDE8           POP      {R4-R11,PC}      ;; return
    412          	}
    413          }
    414          /*
    415          const IPC_REQ my_ipc_upd=
    416          {
    417            my_ipc_name,
    418            my_ipc_name,
    419            NULL
    420          };
    421          */

   \                                 In segment CODE, align 4, keep-with-next
    422          int ReadAllSmsN(void)
    423          {
    424            if(!sdltop) return(readAllSMS());
   \                     ReadAllSmsN:
   \   00000000   ........           LDR      R0,??DataTable7  ;; sdltop
   \   00000004   000090E5           LDR      R0,[R0, #+0]
   \   00000008   000050E3           CMP      R0,#+0
   \   0000000C   0000001A           BNE      ??ReadAllSmsN_0
   \   00000010   ........           B        readAllSMS       ;; tailcall
    425            return 0;
   \                     ??ReadAllSmsN_0:
   \   00000014   0000A0E3           MOV      R0,#+0
   \   00000018   1EFF2FE1           BX       LR
    426          }
    427          

   \                                 In segment CODE, align 4, keep-with-next
    428          int readAllSMS(void)
    429          {
   \                     readAllSMS:
   \   00000000   30402DE9           PUSH     {R4,R5,LR}
    430            int n;
    431            if(is_readall) return 0;
   \   00000004   70409FE5           LDR      R4,??readAllSMS_0  ;; is_readall
   \   00000008   000094E5           LDR      R0,[R4, #+0]
   \   0000000C   000050E3           CMP      R0,#+0
   \   00000010   0000A013           MOVNE    R0,#+0
   \   00000014   3080BD18           POPNE    {R4,R5,PC}
    432            is_readall=1;
   \   00000018   0100A0E3           MOV      R0,#+1
   \   0000001C   000084E5           STR      R0,[R4, #+0]
    433            freeSDList();
   \   00000020   ........           BL       freeSDList
    434            n=NewMsgReader();
   \   00000024   ........           _BLF     NewMsgReader,??NewMsgReader??rA
   \   00000028   0050A0E1           MOV      R5,R0
    435            n+=readFile(TYPE_IN_ALL);
   \   0000002C   0500A0E3           MOV      R0,#+5
   \   00000030   ........           BL       readFile
   \   00000034   055080E0           ADD      R5,R0,R5
    436            n+=readFile(TYPE_OUT);
   \   00000038   0100A0E3           MOV      R0,#+1
   \   0000003C   ........           BL       readFile
   \   00000040   055080E0           ADD      R5,R0,R5
    437            n+=readFile(TYPE_DRAFT);
   \   00000044   0400A0E3           MOV      R0,#+4
   \   00000048   ........           BL       readFile
   \   0000004C   055080E0           ADD      R5,R0,R5
    438            new_sms_n=getCountByType(TYPE_IN_N);
   \   00000050   0300A0E3           MOV      R0,#+3
   \   00000054   ........           BL       getCountByType
   \   00000058   ........           LDR      R1,??DataTable25  ;; new_sms_n
   \   0000005C   000081E5           STR      R0,[R1, #+0]
    439            is_readall=0;
   \   00000060   0000A0E3           MOV      R0,#+0
   \   00000064   000084E5           STR      R0,[R4, #+0]
    440            SendSimpleIpcMsg(SMSYS_IPC_SMS_DATA_UPDATE);
   \   00000068   0100A0E3           MOV      R0,#+1
   \   0000006C   400F80E3           ORR      R0,R0,#0x100
   \   00000070   ........           _BLF     SendSimpleIpcMsg,??SendSimpleIpcMsg??rA
    441            //GBS_SendMessage(MMI_CEPID,MSG_IPC,SMSYS_IPC_SMS_DATA_UPDATE,&my_ipc_upd);
    442            return n;
   \   00000074   0500A0E1           MOV      R0,R5
   \   00000078   3080BDE8           POP      {R4,R5,PC}       ;; return
   \                     ??readAllSMS_0:
   \   0000007C   ........           DC32     is_readall
    443          }
    444          
    445          //------------------------------------------------------
    446          
    447          //write
    448          
    449          

   \                                 In segment CODE, align 4, keep-with-next
    450          int newToRead(SMS_DATA *sd)
    451          {
   \                     newToRead:
   \   00000000   70402DE9           PUSH     {R4-R6,LR}
   \   00000004   0050B0E1           MOVS     R5,R0
    452            if(!sd) return 0;
   \   00000008   0100001A           BNE      ??newToRead_0
   \                     ??newToRead_1:
   \   0000000C   0000A0E3           MOV      R0,#+0
   \   00000010   7080BDE8           POP      {R4-R6,PC}       ;; return
    453            if(!sd->isfile)
   \                     ??newToRead_0:
   \   00000014   140095E5           LDR      R0,[R5, #+20]
   \   00000018   94409FE5           LDR      R4,??newToRead_2  ;; sli_sta
   \   0000001C   ........           LDR      R6,??DataTable25  ;; new_sms_n
   \   00000020   000050E3           CMP      R0,#+0
   \   00000024   1500001A           BNE      ??newToRead_3
    454            {
    455              if(!sd->id) return 0;
   \   00000028   0C0095E5           LDR      R0,[R5, #+12]
   \   0000002C   000050E3           CMP      R0,#+0
   \   00000030   7080BD08           POPEQ    {R4-R6,PC}
    456              if(SetSmsStatus(sd->id, 1)!=0x3E8) return 0;
                        ^
Warning[Pe223]: function "SetSmsStatus" declared implicitly
   \   00000034   0110A0E3           MOV      R1,#+1
   \   00000038   ........           _BLF     SetSmsStatus,??SetSmsStatus??rA
   \   0000003C   FA0F50E3           CMP      R0,#+1000
   \   00000040   F1FFFF1A           BNE      ??newToRead_1
    457            }
    458            else
    459            {
    460              if(NewToRead_File(sd))
    461              {
    462          #ifdef ELKA
    463                extern int sli_sta;
    464                extern void STOP_SLI(void);
    465                if(!new_sms_n && sli_sta) STOP_SLI();
    466                return 1;
    467          #endif
    468              }
    469              else return 0;
    470            }
    471            sd->type=TYPE_IN_R;
   \   00000044   0200A0E3           MOV      R0,#+2
   \   00000048   080085E5           STR      R0,[R5, #+8]
    472            if(new_sms_n>0) new_sms_n--;
   \   0000004C   000096E5           LDR      R0,[R6, #+0]
   \   00000050   010050E3           CMP      R0,#+1
   \   00000054   010040A2           SUBGE    R0,R0,#+1
   \   00000058   000086A5           STRGE    R0,[R6, #+0]
    473          #ifdef ELKA
    474            extern int sli_sta;
    475            extern void STOP_SLI(void);
    476            if(!new_sms_n && sli_sta) STOP_SLI();
   \   0000005C   000096E5           LDR      R0,[R6, #+0]
   \   00000060   000050E3           CMP      R0,#+0
   \   00000064   1000001A           BNE      ??newToRead_4
   \   00000068   000094E5           LDR      R0,[R4, #+0]
   \   0000006C   000050E3           CMP      R0,#+0
   \   00000070   0D00000A           BEQ      ??newToRead_4
   \   00000074   ........           _BLF     STOP_SLI,??STOP_SLI??rA
   \   00000078   0100A0E3           MOV      R0,#+1
   \   0000007C   7080BDE8           POP      {R4-R6,PC}
   \                     ??newToRead_3:
   \   00000080   0500A0E1           MOV      R0,R5
   \   00000084   ........           _BLF     NewToRead_File,??NewToRead_File??rA
   \   00000088   000050E3           CMP      R0,#+0
   \   0000008C   7080BD08           POPEQ    {R4-R6,PC}
   \   00000090   000096E5           LDR      R0,[R6, #+0]
   \   00000094   000050E3           CMP      R0,#+0
   \   00000098   0300001A           BNE      ??newToRead_4
   \   0000009C   000094E5           LDR      R0,[R4, #+0]
   \   000000A0   000050E3           CMP      R0,#+0
   \   000000A4   0000000A           BEQ      ??newToRead_4
   \   000000A8   ........           _BLF     STOP_SLI,??STOP_SLI??rA
   \                     ??newToRead_4:
   \   000000AC   0100A0E3           MOV      R0,#+1
   \   000000B0   7080BDE8           POP      {R4-R6,PC}
   \                     ??newToRead_2:
   \   000000B4   ........           DC32     sli_sta
    477          #endif
    478            return 1;
    479          }
    480          
    481          #define MAX_FILE 10000
    482          //-------------------------------------
    483          
    484          #define HEADER	"MySMSYS"

   \                                 In segment CODE, align 4, keep-with-next
    485          int GetMssPath(char *path, char *folder, TTime *time, TDate *date)
    486          {
   \                     GetMssPath:
   \   00000000   F0402DE9           PUSH     {R4-R7,LR}
   \   00000004   80D04DE2           SUB      SP,SP,#+128
    487            char temp[128];
    488            int i=0;
    489            sprintf(path, "%04d%02d%02d%02d%02d%02d", 
    490          	  date->year,
    491          	  date->month,
    492          	  date->day,
    493          	  time->hour,
    494          	  time->min,
    495          	  time->sec);
   \   00000008   ........           LDR      R7,??DataTable10  ;; `?<Constant "%04d%02d%02d%02d%02d%02d">`
   \   0000000C   0150A0E1           MOV      R5,R1
   \   00000010   0210D2E5           LDRB     R1,[R2, #+2]
   \   00000014   0040A0E1           MOV      R4,R0
   \   00000018   0300A0E1           MOV      R0,R3
   \   0000001C   02002DE9           PUSH     {R1}
   \   00000020   0110D2E5           LDRB     R1,[R2, #+1]
   \   00000024   0060A0E3           MOV      R6,#+0
   \   00000028   02002DE9           PUSH     {R1}
   \   0000002C   0010D2E5           LDRB     R1,[R2, #+0]
   \   00000030   02002DE9           PUSH     {R1}
   \   00000034   0510D0E5           LDRB     R1,[R0, #+5]
   \   00000038   02002DE9           PUSH     {R1}
   \   0000003C   0430D0E5           LDRB     R3,[R0, #+4]
   \   00000040   002090E5           LDR      R2,[R0, #+0]
   \   00000044   0400A0E1           MOV      R0,R4
   \   00000048   0710A0E1           MOV      R1,R7
   \   0000004C   160000EF           SWI      +22
    496            strcpy(temp, folder);
   \   00000050   0510A0E1           MOV      R1,R5
   \   00000054   10008DE2           ADD      R0,SP,#+16
   \   00000058   1A0000EF           SWI      +26
    497            strcat(temp, path);
   \   0000005C   0410A0E1           MOV      R1,R4
   \   00000060   10008DE2           ADD      R0,SP,#+16
   \   00000064   170000EF           SWI      +23
    498            strcat(temp, ".mss");
   \   00000068   1C1087E2           ADD      R1,R7,#+28
   \   0000006C   10008DE2           ADD      R0,SP,#+16
   \   00000070   170000EF           SWI      +23
    499            if(!IsFileExist(temp))
   \   00000074   10008DE2           ADD      R0,SP,#+16
   \   00000078   ........           BL       IsFileExist
   \   0000007C   000050E3           CMP      R0,#+0
   \   00000080   10D08DE2           ADD      SP,SP,#+16
   \   00000084   0500001A           BNE      ??GetMssPath_0
    500            {
    501              strcpy(path, temp);
   \                     ??GetMssPath_1:
   \   00000088   0D10A0E1           MOV      R1,SP
   \   0000008C   0400A0E1           MOV      R0,R4
   \   00000090   1A0000EF           SWI      +26
    502              return 1;
   \   00000094   0100A0E3           MOV      R0,#+1
   \   00000098   80D08DE2           ADD      SP,SP,#+128
   \   0000009C   F080BDE8           POP      {R4-R7,PC}
    503            }
    504            while(i<MAX_FILE)
    505            {
    506              sprintf(temp, "%s%s_%04d%s", folder, path, i, ".mss");
   \                     ??GetMssPath_0:
   \   000000A0   1C0087E2           ADD      R0,R7,#+28
   \   000000A4   01002DE9           PUSH     {R0}
   \   000000A8   0430A0E1           MOV      R3,R4
   \   000000AC   0520A0E1           MOV      R2,R5
   \   000000B0   241087E2           ADD      R1,R7,#+36
   \   000000B4   0600A0E1           MOV      R0,R6
   \   000000B8   01002DE9           PUSH     {R0}
   \   000000BC   08008DE2           ADD      R0,SP,#+8
   \   000000C0   160000EF           SWI      +22
    507              if(!IsFileExist(temp))
   \   000000C4   08008DE2           ADD      R0,SP,#+8
   \   000000C8   ........           BL       IsFileExist
   \   000000CC   000050E3           CMP      R0,#+0
   \   000000D0   08D08DE2           ADD      SP,SP,#+8
   \   000000D4   EBFFFF0A           BEQ      ??GetMssPath_1
    508              {
    509                strcpy(path, temp);
    510                return 1;
    511              }
    512              i++;
   \   000000D8   016086E2           ADD      R6,R6,#+1
    513            }
   \   000000DC   1000A0E3           MOV      R0,#+16
   \   000000E0   9C0D80E3           ORR      R0,R0,#0x2700
   \   000000E4   000056E1           CMP      R6,R0
   \   000000E8   ECFFFFBA           BLT      ??GetMssPath_0
    514            return 0;
   \   000000EC   0000A0E3           MOV      R0,#+0
   \   000000F0   80D08DE2           ADD      SP,SP,#+128
   \   000000F4   F080BDE8           POP      {R4-R7,PC}       ;; return
    515          }
    516          

   \                                 In segment CODE, align 4, keep-with-next
    517          int saveFile(WSHDR *ws, char *number, SMS_DATA *sd, int type, int need_reload) //need_reload,0 not, 1 all, 2 this
    518          {
   \                     saveFile:
   \   00000000   F04F2DE9           PUSH     {R4-R11,LR}
   \   00000004   45DF4DE2           SUB      SP,SP,#+276
   \   00000008   38419DE5           LDR      R4,[SP, #+312]
   \   0000000C   0060A0E1           MOV      R6,R0
   \   00000010   0170A0E1           MOV      R7,R1
   \   00000014   0280A0E1           MOV      R8,R2
   \   00000018   0390A0E1           MOV      R9,R3
    519            char path[128];
    520            TTime time;
    521            TDate date;
    522            unsigned int err;
    523            int f, len, x;
    524            const char *folder;
    525            char dir[128];
    526            SMS_DATA *sdx=0;
    527            switch(type)
   \   0000001C   010059E2           SUBS     R0,R9,#+1
   \   00000020   0900000A           BEQ      ??saveFile_0
   \   00000024   010040E2           SUB      R0,R0,#+1
   \   00000028   010050E3           CMP      R0,#+1
   \   0000002C   0800009A           BLS      ??saveFile_1
   \   00000030   020050E2           SUBS     R0,R0,#+2
   \   00000034   0200000A           BEQ      ??saveFile_2
   \   00000038   010050E2           SUBS     R0,R0,#+1
   \   0000003C   0400000A           BEQ      ??saveFile_1
   \   00000040   050000EA           B        ??saveFile_3
    528            {
    529            case TYPE_DRAFT:
    530              folder=FLDR_DRAFT;
   \                     ??saveFile_2:
   \   00000044   ........           LDR      R10,??DataTable19  ;; FLDR_DRAFT
   \   00000048   040000EA           B        ??saveFile_4
    531              break;
    532            case TYPE_OUT:
    533              folder=FLDR_OUT;
   \                     ??saveFile_0:
   \   0000004C   ........           LDR      R10,??DataTable20  ;; FLDR_OUT
   \   00000050   020000EA           B        ??saveFile_4
    534              break;
    535            case TYPE_IN_N:
    536            case TYPE_IN_R:
    537            case TYPE_IN_ALL:
    538              folder=FLDR_IN;
   \                     ??saveFile_1:
   \   00000054   ........           LDR      R10,??DataTable21  ;; FLDR_IN
   \   00000058   000000EA           B        ??saveFile_4
    539              break;
    540            default:
    541              folder=FLDR_UNK;
   \                     ??saveFile_3:
   \   0000005C   ........           LDR      R10,??DataTable22  ;; FLDR_UNK
    542              break;
    543            }
    544            MSS_FILE_P2 *msf=malloc(sizeof(MSS_FILE_P2));
    545            zeromem(msf, sizeof(MSS_FILE_P2));
    546            GetDateTime(&date, &time);
    547            if(!isdir(CFG_MAIN_FOLDER, &err))
   \                     ??saveFile_4:
   \   00000060   ........           LDR      R11,??DataTable23  ;; CFG_MAIN_FOLDER
   \   00000064   5000A0E3           MOV      R0,#+80
   \   00000068   140000EF           SWI      +20
   \   0000006C   0050A0E1           MOV      R5,R0
   \   00000070   5010A0E3           MOV      R1,#+80
   \   00000074   1D0100EF           SWI      +285
   \   00000078   04108DE2           ADD      R1,SP,#+4
   \   0000007C   0C008DE2           ADD      R0,SP,#+12
   \   00000080   B40000EF           SWI      +180
   \   00000084   0D10A0E1           MOV      R1,SP
   \   00000088   0B00A0E1           MOV      R0,R11
   \   0000008C   910000EF           SWI      +145
   \   00000090   000050E3           CMP      R0,#+0
   \   00000094   0200001A           BNE      ??saveFile_5
    548              mkdir(CFG_MAIN_FOLDER, &err);
   \   00000098   0D10A0E1           MOV      R1,SP
   \   0000009C   0B00A0E1           MOV      R0,R11
   \   000000A0   100000EF           SWI      +16
    549            strcpy(dir, CFG_MAIN_FOLDER);
   \                     ??saveFile_5:
   \   000000A4   0B10A0E1           MOV      R1,R11
   \   000000A8   94008DE2           ADD      R0,SP,#+148
   \   000000AC   1A0000EF           SWI      +26
    550            if((len=strlen(dir))<=0) return 0;
   \   000000B0   94008DE2           ADD      R0,SP,#+148
   \   000000B4   1B0000EF           SWI      +27
   \   000000B8   010050E3           CMP      R0,#+1
   \   000000BC   340000BA           BLT      ??saveFile_6
    551            x=dir[len-1];
   \                     ??saveFile_7:
   \   000000C0   94108DE2           ADD      R1,SP,#+148
   \   000000C4   010080E0           ADD      R0,R0,R1
   \   000000C8   011050E5           LDRB     R1,[R0, #-1]
    552            if((x!='\\')&&(x!='/'))
   \   000000CC   5C0051E3           CMP      R1,#+92
   \   000000D0   2F005113           CMPNE    R1,#+47
   \   000000D4   0300000A           BEQ      ??saveFile_8
    553            {
    554              dir[len]='\\';
   \   000000D8   5C10A0E3           MOV      R1,#+92
   \   000000DC   0010C0E5           STRB     R1,[R0, #+0]
    555              dir[len+1]=0;
   \   000000E0   0010A0E3           MOV      R1,#+0
   \   000000E4   0110C0E5           STRB     R1,[R0, #+1]
    556            }
    557            strcat(dir, folder);
   \                     ??saveFile_8:
   \   000000E8   0A10A0E1           MOV      R1,R10
   \   000000EC   94008DE2           ADD      R0,SP,#+148
   \   000000F0   170000EF           SWI      +23
    558            if(!isdir(dir, &err))
   \   000000F4   0D10A0E1           MOV      R1,SP
   \   000000F8   94008DE2           ADD      R0,SP,#+148
   \   000000FC   910000EF           SWI      +145
   \   00000100   000050E3           CMP      R0,#+0
   \   00000104   0200001A           BNE      ??saveFile_9
    559              mkdir(dir, &err);
   \   00000108   0D10A0E1           MOV      R1,SP
   \   0000010C   94008DE2           ADD      R0,SP,#+148
   \   00000110   100000EF           SWI      +16
    560            if(type==TYPE_DRAFT && sd && sd->type==TYPE_DRAFT && sd->isfile && sd->fname)
   \                     ??saveFile_9:
   \   00000114   040059E3           CMP      R9,#+4
   \   00000118   0C00001A           BNE      ??saveFile_10
   \   0000011C   000058E3           CMP      R8,#+0
   \   00000120   0A00000A           BEQ      ??saveFile_10
   \   00000124   080098E5           LDR      R0,[R8, #+8]
   \   00000128   040050E3           CMP      R0,#+4
   \   0000012C   0700001A           BNE      ??saveFile_10
   \   00000130   140098E5           LDR      R0,[R8, #+20]
   \   00000134   000050E3           CMP      R0,#+0
   \   00000138   20109815           LDRNE    R1,[R8, #+32]
   \   0000013C   00005113           CMPNE    R1,#+0
   \   00000140   0200000A           BEQ      ??saveFile_10
    561              strcpy(path, sd->fname); 
   \   00000144   14008DE2           ADD      R0,SP,#+20
   \   00000148   1A0000EF           SWI      +26
   \   0000014C   060000EA           B        ??saveFile_11
    562            else if(!GetMssPath(path, dir, &time, &date))
   \                     ??saveFile_10:
   \   00000150   0C308DE2           ADD      R3,SP,#+12
   \   00000154   04208DE2           ADD      R2,SP,#+4
   \   00000158   94108DE2           ADD      R1,SP,#+148
   \   0000015C   14008DE2           ADD      R0,SP,#+20
   \   00000160   ........           BL       GetMssPath
   \   00000164   000050E3           CMP      R0,#+0
   \   00000168   6700000A           BEQ      ??saveFile_12
    563              return 0;
    564            if((f=fopen(path, A_BIN+A_WriteOnly+A_Create+A_Truncate, P_WRITE, &err))<0)
   \                     ??saveFile_11:
   \   0000016C   0D30A0E1           MOV      R3,SP
   \   00000170   402FA0E3           MOV      R2,#+256
   \   00000174   0110A0E3           MOV      R1,#+1
   \   00000178   831C81E3           ORR      R1,R1,#0x8300
   \   0000017C   14008DE2           ADD      R0,SP,#+20
   \   00000180   0A0000EF           SWI      +10
   \   00000184   00A0B0E1           MOVS     R10,R0
   \   00000188   0400005A           BPL      ??saveFile_13
    565            {
    566              mfree(msf);
   \   0000018C   0500A0E1           MOV      R0,R5
   \   00000190   150000EF           SWI      +21
    567              return 0;
   \                     ??saveFile_6:
   \   00000194   0000A0E3           MOV      R0,#+0
   \                     ??saveFile_14:
   \   00000198   45DF8DE2           ADD      SP,SP,#+276
   \   0000019C   F08FBDE8           POP      {R4-R11,PC}
    568            }
    569            strcpy(msf->header, ELFNAME);
   \                     ??saveFile_13:
   \   000001A0   ........           LDR      R1,??DataTable16  ;; ELFNAME
   \   000001A4   0500A0E1           MOV      R0,R5
   \   000001A8   1A0000EF           SWI      +26
    570            strncpy(msf->number, number, 32);
   \   000001AC   2020A0E3           MOV      R2,#+32
   \   000001B0   0710A0E1           MOV      R1,R7
   \   000001B4   300085E2           ADD      R0,R5,#+48
   \   000001B8   160100EF           SWI      +278
    571            msf->type=type;
   \   000001BC   0C9085E5           STR      R9,[R5, #+12]
    572            msf->version=MSS_VERSION;
   \   000001C0   0200A0E3           MOV      R0,#+2
   \   000001C4   080085E5           STR      R0,[R5, #+8]
    573            //如果是来短信,直接使用短信中的时间保存
    574            if(((type==TYPE_IN_N)||(type==TYPE_IN_R)||(type==TYPE_IN_ALL))
    575               &&(sd!=0)
    576                 &&(strlen(sd->Time)))
   \   000001C8   030059E3           CMP      R9,#+3
   \   000001CC   02005913           CMPNE    R9,#+2
   \   000001D0   05005913           CMPNE    R9,#+5
   \   000001D4   0900001A           BNE      ??saveFile_15
   \   000001D8   000058E3           CMP      R8,#+0
   \   000001DC   0700000A           BEQ      ??saveFile_15
   \   000001E0   440088E2           ADD      R0,R8,#+68
   \   000001E4   1B0000EF           SWI      +27
   \   000001E8   000050E3           CMP      R0,#+0
   \   000001EC   0300000A           BEQ      ??saveFile_15
    577            {
    578              strcpy(msf->time, sd->Time);
   \   000001F0   441088E2           ADD      R1,R8,#+68
   \   000001F4   100085E2           ADD      R0,R5,#+16
   \   000001F8   1A0000EF           SWI      +26
   \   000001FC   130000EA           B        ??saveFile_16
    579            }
    580            else
    581              sprintf(msf->time, "%02d-%02d-%02d %02d:%02d:%02d", 
    582          	    date.year%2000, // ? //2008 ->08
    583          	    date.month, date.day,
    584          	    time.hour, time.min,
    585          	    time.sec);
   \                     ??saveFile_15:
   \   00000200   0600DDE5           LDRB     R0,[SP, #+6]
   \   00000204   ........           LDR      R1,??DataTable17  ;; 0x10624dd3
   \   00000208   01002DE9           PUSH     {R0}
   \   0000020C   0900DDE5           LDRB     R0,[SP, #+9]
   \   00000210   01002DE9           PUSH     {R0}
   \   00000214   0C00DDE5           LDRB     R0,[SP, #+12]
   \   00000218   01002DE9           PUSH     {R0}
   \   0000021C   1D00DDE5           LDRB     R0,[SP, #+29]
   \   00000220   01002DE9           PUSH     {R0}
   \   00000224   2030DDE5           LDRB     R3,[SP, #+32]
   \   00000228   1C009DE5           LDR      R0,[SP, #+28]
   \   0000022C   917082E0           UMULL    R7,R2,R1,R0
   \   00000230   ........           LDR      R1,??DataTable18  ;; `?<Constant "%02d-%02d-%02d %02d:%...">`
   \   00000234   A223A0E1           LSR      R2,R2,#+7
   \   00000238   7D7EA0E3           MOV      R7,#+2000
   \   0000023C   970202E0           MUL      R2,R7,R2
   \   00000240   022040E0           SUB      R2,R0,R2
   \   00000244   100085E2           ADD      R0,R5,#+16
   \   00000248   160000EF           SWI      +22
   \   0000024C   10D08DE2           ADD      SP,SP,#+16
    586            if(fwrite(f, msf, sizeof(MSS_FILE_P2), &err)!=sizeof(MSS_FILE_P2))
   \                     ??saveFile_16:
   \   00000250   0D30A0E1           MOV      R3,SP
   \   00000254   5020A0E3           MOV      R2,#+80
   \   00000258   0510A0E1           MOV      R1,R5
   \   0000025C   0A00A0E1           MOV      R0,R10
   \   00000260   0C0000EF           SWI      +12
   \   00000264   500050E3           CMP      R0,#+80
   \   00000268   0500000A           BEQ      ??saveFile_17
    587            {
    588              mfree(msf);
   \   0000026C   0500A0E1           MOV      R0,R5
   \   00000270   150000EF           SWI      +21
    589              fclose(f, &err);
   \   00000274   0D10A0E1           MOV      R1,SP
   \   00000278   0A00A0E1           MOV      R0,R10
   \   0000027C   0D0000EF           SWI      +13
    590              return 0;
   \   00000280   C3FFFFEA           B        ??saveFile_6
    591            }
    592            fwrite(f, ws->wsbody, (ws->wsbody[0]+1)*2, &err);
   \                     ??saveFile_17:
   \   00000284   001096E5           LDR      R1,[R6, #+0]
   \   00000288   0D30A0E1           MOV      R3,SP
   \   0000028C   B000D1E1           LDRH     R0,[R1, #+0]
   \   00000290   010080E2           ADD      R0,R0,#+1
   \   00000294   8020A0E1           LSL      R2,R0,#+1
   \   00000298   0A00A0E1           MOV      R0,R10
   \   0000029C   0C0000EF           SWI      +12
    593            fclose(f, &err);
   \   000002A0   0D10A0E1           MOV      R1,SP
   \   000002A4   0A00A0E1           MOV      R0,R10
   \   000002A8   0D0000EF           SWI      +13
    594            mfree(msf);
   \   000002AC   0500A0E1           MOV      R0,R5
   \   000002B0   150000EF           SWI      +21
    595            if(need_reload==1) readAllSMS();
   \   000002B4   010054E3           CMP      R4,#+1
   \   000002B8   0100001A           BNE      ??saveFile_18
   \   000002BC   ........           BL       readAllSMS
   \   000002C0   100000EA           B        ??saveFile_19
    596            else if(need_reload==2)
   \                     ??saveFile_18:
   \   000002C4   020054E3           CMP      R4,#+2
   \   000002C8   0E00001A           BNE      ??saveFile_19
    597            {
    598              //int ReadMSS(char *fname, SMS_DATA *sd)
    599              sdx=AllocSD();
   \   000002CC   ........           BL       AllocSD
   \   000002D0   0040A0E1           MOV      R4,R0
    600              if(ReadMSS(path, sdx))
   \   000002D4   0410A0E1           MOV      R1,R4
   \   000002D8   14008DE2           ADD      R0,SP,#+20
   \   000002DC   ........           BL       ReadMSS
   \   000002E0   000050E3           CMP      R0,#+0
   \   000002E4   0500000A           BEQ      ??saveFile_20
    601              {
    602                LockSched();
   \   000002E8   460100EF           SWI      +326
    603                AddToSdlByTime(sdx);
   \   000002EC   0400A0E1           MOV      R0,R4
   \   000002F0   ........           BL       AddToSdlByTime
    604                UnlockSched();
   \   000002F4   470100EF           SWI      +327
    605                return ((int)sdx);
   \   000002F8   0400A0E1           MOV      R0,R4
   \   000002FC   A5FFFFEA           B        ??saveFile_14
    606              }
    607              else FreeSdOne(sdx);
   \                     ??saveFile_20:
   \   00000300   0400A0E1           MOV      R0,R4
   \   00000304   ........           BL       FreeSdOne
    608            }
    609            return 1;
   \                     ??saveFile_19:
   \   00000308   0100A0E3           MOV      R0,#+1
   \                     ??saveFile_12:
   \   0000030C   45DF8DE2           ADD      SP,SP,#+276      ;; stack cleaning
   \   00000310   F08FBDE8           POP      {R4-R11,PC}      ;; return
    610          }
    611          
    612          //SMS_DATA *AllocSD(void);
    613          //void AddToSdlByTime(SMS_DATA *sd);
    614          

   \                                 In segment CODE, align 4, keep-with-next
    615          int readFile(int type)
    616          {
   \                     readFile:
   \   00000000   F0412DE9           PUSH     {R4-R8,LR}
   \   00000004   48D04DE2           SUB      SP,SP,#+72
   \   00000008   40DE4DE2           SUB      SP,SP,#+1024
    617            unsigned int err;
    618          //  int fp;
    619            const char *folder;
    620            char dir[128];
    621            char fullpath[128];
    622            int n=0/*, wlen*/;
   \   0000000C   0040A0E3           MOV      R4,#+0
    623            DIR_ENTRY de;
    624            int len, x;
    625            SMS_DATA *sdx;
    626            //WSHDR *ws, wsn;
    627            //unsigned short wsb[MAX_TEXT];
    628            switch(type)
   \   00000010   010050E2           SUBS     R0,R0,#+1
   \   00000014   0900000A           BEQ      ??readFile_0
   \   00000018   010040E2           SUB      R0,R0,#+1
   \   0000001C   010050E3           CMP      R0,#+1
   \   00000020   0800009A           BLS      ??readFile_1
   \   00000024   020050E2           SUBS     R0,R0,#+2
   \   00000028   0200000A           BEQ      ??readFile_2
   \   0000002C   010050E2           SUBS     R0,R0,#+1
   \   00000030   0400000A           BEQ      ??readFile_1
   \   00000034   050000EA           B        ??readFile_3
    629            {
    630            case TYPE_DRAFT:
    631              folder=FLDR_DRAFT;
   \                     ??readFile_2:
   \   00000038   ........           LDR      R7,??DataTable19  ;; FLDR_DRAFT
   \   0000003C   040000EA           B        ??readFile_4
    632              break;
    633            case TYPE_OUT:
    634              folder=FLDR_OUT;
   \                     ??readFile_0:
   \   00000040   ........           LDR      R7,??DataTable20  ;; FLDR_OUT
   \   00000044   020000EA           B        ??readFile_4
    635              break;
    636            case TYPE_IN_N:
    637            case TYPE_IN_R:
    638            case TYPE_IN_ALL:
    639              folder=FLDR_IN;
   \                     ??readFile_1:
   \   00000048   ........           LDR      R7,??DataTable21  ;; FLDR_IN
   \   0000004C   000000EA           B        ??readFile_4
    640              break;
    641            default:
    642              folder=FLDR_UNK;
   \                     ??readFile_3:
   \   00000050   ........           LDR      R7,??DataTable22  ;; FLDR_UNK
    643              break;
    644            }
    645            strcpy(dir, CFG_MAIN_FOLDER);
   \                     ??readFile_4:
   \   00000054   ........           LDR      R1,??DataTable23  ;; CFG_MAIN_FOLDER
   \   00000058   D20F8DE2           ADD      R0,SP,#+840
   \   0000005C   1A0000EF           SWI      +26
    646            if((len=strlen(dir))<=0) return 0;
   \   00000060   D20F8DE2           ADD      R0,SP,#+840
   \   00000064   1B0000EF           SWI      +27
   \   00000068   010050E3           CMP      R0,#+1
   \   0000006C   500000BA           BLT      ??readFile_5
    647            x=dir[len-1];
   \   00000070   D21F8DE2           ADD      R1,SP,#+840
   \   00000074   010080E0           ADD      R0,R0,R1
   \   00000078   011050E5           LDRB     R1,[R0, #-1]
    648            if((x!='\\')&&(x!='/'))
   \   0000007C   5C50A0E3           MOV      R5,#+92
   \   00000080   0060A0E3           MOV      R6,#+0
   \   00000084   5C0051E3           CMP      R1,#+92
   \   00000088   2F005113           CMPNE    R1,#+47
    649            {
    650              dir[len]='\\';
   \   0000008C   0050C015           STRBNE   R5,[R0, #+0]
    651              dir[len+1]=0;
   \   00000090   0160C015           STRBNE   R6,[R0, #+1]
    652            }
    653            strcat(dir, folder);
   \   00000094   0710A0E1           MOV      R1,R7
   \   00000098   D20F8DE2           ADD      R0,SP,#+840
   \   0000009C   170000EF           SWI      +23
    654            if(!isdir(dir, &err))
   \   000000A0   0D10A0E1           MOV      R1,SP
   \   000000A4   D20F8DE2           ADD      R0,SP,#+840
   \   000000A8   910000EF           SWI      +145
   \   000000AC   000050E3           CMP      R0,#+0
   \   000000B0   4000000A           BEQ      ??readFile_6
    655              return 0;
    656            strcat(dir, "*.mss");
   \   000000B4   ........           LDR      R1,??DataTable24  ;; `?<Constant {0}>` + 128
   \   000000B8   D20F8DE2           ADD      R0,SP,#+840
   \   000000BC   170000EF           SWI      +23
    657            //ws=CreateLocalWS(&wsn, wsb, MAX_TEXT);
    658            if(FindFirstFile(&de, dir, &err))
   \   000000C0   A57085E2           ADD      R7,R5,#+165
   \   000000C4   0D20A0E1           MOV      R2,SP
   \   000000C8   D21F8DE2           ADD      R1,SP,#+840
   \   000000CC   04008DE2           ADD      R0,SP,#+4
   \   000000D0   6B0000EF           SWI      +107
   \   000000D4   000050E3           CMP      R0,#+0
   \   000000D8   2B00000A           BEQ      ??readFile_7
    659            {
    660              do
    661              {
    662          //      char *buf=malloc((de.file_size+3)&(~3));
    663                strcpy(fullpath, de.folder_name);
   \                     ??readFile_8:
   \   000000DC   38108DE2           ADD      R1,SP,#+56
   \   000000E0   F20F8DE2           ADD      R0,SP,#+968
   \   000000E4   1A0000EF           SWI      +26
    664                if((len=strlen(fullpath))<=0) continue;
   \   000000E8   F20F8DE2           ADD      R0,SP,#+968
   \   000000EC   1B0000EF           SWI      +27
   \   000000F0   010050E3           CMP      R0,#+1
   \   000000F4   1F0000BA           BLT      ??readFile_9
    665                if(fullpath[len-1]!='\\'&&fullpath[len-1]!='/')
   \   000000F8   F21F8DE2           ADD      R1,SP,#+968
   \   000000FC   010080E0           ADD      R0,R0,R1
   \   00000100   011050E5           LDRB     R1,[R0, #-1]
   \   00000104   5C0051E3           CMP      R1,#+92
   \   00000108   2F005113           CMPNE    R1,#+47
    666                {
    667          	fullpath[len++]='\\';
   \   0000010C   0050C015           STRBNE   R5,[R0, #+0]
    668          	fullpath[len]='\0';
   \   00000110   0160C015           STRBNE   R6,[R0, #+1]
    669                }
    670                strcat(fullpath, de.file_name);
   \   00000114   B9108DE2           ADD      R1,SP,#+185
   \   00000118   F20F8DE2           ADD      R0,SP,#+968
   \   0000011C   170000EF           SWI      +23
    671                sdx=AllocSD();
   \   00000120   ........           BL       AllocSD
   \   00000124   0080A0E1           MOV      R8,R0
    672                if(ReadMSS(fullpath, sdx))
   \   00000128   0810A0E1           MOV      R1,R8
   \   0000012C   F20F8DE2           ADD      R0,SP,#+968
   \   00000130   ........           BL       ReadMSS
   \   00000134   000050E3           CMP      R0,#+0
   \   00000138   0C00000A           BEQ      ??readFile_10
    673                {
    674          	n++;
   \   0000013C   014084E2           ADD      R4,R4,#+1
    675          	LockSched();
   \   00000140   460100EF           SWI      +326
    676          	AddToSdlByTime(sdx);
   \   00000144   0800A0E1           MOV      R0,R8
   \   00000148   ........           BL       AddToSdlByTime
    677          	UnlockSched();
   \   0000014C   470100EF           SWI      +327
    678          	if(!(n%4)) SendSimpleIpcMsg(SMSYS_IPC_SMS_DATA_UPDATE);//GBS_SendMessage(MMI_CEPID,MSG_IPC,SMSYS_IPC_SMS_DATA_UPDATE,&my_ipc_upd);
   \   00000150   C400A0E1           ASR      R0,R4,#+1
   \   00000154   200F84E0           ADD      R0,R4,R0, LSR #+30
   \   00000158   4001A0E1           ASR      R0,R0,#+2
   \   0000015C   000154E0           SUBS     R0,R4,R0, LSL #+2
   \   00000160   0400001A           BNE      ??readFile_9
   \   00000164   0700A0E1           MOV      R0,R7
   \   00000168   ........           _BLF     SendSimpleIpcMsg,??SendSimpleIpcMsg??rA
   \   0000016C   010000EA           B        ??readFile_9
    679                }
    680                else FreeSdOne(sdx);
   \                     ??readFile_10:
   \   00000170   0800A0E1           MOV      R0,R8
   \   00000174   ........           BL       FreeSdOne
    681              }
    682              while(FindNextFile(&de, &err));
   \                     ??readFile_9:
   \   00000178   0D10A0E1           MOV      R1,SP
   \   0000017C   04008DE2           ADD      R0,SP,#+4
   \   00000180   6C0000EF           SWI      +108
   \   00000184   000050E3           CMP      R0,#+0
   \   00000188   D3FFFF1A           BNE      ??readFile_8
    683            }
    684            FindClose(&de, &err);
   \                     ??readFile_7:
   \   0000018C   0D10A0E1           MOV      R1,SP
   \   00000190   04008DE2           ADD      R0,SP,#+4
   \   00000194   6D0000EF           SWI      +109
    685            if((n%4)) SendSimpleIpcMsg(SMSYS_IPC_SMS_DATA_UPDATE);//GBS_SendMessage(MMI_CEPID,MSG_IPC,SMSYS_IPC_SMS_DATA_UPDATE,&my_ipc_upd);
   \   00000198   C400A0E1           ASR      R0,R4,#+1
   \   0000019C   200F84E0           ADD      R0,R4,R0, LSR #+30
   \   000001A0   4001A0E1           ASR      R0,R0,#+2
   \   000001A4   000154E0           SUBS     R0,R4,R0, LSL #+2
   \   000001A8   0100000A           BEQ      ??readFile_5
   \   000001AC   0700A0E1           MOV      R0,R7
   \   000001B0   ........           _BLF     SendSimpleIpcMsg,??SendSimpleIpcMsg??rA
    686            return n;
   \                     ??readFile_5:
   \   000001B4   0400A0E1           MOV      R0,R4
   \                     ??readFile_6:
   \   000001B8   48D08DE2           ADD      SP,SP,#+72
   \   000001BC   40DE8DE2           ADD      SP,SP,#+1024
   \   000001C0   F081BDE8           POP      {R4-R8,PC}       ;; return
    687          }
    688          

   \                                 In segment CODE, align 4, keep-with-next
    689          int deleteFile(SMS_DATA *sd, int need_reload)
    690          {
   \                     deleteFile:
   \   00000000   30402DE9           PUSH     {R4,R5,LR}
   \   00000004   04D04DE2           SUB      SP,SP,#+4
   \   00000008   0040A0E1           MOV      R4,R0
   \   0000000C   0150A0E1           MOV      R5,R1
    691          	if((sd!=0)&&(sd->isfile==1)&&(sd->fname!=0))
   \   00000010   000054E3           CMP      R4,#+0
   \   00000014   1500000A           BEQ      ??deleteFile_0
   \   00000018   140094E5           LDR      R0,[R4, #+20]
   \   0000001C   010050E3           CMP      R0,#+1
   \   00000020   1200001A           BNE      ??deleteFile_0
   \   00000024   200094E5           LDR      R0,[R4, #+32]
   \   00000028   000050E3           CMP      R0,#+0
   \   0000002C   3280BD08           POPEQ    {R1,R4,R5,PC}
    692          	{
    693          		unsigned int err;
    694          		unlink(sd->fname, &err);
   \   00000030   0D10A0E1           MOV      R1,SP
   \   00000034   6B0100EF           SWI      +363
    695          		if(need_reload)
   \   00000038   000055E3           CMP      R5,#+0
   \   0000003C   0100000A           BEQ      ??deleteFile_1
    696          			return(readAllSMS());
   \   00000040   ........           BL       readAllSMS
   \   00000044   3280BDE8           POP      {R1,R4,R5,PC}
    697          		if(sd->type==TYPE_IN_N && new_sms_n) new_sms_n--;
   \                     ??deleteFile_1:
   \   00000048   080094E5           LDR      R0,[R4, #+8]
   \   0000004C   030050E3           CMP      R0,#+3
   \   00000050   0400001A           BNE      ??deleteFile_2
   \   00000054   ........           LDR      R0,??DataTable25  ;; new_sms_n
   \   00000058   001090E5           LDR      R1,[R0, #+0]
   \   0000005C   000051E3           CMP      R1,#+0
   \   00000060   01104112           SUBNE    R1,R1,#+1
   \   00000064   00108015           STRNE    R1,[R0, #+0]
    698          		return 1;
   \                     ??deleteFile_2:
   \   00000068   0100A0E3           MOV      R0,#+1
   \   0000006C   3280BDE8           POP      {R1,R4,R5,PC}
    699          	}
    700          	return 0;
   \                     ??deleteFile_0:
   \   00000070   0000A0E3           MOV      R0,#+0
   \   00000074   3280BDE8           POP      {R1,R4,R5,PC}    ;; return
    701          }
    702          

   \                                 In segment CODE, align 4, keep-with-next
    703          int deleteDat(SMS_DATA *sd, int need_reload)
    704          {
   \                     deleteDat:
   \   00000000   10402DE9           PUSH     {R4,LR}
   \   00000004   04D04DE2           SUB      SP,SP,#+4
    705          	short cnt;
    706          	if((sd==0)||(sd->isfile)||(sd->id==0))
   \   00000008   000050E3           CMP      R0,#+0
   \   0000000C   0140A0E1           MOV      R4,R1
   \   00000010   1280BD08           POPEQ    {R1,R4,PC}
   \   00000014   141090E5           LDR      R1,[R0, #+20]
   \   00000018   000051E3           CMP      R1,#+0
   \   0000001C   0200001A           BNE      ??deleteDat_0
   \   00000020   0C0090E5           LDR      R0,[R0, #+12]
   \   00000024   000050E3           CMP      R0,#+0
   \   00000028   0100001A           BNE      ??deleteDat_1
    707          		return 0;
   \                     ??deleteDat_0:
   \   0000002C   0000A0E3           MOV      R0,#+0
   \   00000030   1280BDE8           POP      {R1,R4,PC}
    708          	//extern int DeltetSmsNew(int index, short *del_cnt);
    709          	//if(DeltetSmsNew(sd->id, &cnt)!=0x3E8)
    710          	if(DeleteSMS(sd->id, &cnt)!=0x3E8)
                 	   ^
Warning[Pe223]: function "DeleteSMS" declared implicitly
   \                     ??deleteDat_1:
   \   00000034   0D10A0E1           MOV      R1,SP
   \   00000038   ........           _BLF     DeleteSMS,??DeleteSMS??rA
   \   0000003C   FA0F50E3           CMP      R0,#+1000
   \   00000040   F9FFFF1A           BNE      ??deleteDat_0
    711          		return 0;
    712          	if(need_reload)
   \   00000044   000054E3           CMP      R4,#+0
   \   00000048   0100000A           BEQ      ??deleteDat_2
    713          		return (readAllSMS());
   \   0000004C   ........           BL       readAllSMS
   \   00000050   1280BDE8           POP      {R1,R4,PC}
    714          	return 1;
   \                     ??deleteDat_2:
   \   00000054   0100A0E3           MOV      R0,#+1
   \   00000058   1280BDE8           POP      {R1,R4,PC}       ;; return
    715          }
    716          
    717          /*-----------------------------------------------------------*/
    718          // new reader
    719          #define MAX_DAT 100
    720          typedef struct
    721          {
    722          	void *next;
    723          	void *prev;
    724          	int type;
    725          	int cnt;
    726          	int isused;
    727          	char number[32];
    728          	char time[32];
    729          	WSHDR *text;
    730          }EMS_DATA;
    731          
    732          typedef struct
    733          {
    734          	short index;
    735          	short unk0;
    736          	int opmsg_id;
    737          	short is_xms;
    738          	short unk1;
    739          	short unk2;
    740          	short unk3;
    741          }EMS_INDEX;
    742          
    743          typedef struct
    744          {
    745          	char unk0;
    746          	char unk1;
    747          	unsigned short index_id; //0xFFFF, no
    748          	char num[12]; //hex, num[0],len
    749          	short txt_len;
    750          	short w_char[7]; //
    751          	char unk2;
    752          	char unk3;
    753          	short unk_0x160F;
    754          	char unk4[8];
    755          	int opmsg_id;
    756          	unsigned short data_id;//SMS: (data_id-0x2A)*sizeof(PDU)= the position of this sms in sms.dat, EMS: 0xFFF4 ?
    757          	short unk5; //0xA800 ?
    758          }EMS_ADM;
    759          

   \                                 In segment CODE, align 4, keep-with-next
    760          void AddToEDL(EMS_DATA **edltop)
    761          {
   \                     AddToEDL:
   \   00000000   30402DE9           PUSH     {R4,R5,LR}
   \   00000004   0040A0E1           MOV      R4,R0
    762          	EMS_DATA *edl=malloc(sizeof(EMS_DATA));
   \   00000008   5800A0E3           MOV      R0,#+88
   \   0000000C   140000EF           SWI      +20
   \   00000010   0050A0E1           MOV      R5,R0
    763          	zeromem(edl, sizeof(EMS_DATA));
   \   00000014   5810A0E3           MOV      R1,#+88
   \   00000018   1D0100EF           SWI      +285
    764          	edl->text=AllocWS(MAX_TEXT);
   \   0000001C   800EA0E3           MOV      R0,#+2048
   \   00000020   250100EF           SWI      +293
   \   00000024   540085E5           STR      R0,[R5, #+84]
    765          	if(!(*edltop))
   \   00000028   000094E5           LDR      R0,[R4, #+0]
   \   0000002C   000050E3           CMP      R0,#+0
    766          		(*edltop)=edl;
    767          	else
    768          	{
    769          		EMS_DATA *edx=(*edltop);
    770          		edl->next=edx;
   \   00000030   00008515           STRNE    R0,[R5, #+0]
    771          		(*edltop)=edl;
    772          		edx->prev=edl;
   \   00000034   04508015           STRNE    R5,[R0, #+4]
   \   00000038   005084E5           STR      R5,[R4, #+0]
    773          	}
    774          }
   \   0000003C   3080BDE8           POP      {R4,R5,PC}       ;; return
    775          

   \                                 In segment CODE, align 4, keep-with-next
    776          void FreeEDL(EMS_DATA **edltop)
    777          {
   \                     FreeEDL:
   \   00000000   30402DE9           PUSH     {R4,R5,LR}
    778          	EMS_DATA *edl=(*edltop);
   \   00000004   004090E5           LDR      R4,[R0, #+0]
    779          	(*edltop)=0;
   \   00000008   0010A0E3           MOV      R1,#+0
   \   0000000C   001080E5           STR      R1,[R0, #+0]
   \   00000010   000054E3           CMP      R4,#+0
   \   00000014   3080BD08           POPEQ    {R4,R5,PC}
    780          	while(edl)
    781          	{
    782          		EMS_DATA *edlx=edl->next;;
   \                     ??FreeEDL_0:
   \   00000018   005094E5           LDR      R5,[R4, #+0]
    783          		FreeWS(edl->text);
   \   0000001C   540094E5           LDR      R0,[R4, #+84]
   \   00000020   290100EF           SWI      +297
    784          		mfree(edl);
   \   00000024   0400A0E1           MOV      R0,R4
   \   00000028   150000EF           SWI      +21
    785          		edl=edlx;
   \   0000002C   0540B0E1           MOVS     R4,R5
    786          	}
   \   00000030   F8FFFF1A           BNE      ??FreeEDL_0
    787          }
   \   00000034   3080BDE8           POP      {R4,R5,PC}       ;; return

   \                                 In segment CODE, align 4, keep-with-next
    788          void DoSMS(SMS_DATA *sdl, char *data)
    789          {
   \                     DoSMS:
   \   00000000   F0412DE9           PUSH     {R4-R8,LR}
   \   00000004   0040A0E1           MOV      R4,R0
    790          	int c;
    791          	int ttype;
    792          	int isplus;
    793          	char *p;
    794          	p=data;
    795          	if(*p++!=0x11)
   \   00000008   0000D1E5           LDRB     R0,[R1, #+0]
   \   0000000C   110050E3           CMP      R0,#+17
   \   00000010   F081BD18           POPNE    {R4-R8,PC}
    796          		return;
    797          	
    798          	if(*p++!=0x11)
   \   00000014   010081E2           ADD      R0,R1,#+1
   \   00000018   016080E2           ADD      R6,R0,#+1
   \   0000001C   0000D0E5           LDRB     R0,[R0, #+0]
   \   00000020   110050E3           CMP      R0,#+17
   \   00000024   F081BD18           POPNE    {R4-R8,PC}
    799          		return;
    800          	c=*p++;
   \   00000028   ........           LDRB     R7,[R6], #+1
    801          	if(!c)
   \   0000002C   000057E3           CMP      R7,#+0
   \   00000030   F081BD08           POPEQ    {R4-R8,PC}
    802          		return;
    803          
    804          	switch(c)
   \   00000034   0050A0E3           MOV      R5,#+0
   \   00000038   010057E2           SUBS     R0,R7,#+1
   \   0000003C   0600000A           BEQ      ??DoSMS_0
   \   00000040   020050E2           SUBS     R0,R0,#+2
   \   00000044   1000000A           BEQ      ??DoSMS_1
   \   00000048   020050E2           SUBS     R0,R0,#+2
   \   0000004C   1000000A           BEQ      ??DoSMS_2
   \   00000050   020050E2           SUBS     R0,R0,#+2
   \   00000054   1000000A           BEQ      ??DoSMS_3
   \   00000058   110000EA           B        ??DoSMS_4
    805          	{
    806          	case 0x01:
    807          		sdl->type=TYPE_IN_R;
   \                     ??DoSMS_0:
   \   0000005C   0200A0E3           MOV      R0,#+2
   \                     ??DoSMS_5:
   \   00000060   080084E5           STR      R0,[R4, #+8]
    808          		break;
    809          	case 0x03:
    810          		sdl->type=TYPE_IN_N;
    811          		break;
    812          	case 0x05:
    813          		sdl->type=TYPE_OUT;
    814          		break;
    815          	case 0x07:
    816          		sdl->type=TYPE_DRAFT;
    817          		break;
    818          	default:
    819          		sdl->type=TYPE_UNK;
    820          		wsprintf(sdl->SMS_TEXT, STR_UNK_TYPE, c);
    821          		return; //back 
    822          	}
    823          	
    824          	c=*p++; //sms center
   \   00000064   ........           LDRB     R0,[R6], #+1
    825          	p+=c;
   \   00000068   066080E0           ADD      R6,R0,R6
    826          	c=*p++;
   \   0000006C   ........           LDRB     R0,[R6], #+1
    827          	if((c>>4)%2) isplus=1;
   \   00000070   4002A0E1           ASR      R0,R0,#+4
   \   00000074   A01F80E0           ADD      R1,R0,R0, LSR #+31
   \   00000078   C110A0E1           ASR      R1,R1,#+1
   \   0000007C   810050E0           SUBS     R0,R0,R1, LSL #+1
   \   00000080   0070A003           MOVEQ    R7,#+0
   \   00000084   0170A013           MOVNE    R7,#+1
   \   00000088   0A0000EA           B        ??DoSMS_6
   \                     ??DoSMS_1:
   \   0000008C   0300A0E3           MOV      R0,#+3
   \   00000090   F2FFFFEA           B        ??DoSMS_5
   \                     ??DoSMS_2:
   \   00000094   0100A0E3           MOV      R0,#+1
   \   00000098   F0FFFFEA           B        ??DoSMS_5
   \                     ??DoSMS_3:
   \   0000009C   0400A0E3           MOV      R0,#+4
   \   000000A0   EEFFFFEA           B        ??DoSMS_5
   \                     ??DoSMS_4:
   \   000000A4   ........           LDR      R1,??DataTable30  ;; STR_UNK_TYPE
   \   000000A8   085084E5           STR      R5,[R4, #+8]
   \   000000AC   640094E5           LDR      R0,[R4, #+100]
   \   000000B0   0720A0E1           MOV      R2,R7
   \   000000B4   5C0000EA           B        ??DoSMS_7
    828          		else isplus=0;
    829          	if((sdl->type==TYPE_OUT)||(sdl->type==TYPE_DRAFT)) //out
   \                     ??DoSMS_6:
   \   000000B8   080094E5           LDR      R0,[R4, #+8]
   \   000000BC   010050E3           CMP      R0,#+1
   \   000000C0   04005013           CMPNE    R0,#+4
    830          	{
    831          		p++;
   \   000000C4   01608602           ADDEQ    R6,R6,#+1
    832          	}
    833          	c=*p++;
   \   000000C8   ........           LDRB     R0,[R6], #+1
    834          	if(c)
   \   000000CC   000050E3           CMP      R0,#+0
   \   000000D0   0900000A           BEQ      ??DoSMS_8
   \   000000D4   A01F80E0           ADD      R1,R0,R0, LSR #+31
   \   000000D8   C110A0E1           ASR      R1,R1,#+1
   \   000000DC   810050E0           SUBS     R0,R0,R1, LSL #+1
    835          	{
    836          		if(c%2)
    837          			c=c/2+2;
   \   000000E0   02808112           ADDNE    R8,R1,#+2
    838          		else
    839          			c=c/2+1;
   \   000000E4   01808102           ADDEQ    R8,R1,#+1
    840          		Hex2Num(p, sdl->Number, c);
   \   000000E8   0820A0E1           MOV      R2,R8
   \   000000EC   241084E2           ADD      R1,R4,#+36
   \   000000F0   0600A0E1           MOV      R0,R6
   \   000000F4   ........           BL       Hex2Num
   \   000000F8   010000EA           B        ??DoSMS_9
    841          	}
    842          	else
    843          	{
    844          		c=1;
   \                     ??DoSMS_8:
   \   000000FC   0180A0E3           MOV      R8,#+1
    845          		sdl->Number[0]=0;
   \   00000100   2450C4E5           STRB     R5,[R4, #+36]
    846          	}
    847          	p+=c+1; //num
   \                     ??DoSMS_9:
   \   00000104   060088E0           ADD      R0,R8,R6
   \   00000108   016080E2           ADD      R6,R0,#+1
    848          	ttype=*p++;
    849          	if((sdl->type==TYPE_IN_R)||(sdl->type==TYPE_IN_N))
   \   0000010C   080094E5           LDR      R0,[R4, #+8]
   \   00000110   ........           LDRB     R2,[R6], #+1
   \   00000114   020050E3           CMP      R0,#+2
   \   00000118   03005013           CMPNE    R0,#+3
   \   0000011C   1900001A           BNE      ??DoSMS_10
    850          	{
    851          		char *pp=sdl->Time;
   \   00000120   440084E2           ADD      R0,R4,#+68
    852          		int i;
    853          		for(i=0;i<6;i++) //time
   \   00000124   0010A0E3           MOV      R1,#+0
    854          		{
    855          			*pp++=p[i]%0x10+'0';
   \                     ??DoSMS_11:
   \   00000128   0630D1E7           LDRB     R3,[R1, +R6]
    856          			*pp++=p[i]/0x10+'0';
    857          			if(i<2)
   \   0000012C   020051E3           CMP      R1,#+2
   \   00000130   0380A0E1           MOV      R8,R3
   \   00000134   2882A0E1           LSR      R8,R8,#+4
   \   00000138   083243E0           SUB      R3,R3,R8, LSL #+4
   \   0000013C   303083E2           ADD      R3,R3,#+48
   \   00000140   ........           STRB     R3,[R0], #+1
   \   00000144   0630D1E7           LDRB     R3,[R1, +R6]
   \   00000148   3080A0E3           MOV      R8,#+48
   \   0000014C   233288E0           ADD      R3,R8,R3, LSR #+4
   \   00000150   ........           STRB     R3,[R0], #+1
    858          			*pp++='-';
   \   00000154   2D30A0B3           MOVLT    R3,#+45
   \   00000158   040000BA           BLT      ??DoSMS_12
    859          			if(i==2)
    860          				*pp++=' ';
   \   0000015C   2030A003           MOVEQ    R3,#+32
   \   00000160   0200000A           BEQ      ??DoSMS_12
    861          			if(i>2&&i<5)
   \   00000164   050051E3           CMP      R1,#+5
   \   00000168   010000AA           BGE      ??DoSMS_13
    862          				*pp++=':';
   \   0000016C   3A30A0E3           MOV      R3,#+58
   \                     ??DoSMS_12:
   \   00000170   ........           STRB     R3,[R0], #+1
    863          		}
   \                     ??DoSMS_13:
   \   00000174   011081E2           ADD      R1,R1,#+1
   \   00000178   060051E3           CMP      R1,#+6
   \   0000017C   E9FFFFBA           BLT      ??DoSMS_11
    864          		*pp=0;
   \   00000180   0050C0E5           STRB     R5,[R0, #+0]
    865          		p+=7; //time
   \   00000184   076086E2           ADD      R6,R6,#+7
    866          	}
    867          	if(isplus&&((sdl->type==TYPE_OUT)||(sdl->type==TYPE_DRAFT))) p++; //
   \                     ??DoSMS_10:
   \   00000188   000057E3           CMP      R7,#+0
   \   0000018C   0300000A           BEQ      ??DoSMS_14
   \   00000190   080094E5           LDR      R0,[R4, #+8]
   \   00000194   010050E3           CMP      R0,#+1
   \   00000198   04005013           CMPNE    R0,#+4
   \   0000019C   01608602           ADDEQ    R6,R6,#+1
    868          	c=*p++;
   \                     ??DoSMS_14:
   \   000001A0   ........           LDRB     R7,[R6], #+1
    869          	//...text,
    870          	if(ttype==0x8)
   \   000001A4   640094E5           LDR      R0,[R4, #+100]
   \   000001A8   080052E3           CMP      R2,#+8
   \   000001AC   0400001A           BNE      ??DoSMS_15
    871          	{
    872          		Add2WS(p, (char *)(sdl->SMS_TEXT->wsbody), c);
   \   000001B0   001090E5           LDR      R1,[R0, #+0]
   \   000001B4   0720A0E1           MOV      R2,R7
   \   000001B8   0600A0E1           MOV      R0,R6
   \   000001BC   ........           BL       Add2WS
   \   000001C0   F081BDE8           POP      {R4-R8,PC}
    873          	}
    874          	else if(ttype==0x0) //7bit
   \                     ??DoSMS_15:
   \   000001C4   000052E3           CMP      R2,#+0
   \   000001C8   1600001A           BNE      ??DoSMS_16
    875          	{
    876          		GSMTXT_Decode(sdl->SMS_TEXT,(void*)p,c*7/8+1, ttype, (void*(*)(int))malloc_adr(),(void(*)(void))mfree_adr());
   \   000001CC   158000EF           SWI      +32789
   \   000001D0   0050A0E1           MOV      R5,R0
   \   000001D4   148000EF           SWI      +32788
   \   000001D8   20002DE9           PUSH     {R5}
   \   000001DC   01002DE9           PUSH     {R0}
   \   000001E0   871167E0           RSB      R1,R7,R7, LSL #+3
   \   000001E4   0030A0E3           MOV      R3,#+0
   \   000001E8   4101A0E1           ASR      R0,R1,#+2
   \   000001EC   A00E81E0           ADD      R0,R1,R0, LSR #+29
   \   000001F0   0110A0E3           MOV      R1,#+1
   \   000001F4   C02181E0           ADD      R2,R1,R0, ASR #+3
   \   000001F8   640094E5           LDR      R0,[R4, #+100]
   \   000001FC   0610A0E1           MOV      R1,R6
   \   00000200   1D0200EF           SWI      +541
    877          		if(wslen(sdl->SMS_TEXT)>c)
   \   00000204   640094E5           LDR      R0,[R4, #+100]
   \   00000208   001090E5           LDR      R1,[R0, #+0]
   \   0000020C   B010D1E1           LDRH     R1,[R1, #+0]
   \   00000210   08D08DE2           ADD      SP,SP,#+8
   \   00000214   010057E1           CMP      R7,R1
   \   00000218   F081BDA8           POPGE    {R4-R8,PC}
    878          		{
    879          			CutWSTR(sdl->SMS_TEXT, c);
   \   0000021C   0710A0E1           MOV      R1,R7
   \   00000220   260100EF           SWI      +294
   \   00000224   F081BDE8           POP      {R4-R8,PC}
    880          		}
    881          	}
    882          	else 
    883          	{
    884          		wsprintf(sdl->SMS_TEXT, STR_UNK_TXTT, ttype);
   \                     ??DoSMS_16:
   \   00000228   ........           LDR      R1,??DataTable29  ;; STR_UNK_TXTT
   \                     ??DoSMS_7:
   \   0000022C   240100EF           SWI      +292
   \   00000230   F081BDE8           POP      {R4-R8,PC}       ;; return
    885          	}
    886          }
    887          

   \                                 In segment CODE, align 4, keep-with-next
    888          void DoSMS_E(EMS_DATA *edl, char *data)
    889          {
   \                     DoSMS_E:
   \   00000000   F0412DE9           PUSH     {R4-R8,LR}
   \   00000004   0040A0E1           MOV      R4,R0
    890          	int c;
    891          	int ttype;
    892          	int isplus;
    893          	char *p;
    894          	p=data;
    895          	if(*p++!=0x11)
   \   00000008   0000D1E5           LDRB     R0,[R1, #+0]
   \   0000000C   110050E3           CMP      R0,#+17
   \   00000010   F081BD18           POPNE    {R4-R8,PC}
    896          		return;
    897          	
    898          	if(*p++!=0x11)
   \   00000014   010081E2           ADD      R0,R1,#+1
   \   00000018   016080E2           ADD      R6,R0,#+1
   \   0000001C   0000D0E5           LDRB     R0,[R0, #+0]
   \   00000020   110050E3           CMP      R0,#+17
   \   00000024   F081BD18           POPNE    {R4-R8,PC}
    899          		return;
    900          	c=*p++;
   \   00000028   ........           LDRB     R7,[R6], #+1
    901          	if(!c)
   \   0000002C   000057E3           CMP      R7,#+0
   \   00000030   F081BD08           POPEQ    {R4-R8,PC}
    902          		return;
    903          
    904          	switch(c)
   \   00000034   0050A0E3           MOV      R5,#+0
   \   00000038   010057E2           SUBS     R0,R7,#+1
   \   0000003C   0600000A           BEQ      ??DoSMS_E_0
   \   00000040   020050E2           SUBS     R0,R0,#+2
   \   00000044   1000000A           BEQ      ??DoSMS_E_1
   \   00000048   020050E2           SUBS     R0,R0,#+2
   \   0000004C   1000000A           BEQ      ??DoSMS_E_2
   \   00000050   020050E2           SUBS     R0,R0,#+2
   \   00000054   1000000A           BEQ      ??DoSMS_E_3
   \   00000058   110000EA           B        ??DoSMS_E_4
    905          	{
    906          	case 0x01:
    907          		edl->type=TYPE_IN_R;
   \                     ??DoSMS_E_0:
   \   0000005C   0200A0E3           MOV      R0,#+2
   \                     ??DoSMS_E_5:
   \   00000060   080084E5           STR      R0,[R4, #+8]
    908          		break;
    909          	case 0x03:
    910          		edl->type=TYPE_IN_N;
    911          		break;
    912          	case 0x05:
    913          		edl->type=TYPE_OUT;
    914          		break;
    915          	case 0x07:
    916          		edl->type=TYPE_DRAFT;
    917          		break;
    918          	default:
    919          		edl->type=TYPE_UNK;
    920          		wsprintf(edl->text, STR_UNK_TYPE, c);
    921          		return; //back 
    922          	}
    923          	
    924          	c=*p++; //sms center
   \   00000064   ........           LDRB     R0,[R6], #+1
    925          	p+=c;
   \   00000068   066080E0           ADD      R6,R0,R6
    926          	c=*p++;
   \   0000006C   ........           LDRB     R0,[R6], #+1
    927          	if((c>>4)%2) isplus=1;
   \   00000070   4002A0E1           ASR      R0,R0,#+4
   \   00000074   A01F80E0           ADD      R1,R0,R0, LSR #+31
   \   00000078   C110A0E1           ASR      R1,R1,#+1
   \   0000007C   810050E0           SUBS     R0,R0,R1, LSL #+1
   \   00000080   0070A003           MOVEQ    R7,#+0
   \   00000084   0170A013           MOVNE    R7,#+1
   \   00000088   0A0000EA           B        ??DoSMS_E_6
   \                     ??DoSMS_E_1:
   \   0000008C   0300A0E3           MOV      R0,#+3
   \   00000090   F2FFFFEA           B        ??DoSMS_E_5
   \                     ??DoSMS_E_2:
   \   00000094   0100A0E3           MOV      R0,#+1
   \   00000098   F0FFFFEA           B        ??DoSMS_E_5
   \                     ??DoSMS_E_3:
   \   0000009C   0400A0E3           MOV      R0,#+4
   \   000000A0   EEFFFFEA           B        ??DoSMS_E_5
   \                     ??DoSMS_E_4:
   \   000000A4   ........           LDR      R1,??DataTable30  ;; STR_UNK_TYPE
   \   000000A8   085084E5           STR      R5,[R4, #+8]
   \   000000AC   540094E5           LDR      R0,[R4, #+84]
   \   000000B0   0720A0E1           MOV      R2,R7
   \   000000B4   5C0000EA           B        ??DoSMS_E_7
    928          		else isplus=0;
    929          	if((edl->type==TYPE_OUT)||(edl->type==TYPE_DRAFT)) //out
   \                     ??DoSMS_E_6:
   \   000000B8   080094E5           LDR      R0,[R4, #+8]
   \   000000BC   010050E3           CMP      R0,#+1
   \   000000C0   04005013           CMPNE    R0,#+4
    930          	{
    931          		p++;
   \   000000C4   01608602           ADDEQ    R6,R6,#+1
    932          	}
    933          	c=*p++;
   \   000000C8   ........           LDRB     R0,[R6], #+1
    934          	if(c)
   \   000000CC   000050E3           CMP      R0,#+0
   \   000000D0   0900000A           BEQ      ??DoSMS_E_8
   \   000000D4   A01F80E0           ADD      R1,R0,R0, LSR #+31
   \   000000D8   C110A0E1           ASR      R1,R1,#+1
   \   000000DC   810050E0           SUBS     R0,R0,R1, LSL #+1
    935          	{
    936          		if(c%2)
    937          			c=c/2+2;
   \   000000E0   02808112           ADDNE    R8,R1,#+2
    938          		else
    939          			c=c/2+1;
   \   000000E4   01808102           ADDEQ    R8,R1,#+1
    940          		Hex2Num(p, edl->number, c);
   \   000000E8   0820A0E1           MOV      R2,R8
   \   000000EC   141084E2           ADD      R1,R4,#+20
   \   000000F0   0600A0E1           MOV      R0,R6
   \   000000F4   ........           BL       Hex2Num
   \   000000F8   010000EA           B        ??DoSMS_E_9
    941          	}
    942          	else
    943          	{
    944          		c=1;
   \                     ??DoSMS_E_8:
   \   000000FC   0180A0E3           MOV      R8,#+1
    945          		edl->number[0]=0;
   \   00000100   1450C4E5           STRB     R5,[R4, #+20]
    946          	}
    947          	p+=c+1; //num
   \                     ??DoSMS_E_9:
   \   00000104   060088E0           ADD      R0,R8,R6
   \   00000108   016080E2           ADD      R6,R0,#+1
    948          	ttype=*p++;
    949          	if((edl->type==TYPE_IN_R)||(edl->type==TYPE_IN_N))
   \   0000010C   080094E5           LDR      R0,[R4, #+8]
   \   00000110   ........           LDRB     R2,[R6], #+1
   \   00000114   020050E3           CMP      R0,#+2
   \   00000118   03005013           CMPNE    R0,#+3
   \   0000011C   1900001A           BNE      ??DoSMS_E_10
    950          	{
    951          		char *pp=edl->time;
   \   00000120   340084E2           ADD      R0,R4,#+52
    952          		int i;
    953          		for(i=0;i<6;i++) //time
   \   00000124   0010A0E3           MOV      R1,#+0
    954          		{
    955          			*pp++=p[i]%0x10+'0';
   \                     ??DoSMS_E_11:
   \   00000128   0630D1E7           LDRB     R3,[R1, +R6]
    956          			*pp++=p[i]/0x10+'0';
    957          			if(i<2)
   \   0000012C   020051E3           CMP      R1,#+2
   \   00000130   0380A0E1           MOV      R8,R3
   \   00000134   2882A0E1           LSR      R8,R8,#+4
   \   00000138   083243E0           SUB      R3,R3,R8, LSL #+4
   \   0000013C   303083E2           ADD      R3,R3,#+48
   \   00000140   ........           STRB     R3,[R0], #+1
   \   00000144   0630D1E7           LDRB     R3,[R1, +R6]
   \   00000148   3080A0E3           MOV      R8,#+48
   \   0000014C   233288E0           ADD      R3,R8,R3, LSR #+4
   \   00000150   ........           STRB     R3,[R0], #+1
    958          			*pp++='-';
   \   00000154   2D30A0B3           MOVLT    R3,#+45
   \   00000158   040000BA           BLT      ??DoSMS_E_12
    959          			if(i==2)
    960          				*pp++=' ';
   \   0000015C   2030A003           MOVEQ    R3,#+32
   \   00000160   0200000A           BEQ      ??DoSMS_E_12
    961          			if(i>2&&i<5)
   \   00000164   050051E3           CMP      R1,#+5
   \   00000168   010000AA           BGE      ??DoSMS_E_13
    962          				*pp++=':';
   \   0000016C   3A30A0E3           MOV      R3,#+58
   \                     ??DoSMS_E_12:
   \   00000170   ........           STRB     R3,[R0], #+1
    963          		}
   \                     ??DoSMS_E_13:
   \   00000174   011081E2           ADD      R1,R1,#+1
   \   00000178   060051E3           CMP      R1,#+6
   \   0000017C   E9FFFFBA           BLT      ??DoSMS_E_11
    964          		*pp=0;
   \   00000180   0050C0E5           STRB     R5,[R0, #+0]
    965          		p+=7; //time
   \   00000184   076086E2           ADD      R6,R6,#+7
    966          	}
    967          	if(isplus&&((edl->type==TYPE_OUT)||(edl->type==TYPE_DRAFT))) p++; //
   \                     ??DoSMS_E_10:
   \   00000188   000057E3           CMP      R7,#+0
   \   0000018C   0300000A           BEQ      ??DoSMS_E_14
   \   00000190   080094E5           LDR      R0,[R4, #+8]
   \   00000194   010050E3           CMP      R0,#+1
   \   00000198   04005013           CMPNE    R0,#+4
   \   0000019C   01608602           ADDEQ    R6,R6,#+1
    968          	c=*p++;
   \                     ??DoSMS_E_14:
   \   000001A0   ........           LDRB     R7,[R6], #+1
    969          	//...text,
    970          	if(ttype==0x8)
   \   000001A4   540094E5           LDR      R0,[R4, #+84]
   \   000001A8   080052E3           CMP      R2,#+8
   \   000001AC   0400001A           BNE      ??DoSMS_E_15
    971          	{
    972          		Add2WS(p, (char *)(edl->text->wsbody), c);
   \   000001B0   001090E5           LDR      R1,[R0, #+0]
   \   000001B4   0720A0E1           MOV      R2,R7
   \   000001B8   0600A0E1           MOV      R0,R6
   \   000001BC   ........           BL       Add2WS
   \   000001C0   F081BDE8           POP      {R4-R8,PC}
    973          	}
    974          	else if(ttype==0x0) //7bit
   \                     ??DoSMS_E_15:
   \   000001C4   000052E3           CMP      R2,#+0
   \   000001C8   1600001A           BNE      ??DoSMS_E_16
    975          	{
    976          		GSMTXT_Decode(edl->text,(void*)p,c*7/8+1, ttype, (void*(*)(int))malloc_adr(),(void(*)(void))mfree_adr());
   \   000001CC   158000EF           SWI      +32789
   \   000001D0   0050A0E1           MOV      R5,R0
   \   000001D4   148000EF           SWI      +32788
   \   000001D8   20002DE9           PUSH     {R5}
   \   000001DC   01002DE9           PUSH     {R0}
   \   000001E0   871167E0           RSB      R1,R7,R7, LSL #+3
   \   000001E4   0030A0E3           MOV      R3,#+0
   \   000001E8   4101A0E1           ASR      R0,R1,#+2
   \   000001EC   A00E81E0           ADD      R0,R1,R0, LSR #+29
   \   000001F0   0110A0E3           MOV      R1,#+1
   \   000001F4   C02181E0           ADD      R2,R1,R0, ASR #+3
   \   000001F8   540094E5           LDR      R0,[R4, #+84]
   \   000001FC   0610A0E1           MOV      R1,R6
   \   00000200   1D0200EF           SWI      +541
    977          		if(wslen(edl->text)>c)
   \   00000204   540094E5           LDR      R0,[R4, #+84]
   \   00000208   001090E5           LDR      R1,[R0, #+0]
   \   0000020C   B010D1E1           LDRH     R1,[R1, #+0]
   \   00000210   08D08DE2           ADD      SP,SP,#+8
   \   00000214   010057E1           CMP      R7,R1
   \   00000218   F081BDA8           POPGE    {R4-R8,PC}
    978          		{
    979          			CutWSTR(edl->text, c);
   \   0000021C   0710A0E1           MOV      R1,R7
   \   00000220   260100EF           SWI      +294
   \   00000224   F081BDE8           POP      {R4-R8,PC}
    980          		}
    981          	}
    982          	else 
    983          	{
    984          		wsprintf(edl->text, STR_UNK_TXTT, ttype);
   \                     ??DoSMS_E_16:
   \   00000228   ........           LDR      R1,??DataTable29  ;; STR_UNK_TXTT
   \                     ??DoSMS_E_7:
   \   0000022C   240100EF           SWI      +292
   \   00000230   F081BDE8           POP      {R4-R8,PC}       ;; return
    985          	}
    986          }
    987          

   \                                 In segment CODE, align 4, keep-with-next
    988          void DoEMS(EMS_DATA *edl, char *data, char *sms_dat_buf_start, char *sms_dat_buf_end)
    989          {
   \                     DoEMS:
   \   00000000   FC4F2DE9           PUSH     {R2-R11,LR}
   \   00000004   04D04DE2           SUB      SP,SP,#+4
   \   00000008   0040A0E1           MOV      R4,R0
   \   0000000C   0180A0E1           MOV      R8,R1
    990          	int c;
    991          	int ttype;
    992          	int isems;
    993          	int isplus;
    994          	int skip=0, cmp_size=0;
    995          	char *p, *p2=0, *ems_next=0;
    996          	p=data;
    997          	if(*p++!=0x11)
   \   00000010   0000D8E5           LDRB     R0,[R8, #+0]
   \   00000014   110050E3           CMP      R0,#+17
   \   00000018   F78FBD18           POPNE    {R0-R2,R4-R11,PC}
    998          		return;
    999          	
   1000          	if(*p++!=0x11)
   \   0000001C   010088E2           ADD      R0,R8,#+1
   \   00000020   01A080E2           ADD      R10,R0,#+1
   \   00000024   0000D0E5           LDRB     R0,[R0, #+0]
   \   00000028   110050E3           CMP      R0,#+17
   \   0000002C   F78FBD18           POPNE    {R0-R2,R4-R11,PC}
   1001          		return;
   1002          	c=*p++;
   \   00000030   ........           LDRB     R9,[R10], #+1
   1003          	if(!c)
   \   00000034   000059E3           CMP      R9,#+0
   \   00000038   F78FBD08           POPEQ    {R0-R2,R4-R11,PC}
   1004          		return;
   1005          	switch(c)
   \   0000003C   0050A0E3           MOV      R5,#+0
   \   00000040   010059E2           SUBS     R0,R9,#+1
   \   00000044   0600000A           BEQ      ??DoEMS_0
   \   00000048   020050E2           SUBS     R0,R0,#+2
   \   0000004C   1000000A           BEQ      ??DoEMS_1
   \   00000050   020050E2           SUBS     R0,R0,#+2
   \   00000054   1000000A           BEQ      ??DoEMS_2
   \   00000058   020050E2           SUBS     R0,R0,#+2
   \   0000005C   1000000A           BEQ      ??DoEMS_3
   \   00000060   110000EA           B        ??DoEMS_4
   1006          	{
   1007          	case 0x01:
   1008          		edl->type=TYPE_IN_R;
   \                     ??DoEMS_0:
   \   00000064   0200A0E3           MOV      R0,#+2
   \                     ??DoEMS_5:
   \   00000068   080084E5           STR      R0,[R4, #+8]
   1009          		break;
   1010          	case 0x03:
   1011          		edl->type=TYPE_IN_N;
   1012          		break;
   1013          	case 0x05:
   1014          		edl->type=TYPE_OUT;
   1015          		break;
   1016          	case 0x07:
   1017          		edl->type=TYPE_DRAFT;
   1018          		break;
   1019          	default:
   1020          		edl->type=TYPE_UNK;
   1021          		wsprintf(edl->text, STR_UNK_TYPE, c);
   1022          		return; //back 
   1023          	}
   1024          	
   1025          	c=*p++; //sms center
   \   0000006C   ........           LDRB     R0,[R10], #+1
   1026          	p+=c;
   \   00000070   0AA080E0           ADD      R10,R0,R10
   1027          	c=*p++;
   \   00000074   ........           LDRB     R9,[R10], #+1
   1028          	if((c>>4)%2) isplus=1;
   \   00000078   4902A0E1           ASR      R0,R9,#+4
   \   0000007C   A01F80E0           ADD      R1,R0,R0, LSR #+31
   \   00000080   C110A0E1           ASR      R1,R1,#+1
   \   00000084   810050E0           SUBS     R0,R0,R1, LSL #+1
   \   00000088   0060A003           MOVEQ    R6,#+0
   \   0000008C   0160A013           MOVNE    R6,#+1
   \   00000090   0B0000EA           B        ??DoEMS_6
   \                     ??DoEMS_1:
   \   00000094   0300A0E3           MOV      R0,#+3
   \   00000098   F2FFFFEA           B        ??DoEMS_5
   \                     ??DoEMS_2:
   \   0000009C   0100A0E3           MOV      R0,#+1
   \   000000A0   F0FFFFEA           B        ??DoEMS_5
   \                     ??DoEMS_3:
   \   000000A4   0400A0E3           MOV      R0,#+4
   \   000000A8   EEFFFFEA           B        ??DoEMS_5
   \                     ??DoEMS_4:
   \   000000AC   ........           LDR      R1,??DataTable30  ;; STR_UNK_TYPE
   \   000000B0   085084E5           STR      R5,[R4, #+8]
   \   000000B4   540094E5           LDR      R0,[R4, #+84]
   \   000000B8   0920A0E1           MOV      R2,R9
   \   000000BC   240100EF           SWI      +292
   \   000000C0   F78FBDE8           POP      {R0-R2,R4-R11,PC}
   1029          	else isplus=0;
   1030          	if((c>>6)%2) isems=1;
   \                     ??DoEMS_6:
   \   000000C4   4903A0E1           ASR      R0,R9,#+6
   \   000000C8   A01F80E0           ADD      R1,R0,R0, LSR #+31
   \   000000CC   C110A0E1           ASR      R1,R1,#+1
   \   000000D0   810050E0           SUBS     R0,R0,R1, LSL #+1
   \   000000D4   F78FBD08           POPEQ    {R0-R2,R4-R11,PC}
   1031          	else return; //is not ems
   1032          	if((edl->type==TYPE_OUT)||(edl->type==TYPE_DRAFT)) //out
   \   000000D8   080094E5           LDR      R0,[R4, #+8]
   \   000000DC   010050E3           CMP      R0,#+1
   \   000000E0   04005013           CMPNE    R0,#+4
   1033          		p++;
   \   000000E4   01A08A02           ADDEQ    R10,R10,#+1
   1034          	c=*p++;
   \   000000E8   ........           LDRB     R0,[R10], #+1
   1035          	if(c)
   \   000000EC   000050E3           CMP      R0,#+0
   \   000000F0   0900000A           BEQ      ??DoEMS_7
   \   000000F4   A01F80E0           ADD      R1,R0,R0, LSR #+31
   \   000000F8   C110A0E1           ASR      R1,R1,#+1
   \   000000FC   810050E0           SUBS     R0,R0,R1, LSL #+1
   1036          	{
   1037          		if(c%2)
   1038          			c=c/2+2;
   \   00000100   02708112           ADDNE    R7,R1,#+2
   1039          		else
   1040          			c=c/2+1;
   \   00000104   01708102           ADDEQ    R7,R1,#+1
   1041          		Hex2Num(p, edl->number, c);
   \   00000108   0720A0E1           MOV      R2,R7
   \   0000010C   141084E2           ADD      R1,R4,#+20
   \   00000110   0A00A0E1           MOV      R0,R10
   \   00000114   ........           BL       Hex2Num
   \   00000118   010000EA           B        ??DoEMS_8
   1042          	}
   1043          	else
   1044          	{
   1045          		c=1;
   \                     ??DoEMS_7:
   \   0000011C   0170A0E3           MOV      R7,#+1
   1046          		edl->number[0]=0;
   \   00000120   1450C4E5           STRB     R5,[R4, #+20]
   1047          	}
   1048          	p+=c+1; //num
   \                     ??DoEMS_8:
   \   00000124   0A0087E0           ADD      R0,R7,R10
   \   00000128   01A080E2           ADD      R10,R0,#+1
   1049          	ttype=*p++;
   1050          	if((edl->type!=TYPE_OUT)&&(edl->type!=TYPE_DRAFT))
   \   0000012C   080094E5           LDR      R0,[R4, #+8]
   \   00000130   ........           LDRB     R2,[R10], #+1
   \   00000134   010050E3           CMP      R0,#+1
   \   00000138   04005013           CMPNE    R0,#+4
   \   0000013C   1900000A           BEQ      ??DoEMS_9
   1051          	{
   1052          		char *pp=edl->time;
   \   00000140   340084E2           ADD      R0,R4,#+52
   1053          		int i;
   1054          		for(i=0;i<6;i++) //time
   \   00000144   0010A0E3           MOV      R1,#+0
   1055          		{
   1056          			*pp++=p[i]%0x10+'0';
   \                     ??DoEMS_10:
   \   00000148   0A30D1E7           LDRB     R3,[R1, +R10]
   1057          			*pp++=p[i]/0x10+'0';
   1058          			if(i<2)
   \   0000014C   020051E3           CMP      R1,#+2
   \   00000150   0370A0E1           MOV      R7,R3
   \   00000154   2772A0E1           LSR      R7,R7,#+4
   \   00000158   073243E0           SUB      R3,R3,R7, LSL #+4
   \   0000015C   303083E2           ADD      R3,R3,#+48
   \   00000160   ........           STRB     R3,[R0], #+1
   \   00000164   0A30D1E7           LDRB     R3,[R1, +R10]
   \   00000168   3070A0E3           MOV      R7,#+48
   \   0000016C   233287E0           ADD      R3,R7,R3, LSR #+4
   \   00000170   ........           STRB     R3,[R0], #+1
   1059          			*pp++='-';
   \   00000174   2D30A0B3           MOVLT    R3,#+45
   \   00000178   040000BA           BLT      ??DoEMS_11
   1060          			if(i==2)
   1061          				*pp++=' ';
   \   0000017C   2030A003           MOVEQ    R3,#+32
   \   00000180   0200000A           BEQ      ??DoEMS_11
   1062          			if(i>2&&i<5)
   \   00000184   050051E3           CMP      R1,#+5
   \   00000188   010000AA           BGE      ??DoEMS_12
   1063          				*pp++=':';
   \   0000018C   3A30A0E3           MOV      R3,#+58
   \                     ??DoEMS_11:
   \   00000190   ........           STRB     R3,[R0], #+1
   1064          		}
   \                     ??DoEMS_12:
   \   00000194   011081E2           ADD      R1,R1,#+1
   \   00000198   060051E3           CMP      R1,#+6
   \   0000019C   E9FFFFBA           BLT      ??DoEMS_10
   1065          		*pp=0;
   \   000001A0   0050C0E5           STRB     R5,[R0, #+0]
   1066          		p+=7; //time
   \   000001A4   07A08AE2           ADD      R10,R10,#+7
   1067          	}
   1068          	if(isplus&&((edl->type==TYPE_OUT)||(edl->type==TYPE_DRAFT))) p++; //
   \                     ??DoEMS_9:
   \   000001A8   000056E3           CMP      R6,#+0
   \   000001AC   0300000A           BEQ      ??DoEMS_13
   \   000001B0   080094E5           LDR      R0,[R4, #+8]
   \   000001B4   010050E3           CMP      R0,#+1
   \   000001B8   04005013           CMPNE    R0,#+4
   \   000001BC   01A08A02           ADDEQ    R10,R10,#+1
   1069          	c=*p++;
   \                     ??DoEMS_13:
   \   000001C0   ........           LDRB     R9,[R10], #+1
   1070          	//...text,
   1071          	if(isems)
   1072          	{
   1073          		int sk;
   1074          		cmp_size=p-data-2;
   \   000001C4   08104AE0           SUB      R1,R10,R8
   \   000001C8   021041E2           SUB      R1,R1,#+2
   \   000001CC   00108DE5           STR      R1,[SP, #+0]
   1075          		skip=*p;
   \   000001D0   0000DAE5           LDRB     R0,[R10, #+0]
   1076          		sk=p[1];
   \   000001D4   0110DAE5           LDRB     R1,[R10, #+1]
   1077          		p2=p;
   \   000001D8   0A50A0E1           MOV      R5,R10
   1078          		if(ttype==8)
   \   000001DC   080052E3           CMP      R2,#+8
   \   000001E0   0300001A           BNE      ??DoEMS_14
   1079          		{
   1080          			p+=skip+1;
   \   000001E4   0A3080E0           ADD      R3,R0,R10
   \   000001E8   01A083E2           ADD      R10,R3,#+1
   1081          			c-=skip+1;
   \   000001EC   000049E0           SUB      R0,R9,R0
   \   000001F0   019040E2           SUB      R9,R0,#+1
   1082          		}
   1083          		if(sk==8)
   \                     ??DoEMS_14:
   \   000001F4   080051E3           CMP      R1,#+8
   1084          			skip=6;
   \   000001F8   0660A003           MOVEQ    R6,#+6
   1085          		else
   1086          			skip=5;
   \   000001FC   0560A013           MOVNE    R6,#+5
   1087          	}
   1088          	edl->cnt=p2[skip-1];
   \   00000200   050086E0           ADD      R0,R6,R5
   \   00000204   027040E2           SUB      R7,R0,#+2
   \   00000208   0100D7E5           LDRB     R0,[R7, #+1]
   1089          	if(ttype==0x8)
   \   0000020C   080052E3           CMP      R2,#+8
   \   00000210   0C0084E5           STR      R0,[R4, #+12]
   \   00000214   0500001A           BNE      ??DoEMS_15
   1090          	{
   1091          		Add2WS(p, (char *)(edl->text->wsbody), c);
   \   00000218   540094E5           LDR      R0,[R4, #+84]
   \   0000021C   0920A0E1           MOV      R2,R9
   \   00000220   001090E5           LDR      R1,[R0, #+0]
   \   00000224   0A00A0E1           MOV      R0,R10
   \   00000228   ........           BL       Add2WS
   \   0000022C   1B0000EA           B        ??DoEMS_16
   1092          	}
   1093          	else if(ttype==0x0) //7bit
   \                     ??DoEMS_15:
   \   00000230   000052E3           CMP      R2,#+0
   \   00000234   1600001A           BNE      ??DoEMS_17
   1094          	{
   1095          		GSMTXT_Decode(edl->text,(void*)p,c*7/8+1, ttype, (void*(*)(int))malloc_adr(),(void(*)(void))mfree_adr());
   \   00000238   158000EF           SWI      +32789
   \   0000023C   00B0A0E1           MOV      R11,R0
   \   00000240   148000EF           SWI      +32788
   \   00000244   00082DE9           PUSH     {R11}
   \   00000248   01002DE9           PUSH     {R0}
   \   0000024C   891169E0           RSB      R1,R9,R9, LSL #+3
   \   00000250   0030A0E3           MOV      R3,#+0
   \   00000254   4101A0E1           ASR      R0,R1,#+2
   \   00000258   A00E81E0           ADD      R0,R1,R0, LSR #+29
   \   0000025C   0110A0E3           MOV      R1,#+1
   \   00000260   C02181E0           ADD      R2,R1,R0, ASR #+3
   \   00000264   540094E5           LDR      R0,[R4, #+84]
   \   00000268   0A10A0E1           MOV      R1,R10
   \   0000026C   1D0200EF           SWI      +541
   1096          		if(wslen(edl->text)>c)
   \   00000270   540094E5           LDR      R0,[R4, #+84]
   \   00000274   001090E5           LDR      R1,[R0, #+0]
   \   00000278   B010D1E1           LDRH     R1,[R1, #+0]
   \   0000027C   08D08DE2           ADD      SP,SP,#+8
   \   00000280   010059E1           CMP      R9,R1
   \   00000284   050000AA           BGE      ??DoEMS_16
   1097          		{
   1098          			CutWSTR(edl->text, c);
   \   00000288   0910A0E1           MOV      R1,R9
   \   0000028C   260100EF           SWI      +294
   \   00000290   020000EA           B        ??DoEMS_16
   1099          		}
   1100          	}
   1101          	else
   1102          	{
   1103          		wsprintf(edl->text, STR_UNK_TXTT, ttype);
   \                     ??DoEMS_17:
   \   00000294   ........           LDR      R1,??DataTable31  ;; STR_UNK_TXTT
   \   00000298   540094E5           LDR      R0,[R4, #+84]
   \   0000029C   240100EF           SWI      +292
   1104          	}
   1105          	if(isems&&(p2)&&(skip)&&(p2[skip]<p2[skip-1]))
   \                     ??DoEMS_16:
   \   000002A0   000055E3           CMP      R5,#+0
   \   000002A4   F78FBD08           POPEQ    {R0-R2,R4-R11,PC}
   \   000002A8   0500D6E7           LDRB     R0,[R6, +R5]
   \   000002AC   0110D7E5           LDRB     R1,[R7, #+1]
   \   000002B0   010050E1           CMP      R0,R1
   \   000002B4   F78FBD28           POPCS    {R0-R2,R4-R11,PC}
   1106          	{
   1107          		if(cmp_size)
   \   000002B8   00009DE5           LDR      R0,[SP, #+0]
   \   000002BC   000050E3           CMP      R0,#+0
   \   000002C0   F78FBD08           POPEQ    {R0-R2,R4-R11,PC}
   1108          		{
   1109          			ems_next=FindNextPartOfEMS(data, p2[skip-1], p2[skip], p2[skip-2], sms_dat_buf_start, sms_dat_buf_end, cmp_size, edl->type);
   \   000002C4   089094E5           LDR      R9,[R4, #+8]
   \   000002C8   0900A0E1           MOV      R0,R9
   \   000002CC   01002DE9           PUSH     {R0}
   \   000002D0   04009DE5           LDR      R0,[SP, #+4]
   \   000002D4   01002DE9           PUSH     {R0}
   \   000002D8   10009DE5           LDR      R0,[SP, #+16]
   \   000002DC   01002DE9           PUSH     {R0}
   \   000002E0   10009DE5           LDR      R0,[SP, #+16]
   \   000002E4   01002DE9           PUSH     {R0}
   \   000002E8   0030D7E5           LDRB     R3,[R7, #+0]
   \   000002EC   0520D6E7           LDRB     R2,[R6, +R5]
   \   000002F0   0110D7E5           LDRB     R1,[R7, #+1]
   \   000002F4   0800A0E1           MOV      R0,R8
   \   000002F8   ........           BL       FindNextPartOfEMS
   1110          		}
   1111          		if(ems_next) GetEMSText(ems_next, edl->text, p2[skip-1], p2[skip], edl->type, sms_dat_buf_start, sms_dat_buf_end);
   \   000002FC   000050E3           CMP      R0,#+0
   \   00000300   10D08DE2           ADD      SP,SP,#+16
   \   00000304   F78FBD08           POPEQ    {R0-R2,R4-R11,PC}
   \   00000308   08109DE5           LDR      R1,[SP, #+8]
   \   0000030C   02002DE9           PUSH     {R1}
   \   00000310   08109DE5           LDR      R1,[SP, #+8]
   \   00000314   02002DE9           PUSH     {R1}
   \   00000318   00022DE9           PUSH     {R9}
   \   0000031C   0530D6E7           LDRB     R3,[R6, +R5]
   \   00000320   0120D7E5           LDRB     R2,[R7, #+1]
   \   00000324   541094E5           LDR      R1,[R4, #+84]
   \   00000328   ........           BL       GetEMSText
   \   0000032C   0CD08DE2           ADD      SP,SP,#+12
   \   00000330   F78FBDE8           POP      {R0-R2,R4-R11,PC}  ;; return
   1112          	}
   1113          	
   1114          }

   \                                 In segment CODE, align 4, keep-with-next
   1115          void ReadAllEMS(EMS_DATA **edltop, char *sms_dat_buf, char *sms_dat_buf_end)
   1116          {
   \                     ReadAllEMS:
   \   00000000   F0402DE9           PUSH     {R4-R7,LR}
   \   00000004   0040A0E1           MOV      R4,R0
   \   00000008   0150A0E1           MOV      R5,R1
   \   0000000C   0260A0E1           MOV      R6,R2
   1117          	char *p=sms_dat_buf;
   \   00000010   0570A0E1           MOV      R7,R5
   \   00000014   060057E1           CMP      R7,R6
   \   00000018   F080BD28           POPCS    {R4-R7,PC}
   1118          	int i;
   1119          	EMS_DATA *edl;
   1120          	while(p<sms_dat_buf_end)
   1121          	{
   1122          		i=IsPartOfEMS(p);
   \                     ??ReadAllEMS_0:
   \   0000001C   0700A0E1           MOV      R0,R7
   \   00000020   ........           BL       IsPartOfEMS
   1123          		if(i==1)
   \   00000024   010050E3           CMP      R0,#+1
   \   00000028   0700001A           BNE      ??ReadAllEMS_1
   1124          		{
   1125          			AddToEDL(edltop);
   \   0000002C   0400A0E1           MOV      R0,R4
   \   00000030   ........           BL       AddToEDL
   1126          			edl=(*edltop);
   1127          			DoEMS(edl, p, sms_dat_buf, sms_dat_buf_end);
   \   00000034   000094E5           LDR      R0,[R4, #+0]
   \   00000038   0630A0E1           MOV      R3,R6
   \   0000003C   0520A0E1           MOV      R2,R5
   \   00000040   0710A0E1           MOV      R1,R7
   \   00000044   ........           BL       DoEMS
   \   00000048   060000EA           B        ??ReadAllEMS_2
   1128          		}
   1129          		else if(i==0xFF)
   \                     ??ReadAllEMS_1:
   \   0000004C   FF0050E3           CMP      R0,#+255
   \   00000050   0400001A           BNE      ??ReadAllEMS_2
   1130          		{
   1131          			AddToEDL(edltop);
   \   00000054   0400A0E1           MOV      R0,R4
   \   00000058   ........           BL       AddToEDL
   1132          			edl=(*edltop);
   1133          			DoSMS_E(edl, p);
   \   0000005C   000094E5           LDR      R0,[R4, #+0]
   \   00000060   0710A0E1           MOV      R1,R7
   \   00000064   ........           BL       DoSMS_E
   1134          		}
   1135          		p+=sizeof(PDU);
   1136          	}
   \                     ??ReadAllEMS_2:
   \   00000068   B27087E2           ADD      R7,R7,#+178
   \   0000006C   060057E1           CMP      R7,R6
   \   00000070   E9FFFF3A           BCC      ??ReadAllEMS_0
   1137          }
   \   00000074   F080BDE8           POP      {R4-R7,PC}
   1138          
   1139          /////////////////////////////////////////////
   1140          //NEW LIST

   \                                 In segment CODE, align 4, keep-with-next
   1141          SMS_DATA *AllocSD(void)
   1142          {
   \                     AllocSD:
   \   00000000   10402DE9           PUSH     {R4,LR}
   1143          	SMS_DATA *sd=malloc(sizeof(SMS_DATA));
   \   00000004   6800A0E3           MOV      R0,#+104
   \   00000008   140000EF           SWI      +20
   \   0000000C   0040A0E1           MOV      R4,R0
   1144          	zeromem(sd, sizeof(SMS_DATA));
   \   00000010   6810A0E3           MOV      R1,#+104
   \   00000014   1D0100EF           SWI      +285
   1145          	//sd->SMS_TEXT=AllocWS(MAX_TEXT);
   1146          	return sd;
   \   00000018   0400A0E1           MOV      R0,R4
   \   0000001C   1080BDE8           POP      {R4,PC}          ;; return
   1147          }
   1148          

   \                                 In segment CODE, align 4, keep-with-next
   1149          void AddToSdlByTime(SMS_DATA *sd)
   1150          {
   \                     AddToSdlByTime:
   \   00000000   70402DE9           PUSH     {R4-R6,LR}
   1151          	SMS_DATA *sdp;
   1152          	SMS_DATA *sdl=sdltop;
   \   00000004   ........           LDR      R5,??DataTable45  ;; sdltop
   \   00000008   0040B0E1           MOVS     R4,R0
   \   0000000C   006095E5           LDR      R6,[R5, #+0]
   1153          	if(!sd)
   \   00000010   7080BD08           POPEQ    {R4-R6,PC}
   1154          		return;
   1155          	if(!sdl)
   \   00000014   000056E3           CMP      R6,#+0
   \   00000018   0200001A           BNE      ??AddToSdlByTime_0
   1156          	{
   1157          		sdltop=sd;
   \   0000001C   004085E5           STR      R4,[R5, #+0]
   1158          		return;
   \   00000020   7080BDE8           POP      {R4-R6,PC}
   1159          	}
   1160          	while(sdl)
   1161          	{
   1162          		if(strcmp(sd->Time, sdl->Time)>=0)
   1163          		{
   1164          			sdp=sdl->prev;
   1165          			if(!sdp)
   1166          				sdltop=sd;
   1167          			else
   1168          				sdp->next=sd;
   1169          			sd->prev=sdp;
   1170          			sd->next=sdl;
   1171          			sdl->prev=sd;
   1172          			return;
   1173          		}
   1174          		sdl=sdl->next;
   \                     ??AddToSdlByTime_1:
   \   00000024   006096E5           LDR      R6,[R6, #+0]
   \                     ??AddToSdlByTime_0:
   \   00000028   000056E3           CMP      R6,#+0
   \   0000002C   0C00000A           BEQ      ??AddToSdlByTime_2
   \   00000030   441086E2           ADD      R1,R6,#+68
   \   00000034   440084E2           ADD      R0,R4,#+68
   \   00000038   190000EF           SWI      +25
   \   0000003C   000050E3           CMP      R0,#+0
   \   00000040   F7FFFF4A           BMI      ??AddToSdlByTime_1
   \   00000044   040096E5           LDR      R0,[R6, #+4]
   \   00000048   000050E3           CMP      R0,#+0
   \   0000004C   00408505           STREQ    R4,[R5, #+0]
   \   00000050   00408015           STRNE    R4,[R0, #+0]
   \   00000054   040084E5           STR      R0,[R4, #+4]
   \   00000058   006084E5           STR      R6,[R4, #+0]
   \   0000005C   044086E5           STR      R4,[R6, #+4]
   \   00000060   7080BDE8           POP      {R4-R6,PC}
   1175          	}
   1176          	sdl=sdltop;
   \                     ??AddToSdlByTime_2:
   \   00000064   006095E5           LDR      R6,[R5, #+0]
   \   00000068   000096E5           LDR      R0,[R6, #+0]
   \   0000006C   000050E3           CMP      R0,#+0
   \   00000070   0300000A           BEQ      ??AddToSdlByTime_3
   1177          	while(sdl->next) //add to the last;
   1178          		sdl=sdl->next;
   \                     ??AddToSdlByTime_4:
   \   00000074   006096E5           LDR      R6,[R6, #+0]
   \   00000078   000096E5           LDR      R0,[R6, #+0]
   \   0000007C   000050E3           CMP      R0,#+0
   \   00000080   FBFFFF1A           BNE      ??AddToSdlByTime_4
   1179          	sdl->next=sd;
   \                     ??AddToSdlByTime_3:
   \   00000084   004086E5           STR      R4,[R6, #+0]
   1180          	sd->prev=sdl;
   \   00000088   046084E5           STR      R6,[R4, #+4]
   1181          }
   \   0000008C   7080BDE8           POP      {R4-R6,PC}       ;; return
   1182          
   1183          

   \                                 In segment CODE, align 4, keep-with-next
   1184          SMS_DATA *FindSDByOpmsgId(int opmsg_id)
   1185          {
   1186          	SMS_DATA *sdl=sdltop;
   \                     FindSDByOpmsgId:
   \   00000000   ........           LDR      R1,??DataTable45  ;; sdltop
   1187          	while(sdl)
   1188          	{
   1189          		if(sdl->opmsg_id==opmsg_id)
   1190          		{
   1191          			return sdl;
   1192          		}
   1193          		sdl=sdl->next;
   \                     ??FindSDByOpmsgId_0:
   \   00000004   001091E5           LDR      R1,[R1, #+0]
   \   00000008   000051E3           CMP      R1,#+0
   \   0000000C   0400000A           BEQ      ??FindSDByOpmsgId_1
   \   00000010   102091E5           LDR      R2,[R1, #+16]
   \   00000014   000052E1           CMP      R2,R0
   \   00000018   F9FFFF1A           BNE      ??FindSDByOpmsgId_0
   \   0000001C   0100A0E1           MOV      R0,R1
   \   00000020   1EFF2FE1           BX       LR
   1194          	}
   1195          	return 0;
   \                     ??FindSDByOpmsgId_1:
   \   00000024   0000A0E3           MOV      R0,#+0
   \   00000028   1EFF2FE1           BX       LR               ;; return
   1196          }
   1197          /*
   1198          int SaveAllAsFile(void)
   1199          {
   1200          	int res=0;
   1201          	SMS_DATA *sdl=sdltop;
   1202          	while(sdl)
   1203          	{
   1204          		if((!(sdl->isfile))&&((sdl->id)>0))
   1205          		{
   1206          			if(saveFile(sdl->SMS_TEXT, sdl->Number, sdl, sdl->type, 0))
   1207          			{
   1208          				res++;
   1209          				deleteDat(sdl, 0);
   1210          			}
   1211          		}
   1212          		sdl=sdl->next;
   1213          	}
   1214          	readAllSMS();
   1215          	return res;
   1216          }
   1217          */

   \                                 In segment CODE, align 4, keep-with-next
   1218          SMS_DATA *FindNextByType(SMS_DATA *sdl, int type)
   1219          {
   \                     FindNextByType:
   \   00000000   00402DE9           PUSH     {LR}
   1220            if(!sdl) return 0;
   \   00000004   000050E3           CMP      R0,#+0
   \   00000008   0080BD08           POPEQ    {PC}
   1221            if((type==TYPE_OUT)||(type==TYPE_DRAFT))
   \   0000000C   002090E5           LDR      R2,[R0, #+0]
   \   00000010   010051E3           CMP      R1,#+1
   \   00000014   04005113           CMPNE    R1,#+4
   \   00000018   0800001A           BNE      ??FindNextByType_0
   1222            {
   1223              sdl=sdl->next;
   \   0000001C   0200A0E1           MOV      R0,R2
   \   00000020   000000EA           B        ??FindNextByType_1
   1224              while(sdl)
   1225              {
   1226                if(sdl->type==type)
   1227          	return sdl;
   1228                sdl=sdl->next;
   \                     ??FindNextByType_2:
   \   00000024   000090E5           LDR      R0,[R0, #+0]
   \                     ??FindNextByType_1:
   \   00000028   000050E3           CMP      R0,#+0
   \   0000002C   0080BD08           POPEQ    {PC}
   \   00000030   082090E5           LDR      R2,[R0, #+8]
   \   00000034   010052E1           CMP      R2,R1
   \   00000038   F9FFFF1A           BNE      ??FindNextByType_2
   \   0000003C   0080BDE8           POP      {PC}
   1229              }
   1230            }
   1231            else if((type==TYPE_IN_ALL)||(type==TYPE_IN_N)||(type==TYPE_IN_R))
   \                     ??FindNextByType_0:
   \   00000040   050051E3           CMP      R1,#+5
   \   00000044   03005113           CMPNE    R1,#+3
   \   00000048   02005113           CMPNE    R1,#+2
   \   0000004C   0900001A           BNE      ??FindNextByType_3
   1232            {
   1233              sdl=sdl->next;
   \   00000050   0200A0E1           MOV      R0,R2
   1234              while(sdl)
   \                     ??FindNextByType_4:
   \   00000054   000050E3           CMP      R0,#+0
   \   00000058   0080BD08           POPEQ    {PC}
   1235              {
   1236                if((sdl->type==TYPE_IN_R)||(sdl->type==TYPE_IN_N)||(sdl->type==TYPE_IN_ALL))
   \   0000005C   081090E5           LDR      R1,[R0, #+8]
   \   00000060   020051E3           CMP      R1,#+2
   \   00000064   03005113           CMPNE    R1,#+3
   \   00000068   05005113           CMPNE    R1,#+5
   \   0000006C   0080BD08           POPEQ    {PC}
   1237          	return sdl;
   1238                sdl=sdl->next;
   \   00000070   000090E5           LDR      R0,[R0, #+0]
   \   00000074   F6FFFFEA           B        ??FindNextByType_4
   1239              }
   1240            }
   1241            else if(type==TYPE_FILTER)
   \                     ??FindNextByType_3:
   \   00000078   0F0051E3           CMP      R1,#+15
   \   0000007C   0100001A           BNE      ??FindNextByType_5
   1242            {
   1243              return FindNextFilterSDL(sdl);
   \   00000080   ........           _BLF     FindNextFilterSDL,??FindNextFilterSDL??rA
   \   00000084   0080BDE8           POP      {PC}
   1244            }
   1245            else
   1246            {
   1247              sdl=sdl->next;
   1248              return sdl;
   \                     ??FindNextByType_5:
   \   00000088   0200A0E1           MOV      R0,R2
   \   0000008C   0080BDE8           POP      {PC}             ;; return
   1249            }
   1250            return 0;
   1251          }
   1252          

   \                                 In segment CODE, align 4, keep-with-next
   1253          SMS_DATA *FindPrevByType(SMS_DATA *sdl, int type)
   1254          {
   \                     FindPrevByType:
   \   00000000   00402DE9           PUSH     {LR}
   1255            if(!sdl) return 0;
   \   00000004   000050E3           CMP      R0,#+0
   \   00000008   0080BD08           POPEQ    {PC}
   1256            if((type==TYPE_OUT)||(type==TYPE_DRAFT))
   \   0000000C   042090E5           LDR      R2,[R0, #+4]
   \   00000010   010051E3           CMP      R1,#+1
   \   00000014   04005113           CMPNE    R1,#+4
   \   00000018   0800001A           BNE      ??FindPrevByType_0
   1257            {
   1258              sdl=sdl->prev;
   \   0000001C   0200A0E1           MOV      R0,R2
   \   00000020   000000EA           B        ??FindPrevByType_1
   1259              while(sdl)
   1260              {
   1261                if(sdl->type==type)
   1262          	return sdl;
   1263                sdl=sdl->prev;
   \                     ??FindPrevByType_2:
   \   00000024   040090E5           LDR      R0,[R0, #+4]
   \                     ??FindPrevByType_1:
   \   00000028   000050E3           CMP      R0,#+0
   \   0000002C   0080BD08           POPEQ    {PC}
   \   00000030   082090E5           LDR      R2,[R0, #+8]
   \   00000034   010052E1           CMP      R2,R1
   \   00000038   F9FFFF1A           BNE      ??FindPrevByType_2
   \   0000003C   0080BDE8           POP      {PC}
   1264              }
   1265            }
   1266            else if((type==TYPE_IN_ALL)||(type==TYPE_IN_N)||(type==TYPE_IN_R))
   \                     ??FindPrevByType_0:
   \   00000040   050051E3           CMP      R1,#+5
   \   00000044   03005113           CMPNE    R1,#+3
   \   00000048   02005113           CMPNE    R1,#+2
   \   0000004C   0900001A           BNE      ??FindPrevByType_3
   1267            {
   1268              sdl=sdl->prev;
   \   00000050   0200A0E1           MOV      R0,R2
   1269              while(sdl)
   \                     ??FindPrevByType_4:
   \   00000054   000050E3           CMP      R0,#+0
   \   00000058   0080BD08           POPEQ    {PC}
   1270              {
   1271                if((sdl->type==TYPE_IN_R)||(sdl->type==TYPE_IN_N)||(sdl->type==TYPE_IN_ALL))
   \   0000005C   081090E5           LDR      R1,[R0, #+8]
   \   00000060   020051E3           CMP      R1,#+2
   \   00000064   03005113           CMPNE    R1,#+3
   \   00000068   05005113           CMPNE    R1,#+5
   \   0000006C   0080BD08           POPEQ    {PC}
   1272          	return sdl;
   1273                sdl=sdl->prev;
   \   00000070   040090E5           LDR      R0,[R0, #+4]
   \   00000074   F6FFFFEA           B        ??FindPrevByType_4
   1274              }
   1275            }
   1276            else if(type==TYPE_FILTER)
   \                     ??FindPrevByType_3:
   \   00000078   0F0051E3           CMP      R1,#+15
   \   0000007C   0100001A           BNE      ??FindPrevByType_5
   1277            {
   1278              return (FindPrevFilterSDL(sdl));
   \   00000080   ........           _BLF     FindPrevFilterSDL,??FindPrevFilterSDL??rA
   \   00000084   0080BDE8           POP      {PC}
   1279            }
   1280            else
   1281            {
   1282              sdl=sdl->prev;
   1283              return sdl;
   \                     ??FindPrevByType_5:
   \   00000088   0200A0E1           MOV      R0,R2
   \   0000008C   0080BDE8           POP      {PC}             ;; return
   1284            }
   1285            return 0;
   1286          }
   1287          

   \                                 In segment CODE, align 4, keep-with-next
   1288          int ReadMSS(char *fname, SMS_DATA *sd)
   1289          {
   \                     ReadMSS:
   \   00000000   F0412DE9           PUSH     {R4-R8,LR}
   \   00000004   A8D04DE2           SUB      SP,SP,#+168
   \   00000008   0040A0E1           MOV      R4,R0
   \   0000000C   0150A0E1           MOV      R5,R1
   1290            unsigned int err;
   1291            int fin;
   1292            int size, js, len=0;
   \   00000010   0010A0E3           MOV      R1,#+0
   \   00000014   04108DE5           STR      R1,[SP, #+4]
   1293            MSS_FILE_P1 msf1;
   1294            MSS_FILE_P2 msf2;
   1295            int version;
   1296            //WSHDR *ws, wsn;
   1297            //unsigned short wsb[MAX_TEXT];
   1298            if((fin=fopen(fname, A_BIN+A_ReadOnly, P_READ, &err))<0)
   \   00000018   0D30A0E1           MOV      R3,SP
   \   0000001C   8020A0E3           MOV      R2,#+128
   \   00000020   801CA0E3           MOV      R1,#+32768
   \   00000024   0A0000EF           SWI      +10
   \   00000028   0060B0E1           MOVS     R6,R0
   \   0000002C   8100004A           BMI      ??ReadMSS_0
   1299              return 0;
   1300          //  GetCPUClock();
   1301            size=lseek(fin, 0, S_END, &err, &err);
   \   00000030   0D00A0E1           MOV      R0,SP
   \   00000034   01002DE9           PUSH     {R0}
   \   00000038   04308DE2           ADD      R3,SP,#+4
   \   0000003C   0220A0E3           MOV      R2,#+2
   \   00000040   0010A0E3           MOV      R1,#+0
   \   00000044   0600A0E1           MOV      R0,R6
   \   00000048   0F0000EF           SWI      +15
   \   0000004C   0070A0E1           MOV      R7,R0
   1302            lseek(fin, 8, S_SET, &err, &err);
   \   00000050   04008DE2           ADD      R0,SP,#+4
   \   00000054   01002DE9           PUSH     {R0}
   \   00000058   08308DE2           ADD      R3,SP,#+8
   \   0000005C   0020A0E3           MOV      R2,#+0
   \   00000060   0810A0E3           MOV      R1,#+8
   \   00000064   0600A0E1           MOV      R0,R6
   \   00000068   0F0000EF           SWI      +15
   1303            if(fread(fin, &version, sizeof(int), &err)!=sizeof(int))
   \   0000006C   08308DE2           ADD      R3,SP,#+8
   \   00000070   0420A0E3           MOV      R2,#+4
   \   00000074   10108DE2           ADD      R1,SP,#+16
   \   00000078   0600A0E1           MOV      R0,R6
   \   0000007C   0B0000EF           SWI      +11
   \   00000080   040050E3           CMP      R0,#+4
   \   00000084   08D08DE2           ADD      SP,SP,#+8
   \   00000088   6700001A           BNE      ??ReadMSS_1
   1304              goto EX_BACK0;
   1305            if(version==1)
   \   0000008C   08009DE5           LDR      R0,[SP, #+8]
   \   00000090   ........           LDR      R8,??DataTable34  ;; ELFNAME
   \   00000094   010050E3           CMP      R0,#+1
   \   00000098   1D00001A           BNE      ??ReadMSS_2
   1306            {
   1307              js=sizeof(MSS_FILE_P1);
   1308              if(size<js)
   \   0000009C   4C0057E3           CMP      R7,#+76
   \   000000A0   610000BA           BLT      ??ReadMSS_1
   1309                goto EX_BACK0;
   1310              lseek(fin, 0, S_SET, &err, &err);
   \   000000A4   0D00A0E1           MOV      R0,SP
   \   000000A8   01002DE9           PUSH     {R0}
   \   000000AC   04308DE2           ADD      R3,SP,#+4
   \   000000B0   0020A0E3           MOV      R2,#+0
   \   000000B4   0010A0E3           MOV      R1,#+0
   \   000000B8   0600A0E1           MOV      R0,R6
   \   000000BC   0F0000EF           SWI      +15
   1311              if(fread(fin, &msf1, js, &err)!=js)
   \   000000C0   04308DE2           ADD      R3,SP,#+4
   \   000000C4   4C20A0E3           MOV      R2,#+76
   \   000000C8   60108DE2           ADD      R1,SP,#+96
   \   000000CC   0600A0E1           MOV      R0,R6
   \   000000D0   0B0000EF           SWI      +11
   \   000000D4   4C0050E3           CMP      R0,#+76
   \   000000D8   04D08DE2           ADD      SP,SP,#+4
   \   000000DC   5200001A           BNE      ??ReadMSS_1
   1312                goto EX_BACK0;
   1313              if(strncmp(msf1.header, ELFNAME, 7))
   \   000000E0   0720A0E3           MOV      R2,#+7
   \   000000E4   0810A0E1           MOV      R1,R8
   \   000000E8   5C008DE2           ADD      R0,SP,#+92
   \   000000EC   150100EF           SWI      +277
   \   000000F0   000050E3           CMP      R0,#+0
   \   000000F4   4C00001A           BNE      ??ReadMSS_1
   1314                goto EX_BACK0; 
   1315              strcpy(sd->Time, msf1.time);
   \   000000F8   68108DE2           ADD      R1,SP,#+104
   \   000000FC   440085E2           ADD      R0,R5,#+68
   \   00000100   1A0000EF           SWI      +26
   1316              strcpy(sd->Number, msf1.number);
   \   00000104   88108DE2           ADD      R1,SP,#+136
   \   00000108   240085E2           ADD      R0,R5,#+36
   \   0000010C   1A0000EF           SWI      +26
   \   00000110   200000EA           B        ??ReadMSS_3
   1317            }
   1318            else if(version==2)
   \                     ??ReadMSS_2:
   \   00000114   020050E3           CMP      R0,#+2
   \   00000118   4300001A           BNE      ??ReadMSS_1
   1319            {
   1320              js=sizeof(MSS_FILE_P2);
   1321              if(size<js)
   \   0000011C   500057E3           CMP      R7,#+80
   \   00000120   410000BA           BLT      ??ReadMSS_1
   1322                goto EX_BACK0;
   1323              lseek(fin, 0, S_SET, &err, &err);
   \   00000124   0D00A0E1           MOV      R0,SP
   \   00000128   01002DE9           PUSH     {R0}
   \   0000012C   04308DE2           ADD      R3,SP,#+4
   \   00000130   0020A0E3           MOV      R2,#+0
   \   00000134   0010A0E3           MOV      R1,#+0
   \   00000138   0600A0E1           MOV      R0,R6
   \   0000013C   0F0000EF           SWI      +15
   1324              if(fread(fin, &msf2, js, &err)!=js)
   \   00000140   04308DE2           ADD      R3,SP,#+4
   \   00000144   5020A0E3           MOV      R2,#+80
   \   00000148   10108DE2           ADD      R1,SP,#+16
   \   0000014C   0600A0E1           MOV      R0,R6
   \   00000150   0B0000EF           SWI      +11
   \   00000154   500050E3           CMP      R0,#+80
   \   00000158   04D08DE2           ADD      SP,SP,#+4
   \   0000015C   3200001A           BNE      ??ReadMSS_1
   1325                goto EX_BACK0;
   1326              if(strncmp(msf2.header, ELFNAME, 7))
   \   00000160   0720A0E3           MOV      R2,#+7
   \   00000164   0810A0E1           MOV      R1,R8
   \   00000168   0C008DE2           ADD      R0,SP,#+12
   \   0000016C   150100EF           SWI      +277
   \   00000170   000050E3           CMP      R0,#+0
   \   00000174   2C00001A           BNE      ??ReadMSS_1
   1327                goto EX_BACK0; 
   1328              strcpy(sd->Time, msf2.time);
   \   00000178   1C108DE2           ADD      R1,SP,#+28
   \   0000017C   440085E2           ADD      R0,R5,#+68
   \   00000180   1A0000EF           SWI      +26
   1329              strcpy(sd->Number, msf2.number);
   \   00000184   3C108DE2           ADD      R1,SP,#+60
   \   00000188   240085E2           ADD      R0,R5,#+36
   \   0000018C   1A0000EF           SWI      +26
   1330              sd->type=msf2.type;
   \   00000190   18009DE5           LDR      R0,[SP, #+24]
   \   00000194   080085E5           STR      R0,[R5, #+8]
   1331            }
   1332            else goto EX_BACK0;
   1333            //ws=CreateLocalWS(&wsn, wsb, MAX_TEXT);
   1334            if(fread(fin, &len, 2, &err)!=2)
   \                     ??ReadMSS_3:
   \   00000198   0D30A0E1           MOV      R3,SP
   \   0000019C   0220A0E3           MOV      R2,#+2
   \   000001A0   04108DE2           ADD      R1,SP,#+4
   \   000001A4   0600A0E1           MOV      R0,R6
   \   000001A8   0B0000EF           SWI      +11
   \   000001AC   020050E3           CMP      R0,#+2
   \   000001B0   1D00001A           BNE      ??ReadMSS_1
   1335              goto EX_BACK0;
   1336            sd->SMS_TEXT=AllocWS(len);
   \   000001B4   04009DE5           LDR      R0,[SP, #+4]
   \   000001B8   250100EF           SWI      +293
   \   000001BC   640085E5           STR      R0,[R5, #+100]
   1337            if(fread(fin, sd->SMS_TEXT->wsbody+1, len*2, &err)!=len*2)
   \   000001C0   04009DE5           LDR      R0,[SP, #+4]
   \   000001C4   0D30A0E1           MOV      R3,SP
   \   000001C8   8020A0E1           LSL      R2,R0,#+1
   \   000001CC   640095E5           LDR      R0,[R5, #+100]
   \   000001D0   000090E5           LDR      R0,[R0, #+0]
   \   000001D4   021080E2           ADD      R1,R0,#+2
   \   000001D8   0600A0E1           MOV      R0,R6
   \   000001DC   0B0000EF           SWI      +11
   \   000001E0   04109DE5           LDR      R1,[SP, #+4]
   \   000001E4   810050E1           CMP      R0,R1, LSL #+1
   \   000001E8   0F00001A           BNE      ??ReadMSS_1
   1338              goto EX_BACK0;
   1339            sd->SMS_TEXT->wsbody[0]=len;
   \   000001EC   640095E5           LDR      R0,[R5, #+100]
   \   000001F0   000090E5           LDR      R0,[R0, #+0]
   \   000001F4   B010C0E1           STRH     R1,[R0, #+0]
   1340            //if(fread(fin, ws->wsbody, size-js, &err)!=(size-js))
   1341            //  goto EX_BACK0;
   1342            fclose(fin, &err);
   \   000001F8   0D10A0E1           MOV      R1,SP
   \   000001FC   0600A0E1           MOV      R0,R6
   \   00000200   0D0000EF           SWI      +13
   1343          //  if(!(len=wstrlen(ws)))
   1344          //    len=1;
   1345          //  sd->SMS_TEXT=AllocWS(len);
   1346          //  wstrcpy(sd->SMS_TEXT, ws);
   1347            sd->isfile=1;
   \   00000204   0100A0E3           MOV      R0,#+1
   \   00000208   140085E5           STR      R0,[R5, #+20]
   1348            sd->fname=malloc(128);
   \   0000020C   8000A0E3           MOV      R0,#+128
   \   00000210   140000EF           SWI      +20
   \   00000214   200085E5           STR      R0,[R5, #+32]
   1349            strcpy(sd->fname, fname);
   \   00000218   0410A0E1           MOV      R1,R4
   \   0000021C   1A0000EF           SWI      +26
   1350            return 1;
   \   00000220   0100A0E3           MOV      R0,#+1
   \   00000224   A8D08DE2           ADD      SP,SP,#+168
   \   00000228   F081BDE8           POP      {R4-R8,PC}
   1351          EX_BACK0:
   1352            fclose(fin, &err);
   \                     ??ReadMSS_1:
   \   0000022C   0D10A0E1           MOV      R1,SP
   \   00000230   0600A0E1           MOV      R0,R6
   \   00000234   0D0000EF           SWI      +13
   1353            return 0;
   \                     ??ReadMSS_0:
   \   00000238   0000A0E3           MOV      R0,#+0
   \   0000023C   A8D08DE2           ADD      SP,SP,#+168
   \   00000240   F081BDE8           POP      {R4-R8,PC}       ;; return
   1354          }
   1355          

   \                                 In segment CODE, align 4, keep-with-next
   1356          void FreeSdOne(SMS_DATA *sd)
   1357          {
   \                     FreeSdOne:
   \   00000000   10402DE9           PUSH     {R4,LR}
   \   00000004   0040A0E1           MOV      R4,R0
   1358          	if(sd->SMS_TEXT)
   \   00000008   640094E5           LDR      R0,[R4, #+100]
   \   0000000C   000050E3           CMP      R0,#+0
   \   00000010   0000000A           BEQ      ??FreeSdOne_0
   1359          		FreeWS(sd->SMS_TEXT);
   \   00000014   290100EF           SWI      +297
   1360          	if(sd->fname)
   \                     ??FreeSdOne_0:
   \   00000018   200094E5           LDR      R0,[R4, #+32]
   \   0000001C   000050E3           CMP      R0,#+0
   \   00000020   0000000A           BEQ      ??FreeSdOne_1
   1361          		mfree(sd->fname);
   \   00000024   150000EF           SWI      +21
   1362          	mfree(sd);
   \                     ??FreeSdOne_1:
   \   00000028   0400A0E1           MOV      R0,R4
   \   0000002C   150000EF           SWI      +21
   1363          }
   \   00000030   1080BDE8           POP      {R4,PC}          ;; return
   1364          

   \                                 In segment CODE, align 4, keep-with-next
   1365          SMS_DATA *SdCopyOne(SMS_DATA *sdx)
   1366          {
   \                     SdCopyOne:
   \   00000000   30402DE9           PUSH     {R4,R5,LR}
   \   00000004   0040B0E1           MOVS     R4,R0
   1367          	SMS_DATA *sd;
   1368          	if(!sdx)
   1369          		return 0;
   \   00000008   0000A003           MOVEQ    R0,#+0
   \   0000000C   3080BD08           POPEQ    {R4,R5,PC}
   1370          	sd=malloc(sizeof(SMS_DATA));
   \   00000010   6800A0E3           MOV      R0,#+104
   \   00000014   140000EF           SWI      +20
   \   00000018   0050A0E1           MOV      R5,R0
   1371          	memcpy(sd, sdx, sizeof(SMS_DATA));
   \   0000001C   6820A0E3           MOV      R2,#+104
   \   00000020   0410A0E1           MOV      R1,R4
   \   00000024   1E0100EF           SWI      +286
   1372          	if(sdx->fname)
   \   00000028   200094E5           LDR      R0,[R4, #+32]
   \   0000002C   000050E3           CMP      R0,#+0
   \   00000030   0400000A           BEQ      ??SdCopyOne_0
   1373          	{
   1374          		sd->fname=malloc(128);
   \   00000034   8000A0E3           MOV      R0,#+128
   \   00000038   140000EF           SWI      +20
   \   0000003C   200085E5           STR      R0,[R5, #+32]
   1375          		strcpy(sd->fname, sdx->fname);
   \   00000040   201094E5           LDR      R1,[R4, #+32]
   \   00000044   1A0000EF           SWI      +26
   1376          	}
   1377          	if(sdx->SMS_TEXT)
   \                     ??SdCopyOne_0:
   \   00000048   640094E5           LDR      R0,[R4, #+100]
   \   0000004C   000050E3           CMP      R0,#+0
   \   00000050   0800000A           BEQ      ??SdCopyOne_1
   1378          	{
   1379          		int len=wstrlen(sdx->SMS_TEXT);
   \   00000054   230100EF           SWI      +291
   1380          		if(!len) len=1;
   \   00000058   000050E3           CMP      R0,#+0
   \   0000005C   0100A003           MOVEQ    R0,#+1
   1381          		sd->SMS_TEXT=AllocWS(len);
   \   00000060   250100EF           SWI      +293
   \   00000064   640085E5           STR      R0,[R5, #+100]
   1382          		wstrcpy(sd->SMS_TEXT, sdx->SMS_TEXT);
   \   00000068   641094E5           LDR      R1,[R4, #+100]
   \   0000006C   1F0100EF           SWI      +287
   \   00000070   0500A0E1           MOV      R0,R5
   \   00000074   3080BDE8           POP      {R4,R5,PC}
   1383          	}
   1384          	else
   1385          	  sd->SMS_TEXT=AllocWS(1);
   \                     ??SdCopyOne_1:
   \   00000078   0100A0E3           MOV      R0,#+1
   \   0000007C   250100EF           SWI      +293
   \   00000080   640085E5           STR      R0,[R5, #+100]
   1386          	return sd;
   \   00000084   0500A0E1           MOV      R0,R5
   \   00000088   3080BDE8           POP      {R4,R5,PC}       ;; return
   1387          }
   1388          
   1389          

   \                                 In segment CODE, align 4, keep-with-next
   1390          SMS_DATA *FindSdByTxtTimeNum(WSHDR *ws, char *time, char *num)
   1391          {
   \                     FindSdByTxtTimeNum:
   \   00000000   F0402DE9           PUSH     {R4-R7,LR}
   \   00000004   0040A0E1           MOV      R4,R0
   1392          	SMS_DATA *sdl=sdltop;
   \   00000008   ........           LDR      R0,??DataTable45  ;; sdltop
   \   0000000C   0150A0E1           MOV      R5,R1
   \   00000010   007090E5           LDR      R7,[R0, #+0]
   \   00000014   0260A0E1           MOV      R6,R2
   \   00000018   080000EA           B        ??FindSdByTxtTimeNum_0
   1393          	while(sdl)
   1394          	{
   1395          		if(!wstrncmp_nocase(sdl->SMS_TEXT, ws, ws->wsbody[0])
   1396          				&& !strncmp(sdl->Number, num, strlen(num)))
   1397          		{
   1398          			if(!time || !strlen(time))
   1399          				return sdl;
   1400          			if(!strncmp(sdl->Time, time, strlen(time)))
   \                     ??FindSdByTxtTimeNum_1:
   \   0000001C   0500A0E1           MOV      R0,R5
   \   00000020   1B0000EF           SWI      +27
   \   00000024   0020A0E1           MOV      R2,R0
   \   00000028   0510A0E1           MOV      R1,R5
   \   0000002C   440087E2           ADD      R0,R7,#+68
   \   00000030   150100EF           SWI      +277
   \   00000034   000050E3           CMP      R0,#+0
   \   00000038   1700000A           BEQ      ??FindSdByTxtTimeNum_2
   1401          				return sdl;
   1402          		}
   1403          		sdl=sdl->next;
   \                     ??FindSdByTxtTimeNum_3:
   \   0000003C   007097E5           LDR      R7,[R7, #+0]
   \                     ??FindSdByTxtTimeNum_0:
   \   00000040   000057E3           CMP      R7,#+0
   \   00000044   1600000A           BEQ      ??FindSdByTxtTimeNum_4
   \   00000048   000094E5           LDR      R0,[R4, #+0]
   \   0000004C   0410A0E1           MOV      R1,R4
   \   00000050   B020D0E1           LDRH     R2,[R0, #+0]
   \   00000054   640097E5           LDR      R0,[R7, #+100]
   \   00000058   ........           _BLF     wstrncmp_nocase,??wstrncmp_nocase??rA
   \   0000005C   000050E3           CMP      R0,#+0
   \   00000060   F5FFFF1A           BNE      ??FindSdByTxtTimeNum_3
   \   00000064   0600A0E1           MOV      R0,R6
   \   00000068   1B0000EF           SWI      +27
   \   0000006C   0020A0E1           MOV      R2,R0
   \   00000070   0610A0E1           MOV      R1,R6
   \   00000074   240087E2           ADD      R0,R7,#+36
   \   00000078   150100EF           SWI      +277
   \   0000007C   000050E3           CMP      R0,#+0
   \   00000080   EDFFFF1A           BNE      ??FindSdByTxtTimeNum_3
   \   00000084   000055E3           CMP      R5,#+0
   \   00000088   0300000A           BEQ      ??FindSdByTxtTimeNum_2
   \   0000008C   0500A0E1           MOV      R0,R5
   \   00000090   1B0000EF           SWI      +27
   \   00000094   000050E3           CMP      R0,#+0
   \   00000098   DFFFFF1A           BNE      ??FindSdByTxtTimeNum_1
   \                     ??FindSdByTxtTimeNum_2:
   \   0000009C   0700A0E1           MOV      R0,R7
   \   000000A0   F080BDE8           POP      {R4-R7,PC}
   1404          	}
   1405          	return 0;
   \                     ??FindSdByTxtTimeNum_4:
   \   000000A4   0000A0E3           MOV      R0,#+0
   \   000000A8   F080BDE8           POP      {R4-R7,PC}       ;; return
   1406          }
   1407          

   \                                 In segment CODE, align 4, keep-with-next
   1408          int IsSdInList(SMS_DATA *sd)
   1409          {
   1410          	SMS_DATA *sdl=sdltop;
   \                     IsSdInList:
   \   00000000   ........           LDR      R1,??DataTable45  ;; sdltop
   1411          	while(sdl)
   1412          	{
   1413          		if(sdl==sd)
   1414          			return 1;
   1415          		sdl=sdl->next;
   \                     ??IsSdInList_0:
   \   00000004   001091E5           LDR      R1,[R1, #+0]
   \   00000008   000051E3           CMP      R1,#+0
   \   0000000C   0300000A           BEQ      ??IsSdInList_1
   \   00000010   000051E1           CMP      R1,R0
   \   00000014   FAFFFF1A           BNE      ??IsSdInList_0
   \   00000018   0100A0E3           MOV      R0,#+1
   \   0000001C   1EFF2FE1           BX       LR
   1416          	}
   1417          	return 0;
   \                     ??IsSdInList_1:
   \   00000020   0000A0E3           MOV      R0,#+0
   \   00000024   1EFF2FE1           BX       LR               ;; return
   1418          }
   1419          
   1420          //-----------------------------------------------
   1421          //file works

   \                                 In segment CODE, align 4, keep-with-next
   1422          int IsFileExist(const char *filename)
   1423          {
   \                     IsFileExist:
   \   00000000   00402DE9           PUSH     {LR}
   \   00000004   2CD04DE2           SUB      SP,SP,#+44
   1424            FSTATS fst;
   1425            unsigned int err;
   1426            if(GetFileStats(filename, &fst, &err)!=-1)
   \   00000008   0D20A0E1           MOV      R2,SP
   \   0000000C   04108DE2           ADD      R1,SP,#+4
   \   00000010   840000EF           SWI      +132
   \   00000014   010070E3           CMN      R0,#+1
   1427              return 1;
   \   00000018   0100A013           MOVNE    R0,#+1
   1428            else
   1429              return 0;
   \   0000001C   0000A003           MOVEQ    R0,#+0
   \   00000020   2CD08DE2           ADD      SP,SP,#+44
   \   00000024   0080BDE8           POP      {PC}             ;; return
   1430          }
   1431          

   \                                 In segment CODE, align 4, keep-with-next
   1432          void StrClearChr(char *str, int chr)
   1433          {
   1434            char *p=str;
   \                     StrClearChr:
   \   00000000   0020D0E5           LDRB     R2,[R0, #+0]
   \   00000004   000052E3           CMP      R2,#+0
   \   00000008   1EFF2F01           BXEQ     LR
   1435            char *t;
   1436            while(*p)
   1437            {
   1438              if(*p==chr)
   \                     ??StrClearChr_0:
   \   0000000C   0020D0E5           LDRB     R2,[R0, #+0]
   \   00000010   010052E1           CMP      R2,R1
   \   00000014   0800001A           BNE      ??StrClearChr_1
   1439              {
   1440                t=p;
   \   00000018   0020A0E1           MOV      R2,R0
   \   0000001C   0030D2E5           LDRB     R3,[R2, #+0]
   \   00000020   000053E3           CMP      R3,#+0
   \   00000024   0400000A           BEQ      ??StrClearChr_1
   1441                while(*t)
   1442                {
   1443          	*t=*(t+1);
   \                     ??StrClearChr_2:
   \   00000028   0130D2E5           LDRB     R3,[R2, #+1]
   \   0000002C   0030C2E5           STRB     R3,[R2, #+0]
   1444          	t++;
   1445                }
   \   00000030   0130F2E5           LDRB     R3,[R2, #+1]!
   \   00000034   000053E3           CMP      R3,#+0
   \   00000038   FAFFFF1A           BNE      ??StrClearChr_2
   1446              }
   1447              p++;
   1448            }
   \                     ??StrClearChr_1:
   \   0000003C   0120F0E5           LDRB     R2,[R0, #+1]!
   \   00000040   000052E3           CMP      R2,#+0
   \   00000044   F0FFFF1A           BNE      ??StrClearChr_0
   1449          }
   \   00000048   1EFF2FE1           BX       LR               ;; return
   1450          
   1451          #define FTYPE_TXT 0
   1452          #define FTYPE_MSS 1
   1453          

   \                                 In segment CODE, align 4, keep-with-next
   1454          int GetFilePathBySd(SMS_DATA *sd, char *folder, char *filepath, int ftype)
   1455          {
   \                     GetFilePathBySd:
   \   00000000   F0472DE9           PUSH     {R4-R10,LR}
   \   00000004   5ADF4DE2           SUB      SP,SP,#+360
   \   00000008   0090A0E1           MOV      R9,R0
   \   0000000C   0140A0E1           MOV      R4,R1
   \   00000010   0250A0E1           MOV      R5,R2
   \   00000014   0360A0E1           MOV      R6,R3
   1456            int hasname;
   1457            WSHDR *wname, nm;
   1458            unsigned short nmb[64];
   1459            char sname[65];
   1460            char temp[128];
   1461            TTime time;
   1462            TDate date;
   1463            int i=0;
   \   00000018   0070A0E3           MOV      R7,#+0
   1464            GetDateTime(&date, &time);
   \   0000001C   0D10A0E1           MOV      R1,SP
   \   00000020   08008DE2           ADD      R0,SP,#+8
   \   00000024   B40000EF           SWI      +180
   1465            wname=CreateLocalWS(&nm, nmb, 64);
   \   00000028   4020A0E3           MOV      R2,#+64
   \   0000002C   10108DE2           ADD      R1,SP,#+16
   \   00000030   550F8DE2           ADD      R0,SP,#+340
   \   00000034   270100EF           SWI      +295
   \   00000038   0080A0E1           MOV      R8,R0
   1466            if(strlen(sd->Number))
   \   0000003C   240089E2           ADD      R0,R9,#+36
   \   00000040   1B0000EF           SWI      +27
   \   00000044   000050E3           CMP      R0,#+0
   \   00000048   0A00000A           BEQ      ??GetFilePathBySd_0
   1467            {
   1468              if(!findNameByNum(wname, sd->Number))
   \   0000004C   241089E2           ADD      R1,R9,#+36
   \   00000050   0800A0E1           MOV      R0,R8
   \   00000054   ........           _BLF     findNameByNum,??findNameByNum??rA
   \   00000058   000050E3           CMP      R0,#+0
   1469              {
   1470                hasname=0;
   \   0000005C   00A0A003           MOVEQ    R10,#+0
   \   00000060   0800000A           BEQ      ??GetFilePathBySd_1
   1471              }
   1472              else
   1473              {
   1474                hasname=1;
   1475                ws_2str(wname, sname, 64);
   \   00000064   4020A0E3           MOV      R2,#+64
   \   00000068   441F8DE2           ADD      R1,SP,#+272
   \   0000006C   0800A0E1           MOV      R0,R8
   \   00000070   A30000EF           SWI      +163
   \   00000074   020000EA           B        ??GetFilePathBySd_2
   1476              }
   1477            }
   1478            else
   1479            {
   1480              hasname=1;
   1481              strcpy(sname, "Unk");
   \                     ??GetFilePathBySd_0:
   \   00000078   711F8FE2           ADR      R1,??GetFilePathBySd_3  ;; "Unk"
   \   0000007C   440F8DE2           ADD      R0,SP,#+272
   \   00000080   1A0000EF           SWI      +26
   \                     ??GetFilePathBySd_2:
   \   00000084   01A0A0E3           MOV      R10,#+1
   1482            }
   1483            if(strlen(sd->Time))
   \                     ??GetFilePathBySd_1:
   \   00000088   ........           LDR      R8,??DataTable37  ;; `?<Constant "%04d%02d%02d%02d%02d%02d">`
   \   0000008C   440089E2           ADD      R0,R9,#+68
   \   00000090   1B0000EF           SWI      +27
   \   00000094   000050E3           CMP      R0,#+0
   \   00000098   0A00000A           BEQ      ??GetFilePathBySd_4
   1484            {
   1485              snprintf(filepath, 128, "%s_%s", (hasname)?sname:sd->Number, sd->Time/*, (ftype==FTYPE_MSS)?"mss":"txt"*/);
   \   0000009C   00005AE3           CMP      R10,#+0
   \   000000A0   443F8D12           ADDNE    R3,SP,#+272
   \   000000A4   440089E2           ADD      R0,R9,#+68
   \   000000A8   01002DE9           PUSH     {R0}
   \   000000AC   24308902           ADDEQ    R3,R9,#+36
   \   000000B0   302088E2           ADD      R2,R8,#+48
   \   000000B4   8010A0E3           MOV      R1,#+128
   \   000000B8   0500A0E1           MOV      R0,R5
   \   000000BC   1B0100EF           SWI      +283
   \   000000C0   04D08DE2           ADD      SP,SP,#+4
   \   000000C4   190000EA           B        ??GetFilePathBySd_5
   1486            }
   1487            else
   1488              snprintf(filepath, 128, "%s_%02d-%02d-%02d %02d%02d%02d", (hasname)?sname:sd->Number, 
   1489          	    date.year%2000,
   1490          	    date.month, 
   1491          	    date.day,
   1492          	    time.hour,
   1493          	    time.min,
   1494          	    time.sec
   1495          	      );
   \                     ??GetFilePathBySd_4:
   \   000000C8   0200DDE5           LDRB     R0,[SP, #+2]
   \   000000CC   ........           LDR      R1,??DataTable72  ;; 0x10624dd3
   \   000000D0   00005AE3           CMP      R10,#+0
   \   000000D4   443F8D12           ADDNE    R3,SP,#+272
   \   000000D8   01002DE9           PUSH     {R0}
   \   000000DC   0500DDE5           LDRB     R0,[SP, #+5]
   \   000000E0   24308902           ADDEQ    R3,R9,#+36
   \   000000E4   01002DE9           PUSH     {R0}
   \   000000E8   0800DDE5           LDRB     R0,[SP, #+8]
   \   000000EC   01002DE9           PUSH     {R0}
   \   000000F0   1900DDE5           LDRB     R0,[SP, #+25]
   \   000000F4   01002DE9           PUSH     {R0}
   \   000000F8   1C00DDE5           LDRB     R0,[SP, #+28]
   \   000000FC   01002DE9           PUSH     {R0}
   \   00000100   1C009DE5           LDR      R0,[SP, #+28]
   \   00000104   912089E0           UMULL    R2,R9,R1,R0
   \   00000108   7D2EA0E3           MOV      R2,#+2000
   \   0000010C   A993A0E1           LSR      R9,R9,#+7
   \   00000110   920909E0           MUL      R9,R2,R9
   \   00000114   382088E2           ADD      R2,R8,#+56
   \   00000118   099040E0           SUB      R9,R0,R9
   \   0000011C   00022DE9           PUSH     {R9}
   \   00000120   8010A0E3           MOV      R1,#+128
   \   00000124   0500A0E1           MOV      R0,R5
   \   00000128   1B0100EF           SWI      +283
   \   0000012C   18D08DE2           ADD      SP,SP,#+24
   1496            StrClearChr(filepath, ':');
   \                     ??GetFilePathBySd_5:
   \   00000130   3A10A0E3           MOV      R1,#+58
   \   00000134   0500A0E1           MOV      R0,R5
   \   00000138   ........           BL       StrClearChr
   1497            StrClearChr(filepath, '*');
   \   0000013C   2A10A0E3           MOV      R1,#+42
   \   00000140   0500A0E1           MOV      R0,R5
   \   00000144   ........           BL       StrClearChr
   1498            StrClearChr(filepath, '?');
   \   00000148   3F10A0E3           MOV      R1,#+63
   \   0000014C   0500A0E1           MOV      R0,R5
   \   00000150   ........           BL       StrClearChr
   1499            StrClearChr(filepath, '<');
   \   00000154   3C10A0E3           MOV      R1,#+60
   \   00000158   0500A0E1           MOV      R0,R5
   \   0000015C   ........           BL       StrClearChr
   1500            StrClearChr(filepath, '>');
   \   00000160   3E10A0E3           MOV      R1,#+62
   \   00000164   0500A0E1           MOV      R0,R5
   \   00000168   ........           BL       StrClearChr
   1501            StrClearChr(filepath, '|');
   \   0000016C   7C10A0E3           MOV      R1,#+124
   \   00000170   0500A0E1           MOV      R0,R5
   \   00000174   ........           BL       StrClearChr
   1502            StrClearChr(filepath, '\\');
   \   00000178   5C10A0E3           MOV      R1,#+92
   \   0000017C   0500A0E1           MOV      R0,R5
   \   00000180   ........           BL       StrClearChr
   1503            StrClearChr(filepath, '/');
   \   00000184   2F10A0E3           MOV      R1,#+47
   \   00000188   0500A0E1           MOV      R0,R5
   \   0000018C   ........           BL       StrClearChr
   1504            strcpy(temp, folder);
   \   00000190   0410A0E1           MOV      R1,R4
   \   00000194   90008DE2           ADD      R0,SP,#+144
   \   00000198   1A0000EF           SWI      +26
   1505            strcat(temp, filepath);
   \   0000019C   0510A0E1           MOV      R1,R5
   \   000001A0   90008DE2           ADD      R0,SP,#+144
   \   000001A4   170000EF           SWI      +23
   1506            strcat(temp, (ftype==FTYPE_MSS)?".mss":".txt");
   \   000001A8   010056E3           CMP      R6,#+1
   \   000001AC   1C108802           ADDEQ    R1,R8,#+28
   \   000001B0   58108812           ADDNE    R1,R8,#+88
   \   000001B4   90008DE2           ADD      R0,SP,#+144
   \   000001B8   170000EF           SWI      +23
   1507            if(!IsFileExist(temp))
   \   000001BC   90008DE2           ADD      R0,SP,#+144
   \   000001C0   ........           BL       IsFileExist
   \   000001C4   000050E3           CMP      R0,#+0
   \   000001C8   0500001A           BNE      ??GetFilePathBySd_6
   1508            {
   1509              strcpy(filepath, temp);
   \                     ??GetFilePathBySd_7:
   \   000001CC   90108DE2           ADD      R1,SP,#+144
   \   000001D0   0500A0E1           MOV      R0,R5
   \   000001D4   1A0000EF           SWI      +26
   1510              return 1;
   \   000001D8   0100A0E3           MOV      R0,#+1
   \   000001DC   5ADF8DE2           ADD      SP,SP,#+360
   \   000001E0   F087BDE8           POP      {R4-R10,PC}
   1511            }
   1512            while(i<MAX_FILE)
   1513            {
   1514              sprintf(temp, "%s%s_%04d%s", folder, filepath, i, (ftype==FTYPE_MSS)?".mss":".txt");
   \                     ??GetFilePathBySd_6:
   \   000001E4   010056E3           CMP      R6,#+1
   \   000001E8   1C008802           ADDEQ    R0,R8,#+28
   \   000001EC   58008812           ADDNE    R0,R8,#+88
   \   000001F0   01002DE9           PUSH     {R0}
   \   000001F4   0530A0E1           MOV      R3,R5
   \   000001F8   0420A0E1           MOV      R2,R4
   \   000001FC   241088E2           ADD      R1,R8,#+36
   \   00000200   0700A0E1           MOV      R0,R7
   \   00000204   01002DE9           PUSH     {R0}
   \   00000208   98008DE2           ADD      R0,SP,#+152
   \   0000020C   160000EF           SWI      +22
   1515              if(!IsFileExist(temp))
   \   00000210   98008DE2           ADD      R0,SP,#+152
   \   00000214   ........           BL       IsFileExist
   \   00000218   000050E3           CMP      R0,#+0
   \   0000021C   08D08DE2           ADD      SP,SP,#+8
   \   00000220   E9FFFF0A           BEQ      ??GetFilePathBySd_7
   1516              {
   1517                strcpy(filepath, temp);
   1518                return 1;
   1519              }
   1520              i++;
   \   00000224   017087E2           ADD      R7,R7,#+1
   1521            }
   \   00000228   1000A0E3           MOV      R0,#+16
   \   0000022C   9C0D80E3           ORR      R0,R0,#0x2700
   \   00000230   000057E1           CMP      R7,R0
   \   00000234   EAFFFFBA           BLT      ??GetFilePathBySd_6
   1522            return 0;
   \   00000238   0000A0E3           MOV      R0,#+0
   \   0000023C   5ADF8DE2           ADD      SP,SP,#+360
   \   00000240   F087BDE8           POP      {R4-R10,PC}      ;; return
   \                     ??GetFilePathBySd_3:
   \   00000244   556E6B00           DC8      "Unk"
   1523          }
   1524          

   \                                 In segment CODE, align 4, keep-with-next
   1525          int ExportAllToOneTxt_ASCII(char *filename)
   1526          {
   \                     ExportAllToOneTxt_ASCII:
   \   00000000   F0412DE9           PUSH     {R4-R8,LR}
   \   00000004   77DF4DE2           SUB      SP,SP,#+476
   \   00000008   0070A0E1           MOV      R7,R0
   1527            SMS_DATA *sdl=sdltop;
   \   0000000C   ........           LDR      R0,??DataTable45  ;; sdltop
   \   00000010   80DD4DE2           SUB      SP,SP,#+8192
   \   00000014   005090E5           LDR      R5,[R0, #+0]
   1528            int fin, s_n=0, len;
   \   00000018   0060A0E3           MOV      R6,#+0
   1529            unsigned int err;
   1530            char text[MAX_TEXT*2];
   1531            char buf[MAX_TEXT*2+256];
   1532            WSHDR *wname, nm;
   1533            unsigned short nmb[64];
   1534            char sname[65];
   1535            wname=CreateLocalWS(&nm, nmb, 64);
   \   0000001C   4020A0E3           MOV      R2,#+64
   \   00000020   411F8DE2           ADD      R1,SP,#+260
   \   00000024   801D81E2           ADD      R1,R1,#+8192
   \   00000028   720F8DE2           ADD      R0,SP,#+456
   \   0000002C   800D80E2           ADD      R0,R0,#+8192
   \   00000030   270100EF           SWI      +295
   \   00000034   0040A0E1           MOV      R4,R0
   1536            if(IsFileExist(filename))
   \   00000038   0700A0E1           MOV      R0,R7
   \   0000003C   ........           BL       IsFileExist
   \   00000040   000050E3           CMP      R0,#+0
   1537              return -1;
   \   00000044   0600E011           MVNNE    R0,R6
   \   00000048   4B00001A           BNE      ??ExportAllToOneTxt_ASCII_0
   1538            if((fin=fopen(filename, A_WriteOnly+A_Create+A_Truncate, P_WRITE, &err))<0)
   \   0000004C   0D30A0E1           MOV      R3,SP
   \   00000050   402FA0E3           MOV      R2,#+256
   \   00000054   0110A0E3           MOV      R1,#+1
   \   00000058   C01F81E3           ORR      R1,R1,#0x300
   \   0000005C   0700A0E1           MOV      R0,R7
   \   00000060   0A0000EF           SWI      +10
   \   00000064   0070B0E1           MOVS     R7,R0
   \   00000068   0100005A           BPL      ??ExportAllToOneTxt_ASCII_1
   1539              return 0;
   \   0000006C   410000EA           B        ??ExportAllToOneTxt_ASCII_2
   1540            while(sdl)
   1541            {
   1542              s_n++;
   1543              ws_2ascii(sdl->SMS_TEXT, text, MAX_TEXT*2);
   1544              if(!findNameByNum(wname, sdl->Number))
   1545                strcpy(sname, lgp.LGP_UNK_NUM);
   1546              else
   1547                ws_2ascii(wname, sname, 64);
   1548              sprintf(buf, "%s: %s\r\n%s: %s\r\n%s: %s\r\n%s:\r\n%s\r\n\r\n",
   1549          	    (sdl->type==TYPE_OUT||sdl->type==TYPE_DRAFT)?lgp.LGP_TO:lgp.LGP_FROM,
   1550          	    sname,
   1551          	    lgp.LGP_NUMBER,
   1552          	    sdl->Number,
   1553          	    lgp.LGP_TIME,
   1554          	    (strlen(sdl->Time))?sdl->Time:lgp.LGP_UNK,
   1555          	    lgp.LGP_TEXT,
   1556          	    text);
   1557              len=strlen(buf);
   1558              if(fwrite(fin, buf, len, &err)!=len)
   1559                break;
   1560              sdl=sdl->next;
   \                     ??ExportAllToOneTxt_ASCII_3:
   \   00000070   005095E5           LDR      R5,[R5, #+0]
   \                     ??ExportAllToOneTxt_ASCII_1:
   \   00000074   000055E3           CMP      R5,#+0
   \   00000078   3B00000A           BEQ      ??ExportAllToOneTxt_ASCII_4
   \   0000007C   640095E5           LDR      R0,[R5, #+100]
   \   00000080   ........           LDR      R8,??DataTable77  ;; lgp
   \   00000084   016086E2           ADD      R6,R6,#+1
   \   00000088   402DA0E3           MOV      R2,#+4096
   \   0000008C   411F8DE2           ADD      R1,SP,#+260
   \   00000090   401D81E2           ADD      R1,R1,#+4096
   \   00000094   ........           _BLF     ws_2ascii,??ws_2ascii??rA
   \   00000098   241085E2           ADD      R1,R5,#+36
   \   0000009C   0400A0E1           MOV      R0,R4
   \   000000A0   ........           _BLF     findNameByNum,??findNameByNum??rA
   \   000000A4   000050E3           CMP      R0,#+0
   \   000000A8   0400001A           BNE      ??ExportAllToOneTxt_ASCII_5
   \   000000AC   101198E5           LDR      R1,[R8, #+272]
   \   000000B0   610F8DE2           ADD      R0,SP,#+388
   \   000000B4   800D80E2           ADD      R0,R0,#+8192
   \   000000B8   1A0000EF           SWI      +26
   \   000000BC   040000EA           B        ??ExportAllToOneTxt_ASCII_6
   \                     ??ExportAllToOneTxt_ASCII_5:
   \   000000C0   4020A0E3           MOV      R2,#+64
   \   000000C4   611F8DE2           ADD      R1,SP,#+388
   \   000000C8   801D81E2           ADD      R1,R1,#+8192
   \   000000CC   0400A0E1           MOV      R0,R4
   \   000000D0   ........           _BLF     ws_2ascii,??ws_2ascii??rA
   \                     ??ExportAllToOneTxt_ASCII_6:
   \   000000D4   440085E2           ADD      R0,R5,#+68
   \   000000D8   1B0000EF           SWI      +27
   \   000000DC   081095E5           LDR      R1,[R5, #+8]
   \   000000E0   000050E3           CMP      R0,#+0
   \   000000E4   20019805           LDREQ    R0,[R8, #+288]
   \   000000E8   44008512           ADDNE    R0,R5,#+68
   \   000000EC   010051E3           CMP      R1,#+1
   \   000000F0   04005113           CMPNE    R1,#+4
   \   000000F4   1C219805           LDREQ    R2,[R8, #+284]
   \   000000F8   411F8DE2           ADD      R1,SP,#+260
   \   000000FC   70209815           LDRNE    R2,[R8, #+112]
   \   00000100   401D81E2           ADD      R1,R1,#+4096
   \   00000104   02002DE9           PUSH     {R1}
   \   00000108   181198E5           LDR      R1,[R8, #+280]
   \   0000010C   02002DE9           PUSH     {R1}
   \   00000110   ........           LDR      R1,??DataTable78  ;; `?<Constant "%s: %s\\r\\n%s: %s\\r\\n%s: %...">`
   \   00000114   01002DE9           PUSH     {R0}
   \   00000118   0C0198E5           LDR      R0,[R8, #+268]
   \   0000011C   01002DE9           PUSH     {R0}
   \   00000120   240085E2           ADD      R0,R5,#+36
   \   00000124   01002DE9           PUSH     {R0}
   \   00000128   140198E5           LDR      R0,[R8, #+276]
   \   0000012C   01002DE9           PUSH     {R0}
   \   00000130   673F8DE2           ADD      R3,SP,#+412
   \   00000134   803D83E2           ADD      R3,R3,#+8192
   \   00000138   1C008DE2           ADD      R0,SP,#+28
   \   0000013C   160000EF           SWI      +22
   \   00000140   1C008DE2           ADD      R0,SP,#+28
   \   00000144   1B0000EF           SWI      +27
   \   00000148   0080A0E1           MOV      R8,R0
   \   0000014C   18308DE2           ADD      R3,SP,#+24
   \   00000150   0820A0E1           MOV      R2,R8
   \   00000154   1C108DE2           ADD      R1,SP,#+28
   \   00000158   0700A0E1           MOV      R0,R7
   \   0000015C   0C0000EF           SWI      +12
   \   00000160   080050E1           CMP      R0,R8
   \   00000164   18D08DE2           ADD      SP,SP,#+24
   \   00000168   C0FFFF0A           BEQ      ??ExportAllToOneTxt_ASCII_3
   1561            }
   1562            fclose(fin, &err);
   \                     ??ExportAllToOneTxt_ASCII_4:
   \   0000016C   0D10A0E1           MOV      R1,SP
   \   00000170   0700A0E1           MOV      R0,R7
   \   00000174   0D0000EF           SWI      +13
   1563            return s_n;
   \                     ??ExportAllToOneTxt_ASCII_2:
   \   00000178   0600A0E1           MOV      R0,R6
   \                     ??ExportAllToOneTxt_ASCII_0:
   \   0000017C   77DF8DE2           ADD      SP,SP,#+476
   \   00000180   80DD8DE2           ADD      SP,SP,#+8192
   \   00000184   F081BDE8           POP      {R4-R8,PC}       ;; return
   1564          }
   1565          

   \                                 In segment CODE, align 4, keep-with-next
   1566          int ExportOneToTxt_ASCII(SMS_DATA *sd)
   1567          {
   \                     ExportOneToTxt_ASCII:
   \   00000000   F0412DE9           PUSH     {R4-R8,LR}
   \   00000004   B7DF4DE2           SUB      SP,SP,#+732
   \   00000008   80DD4DE2           SUB      SP,SP,#+8192
   \   0000000C   0040A0E1           MOV      R4,R0
   1568            char folder[128];
   1569            char fullpath[128];
   1570            int fin, len, c;
   1571            unsigned int err;
   1572            char text[MAX_TEXT*2];
   1573            char buf[MAX_TEXT*2+256];
   1574            WSHDR *wname, nm;
   1575            char sname[65];
   1576            unsigned short nmb[64];
   1577            wname=CreateLocalWS(&nm, nmb, 64);
   \   00000010   4020A0E3           MOV      R2,#+64
   \   00000014   811F8DE2           ADD      R1,SP,#+516
   \   00000018   801D81E2           ADD      R1,R1,#+8192
   \   0000001C   B20F8DE2           ADD      R0,SP,#+712
   \   00000020   800D80E2           ADD      R0,R0,#+8192
   \   00000024   270100EF           SWI      +295
   1578            strcpy(folder, CFG_MAIN_FOLDER);
   \   00000028   ........           LDR      R1,??DataTable65  ;; CFG_MAIN_FOLDER
   \   0000002C   0050A0E1           MOV      R5,R0
   \   00000030   410F8DE2           ADD      R0,SP,#+260
   \   00000034   800D80E2           ADD      R0,R0,#+8192
   \   00000038   1A0000EF           SWI      +26
   1579            len=strlen(folder);
   \   0000003C   410F8DE2           ADD      R0,SP,#+260
   \   00000040   800D80E2           ADD      R0,R0,#+8192
   \   00000044   1B0000EF           SWI      +27
   \   00000048   0070A0E1           MOV      R7,R0
   1580            c=folder[len-1];
   \   0000004C   410F8DE2           ADD      R0,SP,#+260
   \   00000050   800D80E2           ADD      R0,R0,#+8192
   \   00000054   000087E0           ADD      R0,R7,R0
   \   00000058   011050E5           LDRB     R1,[R0, #-1]
   1581            if(c!='\\' && c!='/')
   \   0000005C   5C0051E3           CMP      R1,#+92
   \   00000060   2F005113           CMPNE    R1,#+47
   \   00000064   0300000A           BEQ      ??ExportOneToTxt_ASCII_0
   1582            {
   1583              folder[len]='\\';
   \   00000068   5C10A0E3           MOV      R1,#+92
   \   0000006C   0010C0E5           STRB     R1,[R0, #+0]
   1584              folder[len+1]=0;
   \   00000070   0010A0E3           MOV      R1,#+0
   \   00000074   0110C0E5           STRB     R1,[R0, #+1]
   1585            }
   1586            if(!isdir(folder, &err))
   \                     ??ExportOneToTxt_ASCII_0:
   \   00000078   0D10A0E1           MOV      R1,SP
   \   0000007C   410F8DE2           ADD      R0,SP,#+260
   \   00000080   800D80E2           ADD      R0,R0,#+8192
   \   00000084   910000EF           SWI      +145
   \   00000088   000050E3           CMP      R0,#+0
   \   0000008C   0300001A           BNE      ??ExportOneToTxt_ASCII_1
   1587              mkdir(folder, &err);
   \   00000090   0D10A0E1           MOV      R1,SP
   \   00000094   410F8DE2           ADD      R0,SP,#+260
   \   00000098   800D80E2           ADD      R0,R0,#+8192
   \   0000009C   100000EF           SWI      +16
   1588            strcat(folder, "Text\\");
   \                     ??ExportOneToTxt_ASCII_1:
   \   000000A0   ........           LDR      R7,??DataTable55  ;; `?<Constant "Text\\\\">`
   \   000000A4   410F8DE2           ADD      R0,SP,#+260
   \   000000A8   0710A0E1           MOV      R1,R7
   \   000000AC   800D80E2           ADD      R0,R0,#+8192
   \   000000B0   170000EF           SWI      +23
   1589            if(!isdir(folder, &err))
   \   000000B4   0D10A0E1           MOV      R1,SP
   \   000000B8   410F8DE2           ADD      R0,SP,#+260
   \   000000BC   800D80E2           ADD      R0,R0,#+8192
   \   000000C0   910000EF           SWI      +145
   \   000000C4   000050E3           CMP      R0,#+0
   \   000000C8   0300001A           BNE      ??ExportOneToTxt_ASCII_2
   1590              mkdir(folder, &err);
   \   000000CC   0D10A0E1           MOV      R1,SP
   \   000000D0   410F8DE2           ADD      R0,SP,#+260
   \   000000D4   800D80E2           ADD      R0,R0,#+8192
   \   000000D8   100000EF           SWI      +16
   1591            if(!GetFilePathBySd(sd, folder, fullpath, FTYPE_TXT))
   \                     ??ExportOneToTxt_ASCII_2:
   \   000000DC   0030A0E3           MOV      R3,#+0
   \   000000E0   612F8DE2           ADD      R2,SP,#+388
   \   000000E4   802D82E2           ADD      R2,R2,#+8192
   \   000000E8   411F8DE2           ADD      R1,SP,#+260
   \   000000EC   801D81E2           ADD      R1,R1,#+8192
   \   000000F0   0400A0E1           MOV      R0,R4
   \   000000F4   ........           BL       GetFilePathBySd
   \   000000F8   000050E3           CMP      R0,#+0
   1592              return -1;
   \   000000FC   0000E003           MVNEQ    R0,#+0
   \   00000100   4D00000A           BEQ      ??ExportOneToTxt_ASCII_3
   1593            if((fin=fopen(fullpath, A_WriteOnly+A_Create+A_Truncate, P_WRITE, &err))<0)
   \   00000104   0D30A0E1           MOV      R3,SP
   \   00000108   402FA0E3           MOV      R2,#+256
   \   0000010C   0110A0E3           MOV      R1,#+1
   \   00000110   C01F81E3           ORR      R1,R1,#0x300
   \   00000114   610F8DE2           ADD      R0,SP,#+388
   \   00000118   800D80E2           ADD      R0,R0,#+8192
   \   0000011C   0A0000EF           SWI      +10
   \   00000120   0060B0E1           MOVS     R6,R0
   \   00000124   0300005A           BPL      ??ExportOneToTxt_ASCII_4
   1594              return 0;
   \                     ??ExportOneToTxt_ASCII_5:
   \   00000128   0000A0E3           MOV      R0,#+0
   \   0000012C   B7DF8DE2           ADD      SP,SP,#+732
   \   00000130   80DD8DE2           ADD      SP,SP,#+8192
   \   00000134   F081BDE8           POP      {R4-R8,PC}
   1595            ws_2ascii(sd->SMS_TEXT, text, MAX_TEXT*2);
   \                     ??ExportOneToTxt_ASCII_4:
   \   00000138   640094E5           LDR      R0,[R4, #+100]
   1596            if(!findNameByNum(wname, sd->Number))
   \   0000013C   ........           LDR      R8,??DataTable75  ;; lgp
   \   00000140   402DA0E3           MOV      R2,#+4096
   \   00000144   411F8DE2           ADD      R1,SP,#+260
   \   00000148   401D81E2           ADD      R1,R1,#+4096
   \   0000014C   ........           _BLF     ws_2ascii,??ws_2ascii??rA
   \   00000150   241084E2           ADD      R1,R4,#+36
   \   00000154   0500A0E1           MOV      R0,R5
   \   00000158   ........           _BLF     findNameByNum,??findNameByNum??rA
   \   0000015C   000050E3           CMP      R0,#+0
   \   00000160   0400001A           BNE      ??ExportOneToTxt_ASCII_6
   1597              strcpy(sname, lgp.LGP_UNK_NUM);
   \   00000164   101198E5           LDR      R1,[R8, #+272]
   \   00000168   A10F8DE2           ADD      R0,SP,#+644
   \   0000016C   800D80E2           ADD      R0,R0,#+8192
   \   00000170   1A0000EF           SWI      +26
   \   00000174   040000EA           B        ??ExportOneToTxt_ASCII_7
   1598            else
   1599              ws_2ascii(wname, sname, 64);
   \                     ??ExportOneToTxt_ASCII_6:
   \   00000178   4020A0E3           MOV      R2,#+64
   \   0000017C   A11F8DE2           ADD      R1,SP,#+644
   \   00000180   801D81E2           ADD      R1,R1,#+8192
   \   00000184   0500A0E1           MOV      R0,R5
   \   00000188   ........           _BLF     ws_2ascii,??ws_2ascii??rA
   1600            sprintf(buf, "%s: %s\r\n%s: %s\r\n%s: %s\r\n%s:\r\n%s\r\n",
   1601          	  (sd->type==TYPE_OUT||sd->type==TYPE_DRAFT)?lgp.LGP_TO:lgp.LGP_FROM,
   1602          	  sname,
   1603          	  lgp.LGP_NUMBER,
   1604          	  sd->Number,
   1605          	  lgp.LGP_TIME,
   1606          	  (strlen(sd->Time))?sd->Time:lgp.LGP_UNK,
   1607          	  lgp.LGP_TEXT,
   1608          	  text);
   \                     ??ExportOneToTxt_ASCII_7:
   \   0000018C   440084E2           ADD      R0,R4,#+68
   \   00000190   1B0000EF           SWI      +27
   \   00000194   081094E5           LDR      R1,[R4, #+8]
   \   00000198   000050E3           CMP      R0,#+0
   \   0000019C   20019805           LDREQ    R0,[R8, #+288]
   \   000001A0   44008412           ADDNE    R0,R4,#+68
   \   000001A4   010051E3           CMP      R1,#+1
   \   000001A8   04005113           CMPNE    R1,#+4
   \   000001AC   1C219805           LDREQ    R2,[R8, #+284]
   \   000001B0   411F8DE2           ADD      R1,SP,#+260
   \   000001B4   70209815           LDRNE    R2,[R8, #+112]
   \   000001B8   401D81E2           ADD      R1,R1,#+4096
   \   000001BC   02002DE9           PUSH     {R1}
   \   000001C0   181198E5           LDR      R1,[R8, #+280]
   \   000001C4   02002DE9           PUSH     {R1}
   \   000001C8   01002DE9           PUSH     {R0}
   \   000001CC   0C0198E5           LDR      R0,[R8, #+268]
   \   000001D0   081087E2           ADD      R1,R7,#+8
   \   000001D4   01002DE9           PUSH     {R0}
   \   000001D8   240084E2           ADD      R0,R4,#+36
   \   000001DC   01002DE9           PUSH     {R0}
   \   000001E0   140198E5           LDR      R0,[R8, #+276]
   \   000001E4   01002DE9           PUSH     {R0}
   \   000001E8   A73F8DE2           ADD      R3,SP,#+668
   \   000001EC   803D83E2           ADD      R3,R3,#+8192
   \   000001F0   1C008DE2           ADD      R0,SP,#+28
   \   000001F4   160000EF           SWI      +22
   1609            len=strlen(buf);
   \   000001F8   1C008DE2           ADD      R0,SP,#+28
   \   000001FC   1B0000EF           SWI      +27
   \   00000200   0070A0E1           MOV      R7,R0
   1610            if(fwrite(fin, buf, len, &err)!=len)
   \   00000204   18308DE2           ADD      R3,SP,#+24
   \   00000208   0720A0E1           MOV      R2,R7
   \   0000020C   1C108DE2           ADD      R1,SP,#+28
   \   00000210   0600A0E1           MOV      R0,R6
   \   00000214   0C0000EF           SWI      +12
   \   00000218   070050E1           CMP      R0,R7
   \   0000021C   18D08DE2           ADD      SP,SP,#+24
   \   00000220   0D10A0E1           MOV      R1,SP
   \   00000224   0600A0E1           MOV      R0,R6
   \   00000228   0100000A           BEQ      ??ExportOneToTxt_ASCII_8
   1611            {
   1612              fclose(fin, &err);
   \   0000022C   0D0000EF           SWI      +13
   1613              return 0;
   \   00000230   BCFFFFEA           B        ??ExportOneToTxt_ASCII_5
   1614            }
   1615            fclose(fin, &err);
   \                     ??ExportOneToTxt_ASCII_8:
   \   00000234   0D0000EF           SWI      +13
   1616            return 1;
   \   00000238   0100A0E3           MOV      R0,#+1
   \                     ??ExportOneToTxt_ASCII_3:
   \   0000023C   B7DF8DE2           ADD      SP,SP,#+732
   \   00000240   80DD8DE2           ADD      SP,SP,#+8192
   \   00000244   F081BDE8           POP      {R4-R8,PC}       ;; return
   1617          }
   1618          
   1619          //utf8

   \                                 In segment CODE, align 4, keep-with-next
   1620          int ExportAllToOneTxt_UTF8(char *filename)
   1621          {
   \                     ExportAllToOneTxt_UTF8:
   \   00000000   F0412DE9           PUSH     {R4-R8,LR}
   \   00000004   78DF4DE2           SUB      SP,SP,#+480
   \   00000008   0070A0E1           MOV      R7,R0
   1622            SMS_DATA *sdl=sdltop;
   \   0000000C   ........           LDR      R0,??DataTable45  ;; sdltop
   \   00000010   C0DD4DE2           SUB      SP,SP,#+12288
   \   00000014   004090E5           LDR      R4,[R0, #+0]
   1623            int fin, s_n=0, len, utf8_res_len;
   \   00000018   0050A0E3           MOV      R5,#+0
   1624            unsigned int err;
   1625            char text[MAX_TEXT*3];
   1626            char buf[MAX_TEXT*3+256];
   1627            WSHDR *wname, nm;
   1628            unsigned short nmb[64];
   1629            char sname[65];
   1630            wname=CreateLocalWS(&nm, nmb, 64);
   \   0000001C   4020A0E3           MOV      R2,#+64
   \   00000020   421F8DE2           ADD      R1,SP,#+264
   \   00000024   C01D81E2           ADD      R1,R1,#+12288
   \   00000028   730F8DE2           ADD      R0,SP,#+460
   \   0000002C   C00D80E2           ADD      R0,R0,#+12288
   \   00000030   270100EF           SWI      +295
   \   00000034   0060A0E1           MOV      R6,R0
   1631            if(IsFileExist(filename))
   \   00000038   0700A0E1           MOV      R0,R7
   \   0000003C   ........           BL       IsFileExist
   \   00000040   000050E3           CMP      R0,#+0
   1632              return -1;
   \   00000044   0500E011           MVNNE    R0,R5
   \   00000048   5B00001A           BNE      ??ExportAllToOneTxt_UTF8_0
   1633            if((fin=fopen(filename, A_WriteOnly+A_Create+A_Truncate, P_WRITE, &err))<0)
   \   0000004C   0D30A0E1           MOV      R3,SP
   \   00000050   402FA0E3           MOV      R2,#+256
   \   00000054   0110A0E3           MOV      R1,#+1
   \   00000058   C01F81E3           ORR      R1,R1,#0x300
   \   0000005C   0700A0E1           MOV      R0,R7
   \   00000060   0A0000EF           SWI      +10
   \   00000064   0070B0E1           MOVS     R7,R0
   \   00000068   5200004A           BMI      ??ExportAllToOneTxt_UTF8_1
   1634              return 0;
   1635            buf[0]=0xEF;
   \   0000006C   EF10A0E3           MOV      R1,#+239
   \   00000070   0810CDE5           STRB     R1,[SP, #+8]
   1636            buf[1]=0xBB;
   \   00000074   BB10A0E3           MOV      R1,#+187
   \   00000078   0910CDE5           STRB     R1,[SP, #+9]
   1637            buf[2]=0xBF;
   \   0000007C   BF10A0E3           MOV      R1,#+191
   \   00000080   0A10CDE5           STRB     R1,[SP, #+10]
   1638            if(fwrite(fin, buf, 3, &err)!=3)
   \   00000084   0D30A0E1           MOV      R3,SP
   \   00000088   0320A0E3           MOV      R2,#+3
   \   0000008C   08108DE2           ADD      R1,SP,#+8
   \   00000090   0C0000EF           SWI      +12
   \   00000094   030050E3           CMP      R0,#+3
   \   00000098   0400000A           BEQ      ??ExportAllToOneTxt_UTF8_2
   1639              return -2;
   \   0000009C   0100E0E3           MVN      R0,#+1
   \   000000A0   78DF8DE2           ADD      SP,SP,#+480
   \   000000A4   C0DD8DE2           ADD      SP,SP,#+12288
   \   000000A8   F081BDE8           POP      {R4-R8,PC}
   1640            while(sdl)
   1641            {
   1642              s_n++;
   1643              ws_2utf8(sdl->SMS_TEXT, text, &utf8_res_len, MAX_TEXT*3);
   1644              if(!findNameByNum(wname, sdl->Number))
   1645                strcpy(sname, STR_UNK_NUM_UTF8);
   1646              else
   1647                ws_2utf8(wname, sname, &utf8_res_len, 64);
   1648              sprintf(buf, "%s: %s\r\n%s: %s\r\n%s: %s\r\n%s:\r\n%s\r\n\r\n",
   1649          	    (sdl->type==TYPE_OUT||sdl->type==TYPE_DRAFT)?STR_TO_UTF8:STR_FROM_UTF8,
   1650          	    sname,
   1651          	    STR_NUMBER_UTF8,
   1652          	    sdl->Number,
   1653          	    STR_TIME_UTF8,
   1654          	    (strlen(sdl->Time))?sdl->Time:STR_UNK_UTF8,
   1655          	    STR_TEXT_UTF8,
   1656          	    text);
   1657              len=strlen(buf);
   1658              if(fwrite(fin, buf, len, &err)!=len)
   1659                break;
   1660              sdl=sdl->next;
   \                     ??ExportAllToOneTxt_UTF8_3:
   \   000000AC   004094E5           LDR      R4,[R4, #+0]
   \                     ??ExportAllToOneTxt_UTF8_2:
   \   000000B0   000054E3           CMP      R4,#+0
   \   000000B4   3C00000A           BEQ      ??ExportAllToOneTxt_UTF8_4
   \   000000B8   640094E5           LDR      R0,[R4, #+100]
   \   000000BC   015085E2           ADD      R5,R5,#+1
   \   000000C0   603DA0E3           MOV      R3,#+6144
   \   000000C4   04208DE2           ADD      R2,SP,#+4
   \   000000C8   421F8DE2           ADD      R1,SP,#+264
   \   000000CC   601D81E2           ADD      R1,R1,#+6144
   \   000000D0   E20100EF           SWI      +482
   \   000000D4   241084E2           ADD      R1,R4,#+36
   \   000000D8   0600A0E1           MOV      R0,R6
   \   000000DC   ........           _BLF     findNameByNum,??findNameByNum??rA
   \   000000E0   000050E3           CMP      R0,#+0
   \   000000E4   0400001A           BNE      ??ExportAllToOneTxt_UTF8_5
   \   000000E8   ........           LDR      R1,??DataTable79  ;; STR_UNK_NUM_UTF8
   \   000000EC   620F8DE2           ADD      R0,SP,#+392
   \   000000F0   C00D80E2           ADD      R0,R0,#+12288
   \   000000F4   1A0000EF           SWI      +26
   \   000000F8   050000EA           B        ??ExportAllToOneTxt_UTF8_6
   \                     ??ExportAllToOneTxt_UTF8_5:
   \   000000FC   4030A0E3           MOV      R3,#+64
   \   00000100   04208DE2           ADD      R2,SP,#+4
   \   00000104   621F8DE2           ADD      R1,SP,#+392
   \   00000108   C01D81E2           ADD      R1,R1,#+12288
   \   0000010C   0600A0E1           MOV      R0,R6
   \   00000110   E20100EF           SWI      +482
   \                     ??ExportAllToOneTxt_UTF8_6:
   \   00000114   440084E2           ADD      R0,R4,#+68
   \   00000118   1B0000EF           SWI      +27
   \   0000011C   081094E5           LDR      R1,[R4, #+8]
   \   00000120   000050E3           CMP      R0,#+0
   \   00000124   ........           LDREQ    R0,??DataTable80  ;; STR_UNK_UTF8
   \   00000128   44008412           ADDNE    R0,R4,#+68
   \   0000012C   010051E3           CMP      R1,#+1
   \   00000130   04005113           CMPNE    R1,#+4
   \   00000134   ........           LDREQ    R2,??DataTable81  ;; STR_TO_UTF8
   \   00000138   421F8DE2           ADD      R1,SP,#+264
   \   0000013C   ........           LDRNE    R2,??DataTable82  ;; STR_FROM_UTF8
   \   00000140   601D81E2           ADD      R1,R1,#+6144
   \   00000144   02002DE9           PUSH     {R1}
   \   00000148   ........           LDR      R1,??DataTable83  ;; STR_TEXT_UTF8
   \   0000014C   02002DE9           PUSH     {R1}
   \   00000150   ........           LDR      R1,??DataTable78  ;; `?<Constant "%s: %s\\r\\n%s: %s\\r\\n%s: %...">`
   \   00000154   01002DE9           PUSH     {R0}
   \   00000158   ........           LDR      R0,??DataTable85  ;; STR_TIME_UTF8
   \   0000015C   01002DE9           PUSH     {R0}
   \   00000160   240084E2           ADD      R0,R4,#+36
   \   00000164   01002DE9           PUSH     {R0}
   \   00000168   ........           LDR      R0,??DataTable86  ;; STR_NUMBER_UTF8
   \   0000016C   01002DE9           PUSH     {R0}
   \   00000170   683F8DE2           ADD      R3,SP,#+416
   \   00000174   C03D83E2           ADD      R3,R3,#+12288
   \   00000178   20008DE2           ADD      R0,SP,#+32
   \   0000017C   160000EF           SWI      +22
   \   00000180   20008DE2           ADD      R0,SP,#+32
   \   00000184   1B0000EF           SWI      +27
   \   00000188   0080A0E1           MOV      R8,R0
   \   0000018C   18308DE2           ADD      R3,SP,#+24
   \   00000190   0820A0E1           MOV      R2,R8
   \   00000194   20108DE2           ADD      R1,SP,#+32
   \   00000198   0700A0E1           MOV      R0,R7
   \   0000019C   0C0000EF           SWI      +12
   \   000001A0   080050E1           CMP      R0,R8
   \   000001A4   18D08DE2           ADD      SP,SP,#+24
   \   000001A8   BFFFFF0A           BEQ      ??ExportAllToOneTxt_UTF8_3
   1661            }
   1662            fclose(fin, &err);
   \                     ??ExportAllToOneTxt_UTF8_4:
   \   000001AC   0D10A0E1           MOV      R1,SP
   \   000001B0   0700A0E1           MOV      R0,R7
   \   000001B4   0D0000EF           SWI      +13
   1663            return s_n;
   \                     ??ExportAllToOneTxt_UTF8_1:
   \   000001B8   0500A0E1           MOV      R0,R5
   \                     ??ExportAllToOneTxt_UTF8_0:
   \   000001BC   78DF8DE2           ADD      SP,SP,#+480
   \   000001C0   C0DD8DE2           ADD      SP,SP,#+12288
   \   000001C4   F081BDE8           POP      {R4-R8,PC}       ;; return
   1664          }
   1665          

   \                                 In segment CODE, align 4, keep-with-next
   1666          int ExportOneToTxt_UTF8(SMS_DATA *sd)
   1667          {
   \                     ExportOneToTxt_UTF8:
   \   00000000   F0402DE9           PUSH     {R4-R7,LR}
   \   00000004   B8DF4DE2           SUB      SP,SP,#+736
   \   00000008   C0DD4DE2           SUB      SP,SP,#+12288
   \   0000000C   0040A0E1           MOV      R4,R0
   1668            char folder[128];
   1669            char fullpath[128];
   1670            int fin, len, c, utf8_res_len;
   1671            unsigned int err;
   1672            char text[MAX_TEXT*3];
   1673            char buf[MAX_TEXT*3+256];
   1674            WSHDR *wname, nm;
   1675            char sname[65];
   1676            unsigned short nmb[64];
   1677            wname=CreateLocalWS(&nm, nmb, 64);
   \   00000010   4020A0E3           MOV      R2,#+64
   \   00000014   821F8DE2           ADD      R1,SP,#+520
   \   00000018   C01D81E2           ADD      R1,R1,#+12288
   \   0000001C   B30F8DE2           ADD      R0,SP,#+716
   \   00000020   C00D80E2           ADD      R0,R0,#+12288
   \   00000024   270100EF           SWI      +295
   1678            strcpy(folder, CFG_MAIN_FOLDER);
   \   00000028   ........           LDR      R1,??DataTable65  ;; CFG_MAIN_FOLDER
   \   0000002C   0050A0E1           MOV      R5,R0
   \   00000030   420F8DE2           ADD      R0,SP,#+264
   \   00000034   C00D80E2           ADD      R0,R0,#+12288
   \   00000038   1A0000EF           SWI      +26
   1679            len=strlen(folder);
   \   0000003C   420F8DE2           ADD      R0,SP,#+264
   \   00000040   C00D80E2           ADD      R0,R0,#+12288
   \   00000044   1B0000EF           SWI      +27
   \   00000048   0070A0E1           MOV      R7,R0
   1680            c=folder[len-1];
   \   0000004C   420F8DE2           ADD      R0,SP,#+264
   \   00000050   C00D80E2           ADD      R0,R0,#+12288
   \   00000054   000087E0           ADD      R0,R7,R0
   \   00000058   011050E5           LDRB     R1,[R0, #-1]
   1681            if(c!='\\' && c!='/')
   \   0000005C   5C0051E3           CMP      R1,#+92
   \   00000060   2F005113           CMPNE    R1,#+47
   \   00000064   0300000A           BEQ      ??ExportOneToTxt_UTF8_0
   1682            {
   1683              folder[len]='\\';
   \   00000068   5C10A0E3           MOV      R1,#+92
   \   0000006C   0010C0E5           STRB     R1,[R0, #+0]
   1684              folder[len+1]=0;
   \   00000070   0010A0E3           MOV      R1,#+0
   \   00000074   0110C0E5           STRB     R1,[R0, #+1]
   1685            }
   1686            if(!isdir(folder, &err))
   \                     ??ExportOneToTxt_UTF8_0:
   \   00000078   0D10A0E1           MOV      R1,SP
   \   0000007C   420F8DE2           ADD      R0,SP,#+264
   \   00000080   C00D80E2           ADD      R0,R0,#+12288
   \   00000084   910000EF           SWI      +145
   \   00000088   000050E3           CMP      R0,#+0
   \   0000008C   0300001A           BNE      ??ExportOneToTxt_UTF8_1
   1687              mkdir(folder, &err);
   \   00000090   0D10A0E1           MOV      R1,SP
   \   00000094   420F8DE2           ADD      R0,SP,#+264
   \   00000098   C00D80E2           ADD      R0,R0,#+12288
   \   0000009C   100000EF           SWI      +16
   1688            strcat(folder, "Text\\");
   \                     ??ExportOneToTxt_UTF8_1:
   \   000000A0   ........           LDR      R7,??DataTable55  ;; `?<Constant "Text\\\\">`
   \   000000A4   420F8DE2           ADD      R0,SP,#+264
   \   000000A8   0710A0E1           MOV      R1,R7
   \   000000AC   C00D80E2           ADD      R0,R0,#+12288
   \   000000B0   170000EF           SWI      +23
   1689            if(!isdir(folder, &err))
   \   000000B4   0D10A0E1           MOV      R1,SP
   \   000000B8   420F8DE2           ADD      R0,SP,#+264
   \   000000BC   C00D80E2           ADD      R0,R0,#+12288
   \   000000C0   910000EF           SWI      +145
   \   000000C4   000050E3           CMP      R0,#+0
   \   000000C8   0300001A           BNE      ??ExportOneToTxt_UTF8_2
   1690              mkdir(folder, &err);
   \   000000CC   0D10A0E1           MOV      R1,SP
   \   000000D0   420F8DE2           ADD      R0,SP,#+264
   \   000000D4   C00D80E2           ADD      R0,R0,#+12288
   \   000000D8   100000EF           SWI      +16
   1691            if(!GetFilePathBySd(sd, folder, fullpath, FTYPE_TXT))
   \                     ??ExportOneToTxt_UTF8_2:
   \   000000DC   0030A0E3           MOV      R3,#+0
   \   000000E0   622F8DE2           ADD      R2,SP,#+392
   \   000000E4   C02D82E2           ADD      R2,R2,#+12288
   \   000000E8   421F8DE2           ADD      R1,SP,#+264
   \   000000EC   C01D81E2           ADD      R1,R1,#+12288
   \   000000F0   0400A0E1           MOV      R0,R4
   \   000000F4   ........           BL       GetFilePathBySd
   \   000000F8   000050E3           CMP      R0,#+0
   1692              return -1;
   \   000000FC   0000E003           MVNEQ    R0,#+0
   \   00000100   5B00000A           BEQ      ??ExportOneToTxt_UTF8_3
   1693            if((fin=fopen(fullpath, A_WriteOnly+A_Create+A_Truncate, P_WRITE, &err))<0)
   \   00000104   0D30A0E1           MOV      R3,SP
   \   00000108   402FA0E3           MOV      R2,#+256
   \   0000010C   0110A0E3           MOV      R1,#+1
   \   00000110   C01F81E3           ORR      R1,R1,#0x300
   \   00000114   620F8DE2           ADD      R0,SP,#+392
   \   00000118   C00D80E2           ADD      R0,R0,#+12288
   \   0000011C   0A0000EF           SWI      +10
   \   00000120   0060B0E1           MOVS     R6,R0
   \   00000124   0300005A           BPL      ??ExportOneToTxt_UTF8_4
   1694              return 0;
   \                     ??ExportOneToTxt_UTF8_5:
   \   00000128   0000A0E3           MOV      R0,#+0
   \   0000012C   B8DF8DE2           ADD      SP,SP,#+736
   \   00000130   C0DD8DE2           ADD      SP,SP,#+12288
   \   00000134   F080BDE8           POP      {R4-R7,PC}
   1695            buf[0]=0xEF;
   \                     ??ExportOneToTxt_UTF8_4:
   \   00000138   EF10A0E3           MOV      R1,#+239
   \   0000013C   0810CDE5           STRB     R1,[SP, #+8]
   1696            buf[1]=0xBB;
   \   00000140   BB10A0E3           MOV      R1,#+187
   \   00000144   0910CDE5           STRB     R1,[SP, #+9]
   1697            buf[2]=0xBF;
   \   00000148   BF10A0E3           MOV      R1,#+191
   \   0000014C   0A10CDE5           STRB     R1,[SP, #+10]
   1698            if(fwrite(fin, buf, 3, &err)!=3)
   \   00000150   0D30A0E1           MOV      R3,SP
   \   00000154   0320A0E3           MOV      R2,#+3
   \   00000158   08108DE2           ADD      R1,SP,#+8
   \   0000015C   0C0000EF           SWI      +12
   \   00000160   030050E3           CMP      R0,#+3
   1699              return -2;
   \   00000164   0100E013           MVNNE    R0,#+1
   \   00000168   4100001A           BNE      ??ExportOneToTxt_UTF8_3
   1700            ws_2utf8(sd->SMS_TEXT, text, &utf8_res_len, MAX_TEXT*3);
   \   0000016C   640094E5           LDR      R0,[R4, #+100]
   \   00000170   603DA0E3           MOV      R3,#+6144
   \   00000174   04208DE2           ADD      R2,SP,#+4
   \   00000178   421F8DE2           ADD      R1,SP,#+264
   \   0000017C   601D81E2           ADD      R1,R1,#+6144
   \   00000180   E20100EF           SWI      +482
   1701            if(!findNameByNum(wname, sd->Number))
   \   00000184   241084E2           ADD      R1,R4,#+36
   \   00000188   0500A0E1           MOV      R0,R5
   \   0000018C   ........           _BLF     findNameByNum,??findNameByNum??rA
   \   00000190   000050E3           CMP      R0,#+0
   \   00000194   0400001A           BNE      ??ExportOneToTxt_UTF8_6
   1702              strcpy(sname, STR_UNK_NUM_UTF8);
   \   00000198   ........           LDR      R1,??DataTable79  ;; STR_UNK_NUM_UTF8
   \   0000019C   A20F8DE2           ADD      R0,SP,#+648
   \   000001A0   C00D80E2           ADD      R0,R0,#+12288
   \   000001A4   1A0000EF           SWI      +26
   \   000001A8   050000EA           B        ??ExportOneToTxt_UTF8_7
   1703            else
   1704              ws_2utf8(wname, sname, &utf8_res_len, 64);
   \                     ??ExportOneToTxt_UTF8_6:
   \   000001AC   4030A0E3           MOV      R3,#+64
   \   000001B0   04208DE2           ADD      R2,SP,#+4
   \   000001B4   A21F8DE2           ADD      R1,SP,#+648
   \   000001B8   C01D81E2           ADD      R1,R1,#+12288
   \   000001BC   0500A0E1           MOV      R0,R5
   \   000001C0   E20100EF           SWI      +482
   1705            sprintf(buf, "%s: %s\r\n%s: %s\r\n%s: %s\r\n%s:\r\n%s\r\n",
   1706          	  (sd->type==TYPE_OUT||sd->type==TYPE_DRAFT)?STR_TO_UTF8:STR_FROM_UTF8,
   1707          	  sname,
   1708          	  STR_NUMBER_UTF8,
   1709          	  sd->Number,
   1710          	  STR_TIME_UTF8,
   1711          	  (strlen(sd->Time))?sd->Time:STR_UNK_UTF8,
   1712          	  STR_TEXT_UTF8,
   1713          	  text);
   \                     ??ExportOneToTxt_UTF8_7:
   \   000001C4   440084E2           ADD      R0,R4,#+68
   \   000001C8   1B0000EF           SWI      +27
   \   000001CC   081094E5           LDR      R1,[R4, #+8]
   \   000001D0   000050E3           CMP      R0,#+0
   \   000001D4   ........           LDREQ    R0,??DataTable80  ;; STR_UNK_UTF8
   \   000001D8   44008412           ADDNE    R0,R4,#+68
   \   000001DC   010051E3           CMP      R1,#+1
   \   000001E0   04005113           CMPNE    R1,#+4
   \   000001E4   ........           LDREQ    R2,??DataTable81  ;; STR_TO_UTF8
   \   000001E8   421F8DE2           ADD      R1,SP,#+264
   \   000001EC   ........           LDRNE    R2,??DataTable82  ;; STR_FROM_UTF8
   \   000001F0   601D81E2           ADD      R1,R1,#+6144
   \   000001F4   02002DE9           PUSH     {R1}
   \   000001F8   ........           LDR      R1,??DataTable83  ;; STR_TEXT_UTF8
   \   000001FC   02002DE9           PUSH     {R1}
   \   00000200   01002DE9           PUSH     {R0}
   \   00000204   ........           LDR      R0,??DataTable85  ;; STR_TIME_UTF8
   \   00000208   081087E2           ADD      R1,R7,#+8
   \   0000020C   01002DE9           PUSH     {R0}
   \   00000210   240084E2           ADD      R0,R4,#+36
   \   00000214   01002DE9           PUSH     {R0}
   \   00000218   ........           LDR      R0,??DataTable86  ;; STR_NUMBER_UTF8
   \   0000021C   01002DE9           PUSH     {R0}
   \   00000220   A83F8DE2           ADD      R3,SP,#+672
   \   00000224   C03D83E2           ADD      R3,R3,#+12288
   \   00000228   20008DE2           ADD      R0,SP,#+32
   \   0000022C   160000EF           SWI      +22
   1714            len=strlen(buf);
   \   00000230   20008DE2           ADD      R0,SP,#+32
   \   00000234   1B0000EF           SWI      +27
   \   00000238   0070A0E1           MOV      R7,R0
   1715            if(fwrite(fin, buf, len, &err)!=len)
   \   0000023C   18308DE2           ADD      R3,SP,#+24
   \   00000240   0720A0E1           MOV      R2,R7
   \   00000244   20108DE2           ADD      R1,SP,#+32
   \   00000248   0600A0E1           MOV      R0,R6
   \   0000024C   0C0000EF           SWI      +12
   \   00000250   070050E1           CMP      R0,R7
   \   00000254   18D08DE2           ADD      SP,SP,#+24
   \   00000258   0D10A0E1           MOV      R1,SP
   \   0000025C   0600A0E1           MOV      R0,R6
   \   00000260   0100000A           BEQ      ??ExportOneToTxt_UTF8_8
   1716            {
   1717              fclose(fin, &err);
   \   00000264   0D0000EF           SWI      +13
   1718              return 0;
   \   00000268   AEFFFFEA           B        ??ExportOneToTxt_UTF8_5
   1719            } 
   1720            fclose(fin, &err);
   \                     ??ExportOneToTxt_UTF8_8:
   \   0000026C   0D0000EF           SWI      +13
   1721            return 1;
   \   00000270   0100A0E3           MOV      R0,#+1
   \                     ??ExportOneToTxt_UTF8_3:
   \   00000274   B8DF8DE2           ADD      SP,SP,#+736
   \   00000278   C0DD8DE2           ADD      SP,SP,#+12288
   \   0000027C   F080BDE8           POP      {R4-R7,PC}       ;; return
   1722          }
   1723          
   1724          
   1725          #define CHARSET_ASCII 0
   1726          #define CHARSET_UTF8 1

   \                                 In segment CODE, align 4, keep-with-next
   1727          int ExportAllToOneTxt(char *filename)
   1728          {
   1729            if (CFG_EXPORT_CHARSET==CHARSET_ASCII)
   \                     ExportAllToOneTxt:
   \   00000000   ........           LDR      R1,??DataTable87  ;; CFG_EXPORT_CHARSET
   \   00000004   001091E5           LDR      R1,[R1, #+0]
   \   00000008   000051E3           CMP      R1,#+0
   \   0000000C   0000001A           BNE      ??ExportAllToOneTxt_0
   1730              return (ExportAllToOneTxt_ASCII(filename));
   \   00000010   ........           B        ExportAllToOneTxt_ASCII  ;; tailcall
   1731            else if (CFG_EXPORT_CHARSET==CHARSET_UTF8)
   \                     ??ExportAllToOneTxt_0:
   \   00000014   010051E3           CMP      R1,#+1
   \   00000018   0000001A           BNE      ??ExportAllToOneTxt_1
   1732              return (ExportAllToOneTxt_UTF8(filename));
   \   0000001C   ........           B        ExportAllToOneTxt_UTF8  ;; tailcall
   1733            return 0;
   \                     ??ExportAllToOneTxt_1:
   \   00000020   0000A0E3           MOV      R0,#+0
   \   00000024   1EFF2FE1           BX       LR
   1734          }
   1735          

   \                                 In segment CODE, align 4, keep-with-next
   1736          int ExportOneToTxt(SMS_DATA *sd)
   1737          {
   1738            if (CFG_EXPORT_CHARSET==CHARSET_ASCII)
   \                     ExportOneToTxt:
   \   00000000   ........           LDR      R1,??DataTable87  ;; CFG_EXPORT_CHARSET
   \   00000004   001091E5           LDR      R1,[R1, #+0]
   \   00000008   000051E3           CMP      R1,#+0
   \   0000000C   0000001A           BNE      ??ExportOneToTxt_0
   1739              return (ExportOneToTxt_ASCII(sd));
   \   00000010   ........           B        ExportOneToTxt_ASCII  ;; tailcall
   1740            else if (CFG_EXPORT_CHARSET==CHARSET_UTF8)
   \                     ??ExportOneToTxt_0:
   \   00000014   010051E3           CMP      R1,#+1
   \   00000018   0000001A           BNE      ??ExportOneToTxt_1
   1741              return (ExportOneToTxt_UTF8(sd));
   \   0000001C   ........           B        ExportOneToTxt_UTF8  ;; tailcall
   1742            return 0;
   \                     ??ExportOneToTxt_1:
   \   00000020   0000A0E3           MOV      R0,#+0
   \   00000024   1EFF2FE1           BX       LR
   1743          }
   1744          
   1745          
   1746          //-------------------------------------
   1747          //archive
   1748          

   \                                 In segment CODE, align 4, keep-with-next
   1749          int MoveToArchive(SMS_DATA *sd)
   1750          {
   \                     MoveToArchive:
   \   00000000   F0402DE9           PUSH     {R4-R7,LR}
   \   00000004   59DF4DE2           SUB      SP,SP,#+356
   \   00000008   0040A0E1           MOV      R4,R0
   1751            char fullpath[128];
   1752            char folder[128];
   1753            unsigned int err;
   1754            MSS_FILE_P2 msf;
   1755            int fin, len, c;
   1756            TTime time;
   1757            TDate date;
   1758            GetDateTime(&date, &time);
   \   0000000C   0C108DE2           ADD      R1,SP,#+12
   \   00000010   04008DE2           ADD      R0,SP,#+4
   \   00000014   B40000EF           SWI      +180
   1759            strcpy(folder, CFG_MAIN_FOLDER);
   \   00000018   ........           LDR      R1,??DataTable65  ;; CFG_MAIN_FOLDER
   \   0000001C   14008DE2           ADD      R0,SP,#+20
   \   00000020   1A0000EF           SWI      +26
   1760            len=strlen(folder);
   \   00000024   14008DE2           ADD      R0,SP,#+20
   \   00000028   1B0000EF           SWI      +27
   \   0000002C   0050A0E1           MOV      R5,R0
   1761            c=folder[len-1];
   \   00000030   14008DE2           ADD      R0,SP,#+20
   \   00000034   000085E0           ADD      R0,R5,R0
   \   00000038   011050E5           LDRB     R1,[R0, #-1]
   1762            if(c!='\\' && c!='/')
   \   0000003C   0060A0E3           MOV      R6,#+0
   \   00000040   5C70A0E3           MOV      R7,#+92
   \   00000044   5C0051E3           CMP      R1,#+92
   \   00000048   2F005113           CMPNE    R1,#+47
   1763            {
   1764              folder[len]='\\';
   \   0000004C   0070C015           STRBNE   R7,[R0, #+0]
   1765              folder[len+1]=0;
   \   00000050   0160C015           STRBNE   R6,[R0, #+1]
   1766            }
   1767            if(!isdir(folder, &err))
   \   00000054   0D10A0E1           MOV      R1,SP
   \   00000058   14008DE2           ADD      R0,SP,#+20
   \   0000005C   910000EF           SWI      +145
   \   00000060   000050E3           CMP      R0,#+0
   \   00000064   0200001A           BNE      ??MoveToArchive_0
   1768              mkdir(folder, &err);
   \   00000068   0D10A0E1           MOV      R1,SP
   \   0000006C   14008DE2           ADD      R0,SP,#+20
   \   00000070   100000EF           SWI      +16
   1769            strcat(folder, FLDR_ARCHIVE);
   \                     ??MoveToArchive_0:
   \   00000074   A4129FE5           LDR      R1,??MoveToArchive_1+0x4  ;; FLDR_ARCHIVE
   \   00000078   14008DE2           ADD      R0,SP,#+20
   \   0000007C   170000EF           SWI      +23
   1770            if(!isdir(folder, &err))
   \   00000080   0D10A0E1           MOV      R1,SP
   \   00000084   14008DE2           ADD      R0,SP,#+20
   \   00000088   910000EF           SWI      +145
   \   0000008C   000050E3           CMP      R0,#+0
   \   00000090   0200001A           BNE      ??MoveToArchive_2
   1771              mkdir(folder, &err);
   \   00000094   0D10A0E1           MOV      R1,SP
   \   00000098   14008DE2           ADD      R0,SP,#+20
   \   0000009C   100000EF           SWI      +16
   1772            if(strlen(sd->Time)>4)
   \                     ??MoveToArchive_2:
   \   000000A0   ........           LDR      R5,??DataTable66  ;; `?<Constant "%02d-%02d-%02d %02d:%...">`
   \   000000A4   440084E2           ADD      R0,R4,#+68
   \   000000A8   1B0000EF           SWI      +27
   \   000000AC   050050E3           CMP      R0,#+5
   \   000000B0   0C00003A           BCC      ??MoveToArchive_3
   1773            {
   1774              strcpy(fullpath, "20");
   \   000000B4   981F8FE2           ADR      R1,??MoveToArchive_1  ;; "20"
   \   000000B8   94008DE2           ADD      R0,SP,#+148
   \   000000BC   1A0000EF           SWI      +26
   1775              strncat(fullpath, sd->Time, 5);
   \   000000C0   0520A0E3           MOV      R2,#+5
   \   000000C4   441084E2           ADD      R1,R4,#+68
   \   000000C8   94008DE2           ADD      R0,SP,#+148
   \   000000CC   140100EF           SWI      +276
   1776              fullpath[7]='\\';
   \   000000D0   9B70CDE5           STRB     R7,[SP, #+155]
   1777              fullpath[8]='\0';
   \   000000D4   9C60CDE5           STRB     R6,[SP, #+156]
   1778              StrClearChr(fullpath, '-');
   \   000000D8   2D10A0E3           MOV      R1,#+45
   \   000000DC   94008DE2           ADD      R0,SP,#+148
   \   000000E0   ........           BL       StrClearChr
   \   000000E4   040000EA           B        ??MoveToArchive_4
   1779            }
   1780            else sprintf(fullpath, "%04d%02d\\", date.year, date.month); //借用~_~ , 按月份存储
   \                     ??MoveToArchive_3:
   \   000000E8   0830DDE5           LDRB     R3,[SP, #+8]
   \   000000EC   04209DE5           LDR      R2,[SP, #+4]
   \   000000F0   201085E2           ADD      R1,R5,#+32
   \   000000F4   94008DE2           ADD      R0,SP,#+148
   \   000000F8   160000EF           SWI      +22
   1781            strcat(folder, fullpath);
   \                     ??MoveToArchive_4:
   \   000000FC   94108DE2           ADD      R1,SP,#+148
   \   00000100   14008DE2           ADD      R0,SP,#+20
   \   00000104   170000EF           SWI      +23
   1782            if(!isdir(folder, &err))
   \   00000108   0D10A0E1           MOV      R1,SP
   \   0000010C   14008DE2           ADD      R0,SP,#+20
   \   00000110   910000EF           SWI      +145
   \   00000114   000050E3           CMP      R0,#+0
   \   00000118   0200001A           BNE      ??MoveToArchive_5
   1783              mkdir(folder, &err);
   \   0000011C   0D10A0E1           MOV      R1,SP
   \   00000120   14008DE2           ADD      R0,SP,#+20
   \   00000124   100000EF           SWI      +16
   1784            switch(sd->type)
   \                     ??MoveToArchive_5:
   \   00000128   080094E5           LDR      R0,[R4, #+8]
   \   0000012C   010050E2           SUBS     R0,R0,#+1
   \   00000130   0900000A           BEQ      ??MoveToArchive_6
   \   00000134   010040E2           SUB      R0,R0,#+1
   \   00000138   010050E3           CMP      R0,#+1
   \   0000013C   0800009A           BLS      ??MoveToArchive_7
   \   00000140   020050E2           SUBS     R0,R0,#+2
   \   00000144   0200000A           BEQ      ??MoveToArchive_8
   \   00000148   010050E2           SUBS     R0,R0,#+1
   \   0000014C   0400000A           BEQ      ??MoveToArchive_7
   \   00000150   050000EA           B        ??MoveToArchive_9
   1785            {
   1786            case TYPE_DRAFT:
   1787              strcat(folder, FLDR_DRAFT);
   \                     ??MoveToArchive_8:
   \   00000154   ........           LDR      R1,??DataTable67  ;; FLDR_DRAFT
   \   00000158   040000EA           B        ??MoveToArchive_10
   1788              break;
   1789            case TYPE_OUT:
   1790              strcat(folder, FLDR_OUT);
   \                     ??MoveToArchive_6:
   \   0000015C   ........           LDR      R1,??DataTable68  ;; FLDR_OUT
   \   00000160   020000EA           B        ??MoveToArchive_10
   1791              break;
   1792            case TYPE_IN_N:
   1793            case TYPE_IN_R:
   1794            case TYPE_IN_ALL:
   1795              strcat(folder, FLDR_IN);
   \                     ??MoveToArchive_7:
   \   00000164   ........           LDR      R1,??DataTable69  ;; FLDR_IN
   \   00000168   000000EA           B        ??MoveToArchive_10
   1796              break;
   1797            default:
   1798              strcat(folder, FLDR_UNK);
   \                     ??MoveToArchive_9:
   \   0000016C   ........           LDR      R1,??DataTable70  ;; FLDR_UNK
   \                     ??MoveToArchive_10:
   \   00000170   14008DE2           ADD      R0,SP,#+20
   \   00000174   170000EF           SWI      +23
   1799              break;
   1800            }
   1801            if(!isdir(folder, &err))
   \   00000178   0D10A0E1           MOV      R1,SP
   \   0000017C   14008DE2           ADD      R0,SP,#+20
   \   00000180   910000EF           SWI      +145
   \   00000184   000050E3           CMP      R0,#+0
   \   00000188   0200001A           BNE      ??MoveToArchive_11
   1802              mkdir(folder, &err);
   \   0000018C   0D10A0E1           MOV      R1,SP
   \   00000190   14008DE2           ADD      R0,SP,#+20
   \   00000194   100000EF           SWI      +16
   1803            if(!GetFilePathBySd(sd, folder, fullpath, FTYPE_MSS))
   \                     ??MoveToArchive_11:
   \   00000198   0130A0E3           MOV      R3,#+1
   \   0000019C   94208DE2           ADD      R2,SP,#+148
   \   000001A0   14108DE2           ADD      R1,SP,#+20
   \   000001A4   0400A0E1           MOV      R0,R4
   \   000001A8   ........           BL       GetFilePathBySd
   \   000001AC   000050E3           CMP      R0,#+0
   1804              return -1;
   \   000001B0   0600E001           MVNEQ    R0,R6
   \   000001B4   5600000A           BEQ      ??MoveToArchive_12
   1805            if (sd->isfile && sd->fname)
   \   000001B8   140094E5           LDR      R0,[R4, #+20]
   \   000001BC   000050E3           CMP      R0,#+0
   \   000001C0   20009415           LDRNE    R0,[R4, #+32]
   \   000001C4   00005013           CMPNE    R0,#+0
   \   000001C8   0300000A           BEQ      ??MoveToArchive_13
   1806            {
   1807              fmove(sd->fname, fullpath, &err);
   \   000001CC   0D20A0E1           MOV      R2,SP
   \   000001D0   94108DE2           ADD      R1,SP,#+148
   \   000001D4   8E0000EF           SWI      +142
   1808              return 1;
   \   000001D8   4C0000EA           B        ??MoveToArchive_14
   1809            }
   1810            if((fin=fopen(fullpath, A_BIN+A_WriteOnly+A_Create+A_Truncate, P_WRITE, &err))<0)
   \                     ??MoveToArchive_13:
   \   000001DC   0D30A0E1           MOV      R3,SP
   \   000001E0   402FA0E3           MOV      R2,#+256
   \   000001E4   0110A0E3           MOV      R1,#+1
   \   000001E8   831C81E3           ORR      R1,R1,#0x8300
   \   000001EC   94008DE2           ADD      R0,SP,#+148
   \   000001F0   0A0000EF           SWI      +10
   \   000001F4   0060B0E1           MOVS     R6,R0
   \   000001F8   3200004A           BMI      ??MoveToArchive_15
   1811              return 0;
   1812            zeromem(&msf, sizeof(MSS_FILE_P2));
   \                     ??MoveToArchive_16:
   \   000001FC   5010A0E3           MOV      R1,#+80
   \   00000200   450F8DE2           ADD      R0,SP,#+276
   \   00000204   1D0100EF           SWI      +285
   1813            strcpy(msf.header, ELFNAME);
   \   00000208   ........           LDR      R1,??DataTable71  ;; ELFNAME
   \   0000020C   450F8DE2           ADD      R0,SP,#+276
   \   00000210   1A0000EF           SWI      +26
   1814            msf.version=MSS_VERSION;
   \   00000214   0210A0E3           MOV      R1,#+2
   \   00000218   1C118DE5           STR      R1,[SP, #+284]
   1815            msf.type=sd->type;
   \   0000021C   081094E5           LDR      R1,[R4, #+8]
   1816            strcpy(msf.number, sd->Number);
   \   00000220   510F8DE2           ADD      R0,SP,#+324
   \   00000224   20118DE5           STR      R1,[SP, #+288]
   \   00000228   241084E2           ADD      R1,R4,#+36
   \   0000022C   1A0000EF           SWI      +26
   1817            if (strlen(sd->Time))
   \   00000230   440084E2           ADD      R0,R4,#+68
   \   00000234   1B0000EF           SWI      +27
   \   00000238   000050E3           CMP      R0,#+0
   \   0000023C   0300000A           BEQ      ??MoveToArchive_17
   1818              strcpy(msf.time, sd->Time);
   \   00000240   441084E2           ADD      R1,R4,#+68
   \   00000244   490F8DE2           ADD      R0,SP,#+292
   \   00000248   1A0000EF           SWI      +26
   \   0000024C   130000EA           B        ??MoveToArchive_18
   1819            else
   1820            {
   1821              sprintf(msf.time, "%02d-%02d-%02d %02d:%02d:%02d", 
   1822          	    date.year%2000, // ? //2008 ->08
   1823          	    date.month, date.day,
   1824          	    time.hour, time.min,
   1825          	    time.sec);
   \                     ??MoveToArchive_17:
   \   00000250   0E00DDE5           LDRB     R0,[SP, #+14]
   \   00000254   ........           LDR      R1,??DataTable72  ;; 0x10624dd3
   \   00000258   01002DE9           PUSH     {R0}
   \   0000025C   1100DDE5           LDRB     R0,[SP, #+17]
   \   00000260   01002DE9           PUSH     {R0}
   \   00000264   1400DDE5           LDRB     R0,[SP, #+20]
   \   00000268   01002DE9           PUSH     {R0}
   \   0000026C   1500DDE5           LDRB     R0,[SP, #+21]
   \   00000270   01002DE9           PUSH     {R0}
   \   00000274   1830DDE5           LDRB     R3,[SP, #+24]
   \   00000278   14009DE5           LDR      R0,[SP, #+20]
   \   0000027C   917082E0           UMULL    R7,R2,R1,R0
   \   00000280   7D7EA0E3           MOV      R7,#+2000
   \   00000284   A223A0E1           LSR      R2,R2,#+7
   \   00000288   970202E0           MUL      R2,R7,R2
   \   0000028C   0510A0E1           MOV      R1,R5
   \   00000290   022040E0           SUB      R2,R0,R2
   \   00000294   4D0F8DE2           ADD      R0,SP,#+308
   \   00000298   160000EF           SWI      +22
   \   0000029C   10D08DE2           ADD      SP,SP,#+16
   1826            }
   1827            if(fwrite(fin, &msf, sizeof(MSS_FILE_P2), &err)!=sizeof(MSS_FILE_P2))
   \                     ??MoveToArchive_18:
   \   000002A0   0D30A0E1           MOV      R3,SP
   \   000002A4   5020A0E3           MOV      R2,#+80
   \   000002A8   451F8DE2           ADD      R1,SP,#+276
   \   000002AC   0600A0E1           MOV      R0,R6
   \   000002B0   0C0000EF           SWI      +12
   \   000002B4   500050E3           CMP      R0,#+80
   \   000002B8   0500000A           BEQ      ??MoveToArchive_19
   1828            {
   1829              fclose(fin, &err);
   \                     ??MoveToArchive_20:
   \   000002BC   0D10A0E1           MOV      R1,SP
   \   000002C0   0600A0E1           MOV      R0,R6
   \   000002C4   0D0000EF           SWI      +13
   1830              return 0;
   \                     ??MoveToArchive_15:
   \   000002C8   0000A0E3           MOV      R0,#+0
   \   000002CC   59DF8DE2           ADD      SP,SP,#+356
   \   000002D0   F080BDE8           POP      {R4-R7,PC}
   1831            }
   1832            len=(sd->SMS_TEXT->wsbody[0]+1)*2;
   \                     ??MoveToArchive_19:
   \   000002D4   640094E5           LDR      R0,[R4, #+100]
   1833            if (fwrite(fin, sd->SMS_TEXT->wsbody, len, &err)!=len)
   \   000002D8   0D30A0E1           MOV      R3,SP
   \   000002DC   001090E5           LDR      R1,[R0, #+0]
   \   000002E0   B010D1E1           LDRH     R1,[R1, #+0]
   \   000002E4   011081E2           ADD      R1,R1,#+1
   \   000002E8   8150A0E1           LSL      R5,R1,#+1
   \   000002EC   001090E5           LDR      R1,[R0, #+0]
   \   000002F0   0520A0E1           MOV      R2,R5
   \   000002F4   0600A0E1           MOV      R0,R6
   \   000002F8   0C0000EF           SWI      +12
   \   000002FC   050050E1           CMP      R0,R5
   \   00000300   EDFFFF1A           BNE      ??MoveToArchive_20
   1834            {
   1835              fclose(fin, &err);
   1836              return 0;
   1837            }
   1838            fclose(fin, &err);
   \   00000304   0D10A0E1           MOV      R1,SP
   \   00000308   0600A0E1           MOV      R0,R6
   \   0000030C   0D0000EF           SWI      +13
   1839            return 1;
   \                     ??MoveToArchive_14:
   \   00000310   0100A0E3           MOV      R0,#+1
   \                     ??MoveToArchive_12:
   \   00000314   59DF8DE2           ADD      SP,SP,#+356      ;; stack cleaning
   \   00000318   F080BDE8           POP      {R4-R7,PC}       ;; return
   \                     ??MoveToArchive_1:
   \   0000031C   32300000           DC8      "20",+0
   \   00000320   ........           DC32     FLDR_ARCHIVE
   1840          }
   1841          

   \                                 In segment CODE, align 4, keep-with-next
   1842          int MoveAllMssToArchive(void)
   1843          {
   1844            int res=0;
   1845            SMS_DATA *sdl=sdltop;
   \                     MoveAllMssToArchive:
   \   00000000   ........           LDR      R0,??DataTable76  ;; sdltop
   \   00000004   30402DE9           PUSH     {R4,R5,LR}
   \   00000008   005090E5           LDR      R5,[R0, #+0]
   \   0000000C   0040A0E3           MOV      R4,#+0
   \   00000010   000055E3           CMP      R5,#+0
   \   00000014   0B00000A           BEQ      ??MoveAllMssToArchive_0
   1846            while(sdl)
   1847            {
   1848              if(sdl->isfile && sdl->fname)
   \                     ??MoveAllMssToArchive_1:
   \   00000018   140095E5           LDR      R0,[R5, #+20]
   \   0000001C   000050E3           CMP      R0,#+0
   \   00000020   20009515           LDRNE    R0,[R5, #+32]
   \   00000024   00005013           CMPNE    R0,#+0
   \   00000028   0300000A           BEQ      ??MoveAllMssToArchive_2
   1849              {
   1850                if(MoveToArchive(sdl)==1)
   \   0000002C   0500A0E1           MOV      R0,R5
   \   00000030   ........           BL       MoveToArchive
   \   00000034   010050E3           CMP      R0,#+1
   1851                {
   1852                	res++;
   \   00000038   01408402           ADDEQ    R4,R4,#+1
   1853                }
   1854              }
   1855              sdl=sdl->next;
   \                     ??MoveAllMssToArchive_2:
   \   0000003C   005095E5           LDR      R5,[R5, #+0]
   1856            }
   \   00000040   000055E3           CMP      R5,#+0
   \   00000044   F3FFFF1A           BNE      ??MoveAllMssToArchive_1
   1857            readAllSMS();
   \                     ??MoveAllMssToArchive_0:
   \   00000048   ........           BL       readAllSMS
   1858            return res;
   \   0000004C   0400A0E1           MOV      R0,R4
   \   00000050   3080BDE8           POP      {R4,R5,PC}       ;; return
   1859          }
   1860          

   \                                 In segment CODE, align 4, keep-with-next
   1861          int MoveAllToArchive(void)
   1862          {
   1863            int res=0;
   1864            SMS_DATA *sdl=sdltop;
   \                     MoveAllToArchive:
   \   00000000   ........           LDR      R0,??DataTable76  ;; sdltop
   \   00000004   30402DE9           PUSH     {R4,R5,LR}
   \   00000008   005090E5           LDR      R5,[R0, #+0]
   \   0000000C   0040A0E3           MOV      R4,#+0
   \   00000010   000055E3           CMP      R5,#+0
   \   00000014   0F00000A           BEQ      ??MoveAllToArchive_0
   1865            while(sdl)
   1866            {
   1867              if(MoveToArchive(sdl)==1)
   \                     ??MoveAllToArchive_1:
   \   00000018   0500A0E1           MOV      R0,R5
   \   0000001C   ........           BL       MoveToArchive
   \   00000020   010050E3           CMP      R0,#+1
   1868              {
   1869                res++;
   1870              }
   1871              if(!sdl->isfile && sdl->id>0)
   \   00000024   140095E5           LDR      R0,[R5, #+20]
   \   00000028   01408402           ADDEQ    R4,R4,#+1
   \   0000002C   000050E3           CMP      R0,#+0
   \   00000030   0500001A           BNE      ??MoveAllToArchive_2
   \   00000034   0C0095E5           LDR      R0,[R5, #+12]
   \   00000038   010050E3           CMP      R0,#+1
   \   0000003C   020000BA           BLT      ??MoveAllToArchive_2
   1872              {
   1873                deleteDat(sdl, 0);
   \   00000040   0010A0E3           MOV      R1,#+0
   \   00000044   0500A0E1           MOV      R0,R5
   \   00000048   ........           BL       deleteDat
   1874              }
   1875              sdl=sdl->next;
   \                     ??MoveAllToArchive_2:
   \   0000004C   005095E5           LDR      R5,[R5, #+0]
   1876            }
   \   00000050   000055E3           CMP      R5,#+0
   \   00000054   EFFFFF1A           BNE      ??MoveAllToArchive_1
   1877            readAllSMS();
   \                     ??MoveAllToArchive_0:
   \   00000058   ........           BL       readAllSMS
   1878            return res;
   \   0000005C   0400A0E1           MOV      R0,R4
   \   00000060   3080BDE8           POP      {R4,R5,PC}       ;; return
   1879          }
   1880          
   1881          

   \                                 In segment CODE, align 4, keep-with-next
   1882          void ShowFileErrCode(int code)
   1883          {
   1884            if (code==0)
   \                     ShowFileErrCode:
   \   00000000   ........           LDR      R1,??DataTable75  ;; lgp
   \   00000004   00402DE9           PUSH     {LR}
   \   00000008   000050E3           CMP      R0,#+0
   \   0000000C   0100001A           BNE      ??ShowFileErrCode_0
   1885              MsgBoxError(1, (int)lgp.LGP_FILE_FAILED);
   \   00000010   941091E5           LDR      R1,[R1, #+148]
   \   00000014   020000EA           B        ??ShowFileErrCode_1
   1886            else if (code==-1)
   \                     ??ShowFileErrCode_0:
   \   00000018   010070E3           CMN      R0,#+1
   \   0000001C   0080BD18           POPNE    {PC}
   1887              MsgBoxError(1, (int)lgp.LGP_FILE_EXIST);
   \   00000020   981091E5           LDR      R1,[R1, #+152]
   \                     ??ShowFileErrCode_1:
   \   00000024   0100A0E3           MOV      R0,#+1
   \   00000028   4E0000EF           SWI      +78
   1888          }
   \   0000002C   0080BDE8           POP      {PC}             ;; return
   1889          

   \                                 In segment CODE, align 4, keep-with-next
   1890          void DeleteAllMss(void)
   1891          {
   1892          	SMS_DATA *sdl=sdltop;
   \                     DeleteAllMss:
   \   00000000   ........           LDR      R0,??DataTable76  ;; sdltop
   \   00000004   10402DE9           PUSH     {R4,LR}
   \   00000008   004090E5           LDR      R4,[R0, #+0]
   \   0000000C   000054E3           CMP      R4,#+0
   \   00000010   0A00000A           BEQ      ??DeleteAllMss_0
   1893          	while(sdl)
   1894          	{
   1895          		if(sdl->isfile && sdl->fname)
   \                     ??DeleteAllMss_1:
   \   00000014   140094E5           LDR      R0,[R4, #+20]
   \   00000018   000050E3           CMP      R0,#+0
   \   0000001C   20009415           LDRNE    R0,[R4, #+32]
   \   00000020   00005013           CMPNE    R0,#+0
   \   00000024   0200000A           BEQ      ??DeleteAllMss_2
   1896          			deleteFile(sdl, 0);
   \   00000028   0010A0E3           MOV      R1,#+0
   \   0000002C   0400A0E1           MOV      R0,R4
   \   00000030   ........           BL       deleteFile
   1897          		sdl=sdl->next;
   \                     ??DeleteAllMss_2:
   \   00000034   004094E5           LDR      R4,[R4, #+0]
   1898          	}
   \   00000038   000054E3           CMP      R4,#+0
   \   0000003C   F4FFFF1A           BNE      ??DeleteAllMss_1
   1899          	readAllSMS();
   \                     ??DeleteAllMss_0:
   \   00000040   1040BDE8           POP      {R4,LR}          ;; Pop
   \   00000044   ........           B        readAllSMS       ;; tailcall
   1900          }
   1901          /*
   1902          void DeleteAll(void)
   1903          {
   1904          	SMS_DATA *sdl=sdltop;
   1905          	while(sdl)
   1906          	{
   1907          		if(sdl->isfile && sdl->fname)
   1908          			deleteFile(sdl, 0);
   1909          		else if(sdl->id > 0)
   1910          			deleteDat(sdl, 0);
   1911          		sdl=sdl->next;
   1912          	}
   1913          	readAllSMS();
   1914          }
   1915          */

   \                                 In segment CODE, align 4, keep-with-next
   1916          int CovDatToTxt_ASCII(char *dat_path, char *txt_path)
   1917          {
   \                     CovDatToTxt_ASCII:
   \   00000000   F0432DE9           PUSH     {R4-R9,LR}
   \   00000004   78DF4DE2           SUB      SP,SP,#+480
   \   00000008   80DD4DE2           SUB      SP,SP,#+8192
   \   0000000C   0060A0E1           MOV      R6,R0
   \   00000010   0180A0E1           MOV      R8,R1
   1918            int fin, ft, size, res=0, len;
   \   00000014   0040A0E3           MOV      R4,#+0
   1919            unsigned int err;
   1920            char *buf;
   1921            EMS_DATA *edl=0;
   \   00000018   0010A0E3           MOV      R1,#+0
   \   0000001C   04108DE5           STR      R1,[SP, #+4]
   1922            EMS_DATA *edx;
   1923            char temp[MAX_TEXT*2+256];
   1924            char text[MAX_TEXT*2];
   1925            WSHDR *wname, nm;
   1926            unsigned short nmb[64];
   1927            char sname[65];
   1928            wname=CreateLocalWS(&nm, nmb, 64);
   \   00000020   4020A0E3           MOV      R2,#+64
   \   00000024   421F8DE2           ADD      R1,SP,#+264
   \   00000028   801D81E2           ADD      R1,R1,#+8192
   \   0000002C   730F8DE2           ADD      R0,SP,#+460
   \   00000030   800D80E2           ADD      R0,R0,#+8192
   \   00000034   270100EF           SWI      +295
   \   00000038   0050A0E1           MOV      R5,R0
   1929            if(IsFileExist(txt_path))
   \   0000003C   0800A0E1           MOV      R0,R8
   \   00000040   ........           BL       IsFileExist
   \   00000044   000050E3           CMP      R0,#+0
   1930              return -1;
   \   00000048   0400E011           MVNNE    R0,R4
   \   0000004C   2800001A           BNE      ??CovDatToTxt_ASCII_0
   1931          //  GetCPUClock();
   1932            if((fin=fopen(dat_path, A_BIN+A_ReadOnly, P_WRITE, &err))<0)
   \   00000050   0D30A0E1           MOV      R3,SP
   \   00000054   402FA0E3           MOV      R2,#+256
   \   00000058   801CA0E3           MOV      R1,#+32768
   \   0000005C   0600A0E1           MOV      R0,R6
   \   00000060   0A0000EF           SWI      +10
   \   00000064   0070B0E1           MOVS     R7,R0
   \   00000068   2000004A           BMI      ??CovDatToTxt_ASCII_1
   1933              return 0;
   1934            size=lseek(fin, 0, S_END, &err, &err)-2;
   \   0000006C   0D00A0E1           MOV      R0,SP
   \   00000070   01002DE9           PUSH     {R0}
   \   00000074   04308DE2           ADD      R3,SP,#+4
   \   00000078   0220A0E3           MOV      R2,#+2
   \   0000007C   0010A0E3           MOV      R1,#+0
   \   00000080   0700A0E1           MOV      R0,R7
   \   00000084   0F0000EF           SWI      +15
   \   00000088   029050E2           SUBS     R9,R0,#+2
   1935            if(!size)
   \   0000008C   04D08DE2           ADD      SP,SP,#+4
   \   00000090   1300000A           BEQ      ??CovDatToTxt_ASCII_2
   1936              goto EXIT2;
   1937            lseek(fin, 2, S_SET, &err, &err);
   \   00000094   0D00A0E1           MOV      R0,SP
   \   00000098   01002DE9           PUSH     {R0}
   \   0000009C   04308DE2           ADD      R3,SP,#+4
   \   000000A0   0020A0E3           MOV      R2,#+0
   \   000000A4   0210A0E3           MOV      R1,#+2
   \   000000A8   0700A0E1           MOV      R0,R7
   \   000000AC   0F0000EF           SWI      +15
   1938            buf=malloc(size);
   \   000000B0   0900A0E1           MOV      R0,R9
   \   000000B4   140000EF           SWI      +20
   \   000000B8   0060A0E1           MOV      R6,R0
   1939            if(fread(fin, buf, size, &err)!=size)
   \   000000BC   04308DE2           ADD      R3,SP,#+4
   \   000000C0   0920A0E1           MOV      R2,R9
   \   000000C4   0610A0E1           MOV      R1,R6
   \   000000C8   0700A0E1           MOV      R0,R7
   \   000000CC   0B0000EF           SWI      +11
   \   000000D0   090050E1           CMP      R0,R9
   \   000000D4   04D08DE2           ADD      SP,SP,#+4
   \   000000D8   0800000A           BEQ      ??CovDatToTxt_ASCII_3
   1940              goto EXIT3;
   1941            fclose(fin, &err);
   1942            ReadAllEMS(&edl, buf, buf+size-sizeof(PDU));
   1943            if(edl)
   1944            {
   1945              edx=edl;
   1946              if((ft=fopen(txt_path, A_WriteOnly+A_Create+A_Truncate, P_WRITE, &err))!=-1)
   1947              {
   1948                while(edx)
   1949                {
   1950          	res++;
   1951          	ws_2ascii(edx->text, text, MAX_TEXT*2);
   1952          	if(!findNameByNum(wname, edx->number))
   1953          	  strcpy(sname, lgp.LGP_UNK_NUM);
   1954          	else
   1955          	  ws_2ascii(wname, sname, 64);
   1956          	sprintf(temp, "%s: %s\r\n%s: %s\r\n%s: %s\r\n%s:\r\n%s\r\n\r\n",
   1957          		(edx->type==TYPE_OUT||edx->type==TYPE_DRAFT)?lgp.LGP_TO:lgp.LGP_FROM,
   1958          		sname,
   1959          		lgp.LGP_NUMBER,
   1960          		edx->number,
   1961          		lgp.LGP_TIME,
   1962          		(strlen(edx->time))?edx->time:lgp.LGP_UNK,
   1963          		lgp.LGP_TEXT,
   1964          		text);
   1965          	len=strlen(temp);
   1966          	if(fwrite(ft, temp, len, &err)!=len)
   1967          	  break;
   1968          	edx=edx->next;
   1969                }
   1970                fclose(ft, &err);
   1971              }
   1972            }
   1973            FreeEDL(&edl);
   1974            mfree(buf);
   1975            return res;
   1976          EXIT3:
   1977            mfree(buf);
   \   000000DC   0600A0E1           MOV      R0,R6
   \   000000E0   150000EF           SWI      +21
   1978          EXIT2:
   1979            fclose(fin, &err);
   \                     ??CovDatToTxt_ASCII_2:
   \   000000E4   0D10A0E1           MOV      R1,SP
   \   000000E8   0700A0E1           MOV      R0,R7
   \   000000EC   0D0000EF           SWI      +13
   1980            return 0;
   \                     ??CovDatToTxt_ASCII_1:
   \   000000F0   0400A0E1           MOV      R0,R4
   \                     ??CovDatToTxt_ASCII_0:
   \   000000F4   78DF8DE2           ADD      SP,SP,#+480
   \   000000F8   80DD8DE2           ADD      SP,SP,#+8192
   \   000000FC   F083BDE8           POP      {R4-R9,PC}       ;; return
   \                     ??CovDatToTxt_ASCII_3:
   \   00000100   0D10A0E1           MOV      R1,SP
   \   00000104   0700A0E1           MOV      R0,R7
   \   00000108   0D0000EF           SWI      +13
   \   0000010C   B100E0E3           MVN      R0,#+177
   \   00000110   061089E0           ADD      R1,R9,R6
   \   00000114   012080E0           ADD      R2,R0,R1
   \   00000118   0610A0E1           MOV      R1,R6
   \   0000011C   04008DE2           ADD      R0,SP,#+4
   \   00000120   ........           BL       ReadAllEMS
   \   00000124   04009DE5           LDR      R0,[SP, #+4]
   \   00000128   000050E3           CMP      R0,#+0
   \   0000012C   4B00000A           BEQ      ??CovDatToTxt_ASCII_4
   \   00000130   0070A0E1           MOV      R7,R0
   \   00000134   0D30A0E1           MOV      R3,SP
   \   00000138   402FA0E3           MOV      R2,#+256
   \   0000013C   0110A0E3           MOV      R1,#+1
   \   00000140   C01F81E3           ORR      R1,R1,#0x300
   \   00000144   0800A0E1           MOV      R0,R8
   \   00000148   0A0000EF           SWI      +10
   \   0000014C   0080A0E1           MOV      R8,R0
   \   00000150   010078E3           CMN      R8,#+1
   \   00000154   4100000A           BEQ      ??CovDatToTxt_ASCII_4
   \                     ??CovDatToTxt_ASCII_5:
   \   00000158   540097E5           LDR      R0,[R7, #+84]
   \   0000015C   ........           LDR      R9,??DataTable77  ;; lgp
   \   00000160   014084E2           ADD      R4,R4,#+1
   \   00000164   402DA0E3           MOV      R2,#+4096
   \   00000168   421F8DE2           ADD      R1,SP,#+264
   \   0000016C   401D81E2           ADD      R1,R1,#+4096
   \   00000170   ........           _BLF     ws_2ascii,??ws_2ascii??rA
   \   00000174   141087E2           ADD      R1,R7,#+20
   \   00000178   0500A0E1           MOV      R0,R5
   \   0000017C   ........           _BLF     findNameByNum,??findNameByNum??rA
   \   00000180   000050E3           CMP      R0,#+0
   \   00000184   0400001A           BNE      ??CovDatToTxt_ASCII_6
   \   00000188   101199E5           LDR      R1,[R9, #+272]
   \   0000018C   620F8DE2           ADD      R0,SP,#+392
   \   00000190   800D80E2           ADD      R0,R0,#+8192
   \   00000194   1A0000EF           SWI      +26
   \   00000198   040000EA           B        ??CovDatToTxt_ASCII_7
   \                     ??CovDatToTxt_ASCII_6:
   \   0000019C   4020A0E3           MOV      R2,#+64
   \   000001A0   621F8DE2           ADD      R1,SP,#+392
   \   000001A4   801D81E2           ADD      R1,R1,#+8192
   \   000001A8   0500A0E1           MOV      R0,R5
   \   000001AC   ........           _BLF     ws_2ascii,??ws_2ascii??rA
   \                     ??CovDatToTxt_ASCII_7:
   \   000001B0   340087E2           ADD      R0,R7,#+52
   \   000001B4   1B0000EF           SWI      +27
   \   000001B8   081097E5           LDR      R1,[R7, #+8]
   \   000001BC   000050E3           CMP      R0,#+0
   \   000001C0   20019905           LDREQ    R0,[R9, #+288]
   \   000001C4   34008712           ADDNE    R0,R7,#+52
   \   000001C8   010051E3           CMP      R1,#+1
   \   000001CC   04005113           CMPNE    R1,#+4
   \   000001D0   1C219905           LDREQ    R2,[R9, #+284]
   \   000001D4   421F8DE2           ADD      R1,SP,#+264
   \   000001D8   70209915           LDRNE    R2,[R9, #+112]
   \   000001DC   401D81E2           ADD      R1,R1,#+4096
   \   000001E0   02002DE9           PUSH     {R1}
   \   000001E4   181199E5           LDR      R1,[R9, #+280]
   \   000001E8   02002DE9           PUSH     {R1}
   \   000001EC   ........           LDR      R1,??DataTable78  ;; `?<Constant "%s: %s\\r\\n%s: %s\\r\\n%s: %...">`
   \   000001F0   01002DE9           PUSH     {R0}
   \   000001F4   0C0199E5           LDR      R0,[R9, #+268]
   \   000001F8   01002DE9           PUSH     {R0}
   \   000001FC   140087E2           ADD      R0,R7,#+20
   \   00000200   01002DE9           PUSH     {R0}
   \   00000204   140199E5           LDR      R0,[R9, #+276]
   \   00000208   01002DE9           PUSH     {R0}
   \   0000020C   683F8DE2           ADD      R3,SP,#+416
   \   00000210   803D83E2           ADD      R3,R3,#+8192
   \   00000214   20008DE2           ADD      R0,SP,#+32
   \   00000218   160000EF           SWI      +22
   \   0000021C   20008DE2           ADD      R0,SP,#+32
   \   00000220   1B0000EF           SWI      +27
   \   00000224   0090A0E1           MOV      R9,R0
   \   00000228   18308DE2           ADD      R3,SP,#+24
   \   0000022C   0920A0E1           MOV      R2,R9
   \   00000230   20108DE2           ADD      R1,SP,#+32
   \   00000234   0800A0E1           MOV      R0,R8
   \   00000238   0C0000EF           SWI      +12
   \   0000023C   090050E1           CMP      R0,R9
   \   00000240   18D08DE2           ADD      SP,SP,#+24
   \   00000244   0200001A           BNE      ??CovDatToTxt_ASCII_8
   \   00000248   007097E5           LDR      R7,[R7, #+0]
   \   0000024C   000057E3           CMP      R7,#+0
   \   00000250   C0FFFF1A           BNE      ??CovDatToTxt_ASCII_5
   \                     ??CovDatToTxt_ASCII_8:
   \   00000254   0D10A0E1           MOV      R1,SP
   \   00000258   0800A0E1           MOV      R0,R8
   \   0000025C   0D0000EF           SWI      +13
   \                     ??CovDatToTxt_ASCII_4:
   \   00000260   04008DE2           ADD      R0,SP,#+4
   \   00000264   ........           BL       FreeEDL
   \   00000268   0600A0E1           MOV      R0,R6
   \   0000026C   150000EF           SWI      +21
   \   00000270   9EFFFFEA           B        ??CovDatToTxt_ASCII_1
   1981          }
   1982          

   \                                 In segment CODE, align 4, keep-with-next
   1983          int CovDatToTxt_UTF8(char *dat_path, char *txt_path)
   1984          {
   \                     CovDatToTxt_UTF8:
   \   00000000   F0432DE9           PUSH     {R4-R9,LR}
   \   00000004   79DF4DE2           SUB      SP,SP,#+484
   \   00000008   C0DD4DE2           SUB      SP,SP,#+12288
   \   0000000C   0060A0E1           MOV      R6,R0
   \   00000010   0180A0E1           MOV      R8,R1
   1985            int fin, ft, size, res=0, len, utf8_cov_len;
   \   00000014   0040A0E3           MOV      R4,#+0
   1986            unsigned int err;
   1987            char *buf;
   1988            EMS_DATA *edl=0;
   \   00000018   0010A0E3           MOV      R1,#+0
   \   0000001C   04108DE5           STR      R1,[SP, #+4]
   1989            EMS_DATA *edx;
   1990            char temp[MAX_TEXT*3+256];
   1991            char text[MAX_TEXT*3];
   1992            WSHDR *wname, nm;
   1993            unsigned short nmb[64];
   1994            char sname[65];
   1995            wname=CreateLocalWS(&nm, nmb, 64);
   \   00000020   4020A0E3           MOV      R2,#+64
   \   00000024   431F8DE2           ADD      R1,SP,#+268
   \   00000028   C01D81E2           ADD      R1,R1,#+12288
   \   0000002C   740F8DE2           ADD      R0,SP,#+464
   \   00000030   C00D80E2           ADD      R0,R0,#+12288
   \   00000034   270100EF           SWI      +295
   \   00000038   0050A0E1           MOV      R5,R0
   1996            if(IsFileExist(txt_path))
   \   0000003C   0800A0E1           MOV      R0,R8
   \   00000040   ........           BL       IsFileExist
   \   00000044   000050E3           CMP      R0,#+0
   1997              return -1;
   \   00000048   0400E011           MVNNE    R0,R4
   \   0000004C   2800001A           BNE      ??CovDatToTxt_UTF8_0
   1998          //  GetCPUClock();
   1999            if((fin=fopen(dat_path, A_BIN+A_ReadOnly, P_WRITE, &err))<0)
   \   00000050   0D30A0E1           MOV      R3,SP
   \   00000054   402FA0E3           MOV      R2,#+256
   \   00000058   801CA0E3           MOV      R1,#+32768
   \   0000005C   0600A0E1           MOV      R0,R6
   \   00000060   0A0000EF           SWI      +10
   \   00000064   0070B0E1           MOVS     R7,R0
   \   00000068   2000004A           BMI      ??CovDatToTxt_UTF8_1
   2000              return 0;
   2001            size=lseek(fin, 0, S_END, &err, &err)-2;
   \   0000006C   0D00A0E1           MOV      R0,SP
   \   00000070   01002DE9           PUSH     {R0}
   \   00000074   04308DE2           ADD      R3,SP,#+4
   \   00000078   0220A0E3           MOV      R2,#+2
   \   0000007C   0010A0E3           MOV      R1,#+0
   \   00000080   0700A0E1           MOV      R0,R7
   \   00000084   0F0000EF           SWI      +15
   \   00000088   029050E2           SUBS     R9,R0,#+2
   2002            if(!size)
   \   0000008C   04D08DE2           ADD      SP,SP,#+4
   \   00000090   1300000A           BEQ      ??CovDatToTxt_UTF8_2
   2003              goto EXIT2;
   2004            lseek(fin, 2, S_SET, &err, &err);
   \   00000094   0D00A0E1           MOV      R0,SP
   \   00000098   01002DE9           PUSH     {R0}
   \   0000009C   04308DE2           ADD      R3,SP,#+4
   \   000000A0   0020A0E3           MOV      R2,#+0
   \   000000A4   0210A0E3           MOV      R1,#+2
   \   000000A8   0700A0E1           MOV      R0,R7
   \   000000AC   0F0000EF           SWI      +15
   2005            buf=malloc(size);
   \   000000B0   0900A0E1           MOV      R0,R9
   \   000000B4   140000EF           SWI      +20
   \   000000B8   0060A0E1           MOV      R6,R0
   2006            if(fread(fin, buf, size, &err)!=size)
   \   000000BC   04308DE2           ADD      R3,SP,#+4
   \   000000C0   0920A0E1           MOV      R2,R9
   \   000000C4   0610A0E1           MOV      R1,R6
   \   000000C8   0700A0E1           MOV      R0,R7
   \   000000CC   0B0000EF           SWI      +11
   \   000000D0   090050E1           CMP      R0,R9
   \   000000D4   04D08DE2           ADD      SP,SP,#+4
   \   000000D8   0800000A           BEQ      ??CovDatToTxt_UTF8_3
   2007              goto EXIT3;
   2008            fclose(fin, &err);
   2009            ReadAllEMS(&edl, buf, buf+size-sizeof(PDU));
   2010            if(edl)
   2011            {
   2012              edx=edl;
   2013              if((ft=fopen(txt_path, A_WriteOnly+A_Create+A_Truncate, P_WRITE, &err))!=-1)
   2014              {
   2015                temp[0]=0xEF;
   2016                temp[1]=0xBB;
   2017                temp[2]=0xBF;
   2018                if(fwrite(ft, temp, 3, &err)==3)
   2019                {
   2020                while(edx)
   2021                {
   2022          	res++;
   2023          	ws_2utf8(edx->text, text, &utf8_cov_len, MAX_TEXT*3);
   2024          	if(!findNameByNum(wname, edx->number))
   2025          	  strcpy(sname, STR_UNK_NUM_UTF8);
   2026          	else
   2027          	  ws_2utf8(wname, sname, &utf8_cov_len, 64);
   2028          	sprintf(temp, "%s: %s\r\n%s: %s\r\n%s: %s\r\n%s:\r\n%s\r\n\r\n",
   2029          		(edx->type==TYPE_OUT||edx->type==TYPE_DRAFT)?STR_TO_UTF8:STR_FROM_UTF8,
   2030          		sname,
   2031          		STR_NUMBER_UTF8,
   2032          		edx->number,
   2033          		STR_TIME_UTF8,
   2034          		(strlen(edx->time))?edx->time:STR_UNK_UTF8,
   2035          		STR_TEXT_UTF8,
   2036          		text);
   2037          	len=strlen(temp);
   2038          	if(fwrite(ft, temp, len, &err)!=len)
   2039          	  break;
   2040          	edx=edx->next;
   2041                }
   2042                }
   2043                fclose(ft, &err);
   2044              }
   2045            }
   2046            FreeEDL(&edl);
   2047            mfree(buf);
   2048            return res;
   2049          EXIT3:
   2050            mfree(buf);
   \   000000DC   0600A0E1           MOV      R0,R6
   \   000000E0   150000EF           SWI      +21
   2051          EXIT2:
   2052            fclose(fin, &err);
   \                     ??CovDatToTxt_UTF8_2:
   \   000000E4   0D10A0E1           MOV      R1,SP
   \   000000E8   0700A0E1           MOV      R0,R7
   \   000000EC   0D0000EF           SWI      +13
   2053            return 0;
   \                     ??CovDatToTxt_UTF8_1:
   \   000000F0   0400A0E1           MOV      R0,R4
   \                     ??CovDatToTxt_UTF8_0:
   \   000000F4   79DF8DE2           ADD      SP,SP,#+484
   \   000000F8   C0DD8DE2           ADD      SP,SP,#+12288
   \   000000FC   F083BDE8           POP      {R4-R9,PC}       ;; return
   \                     ??CovDatToTxt_UTF8_3:
   \   00000100   0D10A0E1           MOV      R1,SP
   \   00000104   0700A0E1           MOV      R0,R7
   \   00000108   0D0000EF           SWI      +13
   \   0000010C   B100E0E3           MVN      R0,#+177
   \   00000110   061089E0           ADD      R1,R9,R6
   \   00000114   012080E0           ADD      R2,R0,R1
   \   00000118   0610A0E1           MOV      R1,R6
   \   0000011C   04008DE2           ADD      R0,SP,#+4
   \   00000120   ........           BL       ReadAllEMS
   \   00000124   04009DE5           LDR      R0,[SP, #+4]
   \   00000128   000050E3           CMP      R0,#+0
   \   0000012C   5800000A           BEQ      ??CovDatToTxt_UTF8_4
   \   00000130   0070A0E1           MOV      R7,R0
   \   00000134   0D30A0E1           MOV      R3,SP
   \   00000138   402FA0E3           MOV      R2,#+256
   \   0000013C   0110A0E3           MOV      R1,#+1
   \   00000140   C01F81E3           ORR      R1,R1,#0x300
   \   00000144   0800A0E1           MOV      R0,R8
   \   00000148   0A0000EF           SWI      +10
   \   0000014C   0080A0E1           MOV      R8,R0
   \   00000150   010078E3           CMN      R8,#+1
   \   00000154   4E00000A           BEQ      ??CovDatToTxt_UTF8_4
   \   00000158   EF10A0E3           MOV      R1,#+239
   \   0000015C   0C10CDE5           STRB     R1,[SP, #+12]
   \   00000160   BB10A0E3           MOV      R1,#+187
   \   00000164   0D10CDE5           STRB     R1,[SP, #+13]
   \   00000168   BF10A0E3           MOV      R1,#+191
   \   0000016C   0E10CDE5           STRB     R1,[SP, #+14]
   \   00000170   0D30A0E1           MOV      R3,SP
   \   00000174   0320A0E3           MOV      R2,#+3
   \   00000178   0C108DE2           ADD      R1,SP,#+12
   \   0000017C   0C0000EF           SWI      +12
   \   00000180   030050E3           CMP      R0,#+3
   \   00000184   3F00001A           BNE      ??CovDatToTxt_UTF8_5
   \                     ??CovDatToTxt_UTF8_6:
   \   00000188   540097E5           LDR      R0,[R7, #+84]
   \   0000018C   014084E2           ADD      R4,R4,#+1
   \   00000190   603DA0E3           MOV      R3,#+6144
   \   00000194   08208DE2           ADD      R2,SP,#+8
   \   00000198   431F8DE2           ADD      R1,SP,#+268
   \   0000019C   601D81E2           ADD      R1,R1,#+6144
   \   000001A0   E20100EF           SWI      +482
   \   000001A4   141087E2           ADD      R1,R7,#+20
   \   000001A8   0500A0E1           MOV      R0,R5
   \   000001AC   ........           _BLF     findNameByNum,??findNameByNum??rA
   \   000001B0   000050E3           CMP      R0,#+0
   \   000001B4   0400001A           BNE      ??CovDatToTxt_UTF8_7
   \   000001B8   ........           LDR      R1,??DataTable79  ;; STR_UNK_NUM_UTF8
   \   000001BC   630F8DE2           ADD      R0,SP,#+396
   \   000001C0   C00D80E2           ADD      R0,R0,#+12288
   \   000001C4   1A0000EF           SWI      +26
   \   000001C8   050000EA           B        ??CovDatToTxt_UTF8_8
   \                     ??CovDatToTxt_UTF8_7:
   \   000001CC   4030A0E3           MOV      R3,#+64
   \   000001D0   08208DE2           ADD      R2,SP,#+8
   \   000001D4   631F8DE2           ADD      R1,SP,#+396
   \   000001D8   C01D81E2           ADD      R1,R1,#+12288
   \   000001DC   0500A0E1           MOV      R0,R5
   \   000001E0   E20100EF           SWI      +482
   \                     ??CovDatToTxt_UTF8_8:
   \   000001E4   340087E2           ADD      R0,R7,#+52
   \   000001E8   1B0000EF           SWI      +27
   \   000001EC   081097E5           LDR      R1,[R7, #+8]
   \   000001F0   000050E3           CMP      R0,#+0
   \   000001F4   ........           LDREQ    R0,??DataTable80  ;; STR_UNK_UTF8
   \   000001F8   34008712           ADDNE    R0,R7,#+52
   \   000001FC   010051E3           CMP      R1,#+1
   \   00000200   04005113           CMPNE    R1,#+4
   \   00000204   ........           LDREQ    R2,??DataTable81  ;; STR_TO_UTF8
   \   00000208   431F8DE2           ADD      R1,SP,#+268
   \   0000020C   ........           LDRNE    R2,??DataTable82  ;; STR_FROM_UTF8
   \   00000210   601D81E2           ADD      R1,R1,#+6144
   \   00000214   02002DE9           PUSH     {R1}
   \   00000218   ........           LDR      R1,??DataTable83  ;; STR_TEXT_UTF8
   \   0000021C   02002DE9           PUSH     {R1}
   \   00000220   ........           LDR      R1,??DataTable84  ;; `?<Constant "%s: %s\\r\\n%s: %s\\r\\n%s: %...">`
   \   00000224   01002DE9           PUSH     {R0}
   \   00000228   ........           LDR      R0,??DataTable85  ;; STR_TIME_UTF8
   \   0000022C   01002DE9           PUSH     {R0}
   \   00000230   140087E2           ADD      R0,R7,#+20
   \   00000234   01002DE9           PUSH     {R0}
   \   00000238   ........           LDR      R0,??DataTable86  ;; STR_NUMBER_UTF8
   \   0000023C   01002DE9           PUSH     {R0}
   \   00000240   693F8DE2           ADD      R3,SP,#+420
   \   00000244   C03D83E2           ADD      R3,R3,#+12288
   \   00000248   24008DE2           ADD      R0,SP,#+36
   \   0000024C   160000EF           SWI      +22
   \   00000250   24008DE2           ADD      R0,SP,#+36
   \   00000254   1B0000EF           SWI      +27
   \   00000258   0090A0E1           MOV      R9,R0
   \   0000025C   18308DE2           ADD      R3,SP,#+24
   \   00000260   0920A0E1           MOV      R2,R9
   \   00000264   24108DE2           ADD      R1,SP,#+36
   \   00000268   0800A0E1           MOV      R0,R8
   \   0000026C   0C0000EF           SWI      +12
   \   00000270   090050E1           CMP      R0,R9
   \   00000274   18D08DE2           ADD      SP,SP,#+24
   \   00000278   0200001A           BNE      ??CovDatToTxt_UTF8_5
   \   0000027C   007097E5           LDR      R7,[R7, #+0]
   \   00000280   000057E3           CMP      R7,#+0
   \   00000284   BFFFFF1A           BNE      ??CovDatToTxt_UTF8_6
   \                     ??CovDatToTxt_UTF8_5:
   \   00000288   0D10A0E1           MOV      R1,SP
   \   0000028C   0800A0E1           MOV      R0,R8
   \   00000290   0D0000EF           SWI      +13
   \                     ??CovDatToTxt_UTF8_4:
   \   00000294   04008DE2           ADD      R0,SP,#+4
   \   00000298   ........           BL       FreeEDL
   \   0000029C   0600A0E1           MOV      R0,R6
   \   000002A0   150000EF           SWI      +21
   \   000002A4   91FFFFEA           B        ??CovDatToTxt_UTF8_1
   2054          }
   2055          

   \                                 In segment CODE, align 4, keep-with-next
   2056          int CovDatToTxt(char *dat_path, char *txt_path)
   2057          {
   2058            if (CFG_EXPORT_CHARSET==CHARSET_ASCII)
   \                     CovDatToTxt:
   \   00000000   ........           LDR      R2,??DataTable87  ;; CFG_EXPORT_CHARSET
   \   00000004   002092E5           LDR      R2,[R2, #+0]
   \   00000008   000052E3           CMP      R2,#+0
   \   0000000C   0000001A           BNE      ??CovDatToTxt_0
   2059              return (CovDatToTxt_ASCII(dat_path, txt_path));
   \   00000010   ........           B        CovDatToTxt_ASCII  ;; tailcall
   2060            else if (CFG_EXPORT_CHARSET==CHARSET_UTF8)
   \                     ??CovDatToTxt_0:
   \   00000014   010052E3           CMP      R2,#+1
   \   00000018   0000001A           BNE      ??CovDatToTxt_1
   2061              return (CovDatToTxt_UTF8(dat_path, txt_path));
   \   0000001C   ........           B        CovDatToTxt_UTF8  ;; tailcall
   2062            return 0;
   \                     ??CovDatToTxt_1:
   \   00000020   0000A0E3           MOV      R0,#+0
   \   00000024   1EFF2FE1           BX       LR
   2063          }
   2064          

   \                                 In segment CODE, align 4, keep-with-next
   2065          SMS_DATA *FindNextMss(SMS_DATA *sd)
   2066          {
   \                     FindNextMss:
   \   00000000   F0412DE9           PUSH     {R4-R8,LR}
   \   00000004   C8D04DE2           SUB      SP,SP,#+200
   \   00000008   40DE4DE2           SUB      SP,SP,#+1024
   2067            char folder[128];
   2068            char filename[128];
   2069            char dir[128];
   2070            char *p;
   2071            unsigned int err;
   2072            int is_find=0, len;
   2073            SMS_DATA *sdx=0;
   2074            DIR_ENTRY de;
   2075            char *pp=sd->fname;
   \   0000000C   207090E5           LDR      R7,[R0, #+32]
   2076          //  GetCPUClock();
   2077            if (!sd || !sd->isfile || !pp)
   \   00000010   000050E3           CMP      R0,#+0
   \   00000014   14009015           LDRNE    R0,[R0, #+20]
   \   00000018   0050A0E3           MOV      R5,#+0
   \   0000001C   0040A0E3           MOV      R4,#+0
   \   00000020   0460A0E1           MOV      R6,R4
   \   00000024   00005013           CMPNE    R0,#+0
   \   00000028   5800000A           BEQ      ??FindNextMss_0
   \   0000002C   000057E3           CMP      R7,#+0
   \   00000030   0300001A           BNE      ??FindNextMss_1
   2078              return 0;
   \                     ??FindNextMss_2:
   \   00000034   0000A0E3           MOV      R0,#+0
   \   00000038   C8D08DE2           ADD      SP,SP,#+200
   \   0000003C   40DE8DE2           ADD      SP,SP,#+1024
   \   00000040   F081BDE8           POP      {R4-R8,PC}
   2079            if(!(p=strrchr(pp, '\\')) && !(p=strrchr(pp, '/')))
   \                     ??FindNextMss_1:
   \   00000044   5C10A0E3           MOV      R1,#+92
   \   00000048   0700A0E1           MOV      R0,R7
   \   0000004C   170100EF           SWI      +279
   \   00000050   0080B0E1           MOVS     R8,R0
   \   00000054   0400001A           BNE      ??FindNextMss_3
   \   00000058   2F10A0E3           MOV      R1,#+47
   \   0000005C   0700A0E1           MOV      R0,R7
   \   00000060   170100EF           SWI      +279
   \   00000064   0080B0E1           MOVS     R8,R0
   \   00000068   F1FFFF0A           BEQ      ??FindNextMss_2
   2080              return 0;
   2081            strncpy(folder, pp, p-pp+1);
   \                     ??FindNextMss_3:
   \   0000006C   070048E0           SUB      R0,R8,R7
   \   00000070   012080E2           ADD      R2,R0,#+1
   \   00000074   0710A0E1           MOV      R1,R7
   \   00000078   D20F8DE2           ADD      R0,SP,#+840
   \   0000007C   160100EF           SWI      +278
   2082            if(!isdir(folder, &err))
   \   00000080   0D10A0E1           MOV      R1,SP
   \   00000084   D20F8DE2           ADD      R0,SP,#+840
   \   00000088   910000EF           SWI      +145
   \   0000008C   000050E3           CMP      R0,#+0
   \   00000090   3E00000A           BEQ      ??FindNextMss_0
   2083              return 0;
   2084            strcpy(filename, p+1);
   \   00000094   011088E2           ADD      R1,R8,#+1
   \   00000098   F20F8DE2           ADD      R0,SP,#+968
   \   0000009C   1A0000EF           SWI      +26
   2085            strcpy(dir, folder);
   \   000000A0   D21F8DE2           ADD      R1,SP,#+840
   \   000000A4   48008DE2           ADD      R0,SP,#+72
   \   000000A8   400E80E2           ADD      R0,R0,#+1024
   \   000000AC   1A0000EF           SWI      +26
   2086            strcat(dir, "*.mss");
   \   000000B0   ........           LDR      R1,??DataTable88  ;; `?<Constant {0}>` + 128
   \   000000B4   48008DE2           ADD      R0,SP,#+72
   \   000000B8   400E80E2           ADD      R0,R0,#+1024
   \   000000BC   170000EF           SWI      +23
   2087            if(FindFirstFile(&de, dir, &err))
   \   000000C0   0D20A0E1           MOV      R2,SP
   \   000000C4   48108DE2           ADD      R1,SP,#+72
   \   000000C8   401E81E2           ADD      R1,R1,#+1024
   \   000000CC   04008DE2           ADD      R0,SP,#+4
   \   000000D0   6B0000EF           SWI      +107
   \   000000D4   000050E3           CMP      R0,#+0
   \   000000D8   2800000A           BEQ      ??FindNextMss_4
   2088            {
   2089              do
   2090              {
   2091                if(is_find)
   2092                {
   2093          	strcpy(filename, de.folder_name);
   2094          	len=strlen(filename);
   2095          	if(filename[len-1]!='\\'&&filename[len-1]!='/')
   2096          	{
   2097          	  filename[len++]='\\';
   2098          	  filename[len]='\0';
   2099          	}
   2100          	strcat(filename, de.file_name);
   2101          	sdx=malloc(sizeof(SMS_DATA));
   2102          	zeromem(sdx, sizeof(SMS_DATA));
   2103          	if(!ReadMSS(filename, sdx))
   2104          	{
   2105          	  FreeSdOne(sdx);
   2106          	  sdx=0;
   2107          	}
   2108          	break;
   2109                }
   2110                if(!strcmp(de.file_name, filename))
   \                     ??FindNextMss_5:
   \   000000DC   F21F8DE2           ADD      R1,SP,#+968
   \   000000E0   B9008DE2           ADD      R0,SP,#+185
   \   000000E4   190000EF           SWI      +25
   \   000000E8   000050E3           CMP      R0,#+0
   2111          	is_find=1;
   \   000000EC   0150A003           MOVEQ    R5,#+1
   2112              }while(FindNextFile(&de, &err));
   \   000000F0   0D10A0E1           MOV      R1,SP
   \   000000F4   04008DE2           ADD      R0,SP,#+4
   \   000000F8   6C0000EF           SWI      +108
   \   000000FC   000050E3           CMP      R0,#+0
   \   00000100   1E00000A           BEQ      ??FindNextMss_4
   \   00000104   000055E3           CMP      R5,#+0
   \   00000108   F3FFFF0A           BEQ      ??FindNextMss_5
   \   0000010C   38108DE2           ADD      R1,SP,#+56
   \   00000110   F20F8DE2           ADD      R0,SP,#+968
   \   00000114   1A0000EF           SWI      +26
   \   00000118   F20F8DE2           ADD      R0,SP,#+968
   \   0000011C   1B0000EF           SWI      +27
   \   00000120   F21F8DE2           ADD      R1,SP,#+968
   \   00000124   010080E0           ADD      R0,R0,R1
   \   00000128   011050E5           LDRB     R1,[R0, #-1]
   \   0000012C   5C0051E3           CMP      R1,#+92
   \   00000130   2F005113           CMPNE    R1,#+47
   \   00000134   5C10A013           MOVNE    R1,#+92
   \   00000138   0010C015           STRBNE   R1,[R0, #+0]
   \   0000013C   0140C015           STRBNE   R4,[R0, #+1]
   \   00000140   B9108DE2           ADD      R1,SP,#+185
   \   00000144   F20F8DE2           ADD      R0,SP,#+968
   \   00000148   170000EF           SWI      +23
   \   0000014C   6800A0E3           MOV      R0,#+104
   \   00000150   140000EF           SWI      +20
   \   00000154   0060A0E1           MOV      R6,R0
   \   00000158   6810A0E3           MOV      R1,#+104
   \   0000015C   1D0100EF           SWI      +285
   \   00000160   0610A0E1           MOV      R1,R6
   \   00000164   F20F8DE2           ADD      R0,SP,#+968
   \   00000168   ........           BL       ReadMSS
   \   0000016C   000050E3           CMP      R0,#+0
   \   00000170   0200001A           BNE      ??FindNextMss_4
   \   00000174   0600A0E1           MOV      R0,R6
   \   00000178   ........           BL       FreeSdOne
   \   0000017C   0060A0E3           MOV      R6,#+0
   2113            }
   2114            FindClose(&de, &err);
   \                     ??FindNextMss_4:
   \   00000180   0D10A0E1           MOV      R1,SP
   \   00000184   04008DE2           ADD      R0,SP,#+4
   \   00000188   6D0000EF           SWI      +109
   2115            return sdx;
   \   0000018C   0600A0E1           MOV      R0,R6
   \                     ??FindNextMss_0:
   \   00000190   C8D08DE2           ADD      SP,SP,#+200
   \   00000194   40DE8DE2           ADD      SP,SP,#+1024
   \   00000198   F081BDE8           POP      {R4-R8,PC}       ;; return
   2116          }
   2117          

   \                                 In segment CODE, align 4, keep-with-next
   2118          SMS_DATA *FindPrevMss(SMS_DATA *sd)
   2119          {
   \                     FindPrevMss:
   \   00000000   F0412DE9           PUSH     {R4-R8,LR}
   2120            char folder[128];
   2121            char filename[128];
   2122            char dir[128];
   2123            char temp[128]={0};
   \   00000004   D0419FE5           LDR      R4,??FindPrevMss_0  ;; `?<Constant {0}>`
   \   00000008   52DF4DE2           SUB      SP,SP,#+328
   \   0000000C   40DE4DE2           SUB      SP,SP,#+1024
   \   00000010   C8108DE2           ADD      R1,SP,#+200
   \   00000014   401E81E2           ADD      R1,R1,#+1024
   \   00000018   8030A0E3           MOV      R3,#+128
   \                     ??FindPrevMss_1:
   \   0000001C   043053E2           SUBS     R3,R3,#+4
   \   00000020   032094E7           LDR      R2,[R4, R3]
   \   00000024   032081E7           STR      R2,[R1, R3]
   \   00000028   FBFFFF1A           BNE      ??FindPrevMss_1
   2124            char *p;
   2125            unsigned int err;
   2126            int len;
   2127            SMS_DATA *sdx=0;
   2128            DIR_ENTRY de;
   2129            char *pp=sd->fname;
   \   0000002C   207090E5           LDR      R7,[R0, #+32]
   2130          //  GetCPUClock();
   2131            if (!sd || !sd->isfile || !pp)
   \   00000030   000050E3           CMP      R0,#+0
   \   00000034   14009015           LDRNE    R0,[R0, #+20]
   \   00000038   0050A0E3           MOV      R5,#+0
   \   0000003C   0060A0E3           MOV      R6,#+0
   \   00000040   00005013           CMPNE    R0,#+0
   \   00000044   6100000A           BEQ      ??FindPrevMss_2
   \   00000048   000057E3           CMP      R7,#+0
   \   0000004C   0300001A           BNE      ??FindPrevMss_3
   2132              return 0;
   \                     ??FindPrevMss_4:
   \   00000050   0000A0E3           MOV      R0,#+0
   \   00000054   52DF8DE2           ADD      SP,SP,#+328
   \   00000058   40DE8DE2           ADD      SP,SP,#+1024
   \   0000005C   F081BDE8           POP      {R4-R8,PC}
   2133            if(!(p=strrchr(pp, '\\')) && !(p=strrchr(pp, '/')))
   \                     ??FindPrevMss_3:
   \   00000060   5C10A0E3           MOV      R1,#+92
   \   00000064   0700A0E1           MOV      R0,R7
   \   00000068   170100EF           SWI      +279
   \   0000006C   0080B0E1           MOVS     R8,R0
   \   00000070   0400001A           BNE      ??FindPrevMss_5
   \   00000074   2F10A0E3           MOV      R1,#+47
   \   00000078   0700A0E1           MOV      R0,R7
   \   0000007C   170100EF           SWI      +279
   \   00000080   0080B0E1           MOVS     R8,R0
   \   00000084   F1FFFF0A           BEQ      ??FindPrevMss_4
   2134              return 0;
   2135            strncpy(folder, pp, p-pp+1);
   \                     ??FindPrevMss_5:
   \   00000088   070048E0           SUB      R0,R8,R7
   \   0000008C   012080E2           ADD      R2,R0,#+1
   \   00000090   0710A0E1           MOV      R1,R7
   \   00000094   D20F8DE2           ADD      R0,SP,#+840
   \   00000098   160100EF           SWI      +278
   2136            if(!isdir(folder, &err))
   \   0000009C   0D10A0E1           MOV      R1,SP
   \   000000A0   D20F8DE2           ADD      R0,SP,#+840
   \   000000A4   910000EF           SWI      +145
   \   000000A8   000050E3           CMP      R0,#+0
   \   000000AC   4700000A           BEQ      ??FindPrevMss_2
   2137              return 0;
   2138            strcpy(filename, p+1);
   \   000000B0   011088E2           ADD      R1,R8,#+1
   \   000000B4   F20F8DE2           ADD      R0,SP,#+968
   \   000000B8   1A0000EF           SWI      +26
   2139            strcpy(dir, folder);
   \   000000BC   D21F8DE2           ADD      R1,SP,#+840
   \   000000C0   48008DE2           ADD      R0,SP,#+72
   \   000000C4   400E80E2           ADD      R0,R0,#+1024
   \   000000C8   1A0000EF           SWI      +26
   2140            strcat(dir, "*.mss");
   \   000000CC   801084E2           ADD      R1,R4,#+128
   \   000000D0   48008DE2           ADD      R0,SP,#+72
   \   000000D4   400E80E2           ADD      R0,R0,#+1024
   \   000000D8   170000EF           SWI      +23
   2141            if(FindFirstFile(&de, dir, &err))
   \   000000DC   0D20A0E1           MOV      R2,SP
   \   000000E0   48108DE2           ADD      R1,SP,#+72
   \   000000E4   401E81E2           ADD      R1,R1,#+1024
   \   000000E8   04008DE2           ADD      R0,SP,#+4
   \   000000EC   6B0000EF           SWI      +107
   \   000000F0   000050E3           CMP      R0,#+0
   \   000000F4   3100000A           BEQ      ??FindPrevMss_6
   2142            {
   2143              do
   2144              {
   2145                if(!strcmp(de.file_name, filename))
   \                     ??FindPrevMss_7:
   \   000000F8   F21F8DE2           ADD      R1,SP,#+968
   \   000000FC   B9008DE2           ADD      R0,SP,#+185
   \   00000100   190000EF           SWI      +25
   \   00000104   000050E3           CMP      R0,#+0
   \   00000108   2300001A           BNE      ??FindPrevMss_8
   2146                {
   2147          	if(!strlen(temp))
   \   0000010C   C8008DE2           ADD      R0,SP,#+200
   \   00000110   400E80E2           ADD      R0,R0,#+1024
   \   00000114   1B0000EF           SWI      +27
   \   00000118   000050E3           CMP      R0,#+0
   \   0000011C   2700000A           BEQ      ??FindPrevMss_6
   2148          	  break;
   2149          	strcpy(filename, de.folder_name);
   \   00000120   38108DE2           ADD      R1,SP,#+56
   \   00000124   F20F8DE2           ADD      R0,SP,#+968
   \   00000128   1A0000EF           SWI      +26
   2150          	len=strlen(filename);
   \   0000012C   F20F8DE2           ADD      R0,SP,#+968
   \   00000130   1B0000EF           SWI      +27
   2151          	if(filename[len-1]!='\\'&&filename[len-1]!='/')
   \   00000134   F21F8DE2           ADD      R1,SP,#+968
   \   00000138   010080E0           ADD      R0,R0,R1
   \   0000013C   011050E5           LDRB     R1,[R0, #-1]
   \   00000140   5C0051E3           CMP      R1,#+92
   \   00000144   2F005113           CMPNE    R1,#+47
   2152          	{
   2153          	  filename[len++]='\\';
   \   00000148   5C10A013           MOVNE    R1,#+92
   \   0000014C   0010C015           STRBNE   R1,[R0, #+0]
   2154          	  filename[len]='\0';
   \   00000150   0150C015           STRBNE   R5,[R0, #+1]
   2155          	}
   2156          	strcat(filename, temp);
   \   00000154   C8108DE2           ADD      R1,SP,#+200
   \   00000158   401E81E2           ADD      R1,R1,#+1024
   \   0000015C   F20F8DE2           ADD      R0,SP,#+968
   \   00000160   170000EF           SWI      +23
   2157          	sdx=malloc(sizeof(SMS_DATA));
   \   00000164   6800A0E3           MOV      R0,#+104
   \   00000168   140000EF           SWI      +20
   \   0000016C   0060A0E1           MOV      R6,R0
   2158          	zeromem(sdx, sizeof(SMS_DATA));
   \   00000170   6810A0E3           MOV      R1,#+104
   \   00000174   1D0100EF           SWI      +285
   2159          	if(!ReadMSS(filename, sdx))
   \   00000178   0610A0E1           MOV      R1,R6
   \   0000017C   F20F8DE2           ADD      R0,SP,#+968
   \   00000180   ........           BL       ReadMSS
   \   00000184   000050E3           CMP      R0,#+0
   \   00000188   0C00001A           BNE      ??FindPrevMss_6
   2160          	{
   2161          	  FreeSdOne(sdx);
   \   0000018C   0600A0E1           MOV      R0,R6
   \   00000190   ........           BL       FreeSdOne
   2162          	  sdx=0;
   \   00000194   0060A0E3           MOV      R6,#+0
   \   00000198   080000EA           B        ??FindPrevMss_6
   2163          	}
   2164          	break;
   2165                }
   2166                strcpy(temp, de.file_name);
   \                     ??FindPrevMss_8:
   \   0000019C   B9108DE2           ADD      R1,SP,#+185
   \   000001A0   C8008DE2           ADD      R0,SP,#+200
   \   000001A4   400E80E2           ADD      R0,R0,#+1024
   \   000001A8   1A0000EF           SWI      +26
   2167              }while(FindNextFile(&de, &err));
   \   000001AC   0D10A0E1           MOV      R1,SP
   \   000001B0   04008DE2           ADD      R0,SP,#+4
   \   000001B4   6C0000EF           SWI      +108
   \   000001B8   000050E3           CMP      R0,#+0
   \   000001BC   CDFFFF1A           BNE      ??FindPrevMss_7
   2168            }
   2169            FindClose(&de, &err);
   \                     ??FindPrevMss_6:
   \   000001C0   0D10A0E1           MOV      R1,SP
   \   000001C4   04008DE2           ADD      R0,SP,#+4
   \   000001C8   6D0000EF           SWI      +109
   2170            return sdx;
   \   000001CC   0600A0E1           MOV      R0,R6
   \                     ??FindPrevMss_2:
   \   000001D0   52DF8DE2           ADD      SP,SP,#+328
   \   000001D4   40DE8DE2           ADD      SP,SP,#+1024
   \   000001D8   F081BDE8           POP      {R4-R8,PC}       ;; return
   \                     ??FindPrevMss_0:
   \   000001DC   ........           DC32     `?<Constant {0}>`
   2171          }

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable7:
   \   00000000   ........           DC32     sdltop

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable10:
   \   00000000   ........           DC32     `?<Constant "%04d%02d%02d%02d%02d%02d">`

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable16:
   \   00000000   ........           DC32     ELFNAME

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable17:
   \   00000000   D34D6210           DC32     0x10624dd3

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable18:
   \   00000000   ........           DC32     `?<Constant "%02d-%02d-%02d %02d:%...">`

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable19:
   \   00000000   ........           DC32     FLDR_DRAFT

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable20:
   \   00000000   ........           DC32     FLDR_OUT

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable21:
   \   00000000   ........           DC32     FLDR_IN

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable22:
   \   00000000   ........           DC32     FLDR_UNK

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable23:
   \   00000000   ........           DC32     CFG_MAIN_FOLDER

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable24:
   \   00000000   ........           DC32     `?<Constant {0}>` + 128

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable25:
   \   00000000   ........           DC32     new_sms_n

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable29:
   \   00000000   ........           DC32     STR_UNK_TXTT

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable30:
   \   00000000   ........           DC32     STR_UNK_TYPE

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable31:
   \   00000000   ........           DC32     STR_UNK_TXTT

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable34:
   \   00000000   ........           DC32     ELFNAME

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable37:
   \   00000000   ........           DC32     `?<Constant "%04d%02d%02d%02d%02d%02d">`

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable45:
   \   00000000   ........           DC32     sdltop

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable55:
   \   00000000   ........           DC32     `?<Constant "Text\\\\">`

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable65:
   \   00000000   ........           DC32     CFG_MAIN_FOLDER

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable66:
   \   00000000   ........           DC32     `?<Constant "%02d-%02d-%02d %02d:%...">`

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable67:
   \   00000000   ........           DC32     FLDR_DRAFT

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable68:
   \   00000000   ........           DC32     FLDR_OUT

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable69:
   \   00000000   ........           DC32     FLDR_IN

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable70:
   \   00000000   ........           DC32     FLDR_UNK

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable71:
   \   00000000   ........           DC32     ELFNAME

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable72:
   \   00000000   D34D6210           DC32     0x10624dd3

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable75:
   \   00000000   ........           DC32     lgp

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable76:
   \   00000000   ........           DC32     sdltop

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable77:
   \   00000000   ........           DC32     lgp

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable78:
   \   00000000   ........           DC32     `?<Constant "%s: %s\\r\\n%s: %s\\r\\n%s: %...">`

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable79:
   \   00000000   ........           DC32     STR_UNK_NUM_UTF8

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable80:
   \   00000000   ........           DC32     STR_UNK_UTF8

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable81:
   \   00000000   ........           DC32     STR_TO_UTF8

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable82:
   \   00000000   ........           DC32     STR_FROM_UTF8

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable83:
   \   00000000   ........           DC32     STR_TEXT_UTF8

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable84:
   \   00000000   ........           DC32     `?<Constant "%s: %s\\r\\n%s: %s\\r\\n%s: %...">`

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable85:
   \   00000000   ........           DC32     STR_TIME_UTF8

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable86:
   \   00000000   ........           DC32     STR_NUMBER_UTF8

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable87:
   \   00000000   ........           DC32     CFG_EXPORT_CHARSET

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable88:
   \   00000000   ........           DC32     `?<Constant {0}>` + 128

   \                                 In segment DATA_C, align 4, align-sorted
   \                     `?<Constant "%04d%02d%02d%02d%02d%02d">`:
   \   00000000   253034642530       DC8 "%04d%02d%02d%02d%02d%02d"
   \              326425303264
   \              253032642530
   \              326425303264
   \              00          
   \   00000019   000000             DC8 0, 0, 0
   \   0000001C   2E6D737300         DC8 ".mss"
   \   00000021   000000             DC8 0, 0, 0
   \   00000024   257325735F25       DC8 "%s%s_%04d%s"
   \              303464257300
   \   00000030   25735F257300       DC8 "%s_%s"
   \   00000036   0000               DC8 0, 0
   \   00000038   25735F253032       DC8 "%s_%02d-%02d-%02d %02d%02d%02d"
   \              642D25303264
   \              2D2530326420
   \              253032642530
   \              326425303264
   \              00          
   \   00000057   00                 DC8 0
   \   00000058   2E74787400         DC8 ".txt"
   \   0000005D   000000             DC8 0, 0, 0

   \                                 In segment DATA_C, align 4, align-sorted
   \                     `?<Constant "%02d-%02d-%02d %02d:%...">`:
   \   00000000   253032642D25       DC8 "%02d-%02d-%02d %02d:%02d:%02d"
   \              3032642D2530
   \              326420253032
   \              643A25303264
   \              3A2530326400
   \   0000001E   0000               DC8 0, 0
   \   00000020   253034642530       DC8 "%04d%02d\\"
   \              32645C00    
   \   0000002A   0000               DC8 0, 0

   \                                 In segment DATA_C, align 4, align-sorted
   \                     `?<Constant {0}>`:
   \   00000000   000000000000       DC8 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
   \              000000000000
   \              0000000000  
   \   00000011   000000000000       DC8 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
   \              000000000000
   \              00000000    
   \   00000021   000000000000       DC8 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
   \              000000000000
   \              00000000    
   \   00000031   000000000000       DC8 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
   \              000000000000
   \              00000000    
   \   00000041   000000000000       DC8 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
   \              000000000000
   \              00000000    
   \   00000051   000000000000       DC8 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
   \              000000000000
   \              00000000    
   \   00000061   000000000000       DC8 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
   \              000000000000
   \              00000000    
   \   00000071   000000000000       DC8 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
   \              000000000000
   \              000000      
   \   00000080   2A2E6D737300       DC8 "*.mss"
   \   00000086   0000               DC8 0, 0

   \                                 In segment DATA_C, align 4, align-sorted
   \   00000000   556E6B00           DC8 "Unk"

   \                                 In segment DATA_C, align 4, align-sorted
   \                     `?<Constant "%s: %s\\r\\n%s: %s\\r\\n%s: %...">`:
   \   00000000   25733A202573       DC8 "%s: %s\015\012%s: %s\015\012%s: %s\015\012%s:\015\012%s\015\012\015\012"
   \              0D0A25733A20
   \              25730D0A2573
   \              3A2025730D0A
   \              25733A0D0A25
   \              730D0A0D0A00

   \                                 In segment DATA_C, align 4, align-sorted
   \                     `?<Constant "Text\\\\">`:
   \   00000000   546578745C00       DC8 "Text\\"
   \   00000006   0000               DC8 0, 0
   \   00000008   25733A202573       DC8 "%s: %s\015\012%s: %s\015\012%s: %s\015\012%s:\015\012%s\015\012"
   \              0D0A25733A20
   \              25730D0A2573
   \              3A2025730D0A
   \              25733A0D0A25
   \              730D0A00    
   \   0000002A   0000               DC8 0, 0

   \                                 In segment DATA_C, align 1, align-sorted
   \   00000000   323000             DC8 "20"

   Maximum stack usage in bytes:

     Function                CSTACK
     --------                ------
     Add2WS                      4
     AddToEDL                   12
     AddToSdlByTime             16
     AllocSD                     8
     CovDatToTxt                 4
     CovDatToTxt_ASCII        8724
     CovDatToTxt_UTF8        12824
     DeleteAllMss                8
     DoEMS                      64
     DoSMS                      32
     DoSMS_E                    32
     ExportAllToOneTxt           4
     ExportAllToOneTxt_ASCII  8716
     ExportAllToOneTxt_UTF8  12816
     ExportOneToTxt              4
     ExportOneToTxt_ASCII     8972
     ExportOneToTxt_UTF8     13068
     FindNextByType              4
     FindNextMss              1248
     FindNextPartOfEMS          36
     FindPrevByType              4
     FindPrevMss              1376
     FindSDByOpmsgId             0
     FindSdByTxtTimeNum         20
     FreeEDL                    12
     FreeSdOne                   8
     GetCountByIsFileType        0
     GetEMSText                384
     GetFilePathBySd           416
     GetMssPath                164
     Hex2Num                     8
     IsFileExist                48
     IsPartOfEMS                 0
     IsSdInList                  0
     MoveAllMssToArchive        12
     MoveAllToArchive           12
     MoveToArchive             392
     ReadAllEMS                 24
     ReadAllSmsN                 4
     ReadMSS                   200
     SdCopyOne                  12
     ShowFileErrCode             4
     StrClearChr                 0
     delSDList                   8
     deleteDat                  12
     deleteFile                 16
     freeSDList                 16
     getCountByType              4
     getSDPos                    0
     getSMSDataByType            4
     memcmp_wo1                  8
     newToRead                  16
     readAllSMS                 12
     readFile                 1120
     saveFile                  328


   Segment part sizes:

     Function/Label                 Bytes
     --------------                 -----
     sdltop                            4
     delSDList                       116
     freeSDList                      112
     getCountByType                  144
     GetCountByIsFileType            148
     getSMSDataByType                208
     getSDPos                         76
     Hex2Num                         144
     Add2WS                           80
     memcmp_wo1                       80
     FindNextPartOfEMS               176
     IsPartOfEMS                     248
     GetEMSText                      624
     ReadAllSmsN                      28
     readAllSMS                      128
     newToRead                       184
     GetMssPath                      248
     saveFile                        788
     readFile                        452
     deleteFile                      120
     deleteDat                        92
     AddToEDL                         64
     FreeEDL                          56
     DoSMS                           564
     DoSMS_E                         564
     DoEMS                           820
     ReadAllEMS                      120
     AllocSD                          32
     AddToSdlByTime                  144
     FindSDByOpmsgId                  44
     FindNextByType                  144
     FindPrevByType                  144
     ReadMSS                         580
     FreeSdOne                        52
     SdCopyOne                       140
     FindSdByTxtTimeNum              172
     IsSdInList                       40
     IsFileExist                      40
     StrClearChr                      76
     GetFilePathBySd                 584
     ExportAllToOneTxt_ASCII         392
     ExportOneToTxt_ASCII            584
     ExportAllToOneTxt_UTF8          456
     ExportOneToTxt_UTF8             640
     ExportAllToOneTxt                40
     ExportOneToTxt                   40
     MoveToArchive                   804
     MoveAllMssToArchive              84
     MoveAllToArchive                100
     ShowFileErrCode                  48
     DeleteAllMss                     72
     CovDatToTxt_ASCII               628
     CovDatToTxt_UTF8                680
     CovDatToTxt                      40
     FindNextMss                     412
     FindPrevMss                     480
     ??DataTable7                      4
     ??DataTable10                     4
     ??DataTable16                     4
     ??DataTable17                     4
     ??DataTable18                     4
     ??DataTable19                     4
     ??DataTable20                     4
     ??DataTable21                     4
     ??DataTable22                     4
     ??DataTable23                     4
     ??DataTable24                     4
     ??DataTable25                     4
     ??DataTable29                     4
     ??DataTable30                     4
     ??DataTable31                     4
     ??DataTable34                     4
     ??DataTable37                     4
     ??DataTable45                     4
     ??DataTable55                     4
     ??DataTable65                     4
     ??DataTable66                     4
     ??DataTable67                     4
     ??DataTable68                     4
     ??DataTable69                     4
     ??DataTable70                     4
     ??DataTable71                     4
     ??DataTable72                     4
     ??DataTable75                     4
     ??DataTable76                     4
     ??DataTable77                     4
     ??DataTable78                     4
     ??DataTable79                     4
     ??DataTable80                     4
     ??DataTable81                     4
     ??DataTable82                     4
     ??DataTable83                     4
     ??DataTable84                     4
     ??DataTable85                     4
     ??DataTable86                     4
     ??DataTable87                     4
     ??DataTable88                     4
     ?<Constant "%04d%02d%02d%02d%02d%02d">
                                      96
     ?<Constant "%02d-%02d-%02d %02d:%...">
                                      44
     ?<Constant {0}>                 136
     ?<Constant "Unk">                 4
     ?<Constant "%s: %s\r\n%s: %s\r\n%s: %...">
                                      36
     ?<Constant "Text\\">             44
     ?<Constant "20">                  3
      Others                         388

 
 14 616 bytes in segment CODE
    363 bytes in segment DATA_C
      4 bytes in segment DATA_Z
     12 bytes in segment INITTAB
 
 14 240 bytes of CODE  memory (+ 388 bytes shared)
    363 bytes of CONST memory
      4 bytes of DATA  memory

Errors: none
Warnings: 2
