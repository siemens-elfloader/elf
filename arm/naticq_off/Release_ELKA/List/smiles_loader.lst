##############################################################################
#                                                                            #
# IAR ARM ANSI C/C++ Compiler V4.42A/W32 EVALUATION    10/Feb/2011  20:48:52 #
# Copyright 1999-2005 IAR Systems. All rights reserved.                      #
#                                                                            #
#    Cpu mode        =  interwork                                            #
#    Endian          =  little                                               #
#    Stack alignment =  4                                                    #
#    Source file     =  C:\arm\naticq_off\smiles_loader.c                    #
#    Command line    =  C:\arm\naticq_off\smiles_loader.c -D NEWSGOLD -D     #
#                       ELKA --preprocess C:\arm\naticq_off\Release_ELKA\Lis #
#                       t\ -lC C:\arm\naticq_off\Release_ELKA\List\ -o       #
#                       C:\arm\naticq_off\Release_ELKA\Obj\ -s9 --no_unroll  #
#                       --cpu_mode arm --endian little --cpu ARM926EJ-S      #
#                       --stack_align 4 --interwork                          #
#                       --separate_cluster_for_initialized_variables -e      #
#                       --fpu None --dlib_config "C:\arm2\Embedded           #
#                       Workbench 4.0 Evaluation\ARM\LIB\dl5tpainl8n.h" -I   #
#                       "C:\arm2\Embedded Workbench 4.0                      #
#                       Evaluation\ARM\INC\" --inline_threshold=2            #
#    List file       =  C:\arm\naticq_off\Release_ELKA\List\smiles_loader.ls #
#                       t                                                    #
#    Object file     =  C:\arm\naticq_off\Release_ELKA\Obj\smiles_loader.r79 #
#                                                                            #
#                                                                            #
##############################################################################

C:\arm\naticq_off\smiles_loader.c
      1          #include "../inc/swilib.h"
      2          #include "../inc/pnglist.h"
      3          #include "naticq_ipc.h"
      4          #include "smiles.h"
      5          #include "naticq.h"
      6          

   \                                 In segment DATA_Z, align 4, align-sorted
      7          S_SMILES *s_top=0;
   \                     s_top:
   \   00000000                      DS8 4
      8          
      9          DYNPNGICONLIST *SmilesImgList;
     10          DYNPNGICONLIST *XStatusesImgList;
     11          
     12          int *XStatusesIconArray;
     13          
     14          volatile int total_smiles;
     15          volatile int total_xstatuses;
     16          volatile int total_xstatuses2;
     17          int total_clientid;
     18          volatile int xstatuses_load;
     19          volatile int pictures_max=0;
     20          volatile int pictures_loaded=0;
   \                     pictures_loaded:
   \   00000004                      DS8 4

   \                                 In segment DATA_Z, align 4, align-sorted
     21          
     22          extern const char SMILE_FILE[];
     23          extern const char SMILE_PATH[];
     24          extern const char XSTATUSES_PATH[];
     25          extern const char ipc_my_name[32];
     26          extern  int S_ICONS[];
     27          
     28          static IPC_REQ gipc1;
   \                     gipc1:
   \   00000000                      DS8 12
   \                     SmilesImgList:
   \   0000000C                      DS8 4
   \                     total_smiles:
   \   00000010                      DS8 4
   \   00000014                      DS8 4
   \   00000018                      DS8 4
   \   0000001C                      DS8 4
   \   00000020                      DS8 4

   \                                 In segment DATA_Z, align 4, align-sorted
     29          static char *p_buf;
     30          static char *s_buf;
     31          static S_SMILES *s_bot;
     32          static int n_pic1;
     33          
     34          static int n_pic2;
     35          static IPC_REQ gipc2;
   \                     gipc2:
   \   00000000                      DS8 12
   \                     XStatusesImgList:
   \   0000000C                      DS8 4
   \                     XStatusesIconArray:
   \   00000010                      DS8 4
   \                     total_xstatuses:
   \   00000014                      DS8 4
   \                     total_xstatuses2:
   \   00000018                      DS8 4
   \                     total_clientid:
   \   0000001C                      DS8 4
   \                     xstatuses_load:
   \   00000020                      DS8 4
   \   00000024                      DS8 4

   \                                 In segment DATA_Z, align 4, align-sorted
   \                     pictures_max:
   \   00000000                      DS8 4
     36          
     37          

   \                                 In segment CODE, align 4, keep-with-next
     38          S_SMILES *FindSmileById(int n)
     39          {
     40            int i=0;
     41            S_SMILES *sl=(S_SMILES *)s_top;
   \                     FindSmileById:
   \   00000000   ........           LDR      R1,??DataTable11  ;; s_top
   \   00000004   0020A0E3           MOV      R2,#+0
   \   00000008   001091E5           LDR      R1,[R1, #+0]
   \   0000000C   010000EA           B        ??FindSmileById_0
     42            while(sl && i!=n)
     43            {
     44              sl=sl->next;
   \                     ??FindSmileById_1:
   \   00000010   001091E5           LDR      R1,[R1, #+0]
     45              i++;
   \   00000014   012082E2           ADD      R2,R2,#+1
     46            }
   \                     ??FindSmileById_0:
   \   00000018   000051E3           CMP      R1,#+0
   \   0000001C   00005211           CMPNE    R2,R0
   \   00000020   FAFFFF1A           BNE      ??FindSmileById_1
     47            return sl;
   \   00000024   0100A0E1           MOV      R0,R1
   \   00000028   1EFF2FE1           BX       LR               ;; return
     48          }
     49          

   \                                 In segment CODE, align 4, keep-with-next
     50          S_SMILES *FindSmileByUni(int wchar)
     51          {
     52            S_SMILES *sl=(S_SMILES *)s_top;
   \                     FindSmileByUni:
   \   00000000   ........           LDR      R1,??DataTable11  ;; s_top
     53            while(sl)
     54            {
     55              if (sl->uni_smile == wchar) return (sl);
     56              sl=sl->next;
   \                     ??FindSmileByUni_0:
   \   00000004   001091E5           LDR      R1,[R1, #+0]
   \   00000008   000051E3           CMP      R1,#+0
   \   0000000C   0400000A           BEQ      ??FindSmileByUni_1
   \   00000010   042091E5           LDR      R2,[R1, #+4]
   \   00000014   000052E1           CMP      R2,R0
   \   00000018   F9FFFF1A           BNE      ??FindSmileByUni_0
   \   0000001C   0100A0E1           MOV      R0,R1
   \   00000020   1EFF2FE1           BX       LR
     57            }
     58            return (0);
   \                     ??FindSmileByUni_1:
   \   00000024   0000A0E3           MOV      R0,#+0
   \   00000028   1EFF2FE1           BX       LR               ;; return
     59          }
     60          

   \                                 In segment CODE, align 4, keep-with-next
     61          void FreeSmiles(void)
     62          {
   \                     FreeSmiles:
   \   00000000   F0412DE9           PUSH     {R4-R8,LR}
     63            S_SMILES *s_smile;
     64            STXT_SMILES *n;
     65            STXT_SMILES *st;
     66            DYNPNGICONLIST *d;
     67            DYNPNGICONLIST *nd;
     68            LockSched();
     69            total_smiles=0;
   \   00000004   CC409FE5           LDR      R4,??FreeSmiles_0  ;; gipc1
   \   00000008   04D04DE2           SUB      SP,SP,#+4
   \   0000000C   0050A0E3           MOV      R5,#+0
   \   00000010   460100EF           SWI      +326
     70            s_smile=(S_SMILES *)s_top;
   \   00000014   ........           LDR      R0,??DataTable11  ;; s_top
   \   00000018   105084E5           STR      R5,[R4, #+16]
   \   0000001C   006090E5           LDR      R6,[R0, #+0]
     71            s_top=0;
   \   00000020   005080E5           STR      R5,[R0, #+0]
     72            s_bot=0;
   \   00000024   1C5084E5           STR      R5,[R4, #+28]
     73            UnlockSched();
   \   00000028   470100EF           SWI      +327
   \   0000002C   000056E3           CMP      R6,#+0
   \   00000030   1300000A           BEQ      ??FreeSmiles_1
     74            while(s_smile)
     75            {
     76              S_SMILES *s;
     77              s=s_smile;
   \                     ??FreeSmiles_2:
   \   00000034   0670A0E1           MOV      R7,R6
     78              st=s->lines;
   \   00000038   080097E5           LDR      R0,[R7, #+8]
   \   0000003C   000050E3           CMP      R0,#+0
   \   00000040   0A00000A           BEQ      ??FreeSmiles_3
     79              while(st)
     80              {
     81                n=st->next;
   \                     ??FreeSmiles_4:
   \   00000044   0010A0E3           MOV      R1,#+0
   \   00000048   0D20A0E1           MOV      R2,SP
   \                     ??FreeSmiles_5:
   \   0000004C   0030D1E7           LDRB     R3,[R1, +R0]
   \   00000050   0230C1E7           STRB     R3,[R1, +R2]
   \   00000054   011081E2           ADD      R1,R1,#+1
   \   00000058   040051E3           CMP      R1,#+4
   \   0000005C   FAFFFFBA           BLT      ??FreeSmiles_5
   \   00000060   00809DE5           LDR      R8,[SP, #+0]
     82                mfree(st);
   \   00000064   150000EF           SWI      +21
     83                st=n;
   \   00000068   0800B0E1           MOVS     R0,R8
     84              }
   \   0000006C   F4FFFF1A           BNE      ??FreeSmiles_4
     85              s_smile=(S_SMILES *)(s_smile->next);
   \                     ??FreeSmiles_3:
   \   00000070   006096E5           LDR      R6,[R6, #+0]
     86              mfree(s);
   \   00000074   0700A0E1           MOV      R0,R7
   \   00000078   150000EF           SWI      +21
     87            }
   \   0000007C   000056E3           CMP      R6,#+0
   \   00000080   EBFFFF1A           BNE      ??FreeSmiles_2
     88            LockSched();
   \                     ??FreeSmiles_1:
   \   00000084   460100EF           SWI      +326
     89            d=SmilesImgList;
   \   00000088   0C6094E5           LDR      R6,[R4, #+12]
     90            SmilesImgList=0;
   \   0000008C   0C5084E5           STR      R5,[R4, #+12]
     91            UnlockSched();
   \   00000090   470100EF           SWI      +327
   \   00000094   000056E3           CMP      R6,#+0
   \   00000098   0B00000A           BEQ      ??FreeSmiles_6
     92            while(d)
     93            {
     94              if (d->img)
   \                     ??FreeSmiles_7:
   \   0000009C   080096E5           LDR      R0,[R6, #+8]
   \   000000A0   000050E3           CMP      R0,#+0
   \   000000A4   0300000A           BEQ      ??FreeSmiles_8
     95              {
     96                mfree(d->img->bitmap);
   \   000000A8   080090E5           LDR      R0,[R0, #+8]
   \   000000AC   150000EF           SWI      +21
     97                mfree(d->img);
   \   000000B0   080096E5           LDR      R0,[R6, #+8]
   \   000000B4   150000EF           SWI      +21
     98              }
     99              nd=d->next;
   \                     ??FreeSmiles_8:
   \   000000B8   005096E5           LDR      R5,[R6, #+0]
    100              mfree(d);
   \   000000BC   0600A0E1           MOV      R0,R6
   \   000000C0   150000EF           SWI      +21
    101              d=nd;
   \   000000C4   0560B0E1           MOVS     R6,R5
    102            }
   \   000000C8   F3FFFF1A           BNE      ??FreeSmiles_7
    103            mfree(s_buf);
   \                     ??FreeSmiles_6:
   \   000000CC   180094E5           LDR      R0,[R4, #+24]
   \   000000D0   150000EF           SWI      +21
    104          }
   \   000000D4   F181BDE8           POP      {R0,R4-R8,PC}    ;; return
   \                     ??FreeSmiles_0:
   \   000000D8   ........           DC32     gipc1
    105          

   \                                 In segment CODE, align 4, keep-with-next
    106          void InitSmiles(void)
    107          {
   \                     InitSmiles:
   \   00000000   F0412DE9           PUSH     {R4-R8,LR}
    108            int f;
    109            unsigned int err;
    110            int fsize;
    111            char *buf;
    112            FSTATS stat;
    113          
    114            FreeSmiles();
    115          
    116            n_pic1=FIRST_UCS2_BITMAP;
   \   00000004   ........           LDR      R4,??DataTable9  ;; gipc1
    117            if (GetFileStats(SMILE_FILE,&stat,&err)==-1)
   \   00000008   ........           LDR      R6,??DataTable7  ;; SMILE_FILE
   \   0000000C   2CD04DE2           SUB      SP,SP,#+44
   \   00000010   ........           BL       FreeSmiles
   \   00000014   2A00A0E3           MOV      R0,#+42
   \   00000018   E10C80E3           ORR      R0,R0,#0xE100
   \   0000001C   200084E5           STR      R0,[R4, #+32]
   \   00000020   0050E0E3           MVN      R5,#+0
   \   00000024   0D20A0E1           MOV      R2,SP
   \   00000028   04108DE2           ADD      R1,SP,#+4
   \   0000002C   0600A0E1           MOV      R0,R6
   \   00000030   840000EF           SWI      +132
   \   00000034   050050E1           CMP      R0,R5
   \   00000038   2800000A           BEQ      ??InitSmiles_0
    118              return;
    119          
    120            if ((fsize=stat.size)<=0)
   \   0000003C   08709DE5           LDR      R7,[SP, #+8]
   \   00000040   010057E3           CMP      R7,#+1
   \   00000044   250000BA           BLT      ??InitSmiles_0
    121              return;
    122          
    123            if ((f=fopen(SMILE_FILE,A_ReadOnly+A_BIN,P_READ,&err))==-1)
   \   00000048   0D30A0E1           MOV      R3,SP
   \   0000004C   8020A0E3           MOV      R2,#+128
   \   00000050   801CA0E3           MOV      R1,#+32768
   \   00000054   0600A0E1           MOV      R0,R6
   \   00000058   0A0000EF           SWI      +10
   \   0000005C   0060A0E1           MOV      R6,R0
   \   00000060   050056E1           CMP      R6,R5
   \   00000064   1D00000A           BEQ      ??InitSmiles_0
    124              return;
    125          
    126            buf=s_buf=p_buf=malloc(fsize+1);
   \   00000068   010087E2           ADD      R0,R7,#+1
   \   0000006C   140000EF           SWI      +20
   \   00000070   0050A0E1           MOV      R5,R0
   \   00000074   145084E5           STR      R5,[R4, #+20]
   \   00000078   185084E5           STR      R5,[R4, #+24]
    127            buf[fread(f,buf,fsize,&err)]=0;
   \   0000007C   0080A0E3           MOV      R8,#+0
   \   00000080   0D30A0E1           MOV      R3,SP
   \   00000084   0720A0E1           MOV      R2,R7
   \   00000088   0510A0E1           MOV      R1,R5
   \   0000008C   0600A0E1           MOV      R0,R6
   \   00000090   0B0000EF           SWI      +11
   \   00000094   0580C0E7           STRB     R8,[R0, +R5]
    128            fclose(f,&err);
   \   00000098   0D10A0E1           MOV      R1,SP
   \   0000009C   0600A0E1           MOV      R0,R6
   \   000000A0   0D0000EF           SWI      +13
    129            //f=fopen("4:\\smiles.cfg",A_ReadWrite+A_BIN+A_Create+A_Append,P_READ+P_WRITE,&err);
    130            gipc1.name_to=ipc_my_name;
   \   000000A4   ........           LDR      R0,??DataTable16  ;; ipc_my_name
    131            gipc1.name_from=ipc_my_name;
    132            gipc1.data=0;
   \   000000A8   088084E5           STR      R8,[R4, #+8]
   \   000000AC   000084E5           STR      R0,[R4, #+0]
   \   000000B0   040084E5           STR      R0,[R4, #+4]
    133            GBS_SendMessage(MMI_CEPID,MSG_IPC,IPC_SMILE_PROCESSED,&gipc1);
   \   000000B4   0430A0E1           MOV      R3,R4
   \   000000B8   0220A0E3           MOV      R2,#+2
   \   000000BC   B010A0E3           MOV      R1,#+176
   \   000000C0   DE1C81E3           ORR      R1,R1,#0xDE00
   \   000000C4   0900A0E3           MOV      R0,#+9
   \   000000C8   420C80E3           ORR      R0,R0,#0x4200
   \   000000CC   000100EF           SWI      +256
    134            pictures_max+=60;
   \   000000D0   ........           LDR      R0,??DataTable14  ;; pictures_max
   \   000000D4   001090E5           LDR      R1,[R0, #+0]
   \   000000D8   3C1081E2           ADD      R1,R1,#+60
   \   000000DC   001080E5           STR      R1,[R0, #+0]
    135          }
   \                     ??InitSmiles_0:
   \   000000E0   2CD08DE2           ADD      SP,SP,#+44       ;; stack cleaning
   \   000000E4   F081BDE8           POP      {R4-R8,PC}       ;; return
    136          

   \                                 In segment CODE, align 4, keep-with-next
    137          void CheckSmiles(void)
    138          {
   \                     CheckSmiles:
   \   00000000   F0402DE9           PUSH     {R4-R7,LR}
    139            int f;
    140            unsigned int err;
    141            int fsize;
    142            char *buf, *p_buf;
    143            FSTATS stat;
    144          
    145            if (GetFileStats(SMILE_FILE,&stat,&err)==-1)
   \   00000004   ........           LDR      R5,??DataTable7  ;; SMILE_FILE
   \   00000008   2CD04DE2           SUB      SP,SP,#+44
   \   0000000C   0040E0E3           MVN      R4,#+0
   \   00000010   0D20A0E1           MOV      R2,SP
   \   00000014   04108DE2           ADD      R1,SP,#+4
   \   00000018   0500A0E1           MOV      R0,R5
   \   0000001C   840000EF           SWI      +132
   \   00000020   040050E1           CMP      R0,R4
   \   00000024   2B00000A           BEQ      ??CheckSmiles_0
    146              return;
    147          
    148            if ((fsize=stat.size)<=0)
   \   00000028   08609DE5           LDR      R6,[SP, #+8]
   \   0000002C   010056E3           CMP      R6,#+1
   \   00000030   280000BA           BLT      ??CheckSmiles_0
    149              return;
    150          
    151            if ((f=fopen(SMILE_FILE,A_ReadOnly+A_BIN,P_READ,&err))==-1)
   \   00000034   0D30A0E1           MOV      R3,SP
   \   00000038   8020A0E3           MOV      R2,#+128
   \   0000003C   801CA0E3           MOV      R1,#+32768
   \   00000040   0500A0E1           MOV      R0,R5
   \   00000044   0A0000EF           SWI      +10
   \   00000048   0070A0E1           MOV      R7,R0
   \   0000004C   040057E1           CMP      R7,R4
   \   00000050   2000000A           BEQ      ??CheckSmiles_0
    152              return;
    153          
    154            buf=p_buf=malloc(fsize+1);
   \   00000054   010086E2           ADD      R0,R6,#+1
   \   00000058   140000EF           SWI      +20
   \   0000005C   0040A0E1           MOV      R4,R0
   \   00000060   0450A0E1           MOV      R5,R4
    155            buf[fread(f,buf,fsize,&err)]=0;
   \   00000064   0D30A0E1           MOV      R3,SP
   \   00000068   0620A0E1           MOV      R2,R6
   \   0000006C   0410A0E1           MOV      R1,R4
   \   00000070   0700A0E1           MOV      R0,R7
   \   00000074   0B0000EF           SWI      +11
   \   00000078   0010A0E3           MOV      R1,#+0
   \   0000007C   0410C0E7           STRB     R1,[R0, +R4]
    156            fclose(f,&err);
   \   00000080   0D10A0E1           MOV      R1,SP
   \   00000084   0700A0E1           MOV      R0,R7
   \   00000088   0D0000EF           SWI      +13
    157            
    158          //  f = pictures_max;
    159            for(buf=p_buf;*buf; buf++)
   \   0000008C   0000D5E5           LDRB     R0,[R5, #+0]
   \   00000090   000050E3           CMP      R0,#+0
   \   00000094   0D00000A           BEQ      ??CheckSmiles_1
    160              if(*buf == ':')
   \                     ??CheckSmiles_2:
   \   00000098   0000D5E5           LDRB     R0,[R5, #+0]
   \   0000009C   3A0050E3           CMP      R0,#+58
   \   000000A0   0700001A           BNE      ??CheckSmiles_3
    161              {
    162                buf++;
    163                while(*buf && *buf != 0x0D) buf++;
   \                     ??CheckSmiles_4:
   \   000000A4   0100F5E5           LDRB     R0,[R5, #+1]!
   \   000000A8   000050E3           CMP      R0,#+0
   \   000000AC   0D005013           CMPNE    R0,#+13
   \   000000B0   FBFFFF1A           BNE      ??CheckSmiles_4
    164                pictures_max++;
   \   000000B4   ........           LDR      R0,??DataTable14  ;; pictures_max
   \   000000B8   001090E5           LDR      R1,[R0, #+0]
   \   000000BC   011081E2           ADD      R1,R1,#+1
   \   000000C0   001080E5           STR      R1,[R0, #+0]
    165              }
   \                     ??CheckSmiles_3:
   \   000000C4   0100F5E5           LDRB     R0,[R5, #+1]!
   \   000000C8   000050E3           CMP      R0,#+0
   \   000000CC   F1FFFF1A           BNE      ??CheckSmiles_2
    166          /*  if(f == pictures_max)                 //А вдруг у нас кривые переводы строк?
    167            {
    168              for(buf=p_buf;*buf; buf++)
    169              if(*buf == 0x0A)
    170              {
    171                buf++;
    172                while(*buf && *buf != 0x0A && *buf!=':') buf++;
    173                if(*buf!=':') pictures_max++;
    174              }
    175            }*/
    176            mfree(p_buf);
   \                     ??CheckSmiles_1:
   \   000000D0   0400A0E1           MOV      R0,R4
   \   000000D4   150000EF           SWI      +21
    177          }
   \                     ??CheckSmiles_0:
   \   000000D8   2CD08DE2           ADD      SP,SP,#+44       ;; stack cleaning
   \   000000DC   F080BDE8           POP      {R4-R7,PC}       ;; return
    178          

   \                                 In segment CODE, align 4, keep-with-next
    179          void ProcessNextSmile(void)  
    180          {  
    181            int c;
    182            char fn[128];
    183            const char _slash[]="\\";
   \                     ProcessNextSmile:
   \   00000000   3C139FE5           LDR      R1,??ProcessNextSmile_0  ;; `?<Constant "\\\\">`
   \   00000004   F0472DE9           PUSH     {R4-R10,LR}
    184            DYNPNGICONLIST *dp;
    185            S_SMILES *si;
    186            STXT_SMILES *st;
    187            char *buf=p_buf;
   \   00000008   ........           LDR      R4,??DataTable9  ;; gipc1
   \   0000000C   88D04DE2           SUB      SP,SP,#+136
   \   00000010   0020D1E5           LDRB     R2,[R1, #0]
   \   00000014   148094E5           LDR      R8,[R4, #+20]
   \   00000018   04008DE2           ADD      R0,SP,#+4
   \   0000001C   0020C0E5           STRB     R2,[R0, #+0]
   \   00000020   0120D1E5           LDRB     R2,[R1, #+1]
    188            if (!buf) return;
   \   00000024   000058E3           CMP      R8,#+0
   \   00000028   0050A0E3           MOV      R5,#+0
   \   0000002C   0120C0E5           STRB     R2,[R0, #+1]
   \   00000030   0600001A           BNE      ??ProcessNextSmile_1
   \   00000034   180000EA           B        ??ProcessNextSmile_2
    189            while ((c=*buf))
    190            {
    191              char *p;
    192              if ((c==10)||(c==13))
    193              {
    194                buf++;
    195                gipc1.name_to=ipc_my_name;
    196                gipc1.name_from=ipc_my_name;
    197                gipc1.data=0;
    198                GBS_SendMessage(MMI_CEPID,MSG_IPC,IPC_SMILE_PROCESSED,&gipc1);
    199                p_buf=buf;
    200                return;
    201              }
    202              p=strchr(buf,':');
    203              if (!p) break;
    204              zeromem(fn,128);
    205              strcpy(fn,SMILE_PATH);
    206              if (fn[strlen(fn)-1]!='\\') strcat(fn,_slash);
    207              c=p-buf;
    208              if (c>(127-strlen(fn))) break;
    209              strncpy(fn+strlen(fn),buf,c);
    210          //    snprintf(logmsg,255,"Process file %s...",fn);
    211          //    REDRAW();
    212              buf=p;
    213              dp=malloc(sizeof(DYNPNGICONLIST));
    214              zeromem(dp,sizeof(DYNPNGICONLIST));
    215              dp->icon=GetPicNByUnicodeSymbol(n_pic1);
    216              dp->img=CreateIMGHDRFromPngFile(fn,0);
    217              LockSched();
    218              if (SmilesImgList)
    219              {
    220                dp->next=SmilesImgList;
    221              }
    222              SmilesImgList=dp;
    223              UnlockSched();
    224              si=malloc(sizeof(S_SMILES));
    225              si->next=NULL;
    226              si->lines=NULL;
    227              si->botlines=NULL;
    228              si->uni_smile=n_pic1;
    229              if (s_bot)
    230              {
    231                //Не первый
    232                s_bot->next=si;
    233                s_bot=si;
    234              }
    235              else
    236              {
    237                //Первый
    238                s_top=si;
    239                s_bot=si;
    240              }
    241              n_pic1++;
    242              while (*buf!=10 && *buf!=13 && *buf!=0)
    243              {
    244                buf++;
    245                int i=0;
    246                while (buf[i]!=0&&buf [i]!=','&&buf [i]!=10&&buf[i]!=13)  i++;
    247                st=malloc(sizeof(STXT_SMILES)+i);
    248                strncpy(st->text,buf,i);
    249                st->text[i]=0;
    250                
    251                st->next=NULL;
    252                st->key=*((unsigned long *)st->text);
    253                st->mask=~(0xFFFFFFFFUL<<(8*i));
    254                st->key&=st->mask;
    255                if (si->botlines)
    256                {
    257          	si->botlines->next=st;
    258          	si->botlines=st;
    259                }
    260                else
    261                {
    262          	si->lines=st;
    263          	si->botlines=st;
    264                }
    265                buf+=i;
    266              }
    267              pictures_loaded++;
   \                     ??ProcessNextSmile_3:
   \   00000038   040097E5           LDR      R0,[R7, #+4]
   \   0000003C   010080E2           ADD      R0,R0,#+1
   \   00000040   040087E5           STR      R0,[R7, #+4]
    268              total_smiles++;
   \   00000044   100094E5           LDR      R0,[R4, #+16]
   \   00000048   010080E2           ADD      R0,R0,#+1
   \   0000004C   100084E5           STR      R0,[R4, #+16]
   \                     ??ProcessNextSmile_1:
   \   00000050   0070D8E5           LDRB     R7,[R8, #+0]
   \   00000054   000057E3           CMP      R7,#+0
   \   00000058   B100000A           BEQ      ??ProcessNextSmile_4
   \   0000005C   0A0057E3           CMP      R7,#+10
   \   00000060   0D005713           CMPNE    R7,#+13
   \   00000064   0E00001A           BNE      ??ProcessNextSmile_5
   \   00000068   ........           LDR      R0,??DataTable16  ;; ipc_my_name
   \   0000006C   085084E5           STR      R5,[R4, #+8]
   \   00000070   000084E5           STR      R0,[R4, #+0]
   \   00000074   040084E5           STR      R0,[R4, #+4]
   \   00000078   0430A0E1           MOV      R3,R4
   \   0000007C   0220A0E3           MOV      R2,#+2
   \   00000080   B010A0E3           MOV      R1,#+176
   \   00000084   DE1C81E3           ORR      R1,R1,#0xDE00
   \   00000088   0900A0E3           MOV      R0,#+9
   \   0000008C   420C80E3           ORR      R0,R0,#0x4200
   \   00000090   000100EF           SWI      +256
   \   00000094   018088E2           ADD      R8,R8,#+1
   \   00000098   148084E5           STR      R8,[R4, #+20]
   \                     ??ProcessNextSmile_2:
   \   0000009C   88D08DE2           ADD      SP,SP,#+136
   \   000000A0   F087BDE8           POP      {R4-R10,PC}
   \                     ??ProcessNextSmile_5:
   \   000000A4   3A10A0E3           MOV      R1,#+58
   \   000000A8   0800A0E1           MOV      R0,R8
   \   000000AC   180000EF           SWI      +24
   \   000000B0   0060B0E1           MOVS     R6,R0
   \   000000B4   9A00000A           BEQ      ??ProcessNextSmile_4
   \   000000B8   8010A0E3           MOV      R1,#+128
   \   000000BC   08008DE2           ADD      R0,SP,#+8
   \   000000C0   1D0100EF           SWI      +285
   \   000000C4   7C129FE5           LDR      R1,??ProcessNextSmile_0+0x4  ;; SMILE_PATH
   \   000000C8   08008DE2           ADD      R0,SP,#+8
   \   000000CC   1A0000EF           SWI      +26
   \   000000D0   08008DE2           ADD      R0,SP,#+8
   \   000000D4   1B0000EF           SWI      +27
   \   000000D8   08108DE2           ADD      R1,SP,#+8
   \   000000DC   010080E0           ADD      R0,R0,R1
   \   000000E0   010050E5           LDRB     R0,[R0, #-1]
   \   000000E4   5C0050E3           CMP      R0,#+92
   \   000000E8   0200000A           BEQ      ??ProcessNextSmile_6
   \   000000EC   04108DE2           ADD      R1,SP,#+4
   \   000000F0   08008DE2           ADD      R0,SP,#+8
   \   000000F4   170000EF           SWI      +23
   \                     ??ProcessNextSmile_6:
   \   000000F8   087046E0           SUB      R7,R6,R8
   \   000000FC   08008DE2           ADD      R0,SP,#+8
   \   00000100   1B0000EF           SWI      +27
   \   00000104   7F0060E2           RSB      R0,R0,#+127
   \   00000108   070050E1           CMP      R0,R7
   \   0000010C   8400003A           BCC      ??ProcessNextSmile_4
   \   00000110   08008DE2           ADD      R0,SP,#+8
   \   00000114   1B0000EF           SWI      +27
   \   00000118   0720A0E1           MOV      R2,R7
   \   0000011C   0810A0E1           MOV      R1,R8
   \   00000120   08308DE2           ADD      R3,SP,#+8
   \   00000124   030080E0           ADD      R0,R0,R3
   \   00000128   160100EF           SWI      +278
   \   0000012C   0680A0E1           MOV      R8,R6
   \   00000130   ........           LDR      R7,??DataTable11  ;; s_top
   \   00000134   0C00A0E3           MOV      R0,#+12
   \   00000138   140000EF           SWI      +20
   \   0000013C   0060A0E1           MOV      R6,R0
   \   00000140   0C10A0E3           MOV      R1,#+12
   \   00000144   1D0100EF           SWI      +285
   \   00000148   200094E5           LDR      R0,[R4, #+32]
   \   0000014C   E40100EF           SWI      +484
   \   00000150   040086E5           STR      R0,[R6, #+4]
   \   00000154   0010A0E3           MOV      R1,#+0
   \   00000158   08008DE2           ADD      R0,SP,#+8
   \   0000015C   E90100EF           SWI      +489
   \   00000160   080086E5           STR      R0,[R6, #+8]
   \   00000164   460100EF           SWI      +326
   \   00000168   0C0094E5           LDR      R0,[R4, #+12]
   \   0000016C   000050E3           CMP      R0,#+0
   \   00000170   00008615           STRNE    R0,[R6, #+0]
   \   00000174   0C6084E5           STR      R6,[R4, #+12]
   \   00000178   470100EF           SWI      +327
   \   0000017C   1000A0E3           MOV      R0,#+16
   \   00000180   140000EF           SWI      +20
   \   00000184   0060A0E1           MOV      R6,R0
   \   00000188   005086E5           STR      R5,[R6, #+0]
   \   0000018C   085086E5           STR      R5,[R6, #+8]
   \   00000190   0C5086E5           STR      R5,[R6, #+12]
   \   00000194   200094E5           LDR      R0,[R4, #+32]
   \   00000198   040086E5           STR      R0,[R6, #+4]
   \   0000019C   1C1094E5           LDR      R1,[R4, #+28]
   \   000001A0   010080E2           ADD      R0,R0,#+1
   \   000001A4   000051E3           CMP      R1,#+0
   \   000001A8   00608115           STRNE    R6,[R1, #+0]
   \   000001AC   00608705           STREQ    R6,[R7, #+0]
   \   000001B0   0610A0E1           MOV      R1,R6
   \   000001B4   1C1084E5           STR      R1,[R4, #+28]
   \   000001B8   200084E5           STR      R0,[R4, #+32]
   \   000001BC   020000EA           B        ??ProcessNextSmile_7
   \                     ??ProcessNextSmile_8:
   \   000001C0   08A086E5           STR      R10,[R6, #+8]
   \                     ??ProcessNextSmile_9:
   \   000001C4   0CA086E5           STR      R10,[R6, #+12]
   \   000001C8   088089E0           ADD      R8,R9,R8
   \                     ??ProcessNextSmile_7:
   \   000001CC   0000D8E5           LDRB     R0,[R8, #+0]
   \   000001D0   0A0050E3           CMP      R0,#+10
   \   000001D4   0D005013           CMPNE    R0,#+13
   \   000001D8   00005013           CMPNE    R0,#+0
   \   000001DC   95FFFF0A           BEQ      ??ProcessNextSmile_3
   \   000001E0   018088E2           ADD      R8,R8,#+1
   \   000001E4   0090A0E3           MOV      R9,#+0
   \   000001E8   000000EA           B        ??ProcessNextSmile_10
   \                     ??ProcessNextSmile_11:
   \   000001EC   019089E2           ADD      R9,R9,#+1
   \                     ??ProcessNextSmile_10:
   \   000001F0   0800D9E7           LDRB     R0,[R9, +R8]
   \   000001F4   000050E3           CMP      R0,#+0
   \   000001F8   2C005013           CMPNE    R0,#+44
   \   000001FC   0A005013           CMPNE    R0,#+10
   \   00000200   0D005013           CMPNE    R0,#+13
   \   00000204   F8FFFF1A           BNE      ??ProcessNextSmile_11
   \   00000208   0D0089E2           ADD      R0,R9,#+13
   \   0000020C   140000EF           SWI      +20
   \   00000210   00A0A0E1           MOV      R10,R0
   \   00000214   0920A0E1           MOV      R2,R9
   \   00000218   0810A0E1           MOV      R1,R8
   \   0000021C   0C008AE2           ADD      R0,R10,#+12
   \   00000220   160100EF           SWI      +278
   \   00000224   0A0089E0           ADD      R0,R9,R10
   \   00000228   0C50C0E5           STRB     R5,[R0, #+12]
   \   0000022C   00508DE5           STR      R5,[SP, #+0]
   \   00000230   0000A0E3           MOV      R0,#+0
   \                     ??ProcessNextSmile_12:
   \   00000234   0D10A0E1           MOV      R1,SP
   \   00000238   0110D0E7           LDRB     R1,[R0, +R1]
   \   0000023C   0A10C0E7           STRB     R1,[R0, +R10]
   \   00000240   010080E2           ADD      R0,R0,#+1
   \   00000244   040050E3           CMP      R0,#+4
   \   00000248   F9FFFFBA           BLT      ??ProcessNextSmile_12
   \   0000024C   0C009AE5           LDR      R0,[R10, #+12]
   \   00000250   0910A0E1           MOV      R1,R9
   \   00000254   0400CAE5           STRB     R0,[R10, #+4]
   \   00000258   2004A0E1           LSR      R0,R0,#+8
   \   0000025C   0500CAE5           STRB     R0,[R10, #+5]
   \   00000260   2004A0E1           LSR      R0,R0,#+8
   \   00000264   0600CAE5           STRB     R0,[R10, #+6]
   \   00000268   2004A0E1           LSR      R0,R0,#+8
   \   0000026C   0700CAE5           STRB     R0,[R10, #+7]
   \   00000270   0500E0E1           MVN      R0,R5
   \   00000274   8111A0E1           LSL      R1,R1,#+3
   \   00000278   1001E0E1           MVN      R0,R0, LSL R1
   \   0000027C   0800CAE5           STRB     R0,[R10, #+8]
   \   00000280   2004A0E1           LSR      R0,R0,#+8
   \   00000284   0900CAE5           STRB     R0,[R10, #+9]
   \   00000288   2004A0E1           LSR      R0,R0,#+8
   \   0000028C   0A00CAE5           STRB     R0,[R10, #+10]
   \   00000290   2004A0E1           LSR      R0,R0,#+8
   \   00000294   0B00CAE5           STRB     R0,[R10, #+11]
   \   00000298   0700DAE5           LDRB     R0,[R10, #+7]
   \   0000029C   0610DAE5           LDRB     R1,[R10, #+6]
   \   000002A0   0A20DAE5           LDRB     R2,[R10, #+10]
   \   000002A4   000481E1           ORR      R0,R1,R0, LSL #+8
   \   000002A8   0510DAE5           LDRB     R1,[R10, #+5]
   \   000002AC   000481E1           ORR      R0,R1,R0, LSL #+8
   \   000002B0   0410DAE5           LDRB     R1,[R10, #+4]
   \   000002B4   000481E1           ORR      R0,R1,R0, LSL #+8
   \   000002B8   0B10DAE5           LDRB     R1,[R10, #+11]
   \   000002BC   011482E1           ORR      R1,R2,R1, LSL #+8
   \   000002C0   0920DAE5           LDRB     R2,[R10, #+9]
   \   000002C4   011482E1           ORR      R1,R2,R1, LSL #+8
   \   000002C8   0820DAE5           LDRB     R2,[R10, #+8]
   \   000002CC   011482E1           ORR      R1,R2,R1, LSL #+8
   \   000002D0   000001E0           AND      R0,R1,R0
   \   000002D4   0400CAE5           STRB     R0,[R10, #+4]
   \   000002D8   2004A0E1           LSR      R0,R0,#+8
   \   000002DC   0500CAE5           STRB     R0,[R10, #+5]
   \   000002E0   2004A0E1           LSR      R0,R0,#+8
   \   000002E4   0600CAE5           STRB     R0,[R10, #+6]
   \   000002E8   2004A0E1           LSR      R0,R0,#+8
   \   000002EC   0700CAE5           STRB     R0,[R10, #+7]
   \   000002F0   0C0096E5           LDR      R0,[R6, #+12]
   \   000002F4   000050E3           CMP      R0,#+0
   \   000002F8   B0FFFF0A           BEQ      ??ProcessNextSmile_8
   \   000002FC   00A08DE5           STR      R10,[SP, #+0]
   \   00000300   0000A0E3           MOV      R0,#+0
   \                     ??ProcessNextSmile_13:
   \   00000304   0C1096E5           LDR      R1,[R6, #+12]
   \   00000308   0D20A0E1           MOV      R2,SP
   \   0000030C   0220D0E7           LDRB     R2,[R0, +R2]
   \   00000310   0120C0E7           STRB     R2,[R0, +R1]
   \   00000314   010080E2           ADD      R0,R0,#+1
   \   00000318   040050E3           CMP      R0,#+4
   \   0000031C   F8FFFFBA           BLT      ??ProcessNextSmile_13
   \   00000320   A7FFFFEA           B        ??ProcessNextSmile_9
    269            }
    270            //fclose(f,&err);
    271            total_smiles=0;
   \                     ??ProcessNextSmile_4:
   \   00000324   105084E5           STR      R5,[R4, #+16]
    272            p_buf=NULL;
    273            mfree(s_buf);
   \   00000328   180094E5           LDR      R0,[R4, #+24]
   \   0000032C   145084E5           STR      R5,[R4, #+20]
   \   00000330   150000EF           SWI      +21
    274            s_buf=NULL;
   \   00000334   185084E5           STR      R5,[R4, #+24]
    275            REDRAW();
   \   00000338   720100EF           SWI      +370
    276          }
   \   0000033C   88D08DE2           ADD      SP,SP,#+136
   \   00000340   F087BDE8           POP      {R4-R10,PC}      ;; return
   \                     ??ProcessNextSmile_0:
   \   00000344   ........           DC32     `?<Constant "\\\\">`
   \   00000348   ........           DC32     SMILE_PATH
    277          

   \                                 In segment CODE, align 4, keep-with-next
    278          void FreeXStatusesImg(void)
    279          {
   \                     FreeXStatusesImg:
   \   00000000   70402DE9           PUSH     {R4-R6,LR}
    280            DYNPNGICONLIST *d;
    281            DYNPNGICONLIST *nd;
    282            LockSched();
    283            total_xstatuses=0;
   \   00000004   5C409FE5           LDR      R4,??FreeXStatusesImg_0  ;; gipc2
   \   00000008   0050A0E3           MOV      R5,#+0
   \   0000000C   460100EF           SWI      +326
   \   00000010   145084E5           STR      R5,[R4, #+20]
    284            d=XStatusesImgList;
   \   00000014   0C6094E5           LDR      R6,[R4, #+12]
    285            XStatusesImgList=0;
   \   00000018   0C5084E5           STR      R5,[R4, #+12]
    286            UnlockSched();
   \   0000001C   470100EF           SWI      +327
    287            mfree(XStatusesIconArray);
   \   00000020   100094E5           LDR      R0,[R4, #+16]
   \   00000024   150000EF           SWI      +21
    288            XStatusesIconArray=NULL;
   \   00000028   105084E5           STR      R5,[R4, #+16]
   \   0000002C   000056E3           CMP      R6,#+0
   \   00000030   7080BD08           POPEQ    {R4-R6,PC}
    289            while(d)
    290            {
    291              if (d->img)
   \                     ??FreeXStatusesImg_1:
   \   00000034   080096E5           LDR      R0,[R6, #+8]
   \   00000038   000050E3           CMP      R0,#+0
   \   0000003C   0300000A           BEQ      ??FreeXStatusesImg_2
    292              {
    293                mfree(d->img->bitmap);
   \   00000040   080090E5           LDR      R0,[R0, #+8]
   \   00000044   150000EF           SWI      +21
    294                mfree(d->img);
   \   00000048   080096E5           LDR      R0,[R6, #+8]
   \   0000004C   150000EF           SWI      +21
    295              }
    296              nd=d->next;
   \                     ??FreeXStatusesImg_2:
   \   00000050   004096E5           LDR      R4,[R6, #+0]
    297              mfree(d);
   \   00000054   0600A0E1           MOV      R0,R6
   \   00000058   150000EF           SWI      +21
    298              d=nd;
   \   0000005C   0460B0E1           MOVS     R6,R4
    299            }
   \   00000060   F3FFFF1A           BNE      ??FreeXStatusesImg_1
    300          }
   \   00000064   7080BDE8           POP      {R4-R6,PC}       ;; return
   \                     ??FreeXStatusesImg_0:
   \   00000068   ........           DC32     gipc2
    301          

   \                                 In segment CODE, align 4, keep-with-next
    302          void InitXStatusesImg(void)
    303          {
   \                     InitXStatusesImg:
   \   00000000   30402DE9           PUSH     {R4,R5,LR}
    304            FreeXStatusesImg();
    305            total_xstatuses=0;
   \   00000004   ........           LDR      R4,??DataTable15  ;; gipc2
   \   00000008   ........           BL       FreeXStatusesImg
   \   0000000C   0050A0E3           MOV      R5,#+0
   \   00000010   145084E5           STR      R5,[R4, #+20]
    306            total_xstatuses2=0;
   \   00000014   185084E5           STR      R5,[R4, #+24]
    307            *(XStatusesIconArray=malloc(sizeof(int)))=S_ICONS[IS_NULLICON];
   \   00000018   0400A0E3           MOV      R0,#+4
   \   0000001C   140000EF           SWI      +20
   \   00000020   5C109FE5           LDR      R1,??InitXStatusesImg_0  ;; S_ICONS + 68
   \   00000024   100084E5           STR      R0,[R4, #+16]
   \   00000028   001091E5           LDR      R1,[R1, #+0]
    308            xstatuses_load=1;
    309            n_pic2=FIRST_UCS2_BITMAP;
    310            gipc2.name_to=ipc_my_name;
    311            gipc2.name_from=ipc_my_name;
    312            gipc2.data=0;
    313            GBS_SendMessage(MMI_CEPID,MSG_IPC,IPC_XSTATUSIMG_PROCESSED,&gipc2);
   \   0000002C   0430A0E1           MOV      R3,R4
   \   00000030   001080E5           STR      R1,[R0, #+0]
   \   00000034   0100A0E3           MOV      R0,#+1
   \   00000038   200084E5           STR      R0,[R4, #+32]
   \   0000003C   2A00A0E3           MOV      R0,#+42
   \   00000040   E10C80E3           ORR      R0,R0,#0xE100
   \   00000044   240084E5           STR      R0,[R4, #+36]
   \   00000048   ........           LDR      R0,??DataTable16  ;; ipc_my_name
   \   0000004C   085084E5           STR      R5,[R4, #+8]
   \   00000050   000084E5           STR      R0,[R4, #+0]
   \   00000054   040084E5           STR      R0,[R4, #+4]
   \   00000058   0320A0E3           MOV      R2,#+3
   \   0000005C   B010A0E3           MOV      R1,#+176
   \   00000060   DE1C81E3           ORR      R1,R1,#0xDE00
   \   00000064   0900A0E3           MOV      R0,#+9
   \   00000068   420C80E3           ORR      R0,R0,#0x4200
   \   0000006C   000100EF           SWI      +256
    314            pictures_max+=50;
   \   00000070   ........           LDR      R0,??DataTable14  ;; pictures_max
   \   00000074   001090E5           LDR      R1,[R0, #+0]
   \   00000078   321081E2           ADD      R1,R1,#+50
   \   0000007C   001080E5           STR      R1,[R0, #+0]
    315          
    316          /*  char fn[128];
    317            const char _slash[]="\\";
    318            FSTATS stat;
    319            unsigned err;
    320            
    321            pictures_max = 0;
    322            do
    323            {
    324              strcpy(fn,XSTATUSES_PATH);
    325              if (fn[strlen(fn)-1]!='\\') strcat(fn,_slash);
    326              sprintf(fn+strlen(fn),"%d.png",pictures_max++);
    327              if (GetFileStats(fn,&stat,&err)==-1) break;
    328            }  
    329            while (stat.size>0);
    330            pictures_max--;
    331            CheckSmiles();
    332          */  
    333          //  GBS_SendMessage(MMI_CEPID,MSG_IPC,IPC_XSTATUSIMG_PROCESSED,&gipc2);
    334          }
   \   00000080   3080BDE8           POP      {R4,R5,PC}       ;; return
   \                     ??InitXStatusesImg_0:
   \   00000084   ........           DC32     S_ICONS + 68
    335          

   \                                 In segment CODE, align 4, keep-with-next
    336          void ProcessNextXStatImg(void)
    337          {
   \                     ProcessNextXStatImg:
   \   00000000   F0402DE9           PUSH     {R4-R7,LR}
    338            char fn[128];
    339            const char _slash[]="\\";
   \   00000004   98519FE5           LDR      R5,??ProcessNextXStatImg_0  ;; `?<Constant "\\\\">_1`
   \   00000008   B0D04DE2           SUB      SP,SP,#+176
   \   0000000C   0010D5E5           LDRB     R1,[R5, #0]
   \   00000010   0D00A0E1           MOV      R0,SP
   \   00000014   0010C0E5           STRB     R1,[R0, #+0]
   \   00000018   0110D5E5           LDRB     R1,[R5, #+1]
   \   0000001C   0110C0E5           STRB     R1,[R0, #+1]
    340            DYNPNGICONLIST *dp;
    341            unsigned int err;
    342            FSTATS stat;
    343            int i;
    344            
    345            strcpy(fn,XSTATUSES_PATH);
   \   00000020   80119FE5           LDR      R1,??ProcessNextXStatImg_0+0x4  ;; XSTATUSES_PATH
   \   00000024   08008DE2           ADD      R0,SP,#+8
   \   00000028   1A0000EF           SWI      +26
    346            if (fn[strlen(fn)-1]!='\\') strcat(fn,_slash);
   \   0000002C   08008DE2           ADD      R0,SP,#+8
   \   00000030   1B0000EF           SWI      +27
   \   00000034   08108DE2           ADD      R1,SP,#+8
   \   00000038   010080E0           ADD      R0,R0,R1
   \   0000003C   010050E5           LDRB     R0,[R0, #-1]
   \   00000040   5C0050E3           CMP      R0,#+92
   \   00000044   0200000A           BEQ      ??ProcessNextXStatImg_1
   \   00000048   0D10A0E1           MOV      R1,SP
   \   0000004C   08008DE2           ADD      R0,SP,#+8
   \   00000050   170000EF           SWI      +23
    347            sprintf(fn+strlen(fn),"%d.png",total_xstatuses2);
   \                     ??ProcessNextXStatImg_1:
   \   00000054   ........           LDR      R4,??DataTable15  ;; gipc2
   \   00000058   08008DE2           ADD      R0,SP,#+8
   \   0000005C   186094E5           LDR      R6,[R4, #+24]
   \   00000060   1B0000EF           SWI      +27
   \   00000064   0620A0E1           MOV      R2,R6
   \   00000068   041085E2           ADD      R1,R5,#+4
   \   0000006C   08308DE2           ADD      R3,SP,#+8
   \   00000070   030080E0           ADD      R0,R0,R3
   \   00000074   160000EF           SWI      +22
    348            if (GetFileStats(fn,&stat,&err)!=-1)
   \   00000078   0050A0E3           MOV      R5,#+0
   \   0000007C   04208DE2           ADD      R2,SP,#+4
   \   00000080   88108DE2           ADD      R1,SP,#+136
   \   00000084   08008DE2           ADD      R0,SP,#+8
   \   00000088   840000EF           SWI      +132
   \   0000008C   010070E3           CMN      R0,#+1
   \   00000090   3500000A           BEQ      ??ProcessNextXStatImg_2
    349            {
    350              if (stat.size>0)
   \   00000094   8C009DE5           LDR      R0,[SP, #+140]
   \   00000098   000050E3           CMP      R0,#+0
   \   0000009C   3A00000A           BEQ      ??ProcessNextXStatImg_3
    351              {
    352                dp=malloc(sizeof(DYNPNGICONLIST));
   \   000000A0   0C00A0E3           MOV      R0,#+12
   \   000000A4   140000EF           SWI      +20
   \   000000A8   0070A0E1           MOV      R7,R0
    353                zeromem(dp,sizeof(DYNPNGICONLIST));
   \   000000AC   0C10A0E3           MOV      R1,#+12
   \   000000B0   1D0100EF           SWI      +285
    354                dp->icon=i=GetPicNByUnicodeSymbol(n_pic2);
   \   000000B4   240094E5           LDR      R0,[R4, #+36]
   \   000000B8   E40100EF           SWI      +484
   \   000000BC   0060A0E1           MOV      R6,R0
   \   000000C0   046087E5           STR      R6,[R7, #+4]
    355                dp->img=CreateIMGHDRFromPngFile(fn,0);
   \   000000C4   0010A0E3           MOV      R1,#+0
   \   000000C8   08008DE2           ADD      R0,SP,#+8
   \   000000CC   E90100EF           SWI      +489
   \   000000D0   080087E5           STR      R0,[R7, #+8]
    356                LockSched();
   \   000000D4   460100EF           SWI      +326
    357                if (XStatusesImgList)
   \   000000D8   0C0094E5           LDR      R0,[R4, #+12]
   \   000000DC   000050E3           CMP      R0,#+0
    358                {
    359          	dp->next=XStatusesImgList;
   \   000000E0   00008715           STRNE    R0,[R7, #+0]
    360                }
    361                XStatusesImgList=dp;
   \   000000E4   0C7084E5           STR      R7,[R4, #+12]
    362                UnlockSched();
   \   000000E8   470100EF           SWI      +327
    363                total_xstatuses2++;
   \   000000EC   180094E5           LDR      R0,[R4, #+24]
   \   000000F0   010080E2           ADD      R0,R0,#+1
   \   000000F4   180084E5           STR      R0,[R4, #+24]
    364                pictures_loaded++;
   \   000000F8   AC009FE5           LDR      R0,??ProcessNextXStatImg_0+0x8  ;; s_top
   \   000000FC   041090E5           LDR      R1,[R0, #+4]
   \   00000100   011081E2           ADD      R1,R1,#+1
   \   00000104   041080E5           STR      R1,[R0, #+4]
    365                XStatusesIconArray=realloc(XStatusesIconArray,(total_xstatuses2*sizeof(int)));
   \   00000108   180094E5           LDR      R0,[R4, #+24]
   \   0000010C   0011A0E1           LSL      R1,R0,#+2
   \   00000110   100094E5           LDR      R0,[R4, #+16]
   \   00000114   BA0000EF           SWI      +186
   \   00000118   100084E5           STR      R0,[R4, #+16]
    366                *(XStatusesIconArray+(total_xstatuses2-1))=i;
   \   0000011C   180094E5           LDR      R0,[R4, #+24]
   \   00000120   101094E5           LDR      R1,[R4, #+16]
   \   00000124   000181E0           ADD      R0,R1,R0, LSL #+2
   \   00000128   046000E5           STR      R6,[R0, #-4]
    367                n_pic2++;
   \   0000012C   240094E5           LDR      R0,[R4, #+36]
   \   00000130   010080E2           ADD      R0,R0,#+1
   \   00000134   240084E5           STR      R0,[R4, #+36]
    368              l1:
    369                gipc2.name_to=ipc_my_name;
   \                     ??ProcessNextXStatImg_4:
   \   00000138   ........           LDR      R0,??DataTable16  ;; ipc_my_name
    370                gipc2.name_from=ipc_my_name;
    371                gipc2.data=0;
   \   0000013C   085084E5           STR      R5,[R4, #+8]
   \   00000140   000084E5           STR      R0,[R4, #+0]
   \   00000144   040084E5           STR      R0,[R4, #+4]
    372                GBS_SendMessage(MMI_CEPID,MSG_IPC,IPC_XSTATUSIMG_PROCESSED,&gipc2);
   \   00000148   0430A0E1           MOV      R3,R4
   \   0000014C   0320A0E3           MOV      R2,#+3
   \   00000150   B010A0E3           MOV      R1,#+176
   \   00000154   DE1C81E3           ORR      R1,R1,#0xDE00
   \   00000158   0900A0E3           MOV      R0,#+9
   \   0000015C   420C80E3           ORR      R0,R0,#0x4200
   \   00000160   000100EF           SWI      +256
    373                return;
   \   00000164   B0D08DE2           ADD      SP,SP,#+176
   \   00000168   F080BDE8           POP      {R4-R7,PC}
    374              }
    375            }else{
    376              if (total_xstatuses2<100){
   \                     ??ProcessNextXStatImg_2:
   \   0000016C   180094E5           LDR      R0,[R4, #+24]
   \   00000170   640050E3           CMP      R0,#+100
   \   00000174   040000AA           BGE      ??ProcessNextXStatImg_3
    377                total_xstatuses=total_xstatuses2;
   \   00000178   180094E5           LDR      R0,[R4, #+24]
   \   0000017C   140084E5           STR      R0,[R4, #+20]
    378                total_xstatuses2=100;
   \   00000180   6400A0E3           MOV      R0,#+100
   \   00000184   180084E5           STR      R0,[R4, #+24]
    379                goto l1;
   \   00000188   EAFFFFEA           B        ??ProcessNextXStatImg_4
    380              }
    381            }
    382            total_clientid=total_xstatuses2-101;
   \                     ??ProcessNextXStatImg_3:
   \   0000018C   180094E5           LDR      R0,[R4, #+24]
   \   00000190   650040E2           SUB      R0,R0,#+101
   \   00000194   1C0084E5           STR      R0,[R4, #+28]
    383            xstatuses_load=0;
   \   00000198   205084E5           STR      R5,[R4, #+32]
    384          }
   \   0000019C   B0D08DE2           ADD      SP,SP,#+176
   \   000001A0   F080BDE8           POP      {R4-R7,PC}       ;; return
   \                     ??ProcessNextXStatImg_0:
   \   000001A4   ........           DC32     `?<Constant "\\\\">_1`
   \   000001A8   ........           DC32     XSTATUSES_PATH
   \   000001AC   ........           DC32     s_top

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable7:
   \   00000000   ........           DC32     SMILE_FILE

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable9:
   \   00000000   ........           DC32     gipc1

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable11:
   \   00000000   ........           DC32     s_top

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable14:
   \   00000000   ........           DC32     pictures_max

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable15:
   \   00000000   ........           DC32     gipc2

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable16:
   \   00000000   ........           DC32     ipc_my_name

   \                                 In segment DATA_C, align 1, align-sorted
   \                     `?<Constant "\\\\">`:
   \   00000000   5C00               DC8 "\\"

   \                                 In segment DATA_C, align 4, align-sorted
   \                     `?<Constant "\\\\">_1`:
   \   00000000   5C00               DC8 "\\"
   \   00000002   0000               DC8 0, 0
   \   00000004   25642E706E67       DC8 "%d.png"
   \              00          
   \   0000000B   00                 DC8 0

   Maximum stack usage in bytes:

     Function            CSTACK
     --------            ------
     CheckSmiles            64
     FindSmileById           0
     FindSmileByUni          0
     FreeSmiles             28
     FreeXStatusesImg       16
     InitSmiles             68
     InitXStatusesImg       12
     ProcessNextSmile      168
     ProcessNextXStatImg   196


   Segment part sizes:

     Function/Label      Bytes
     --------------      -----
     s_top                  8
     gipc1                 36
     gipc2                 40
     pictures_max           4
     FindSmileById         44
     FindSmileByUni        44
     FreeSmiles           220
     InitSmiles           232
     CheckSmiles          224
     ProcessNextSmile     844
     FreeXStatusesImg     108
     InitXStatusesImg     136
     ProcessNextXStatImg  432
     ??DataTable7           4
     ??DataTable9           4
     ??DataTable11          4
     ??DataTable14          4
     ??DataTable15          4
     ??DataTable16          4
     ?<Constant "\\">       2
     ?<Constant "\\">_1    12
      Others               48

 
 2 344 bytes in segment CODE
    14 bytes in segment DATA_C
    88 bytes in segment DATA_Z
    12 bytes in segment INITTAB
 
 2 308 bytes of CODE  memory (+ 48 bytes shared)
    14 bytes of CONST memory
    88 bytes of DATA  memory

Errors: none
Warnings: none
