##############################################################################
#                                                                            #
# IAR ARM ANSI C/C++ Compiler V4.42A/W32 EVALUATION    14/Apr/2011  09:16:48 #
# Copyright 1999-2005 IAR Systems. All rights reserved.                      #
#                                                                            #
#    Cpu mode        =  interwork                                            #
#    Endian          =  little                                               #
#    Stack alignment =  4                                                    #
#    Source file     =  D:\pasha\elf\SVN2\NATICQ1\mainmenu.c                 #
#    Command line    =  D:\pasha\elf\SVN2\NATICQ1\mainmenu.c -D NEWSGOLD -D  #
#                       ELKA --preprocess D:\pasha\elf\SVN2\NATICQ1\Release_ #
#                       ELKA\List\ -lC D:\pasha\elf\SVN2\NATICQ1\Release_ELK #
#                       A\List\ -o D:\pasha\elf\SVN2\NATICQ1\Release_ELKA\Ob #
#                       j\ -s9 --no_unroll --cpu_mode arm --endian little    #
#                       --cpu ARM926EJ-S --stack_align 4 --interwork -e      #
#                       --fpu None --dlib_config "D:\pasha\Embedded          #
#                       Workbench 4.0 Evaluation2\ARM\LIB\dl5tpainl8n.h" -I  #
#                       "D:\pasha\Embedded Workbench 4.0                     #
#                       Evaluation2\ARM\INC\" --inline_threshold=2           #
#    List file       =  D:\pasha\elf\SVN2\NATICQ1\Release_ELKA\List\mainmenu #
#                       .lst                                                 #
#    Object file     =  D:\pasha\elf\SVN2\NATICQ1\Release_ELKA\Obj\mainmenu. #
#                       r79                                                  #
#                                                                            #
#                                                                            #
##############################################################################

D:\pasha\elf\SVN2\NATICQ1\mainmenu.c
      1          #include "../inc/swilib.h"
      2          #include "../inc/cfg_items.h"
      3          #include "../inc/pnglist.h"
      4          #include "NatICQ.h"
      5          #include "history.h"
      6          #include "mainmenu.h"
      7          #include "main.h"
      8          #include "conf_loader.h"
      9          #include "status_change.h"
     10          #include "language.h"
     11          #include "revision.h"
     12          #include "manage_cl.h"
     13          #include "rect_patcher.h"
     14          #include "cl_work.h"
     15          #include "lang.h"
     16          
     17          //==============================================================================
     18          int MainMenu_ID;
     19          
     20          extern int CurrentStatus;
     21          extern int CurrentXStatus;
     22          extern DYNPNGICONLIST *XStatusesImgList;
     23          extern int *XStatusesIconArray;
     24          extern  int S_ICONS[];
     25          extern const SOFTKEYSTAB menu_skt;
     26          
     27          
     28          
     29          extern int Is_Vibra_Enabled;
     30          extern unsigned int Is_Sounds_Enabled; 
     31          extern int Is_Show_Offline;
     32          extern int Is_Show_Groups;
     33          extern int Is_SLI_On;
     34          

   \                                 In segment CODE, align 4, keep-with-next
     35          static void ChangeVibraMode(void)
     36          {
     37            Is_Vibra_Enabled=!(Is_Vibra_Enabled);
   \                     ChangeVibraMode:
   \   00000000   ........           LDR      R0,??DataTable10  ;; Is_Vibra_Enabled
   \   00000004   00402DE9           PUSH     {LR}
   \   00000008   001090E5           LDR      R1,[R0, #+0]
   \   0000000C   000051E3           CMP      R1,#+0
   \   00000010   0110A003           MOVEQ    R1,#+1
   \   00000014   0010A013           MOVNE    R1,#+0
   \   00000018   001080E5           STR      R1,[R0, #+0]
     38            SUBPROC((void*)WriteDefSettings);
   \   0000001C   ........           LDR      R0,??DataTable9  ;; WriteDefSettings
   \   00000020   710100EF           SWI      +369
     39            RefreshGUI();
   \   00000024   960100EF           SWI      +406
     40          }
   \   00000028   0080BDE8           POP      {PC}             ;; return
     41            

   \                                 In segment CODE, align 4, keep-with-next
     42          static void ChangeSoundMode(void)
     43          {
     44            Is_Sounds_Enabled=!(Is_Sounds_Enabled);
   \                     ChangeSoundMode:
   \   00000000   ........           LDR      R0,??DataTable11  ;; Is_Sounds_Enabled
   \   00000004   00402DE9           PUSH     {LR}
   \   00000008   001090E5           LDR      R1,[R0, #+0]
   \   0000000C   000051E3           CMP      R1,#+0
   \   00000010   0110A003           MOVEQ    R1,#+1
   \   00000014   0010A013           MOVNE    R1,#+0
   \   00000018   001080E5           STR      R1,[R0, #+0]
     45            SUBPROC((void*)WriteDefSettings);
   \   0000001C   ........           LDR      R0,??DataTable9  ;; WriteDefSettings
   \   00000020   710100EF           SWI      +369
     46            RefreshGUI();
   \   00000024   960100EF           SWI      +406
     47          }
   \   00000028   0080BDE8           POP      {PC}             ;; return
     48          

   \                                 In segment CODE, align 4, keep-with-next
     49          static void ChangeSLIMode()
     50          {
     51            Is_SLI_On = !Is_SLI_On;
   \                     ChangeSLIMode:
   \   00000000   ........           LDR      R0,??DataTable12  ;; Is_SLI_On
   \   00000004   00402DE9           PUSH     {LR}
   \   00000008   001090E5           LDR      R1,[R0, #+0]
   \   0000000C   000051E3           CMP      R1,#+0
   \   00000010   0110A003           MOVEQ    R1,#+1
   \   00000014   0010A013           MOVNE    R1,#+0
   \   00000018   001080E5           STR      R1,[R0, #+0]
     52            SUBPROC((void*)WriteDefSettings);
   \   0000001C   ........           LDR      R0,??DataTable9  ;; WriteDefSettings
   \   00000020   710100EF           SWI      +369
     53            RefreshGUI();
   \   00000024   960100EF           SWI      +406
     54          }
   \   00000028   0080BDE8           POP      {PC}             ;; return
     55          

   \                                 In segment CODE, align 4, keep-with-next
     56          static void ChangeShowOfflineMode(void)
     57          {
     58            void RecountMenu(CLIST *req, int needfocus);
     59            Is_Show_Offline=!(Is_Show_Offline);
   \                     ChangeShowOfflineMode:
   \   00000000   ........           LDR      R0,??DataTable13  ;; Is_Show_Offline
   \   00000004   00402DE9           PUSH     {LR}
   \   00000008   001090E5           LDR      R1,[R0, #+0]
   \   0000000C   000051E3           CMP      R1,#+0
   \   00000010   0110A003           MOVEQ    R1,#+1
   \   00000014   0010A013           MOVNE    R1,#+0
   \   00000018   001080E5           STR      R1,[R0, #+0]
     60            SUBPROC((void*)WriteDefSettings);
   \   0000001C   ........           LDR      R0,??DataTable9  ;; WriteDefSettings
   \   00000020   710100EF           SWI      +369
     61            RecountMenu(NULL, 1);
   \   00000024   0110A0E3           MOV      R1,#+1
   \   00000028   0000A0E3           MOV      R0,#+0
   \   0000002C   ........           _BLF     RecountMenu,??RecountMenu??rA
     62            RefreshGUI();
   \   00000030   960100EF           SWI      +406
     63          }
   \   00000034   0080BDE8           POP      {PC}             ;; return
     64          

   \                                 In segment CODE, align 4, keep-with-next
     65          static void ChangeShowGroupsMode(void)
     66          {
     67            void RecountMenu(CLIST *req, int needfocus);
     68            Is_Show_Groups=!(Is_Show_Groups);
   \                     ChangeShowGroupsMode:
   \   00000000   ........           LDR      R0,??DataTable14  ;; Is_Show_Groups
   \   00000004   00402DE9           PUSH     {LR}
   \   00000008   001090E5           LDR      R1,[R0, #+0]
   \   0000000C   000051E3           CMP      R1,#+0
   \   00000010   0110A003           MOVEQ    R1,#+1
   \   00000014   0010A013           MOVNE    R1,#+0
   \   00000018   001080E5           STR      R1,[R0, #+0]
     69            SUBPROC((void*)WriteDefSettings);
   \   0000001C   ........           LDR      R0,??DataTable9  ;; WriteDefSettings
   \   00000020   710100EF           SWI      +369
     70            ResortCL();
   \   00000024   ........           _BLF     ResortCL,??ResortCL??rA
     71            RecountMenu(NULL, 1);
   \   00000028   0110A0E3           MOV      R1,#+1
   \   0000002C   0000A0E3           MOV      R0,#+0
   \   00000030   ........           _BLF     RecountMenu,??RecountMenu??rA
     72            RefreshGUI();
   \   00000034   960100EF           SWI      +406
     73          }
   \   00000038   0080BDE8           POP      {PC}             ;; return
     74          

   \                                 In segment CODE, align 4, keep-with-next
     75          static void EditConfig(void)
     76          {
   \                     EditConfig:
   \   00000000   10402DE9           PUSH     {R4,LR}
     77            extern const char *successed_config_filename;
     78            WSHDR *ws;
     79            ws=AllocWS(150);
   \   00000004   9600A0E3           MOV      R0,#+150
   \   00000008   250100EF           SWI      +293
   \   0000000C   0040A0E1           MOV      R4,R0
     80            str_2ws(ws,successed_config_filename,128);
   \   00000010   30009FE5           LDR      R0,??EditConfig_0  ;; successed_config_filename
   \   00000014   8020A0E3           MOV      R2,#+128
   \   00000018   001090E5           LDR      R1,[R0, #+0]
   \   0000001C   0400A0E1           MOV      R0,R4
   \   00000020   6C0100EF           SWI      +364
     81            ExecuteFile(ws,0,0);
   \   00000024   0020A0E3           MOV      R2,#+0
   \   00000028   0010A0E3           MOV      R1,#+0
   \   0000002C   0400A0E1           MOV      R0,R4
   \   00000030   940000EF           SWI      +148
     82            FreeWS(ws);
   \   00000034   0400A0E1           MOV      R0,R4
   \   00000038   290100EF           SWI      +297
     83            GeneralFuncF1(1);
   \   0000003C   0100A0E3           MOV      R0,#+1
   \   00000040   3B0100EF           SWI      +315
     84          }
   \   00000044   1080BDE8           POP      {R4,PC}          ;; return
   \                     ??EditConfig_0:
   \   00000048   ........           DC32     successed_config_filename
     85          

   \                                 In segment CODE, align 4, keep-with-next
     86          static void Disconnect(void)
     87          {
     88            extern volatile int disautorecconect;
     89            disautorecconect=1;
   \                     Disconnect:
   \   00000000   1C009FE5           LDR      R0,??Disconnect_0  ;; disautorecconect
   \   00000004   00402DE9           PUSH     {LR}
   \   00000008   0110A0E3           MOV      R1,#+1
   \   0000000C   001080E5           STR      R1,[R0, #+0]
     90            extern void end_socket(void);
     91            SUBPROC((void*)end_socket);
   \   00000010   10009FE5           LDR      R0,??Disconnect_0+0x4  ;; end_socket
   \   00000014   710100EF           SWI      +369
     92            GeneralFuncF1(1);
   \   00000018   0100A0E3           MOV      R0,#+1
   \   0000001C   3B0100EF           SWI      +315
     93          }
   \   00000020   0080BDE8           POP      {PC}             ;; return
   \                     ??Disconnect_0:
   \   00000024   ........           DC32     disautorecconect
   \   00000028   ........           DC32     end_socket
     94          

   \                                 In segment CODE, align 4, keep-with-next
     95          static void PingToServer(void)
     96          {
   \                     PingToServer:
   \   00000000   10402DE9           PUSH     {R4,LR}
     97            TPKT *p;
     98            p=malloc(sizeof(PKT)+sizeof(TTime));
   \   00000004   1000A0E3           MOV      R0,#+16
   \   00000008   140000EF           SWI      +20
   \   0000000C   0040A0E1           MOV      R4,R0
     99            GetDateTime(NULL,(TTime *)p->data);
   \   00000010   081084E2           ADD      R1,R4,#+8
   \   00000014   0000A0E3           MOV      R0,#+0
   \   00000018   B40000EF           SWI      +180
    100            p->pkt.uin=0;
   \   0000001C   0000A0E3           MOV      R0,#+0
   \   00000020   000084E5           STR      R0,[R4, #+0]
    101            p->pkt.type=T_ECHO;
   \   00000024   1200A0E3           MOV      R0,#+18
   \   00000028   B400C4E1           STRH     R0,[R4, #+4]
    102            p->pkt.data_len=sizeof(TTime);
   \   0000002C   0800A0E3           MOV      R0,#+8
   \   00000030   B600C4E1           STRH     R0,[R4, #+6]
    103            SUBPROC((void *)SendAnswer,0,p);
   \   00000034   0C009FE5           LDR      R0,??PingToServer_0  ;; SendAnswer
   \   00000038   0420A0E1           MOV      R2,R4
   \   0000003C   0010A0E3           MOV      R1,#+0
   \   00000040   710100EF           SWI      +369
    104          }
   \   00000044   1080BDE8           POP      {R4,PC}          ;; return
   \                     ??PingToServer_0:
   \   00000048   ........           DC32     SendAnswer
    105          

   \                                 In segment CODE, align 4, keep-with-next
    106          static void AboutDlg()
    107          {
    108            char s[256];
    109            snprintf(s,255,LG_COPYRIGHT,__SVN_REVISION__);
   \                     AboutDlg:
   \   00000000   2C209FE5           LDR      R2,??AboutDlg_0  ;; `?<Constant "NATICQ v2.0\\nRevision ...">`
   \   00000004   00402DE9           PUSH     {LR}
   \   00000008   40DF4DE2           SUB      SP,SP,#+256
   \   0000000C   0330A0E3           MOV      R3,#+3
   \   00000010   703E83E3           ORR      R3,R3,#0x700
   \   00000014   FF10A0E3           MOV      R1,#+255
   \   00000018   0D00A0E1           MOV      R0,SP
   \   0000001C   1B0100EF           SWI      +283
    110            ShowMSG(2, (int)s);
   \   00000020   0D10A0E1           MOV      R1,SP
   \   00000024   0200A0E3           MOV      R0,#+2
   \   00000028   480100EF           SWI      +328
    111          }
   \   0000002C   40DF8DE2           ADD      SP,SP,#+256
   \   00000030   0080BDE8           POP      {PC}             ;; return
   \                     ??AboutDlg_0:
   \   00000034   ........           DC32     `?<Constant "NATICQ v2.0\\nRevision ...">`
    112          
    113          #ifdef ELKA
    114            #define MENU_ITEMS 12
    115          #else
    116            #define MENU_ITEMS 11
    117          #endif
    118          
    119          static HEADER_DESC menuhdr={0,0,0,0,NULL,NULL,LGP_NULL};
    120          

   \                                 In segment DATA_C, align 4, align-sorted
    121          static const int mmenusoftkeys[]={0,1,2};
   \                     mmenusoftkeys:
   \   00000000   000000000100       DC32 0, 1, 2
   \              000002000000
    122          
    123          static char * menutexts[MENU_ITEMS]=
    124          {
    125            NULL,
    126            NULL,
    127            NULL,
    128            NULL,
    129            NULL,
    130            NULL,
    131            NULL,
    132            NULL,
    133            NULL,
    134            NULL,
    135            NULL,
    136            NULL
    137          };
    138          
    139          /*MENUITEM_DESC menuitems[7]=
    140          {
    141            {S_ICONS,    (int)LG_MNUSTATUS,  LGP_NULL,0,NULL,MENU_FLAG3,MENU_FLAG2},
    142            {NULL,       (int)LG_MNUADDCONT, LGP_NULL,0,NULL,MENU_FLAG3,MENU_FLAG2},
    143            {icon_array, (int)LG_MNUVIBRA,   LGP_NULL,0,NULL,MENU_FLAG3,MENU_FLAG2},
    144            {icon_array, (int)LG_MNUSOUND,   LGP_NULL,0,NULL,MENU_FLAG3,MENU_FLAG2},
    145            {NULL,       (int)LG_MNUEDCFG,   LGP_NULL,0,NULL,MENU_FLAG3,MENU_FLAG2},
    146            {NULL,       (int)LG_MNUPING ,   LGP_NULL,0,NULL,MENU_FLAG3,MENU_FLAG2},
    147            {S_ICONS,    (int)LG_MNUABOUT,   LGP_NULL,0,NULL,MENU_FLAG3,MENU_FLAG2},
    148          };*/
    149          
    150          static const void *menuprocs[MENU_ITEMS]=
    151          {
    152            (void *)DispStatusChangeMenu,
    153            (void *)DispXStatusChangeMenu,
    154            (void *)CreateManageCLMenu,
    155            (void *)ChangeVibraMode,
    156            (void *)ChangeSoundMode,
    157            (void *)ChangeSLIMode,
    158            (void *)ChangeShowOfflineMode,
    159            (void *)ChangeShowGroupsMode,
    160            (void *)EditConfig,
    161            (void *)Disconnect,
    162            (void *)PingToServer,
    163            (void *)AboutDlg,
    164          };
    165          
    166          static SOFTKEY_DESC mmenu_sk[]=
    167          {
    168            {0x0018,0x0000,NULL},
    169            {0x0001,0x0000,NULL},
    170            {0x003D,0x0000,(int)LGP_DOIT_PIC}
    171          };
    172          
    173          static SOFTKEYSTAB mmenu_skt=
    174          {
    175            mmenu_sk,0
    176          };
    177          

   \                                 In segment CODE, align 4, keep-with-next
    178          void tmenu_ghook(void *data, int cmd)
    179          {
   \                     tmenu_ghook:
   \   00000000   10402DE9           PUSH     {R4,LR}
   \   00000004   0140A0E1           MOV      R4,R1
    180            PNGTOP_DESC *pltop=PNG_TOP();
   \   00000008   B98100EF           SWI      +33209
    181            if (cmd==9)
   \   0000000C   090054E3           CMP      R4,#+9
    182            {
    183              pltop->dyn_pltop=NULL;
   \   00000010   0010A003           MOVEQ    R1,#+0
   \   00000014   08108005           STREQ    R1,[R0, #+8]
   \   00000018   1080BD08           POPEQ    {R4,PC}
    184            }
    185            if (cmd==0x0A)
   \   0000001C   0A0054E3           CMP      R4,#+10
   \   00000020   1080BD18           POPNE    {R4,PC}
    186            {
    187              pltop->dyn_pltop=XStatusesImgList;
   \   00000024   0C109FE5           LDR      R1,??tmenu_ghook_0  ;; XStatusesImgList
   \   00000028   001091E5           LDR      R1,[R1, #+0]
   \   0000002C   081080E5           STR      R1,[R0, #+8]
    188              DisableIDLETMR();
   \   00000030   7F0100EF           SWI      +383
    189            }
    190          }
   \   00000034   1080BDE8           POP      {R4,PC}          ;; return
   \                     ??tmenu_ghook_0:
   \   00000038   ........           DC32     XStatusesImgList

   \                                 In segment DATA_I, align 4, align-sorted
   \                     menuhdr:
   \   00000000                      DS8 20
   \   00000014                      REQUIRE `?<Initializer for menuhdr>`
   \   00000014                      DS8 48
   \   00000044                      REQUIRE `?<Initializer for menutexts>`
   \                     mmenu_sk:
   \   00000044                      DS8 24
   \   0000005C                      REQUIRE `?<Initializer for mmenu_sk>`
   \   0000005C                      DS8 8
   \   00000064                      REQUIRE `?<Initializer for icon_array>`
   \                     MainMenu_ID:
   \   00000064                      DS8 4
   \   00000068                      REQUIRE `?<Initializer for MainMenu_ID>`

   \                                 In segment DATA_I, align 4, align-sorted
   \                     menuprocs:
   \   00000000                      DS8 48
   \   00000030                      REQUIRE `?<Initializer for menuprocs>`

   \                                 In segment DATA_I, align 4, align-sorted
   \                     mmenu_skt:
   \   00000000                      DS8 8
   \   00000008                      REQUIRE `?<Initializer for mmenu_skt>`
    191          
    192          static int icon_array[2];
    193          

   \                                 In segment CODE, align 4, keep-with-next
    194          static void menuitemhandler(void *data, int curitem, void *unk)
    195          {
   \                     menuitemhandler:
   \   00000000   F0432DE9           PUSH     {R4-R9,LR}
    196            WSHDR *ws;
    197            void *item=AllocMenuItem(data);
    198            extern const char percent_t[];
    199            ws=AllocMenuWS(data,strlen(menutexts[curitem]));
   \   00000004   1C819FE5           LDR      R8,??menuitemhandler_1  ;; menuhdr
   \   00000008   0040A0E1           MOV      R4,R0
   \   0000000C   0150A0E1           MOV      R5,R1
   \   00000010   970100EF           SWI      +407
   \   00000014   0060A0E1           MOV      R6,R0
   \   00000018   059188E0           ADD      R9,R8,R5, LSL #+2
   \   0000001C   140099E5           LDR      R0,[R9, #+20]
   \   00000020   1B0000EF           SWI      +27
   \   00000024   0010A0E1           MOV      R1,R0
   \   00000028   0400A0E1           MOV      R0,R4
   \   0000002C   980100EF           SWI      +408
    200            wsprintf(ws,percent_t,menutexts[curitem]);
   \   00000030   142099E5           LDR      R2,[R9, #+20]
   \   00000034   F0109FE5           LDR      R1,??menuitemhandler_1+0x4  ;; percent_t
   \   00000038   0070A0E1           MOV      R7,R0
   \   0000003C   240100EF           SWI      +292
    201            switch(curitem)
   \   00000040   E8209FE5           LDR      R2,??menuitemhandler_1+0x8  ;; S_ICONS
   \   00000044   0500A0E1           MOV      R0,R5
   \   00000048   0B0050E3           CMP      R0,#+11
   \   0000004C   2F00008A           BHI      ??menuitemhandler_2
   \   00000050   011F8FE2           ADR      R1,??menuitemhandler_0
   \   00000054   0010D1E7           LDRB     R1,[R1, R0]
   \   00000058   01F18FE0           ADD      PC,PC,R1, LSL #+2
   \                     ??menuitemhandler_0:
   \   0000005C   02060C0E           DC8      +2,+6,+12,+14
   \   00000060   16182022           DC8      +22,+24,+32,+34
   \   00000064   24292628           DC8      +36,+41,+38,+40
    202            {
    203            case 0:
    204              SetMenuItemIconArray(data,item,S_ICONS+CurrentStatus);
   \                     ??menuitemhandler_3:
   \   00000068   C4009FE5           LDR      R0,??menuitemhandler_1+0xC  ;; CurrentStatus
   \   0000006C   000090E5           LDR      R0,[R0, #+0]
   \   00000070   002182E0           ADD      R2,R2,R0, LSL #+2
   \   00000074   220000EA           B        ??menuitemhandler_4
    205              break;
    206            case 1:
    207              SetMenuItemIconArray(data,item,XStatusesIconArray+CurrentXStatus);
   \                     ??menuitemhandler_5:
   \   00000078   B8009FE5           LDR      R0,??menuitemhandler_1+0x10  ;; CurrentXStatus
   \   0000007C   B8109FE5           LDR      R1,??menuitemhandler_1+0x14  ;; XStatusesIconArray
   \   00000080   000090E5           LDR      R0,[R0, #+0]
   \   00000084   001091E5           LDR      R1,[R1, #+0]
   \   00000088   002181E0           ADD      R2,R1,R0, LSL #+2
   \   0000008C   1C0000EA           B        ??menuitemhandler_4
    208              break;
    209            case 2:
    210              SetMenuItemIconArray(data,item,S_ICONS+ICON_ADDCONTACT);
   \                     ??menuitemhandler_6:
   \   00000090   482082E2           ADD      R2,R2,#+72
   \   00000094   1A0000EA           B        ??menuitemhandler_4
    211              break;
    212            case 3:
    213              SetMenuItemIconArray(data,item,icon_array+(Is_Vibra_Enabled?0:1));
   \                     ??menuitemhandler_7:
   \   00000098   ........           LDR      R0,??DataTable10  ;; Is_Vibra_Enabled
   \                     ??menuitemhandler_8:
   \   0000009C   000090E5           LDR      R0,[R0, #+0]
   \   000000A0   000050E3           CMP      R0,#+0
   \   000000A4   0000A013           MOVNE    R0,#+0
   \   000000A8   0100A003           MOVEQ    R0,#+1
   \   000000AC   000188E0           ADD      R0,R8,R0, LSL #+2
   \   000000B0   5C2080E2           ADD      R2,R0,#+92
   \   000000B4   120000EA           B        ??menuitemhandler_4
    214              break;
    215            case 4:
    216              SetMenuItemIconArray(data,item,icon_array+(Is_Sounds_Enabled?0:1));
   \                     ??menuitemhandler_9:
   \   000000B8   ........           LDR      R0,??DataTable11  ;; Is_Sounds_Enabled
   \   000000BC   F6FFFFEA           B        ??menuitemhandler_8
    217              break;
    218          #ifdef ELKA
    219            case 5:
    220              SetMenuItemIconArray(data,item,icon_array+(Is_SLI_On?0:1));
   \                     ??menuitemhandler_10:
   \   000000C0   ........           LDR      R0,??DataTable12  ;; Is_SLI_On
   \                     ??menuitemhandler_11:
   \   000000C4   000090E5           LDR      R0,[R0, #+0]
   \   000000C8   000050E3           CMP      R0,#+0
   \   000000CC   0000A013           MOVNE    R0,#+0
   \   000000D0   0100A003           MOVEQ    R0,#+1
   \   000000D4   000188E0           ADD      R0,R8,R0, LSL #+2
   \   000000D8   5C2080E2           ADD      R2,R0,#+92
   \   000000DC   080000EA           B        ??menuitemhandler_4
    221              break;
    222            case 6:
    223              SetMenuItemIconArray(data,item,icon_array+(Is_Show_Offline?0:1));
   \                     ??menuitemhandler_12:
   \   000000E0   ........           LDR      R0,??DataTable13  ;; Is_Show_Offline
   \   000000E4   ECFFFFEA           B        ??menuitemhandler_8
    224              break;
    225            case 7:
    226              SetMenuItemIconArray(data,item,icon_array+(Is_Show_Groups?0:1));
   \                     ??menuitemhandler_13:
   \   000000E8   ........           LDR      R0,??DataTable14  ;; Is_Show_Groups
   \   000000EC   F4FFFFEA           B        ??menuitemhandler_11
    227              break;    
    228            case 8:
    229              SetMenuItemIconArray(data,item,S_ICONS+ICON_SETTINGS);
   \                     ??menuitemhandler_14:
   \   000000F0   582082E2           ADD      R2,R2,#+88
   \   000000F4   020000EA           B        ??menuitemhandler_4
    230              break;
    231            case 9:
    232              SetMenuItemIconArray(data,item,S_ICONS+IS_OFFLINE);
    233              break;
    234            case 10:
    235              SetMenuItemIconArray(data,item,S_ICONS+ICON_PING);
   \                     ??menuitemhandler_15:
   \   000000F8   542082E2           ADD      R2,R2,#+84
   \   000000FC   000000EA           B        ??menuitemhandler_4
    236              break;
    237            case 11:
    238              SetMenuItemIconArray(data,item,S_ICONS+IS_UNKNOWN);
   \                     ??menuitemhandler_16:
   \   00000100   382082E2           ADD      R2,R2,#+56
   \                     ??menuitemhandler_4:
   \   00000104   0610A0E1           MOV      R1,R6
   \   00000108   0400A0E1           MOV      R0,R4
   \   0000010C   990100EF           SWI      +409
    239              break;
    240          #else
    241            case 5:
    242              SetMenuItemIconArray(data,item,icon_array+(Is_Show_Offline?0:1));
    243              break;
    244            case 6:
    245              SetMenuItemIconArray(data,item,icon_array+(Is_Show_Groups?0:1));
    246              break;    
    247            case 7:
    248              SetMenuItemIconArray(data,item,S_ICONS+ICON_SETTINGS);
    249              break;
    250            case 8:
    251              SetMenuItemIconArray(data,item,S_ICONS+IS_OFFLINE);
    252              break;
    253            case 9:
    254              SetMenuItemIconArray(data,item,S_ICONS+ICON_PING);
    255              break;
    256            case 10:
    257              SetMenuItemIconArray(data,item,S_ICONS+IS_UNKNOWN);
    258              break;
    259          #endif
    260            }
    261            SetMenuItemText(data, item, ws, curitem);
   \                     ??menuitemhandler_2:
   \   00000110   0530A0E1           MOV      R3,R5
   \   00000114   0720A0E1           MOV      R2,R7
   \   00000118   0610A0E1           MOV      R1,R6
   \   0000011C   0400A0E1           MOV      R0,R4
   \   00000120   9A0100EF           SWI      +410
    262          }
   \   00000124   F083BDE8           POP      {R4-R9,PC}       ;; return
   \                     ??menuitemhandler_1:
   \   00000128   ........           DC32     menuhdr
   \   0000012C   ........           DC32     percent_t
   \   00000130   ........           DC32     S_ICONS
   \   00000134   ........           DC32     CurrentStatus
   \   00000138   ........           DC32     CurrentXStatus
   \   0000013C   ........           DC32     XStatusesIconArray
    263          

   \                                 In segment CODE, align 4, keep-with-next
    264          static int tmenu_keyhook(void *data, GUI_MSG *msg)
    265          {
   \                     tmenu_keyhook:
   \   00000000   00402DE9           PUSH     {LR}
    266            if ((msg->keys==0x18)||(msg->keys==0x3D))
   \   00000004   F210D1E1           LDRSH    R1,[R1, #+2]
   \   00000008   180051E3           CMP      R1,#+24
   \   0000000C   3D005113           CMPNE    R1,#+61
   \   00000010   0300001A           BNE      ??tmenu_keyhook_0
    267            {
    268              ((void (*)(void))(menuprocs[GetCurMenuItem(data)]))();
   \   00000014   8F0100EF           SWI      +399
   \   00000018   0C109FE5           LDR      R1,??tmenu_keyhook_1  ;; menuprocs
   \   0000001C   000191E7           LDR      R0,[R1, +R0, LSL #+2]
   \   00000020   30FF2FE1           BLX      R0
    269            }
    270            return(0);
   \                     ??tmenu_keyhook_0:
   \   00000024   0000A0E3           MOV      R0,#+0
   \   00000028   0080BDE8           POP      {PC}             ;; return
   \                     ??tmenu_keyhook_1:
   \   0000002C   ........           DC32     menuprocs
    271          }
    272          
    273          

   \                                 In segment DATA_C, align 4, align-sorted
    274          static const MENU_DESC tmenu=
   \                     tmenu:
   \   00000000   08000000....       DC32 8, tmenu_keyhook, tmenu_ghook, 0H, mmenusoftkeys, mmenu_skt, 17
   \              ............
   \              00000000....
   \              ............
   \              11000000    
   \   0000001C   ........0000       DC32 menuitemhandler, 0H, 0H, 12
   \              000000000000
   \              0C000000    
    275          {
    276            8,tmenu_keyhook,tmenu_ghook,NULL,
    277            mmenusoftkeys,
    278            &mmenu_skt,
    279            0x11,//MENU_FLAG,
    280            menuitemhandler,
    281            NULL,//menuitems,
    282            NULL,//menuprocs,
    283            MENU_ITEMS
    284          };
    285          

   \                                 In segment CODE, align 4, keep-with-next
    286          void ShowMainMenu()
    287          {
   \                     ShowMainMenu:
   \   00000000   10402DE9           PUSH     {R4,LR}
    288            icon_array[0]=GetPicNByUnicodeSymbol(CBOX_CHECKED);
   \   00000004   FC409FE5           LDR      R4,??ShowMainMenu_0  ;; menuhdr
   \   00000008   1600A0E3           MOV      R0,#+22
   \   0000000C   E10C80E3           ORR      R0,R0,#0xE100
   \   00000010   E40100EF           SWI      +484
   \   00000014   5C0084E5           STR      R0,[R4, #+92]
    289            icon_array[1]=GetPicNByUnicodeSymbol(CBOX_UNCHECKED);
   \   00000018   1700A0E3           MOV      R0,#+23
   \   0000001C   E10C80E3           ORR      R0,R0,#0xE100
   \   00000020   E40100EF           SWI      +484
   \   00000024   600084E5           STR      R0,[R4, #+96]
    290          
    291            //Инициализация ленгпака
    292            menuhdr.lgp_id=(int)lgpData[LGP_Menu];
   \   00000028   DC009FE5           LDR      R0,??ShowMainMenu_0+0x4  ;; lgpData
   \   0000002C   181090E5           LDR      R1,[R0, #+24]
   \   00000030   0C1084E5           STR      R1,[R4, #+12]
    293            
    294            mmenu_sk[0].lgp_id=(int)lgpData[LGP_Select];
   \   00000034   301090E5           LDR      R1,[R0, #+48]
   \   00000038   481084E5           STR      R1,[R4, #+72]
    295            mmenu_sk[1].lgp_id=(int)lgpData[LGP_Back];
   \   0000003C   381090E5           LDR      R1,[R0, #+56]
   \   00000040   501084E5           STR      R1,[R4, #+80]
    296            
    297            int i = 0;
    298            menutexts[i++]=(char *)lgpData[LGP_MnuStatus];
   \   00000044   5C1090E5           LDR      R1,[R0, #+92]
   \   00000048   141084E5           STR      R1,[R4, #+20]
    299            menutexts[i++]=(char *)lgpData[LGP_MnuXStatus];
   \   0000004C   601090E5           LDR      R1,[R0, #+96]
   \   00000050   181084E5           STR      R1,[R4, #+24]
    300            menutexts[i++]=(char *)lgpData[LGP_ManageList];
   \   00000054   141190E5           LDR      R1,[R0, #+276]
   \   00000058   1C1084E5           STR      R1,[R4, #+28]
    301            menutexts[i++]=(char *)lgpData[LGP_MnuVibra];
   \   0000005C   681090E5           LDR      R1,[R0, #+104]
   \   00000060   201084E5           STR      R1,[R4, #+32]
    302            menutexts[i++]=(char *)lgpData[LGP_MnuSound];
   \   00000064   6C1090E5           LDR      R1,[R0, #+108]
   \   00000068   241084E5           STR      R1,[R4, #+36]
    303          #ifdef ELKA
    304            menutexts[i++]=(char *)lgpData[LGP_MnuSli];
   \   0000006C   701090E5           LDR      R1,[R0, #+112]
   \   00000070   281084E5           STR      R1,[R4, #+40]
    305          #endif
    306            menutexts[i++]=(char *)lgpData[LGP_MnuShowOff];
   \   00000074   741090E5           LDR      R1,[R0, #+116]
   \   00000078   2C1084E5           STR      R1,[R4, #+44]
    307            menutexts[i++]=(char *)lgpData[LGP_MnuShowGroup];
   \   0000007C   781090E5           LDR      R1,[R0, #+120]
   \   00000080   301084E5           STR      R1,[R4, #+48]
    308            menutexts[i++]=(char *)lgpData[LGP_MnuEdCfg];
   \   00000084   7C1090E5           LDR      R1,[R0, #+124]
   \   00000088   341084E5           STR      R1,[R4, #+52]
    309            menutexts[i++]=(char *)lgpData[LGP_MnuDisconnect];
   \   0000008C   801090E5           LDR      R1,[R0, #+128]
   \   00000090   381084E5           STR      R1,[R4, #+56]
    310            menutexts[i++]=(char *)lgpData[LGP_MnuPing];
   \   00000094   841090E5           LDR      R1,[R0, #+132]
    311            menutexts[i++]=(char *)lgpData[LGP_MnuAbout];
   \   00000098   880090E5           LDR      R0,[R0, #+136]
   \   0000009C   3C1084E5           STR      R1,[R4, #+60]
   \   000000A0   400084E5           STR      R0,[R4, #+64]
    312            
    313            *((int **)(&menuhdr.icon))=S_ICONS+IS_ONLINE;
   \   000000A4   64009FE5           LDR      R0,??ShowMainMenu_0+0x8  ;; S_ICONS + 44
   \   000000A8   080084E5           STR      R0,[R4, #+8]
    314            patch_header(&menuhdr);
   \   000000AC   0000A0E3           MOV      R0,#+0
   \   000000B0   B000C4E1           STRH     R0,[R4, #+0]
   \   000000B4   1800A0E3           MOV      R0,#+24
   \   000000B8   B200C4E1           STRH     R0,[R4, #+2]
   \   000000BC   888100EF           SWI      +33160
   \   000000C0   010040E2           SUB      R0,R0,#+1
   \   000000C4   B400C4E1           STRH     R0,[R4, #+4]
   \   000000C8   8A8100EF           SWI      +33162
    315            MainMenu_ID=CreateMenu(0,0,&tmenu,&menuhdr,0,MENU_ITEMS,0,0);
   \   000000CC   40209FE5           LDR      R2,??ShowMainMenu_0+0xC  ;; tmenu
   \   000000D0   170080E2           ADD      R0,R0,#+23
   \   000000D4   B600C4E1           STRH     R0,[R4, #+6]
   \   000000D8   0000A0E3           MOV      R0,#+0
   \   000000DC   01002DE9           PUSH     {R0}
   \   000000E0   01002DE9           PUSH     {R0}
   \   000000E4   0430A0E1           MOV      R3,R4
   \   000000E8   0010A0E3           MOV      R1,#+0
   \   000000EC   0C00A0E3           MOV      R0,#+12
   \   000000F0   01002DE9           PUSH     {R0}
   \   000000F4   0000A0E3           MOV      R0,#+0
   \   000000F8   01002DE9           PUSH     {R0}
   \   000000FC   520100EF           SWI      +338
   \   00000100   640084E5           STR      R0,[R4, #+100]
    316          }
   \   00000104   1F80BDE8           POP      {R0-R4,PC}       ;; return
   \                     ??ShowMainMenu_0:
   \   00000108   ........           DC32     menuhdr
   \   0000010C   ........           DC32     lgpData
   \   00000110   ........           DC32     S_ICONS + 44
   \   00000114   ........           DC32     tmenu

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable9:
   \   00000000   ........           DC32     WriteDefSettings

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable10:
   \   00000000   ........           DC32     Is_Vibra_Enabled

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable11:
   \   00000000   ........           DC32     Is_Sounds_Enabled

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable12:
   \   00000000   ........           DC32     Is_SLI_On

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable13:
   \   00000000   ........           DC32     Is_Show_Offline

   \                                 In segment CODE, align 4, keep-with-next
   \                     ??DataTable14:
   \   00000000   ........           DC32     Is_Show_Groups

   \                                 In segment DATA_ID, align 4, align-sorted
   \                     `?<Initializer for menuhdr>`:
   \   00000000   000000000000       DC16 0, 0, 0, 0
   \              0000        
   \   00000008   000000000000       DC32 0H, 0, 2147483647
   \              0000FFFFFF7F
   \                     `?<Initializer for menutexts>`:
   \   00000014   000000000000       DC32 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H, 0H
   \              000000000000
   \              000000000000
   \              000000000000
   \              000000000000
   \              000000000000
   \              000000000000
   \              000000000000
   \                     `?<Initializer for mmenu_sk>`:
   \   00000044   18000000           DC16 24, 0
   \   00000048   00000000           DC32 0
   \   0000004C   01000000           DC16 1, 0
   \   00000050   00000000           DC32 0
   \   00000054   3D000000           DC16 61, 0
   \   00000058   FBC0FF7F           DC32 2147467515
   \                     `?<Initializer for icon_array>`:
   \   0000005C   000000000000       DC8 0, 0, 0, 0, 0, 0, 0, 0
   \              0000        
   \                     `?<Initializer for MainMenu_ID>`:
   \   00000064   00000000           DC8 0, 0, 0, 0

   \                                 In segment DATA_ID, align 4, align-sorted
   \                     `?<Initializer for menuprocs>`:
   \   00000000   ............       DC32 DispStatusChangeMenu, DispXStatusChangeMenu, CreateManageCLMenu
   \              ............
   \   0000000C   ............       DC32 ChangeVibraMode, ChangeSoundMode, ChangeSLIMode
   \              ............
   \   00000018   ............       DC32 ChangeShowOfflineMode, ChangeShowGroupsMode, EditConfig
   \              ............
   \   00000024   ............       DC32 Disconnect, PingToServer, AboutDlg
   \              ............

   \                                 In segment DATA_ID, align 4, align-sorted
   \                     `?<Initializer for mmenu_skt>`:
   \   00000000   ........0000       DC32 mmenu_sk, 0
   \              0000        

   \                                 In segment DATA_C, align 4, align-sorted
   \                     `?<Constant "NATICQ v2.0\\nRevision ...">`:
   \   00000000   4E4154494351       DC8 4EH, 41H, 54H, 49H, 43H, 51H, 20H, 76H
   \              2076        
   \   00000008   322E300A5265       DC8 32H, 2EH, 30H, 0AH, 52H, 65H, 76H, 69H
   \              7669        
   \   00000010   73696F6E2025       DC8 73H, 69H, 6FH, 6EH, 20H, 25H, 64H, 0AH
   \              640A        
   \   00000018   284329206279       DC8 28H, 43H, 29H, 20H, 62H, 79H, 20H, 52H
   \              2052        
   \   00000020   7374372F4342       DC8 73H, 74H, 37H, 2FH, 43H, 42H, 53H, 49H
   \              5349        
   \   00000028   450A4B72656E       DC8 45H, 0AH, 4BH, 72H, 65H, 6EH, 0AH, 4BH
   \              0A4B        
   \   00000030   696261620A53       DC8 69H, 62H, 61H, 62H, 0AH, 53H, 68H, 61H
   \              6861        
   \   00000038   646F770A5365       DC8 64H, 6FH, 77H, 0AH, 53H, 65H, 6BH, 6CH
   \              6B6C        
   \   00000040   746800             DC8 74H, 68H, 0
   \   00000043   00                 DC8 0

   Maximum stack usage in bytes:

     Function              CSTACK
     --------              ------
     AboutDlg                260
     ChangeSLIMode             4
     ChangeShowGroupsMode      4
     ChangeShowOfflineMode     4
     ChangeSoundMode           4
     ChangeVibraMode           4
     Disconnect                4
     EditConfig                8
     PingToServer              8
     ShowMainMenu             24
     menuitemhandler          28
     tmenu_ghook               8
     tmenu_keyhook             4


   Segment part sizes:

     Function/Label                 Bytes
     --------------                 -----
     ChangeVibraMode                  44
     ChangeSoundMode                  44
     ChangeSLIMode                    44
     ChangeShowOfflineMode            56
     ChangeShowGroupsMode             60
     EditConfig                       76
     Disconnect                       44
     PingToServer                     76
     AboutDlg                         56
     mmenusoftkeys                    12
     tmenu_ghook                      60
     menuhdr                         104
     menuprocs                        48
     mmenu_skt                         8
     menuitemhandler                 320
     tmenu_keyhook                    48
     tmenu                            44
     ShowMainMenu                    280
     ??DataTable9                      4
     ??DataTable10                     4
     ??DataTable11                     4
     ??DataTable12                     4
     ??DataTable13                     4
     ??DataTable14                     4
     ?<Initializer for menuhdr>      104
     ?<Initializer for menuprocs>     48
     ?<Initializer for mmenu_skt>      8
     ?<Constant "NATICQ v2.0\nRevision ...">
                                      68
      Others                          88

 
 1 308 bytes in segment CODE
   124 bytes in segment DATA_C
   160 bytes in segment DATA_I
   160 bytes in segment DATA_ID
    12 bytes in segment INITTAB
 
 1 232 bytes of CODE  memory (+ 88 bytes shared)
   284 bytes of CONST memory
   160 bytes of DATA  memory

Errors: none
Warnings: none
